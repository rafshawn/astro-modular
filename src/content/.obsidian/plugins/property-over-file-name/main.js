/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __esm = (fn, res) => function __init() {
  return fn && (res = (0, fn[__getOwnPropNames(fn)[0]])(fn = 0)), res;
};
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/utils/frontmatter.ts
var frontmatter_exports = {};
__export(frontmatter_exports, {
  getFrontmatter: () => getFrontmatter,
  getFrontmatterSync: () => getFrontmatterSync,
  isFileTypeSupported: () => isFileTypeSupported
});
async function getFrontmatter(app, file, settings) {
  if (file.extension === "md") {
    const fileCache = app.metadataCache.getFileCache(file);
    return (fileCache == null ? void 0 : fileCache.frontmatter) || null;
  }
  if (file.extension === "mdx" && settings.enableMdxSupport) {
    try {
      const content = await app.vault.read(file);
      const frontmatterRegex = /^---\n([\s\S]*?)\n---/;
      const match = content.match(frontmatterRegex);
      if (match && match[1]) {
        const frontmatterText = match[1];
        try {
          const parsed = (0, import_obsidian.parseYaml)(frontmatterText);
          return parsed && typeof parsed === "object" ? parsed : null;
        } catch (parseError) {
          console.error("MDX YAML parse error:", parseError);
          return null;
        }
      }
      return null;
    } catch (readError) {
      console.error("Error reading MDX file:", readError);
      return null;
    }
  }
  return null;
}
function getFrontmatterSync(app, file, settings) {
  if (file.extension === "md") {
    const fileCache = app.metadataCache.getFileCache(file);
    return (fileCache == null ? void 0 : fileCache.frontmatter) || null;
  }
  if (file.extension === "mdx" && settings.enableMdxSupport) {
    return null;
  }
  return null;
}
function isFileTypeSupported(extension, settings) {
  if (extension === "md") {
    return true;
  }
  if (extension === "mdx") {
    return settings.enableMdxSupport;
  }
  return false;
}
var import_obsidian;
var init_frontmatter = __esm({
  "src/utils/frontmatter.ts"() {
    "use strict";
    import_obsidian = require("obsidian");
  }
});

// src/utils/search.ts
async function buildFileCache(files, metadataCache, app, propertyKey, settings) {
  const cache = /* @__PURE__ */ new Map();
  const { getFrontmatter: getFrontmatter2 } = await Promise.resolve().then(() => (init_frontmatter(), frontmatter_exports));
  await Promise.all(files.map(async (file) => {
    if (!isFileTypeSupported(file.extension, settings)) {
      return;
    }
    let frontmatter;
    if (file.extension === "md") {
      const fileCache = app.metadataCache.getFileCache(file);
      frontmatter = (fileCache == null ? void 0 : fileCache.frontmatter) || null;
    } else {
      frontmatter = await getFrontmatter2(app, file, settings);
    }
    let displayName = file.basename;
    let isCustomDisplay = false;
    let aliases = [];
    if (frontmatter && frontmatter[propertyKey] !== void 0 && frontmatter[propertyKey] !== null) {
      const propertyValueRaw = frontmatter[propertyKey];
      let propertyValue;
      if (typeof propertyValueRaw === "string") {
        propertyValue = propertyValueRaw.trim();
      } else if (typeof propertyValueRaw === "number" || typeof propertyValueRaw === "boolean") {
        propertyValue = String(propertyValueRaw).trim();
      } else {
        propertyValue = "";
      }
      if (propertyValue && propertyValue !== "") {
        displayName = propertyValue;
        isCustomDisplay = true;
      }
    }
    if (frontmatter == null ? void 0 : frontmatter.aliases) {
      const aliasesRaw = frontmatter.aliases;
      aliases = Array.isArray(aliasesRaw) ? aliasesRaw.map((a) => String(a)) : [String(aliasesRaw)];
      aliases = aliases.map((alias) => alias.trim()).filter((alias) => alias !== "");
    }
    cache.set(file.path, {
      file,
      displayName,
      aliases,
      lastModified: file.stat.mtime,
      isCustomDisplay
    });
  }));
  return cache;
}
var init_search = __esm({
  "src/utils/search.ts"() {
    "use strict";
    init_frontmatter();
  }
});

// src/ui/QuickSwitchModal.ts
var QuickSwitchModal_exports = {};
__export(QuickSwitchModal_exports, {
  QuickSwitchModal: () => QuickSwitchModal
});
var import_obsidian5, QuickSwitchModal;
var init_QuickSwitchModal = __esm({
  "src/ui/QuickSwitchModal.ts"() {
    "use strict";
    import_obsidian5 = require("obsidian");
    init_search();
    init_frontmatter();
    QuickSwitchModal = class extends import_obsidian5.FuzzySuggestModal {
      constructor(app, plugin) {
        super(app);
        this.fileCache = /* @__PURE__ */ new Map();
        this.recentFiles = [];
        this.searchTimeout = null;
        this.matchReasons = /* @__PURE__ */ new Map();
        this.plugin = plugin;
        this.limit = 8;
        if (this.plugin.settings.enableForQuickSwitcher) {
          this.setPlaceholder("Type to search notes by title or file name...");
        } else {
          this.setPlaceholder("Type to search files...");
        }
        void this.buildFileCache();
        this.updateRecentFiles();
        this.addKeyboardNavigation();
        this.addFooter();
        if (this.plugin.settings.enableForQuickSwitcher) {
          this.containerEl.addClass("property-over-filename-modal");
        }
      }
      addKeyboardNavigation() {
        this.inputEl.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            this.close();
            e.preventDefault();
            e.stopPropagation();
          }
        });
      }
      addFooter() {
        const promptContainer = this.containerEl.querySelector(".prompt");
        if (promptContainer) {
          const footer = promptContainer.createDiv({ cls: "prompt-instructions" });
          const instructions = [
            { command: "\u2191\u2193", action: "to navigate" },
            { command: "\u21B5", action: "to open" },
            { command: "ctrl \u21B5", action: "to open in new tab" },
            { command: "ctrl alt \u21B5", action: "to open to the right" },
            { command: "shift \u21B5", action: "to create" },
            { command: "esc", action: "to dismiss" }
          ];
          instructions.forEach(({ command, action }) => {
            const instruction = footer.createDiv({ cls: "prompt-instruction" });
            instruction.createSpan({ cls: "prompt-instruction-command", text: command });
            instruction.createSpan({ text: action });
          });
        }
      }
      async buildFileCache() {
        const files = this.getFilteredFiles();
        this.fileCache = await buildFileCache(
          files,
          this.app.metadataCache,
          this.app,
          this.plugin.settings.propertyKey,
          this.plugin.settings
        );
      }
      async updateFileCache(file) {
        const { getFrontmatter: getFrontmatter2, isFileTypeSupported: isFileTypeSupported2 } = await Promise.resolve().then(() => (init_frontmatter(), frontmatter_exports));
        if (!isFileTypeSupported2(file.extension, this.plugin.settings)) {
          return;
        }
        const frontmatter = await getFrontmatter2(this.app, file, this.plugin.settings);
        let displayName = file.basename;
        let isCustomDisplay = false;
        let aliases = [];
        if (frontmatter && frontmatter[this.plugin.settings.propertyKey] !== void 0 && frontmatter[this.plugin.settings.propertyKey] !== null) {
          const propertyValue = String(frontmatter[this.plugin.settings.propertyKey]).trim();
          if (propertyValue !== "") {
            displayName = propertyValue;
            isCustomDisplay = true;
          }
        }
        if (frontmatter == null ? void 0 : frontmatter.aliases) {
          const aliasesRaw = frontmatter.aliases;
          aliases = Array.isArray(aliasesRaw) ? aliasesRaw.map((a) => String(a)) : [String(aliasesRaw)];
          aliases = aliases.map((alias) => alias.trim()).filter((alias) => alias !== "");
        }
        this.fileCache.set(file.path, {
          file,
          displayName,
          aliases,
          lastModified: file.stat.mtime,
          isCustomDisplay
        });
      }
      updateRecentFiles() {
        var _a, _b;
        let recentFiles = [];
        const workspace = this.app.workspace;
        const quickSwitcherOptions = this.getQuickSwitcherOptions();
        const showAttachments = (_a = quickSwitcherOptions == null ? void 0 : quickSwitcherOptions.showAttachments) != null ? _a : true;
        if ((_b = workspace.recentFileTracker) == null ? void 0 : _b.getLastOpenFiles) {
          const lastOpenFiles = workspace.recentFileTracker.getLastOpenFiles();
          recentFiles = lastOpenFiles.map((filePath) => this.app.vault.getAbstractFileByPath(filePath)).filter((file) => file instanceof import_obsidian5.TFile);
        }
        if (recentFiles.length === 0) {
          const openFiles = this.app.workspace.getLeavesOfType("markdown").map((leaf) => leaf.view).filter((view) => view instanceof import_obsidian5.MarkdownView).map((view) => view.file).filter((file) => file !== null).filter((file, index, self) => self.indexOf(file) === index);
          recentFiles = [...openFiles];
        }
        if (!showAttachments) {
          recentFiles = recentFiles.filter(
            (file) => file.extension === "md" || file.extension === "mdx" && this.plugin.settings.enableMdxSupport
          );
        }
        const targetCount = 8;
        const existingPaths = new Set(recentFiles.map((f) => f.path));
        if (recentFiles.length < targetCount) {
          if (showAttachments) {
            const allFiles = this.app.vault.getFiles().filter((file) => file instanceof import_obsidian5.TFile);
            const additionalFiles = allFiles.filter((file) => !existingPaths.has(file.path)).slice(0, targetCount - recentFiles.length);
            recentFiles.push(...additionalFiles);
          } else {
            const allMarkdownFiles = this.app.vault.getMarkdownFiles();
            const mdxFiles = this.plugin.settings.enableMdxSupport ? this.app.vault.getFiles().filter(
              (f) => f instanceof import_obsidian5.TFile && f.extension === "mdx"
            ) : [];
            const allSupportedFiles = [...allMarkdownFiles, ...mdxFiles];
            const additionalFiles = allSupportedFiles.filter((file) => !existingPaths.has(file.path)).slice(0, targetCount - recentFiles.length);
            recentFiles.push(...additionalFiles);
          }
        }
        this.recentFiles = recentFiles.slice(0, targetCount);
      }
      getItems() {
        return this.getFilteredFiles();
      }
      getFilteredFiles() {
        const quickSwitcherOptions = this.getQuickSwitcherOptions();
        let files = this.app.vault.getMarkdownFiles();
        if (this.plugin.settings.enableMdxSupport) {
          const mdxFiles = this.app.vault.getFiles().filter(
            (f) => f instanceof import_obsidian5.TFile && f.extension === "mdx"
          );
          files = [...files, ...mdxFiles];
        }
        if (quickSwitcherOptions == null ? void 0 : quickSwitcherOptions.showAttachments) {
          const allFiles = this.app.vault.getFiles().filter((file) => file instanceof import_obsidian5.TFile);
          files = allFiles.filter(
            (file) => file instanceof import_obsidian5.TFile && (file.extension === "md" || file.extension === "mdx" && this.plugin.settings.enableMdxSupport || this.isAttachment(file))
          );
        }
        return files;
      }
      isAttachment(file) {
        const attachmentExtensions = ["png", "jpg", "jpeg", "gif", "svg", "webp", "pdf", "mp4", "mp3", "wav", "ogg", "webm"];
        return attachmentExtensions.includes(file.extension.toLowerCase());
      }
      getQuickSwitcherOptions() {
        var _a;
        try {
          const internalPlugins = this.app.internalPlugins;
          if (!internalPlugins) return null;
          const switcherPlugin = (_a = internalPlugins.getPluginById) == null ? void 0 : _a.call(internalPlugins, "switcher");
          if (!switcherPlugin || !switcherPlugin.instance) {
            return null;
          }
          return switcherPlugin.instance.options || null;
        } catch (e) {
          return null;
        }
      }
      getItemText(item) {
        if ("isNewNote" in item) {
          return item.newName;
        }
        if ("isUnresolved" in item) {
          return item.unresolvedText;
        }
        if (!this.plugin.settings.enableForQuickSwitcher) {
          return item.basename;
        }
        const display = this.getDisplayName(item);
        return display;
      }
      getDisplayName(file) {
        const cached = this.fileCache.get(file.path);
        if (cached) {
          return cached.displayName;
        }
        const frontmatter = getFrontmatterSync(this.app, file, this.plugin.settings);
        if (frontmatter) {
          const propertyValue = frontmatter[this.plugin.settings.propertyKey];
          if (propertyValue !== void 0 && propertyValue !== null) {
            const trimmed = typeof propertyValue === "string" ? propertyValue.trim() : (typeof propertyValue === "number" || typeof propertyValue === "boolean" ? String(propertyValue) : "").trim();
            if (trimmed !== "") {
              return trimmed;
            }
          }
        }
        return file.basename;
      }
      getSuggestions(query) {
        var _a;
        if (!this.plugin.settings.enableForQuickSwitcher) {
          const searchQuery2 = query.trim();
          if (!searchQuery2) {
            return this.getRecentFilesResults();
          }
          const files = this.getFilteredFiles();
          const search = this.plugin.settings.useSimpleSearch ? (0, import_obsidian5.prepareSimpleSearch)(searchQuery2) : (0, import_obsidian5.prepareFuzzySearch)(searchQuery2);
          const results = [];
          for (const file of files) {
            const match = (_a = search(file.basename)) != null ? _a : { score: 0, matches: [] };
            if (match.matches.length > 0) {
              results.push({ item: file, match });
            }
          }
          (0, import_obsidian5.sortSearchResults)(results);
          if (results.length === 0) {
            const newItem = { isNewNote: true, newName: searchQuery2 };
            results.push({
              item: newItem,
              match: { score: 1e3, matches: [[0, searchQuery2.length]] }
            });
          }
          return results.slice(0, this.limit);
        }
        const searchQuery = query.trim();
        if (this.searchTimeout) {
          clearTimeout(this.searchTimeout);
        }
        if (!searchQuery) {
          return this.getRecentFilesResults();
        }
        return this.performSearch(searchQuery);
      }
      getRecentFilesResults() {
        this.updateRecentFiles();
        this.matchReasons.clear();
        return this.recentFiles.map((file) => ({
          item: file,
          match: { score: 1e3, matches: [] }
        }));
      }
      performSearch(searchQuery) {
        var _a;
        const search = this.plugin.settings.useSimpleSearch ? (0, import_obsidian5.prepareSimpleSearch)(searchQuery) : (0, import_obsidian5.prepareFuzzySearch)(searchQuery);
        const results = [];
        this.matchReasons.clear();
        for (const cachedData of this.fileCache.values()) {
          const { file, displayName, aliases, isCustomDisplay } = cachedData;
          const matchReason = {
            matchedInTitle: false,
            matchedInFilename: false,
            matchedInAlias: false
          };
          let primaryMatch = null;
          let bestMatch = null;
          let matchType = null;
          if (isCustomDisplay) {
            primaryMatch = search(displayName);
            if (primaryMatch && primaryMatch.matches.length > 0) {
              matchReason.matchedInTitle = true;
              bestMatch = primaryMatch;
              matchType = "title";
            }
          }
          if (!matchType) {
            if (this.plugin.settings.includeFilenameInSearch && file.basename !== displayName) {
              const filenameMatch = search(file.basename);
              if (filenameMatch && filenameMatch.matches.length > 0) {
                matchReason.matchedInFilename = true;
                bestMatch = { ...filenameMatch, score: filenameMatch.score - 1 };
                matchType = "filename";
              }
            } else if (!isCustomDisplay) {
              const filenameMatch = search(file.basename);
              if (filenameMatch && filenameMatch.matches.length > 0) {
                matchReason.matchedInFilename = true;
                bestMatch = filenameMatch;
                matchType = "filename";
              }
            }
          }
          if (!matchType && this.plugin.settings.includeAliasesInSearch && aliases.length > 0) {
            for (const alias of aliases) {
              const aliasMatch = search(alias);
              if (aliasMatch && aliasMatch.matches.length > 0) {
                matchReason.matchedInAlias = true;
                matchReason.matchedAliasText = alias;
                bestMatch = { ...aliasMatch, score: aliasMatch.score - 1 };
                matchType = "alias";
                break;
              }
            }
          }
          if (bestMatch && bestMatch.matches.length > 0) {
            results.push({ item: file, match: bestMatch });
            this.matchReasons.set(file.path, matchReason);
          }
        }
        const quickSwitcherOptions = this.getQuickSwitcherOptions();
        const showExistingOnly = (_a = quickSwitcherOptions == null ? void 0 : quickSwitcherOptions.showExistingOnly) != null ? _a : false;
        if (!showExistingOnly) {
          const { unresolvedLinks } = this.app.metadataCache;
          const unresolvedSet = /* @__PURE__ */ new Set();
          for (const sourcePath in unresolvedLinks) {
            const links = Object.keys(unresolvedLinks[sourcePath]);
            links.forEach((link) => unresolvedSet.add(link));
          }
          for (const unresolved of unresolvedSet) {
            const unresolvedMatch = search(unresolved);
            if (unresolvedMatch && unresolvedMatch.matches.length > 0) {
              const unresolvedItem = { isUnresolved: true, unresolvedText: unresolved };
              results.push({
                item: unresolvedItem,
                match: unresolvedMatch
              });
            }
          }
        }
        try {
          (0, import_obsidian5.sortSearchResults)(results);
          let filteredResults = results;
          if (showExistingOnly) {
            filteredResults = results.filter((r) => {
              return r.item instanceof import_obsidian5.TFile || "isNewNote" in r.item && r.item.isNewNote === true;
            });
          }
          const lowerQuery = searchQuery.toLowerCase();
          let exactMatch = filteredResults.some(
            (r) => {
              var _a2;
              return r.item instanceof import_obsidian5.TFile && (this.getDisplayName(r.item).toLowerCase() === lowerQuery || this.plugin.settings.includeFilenameInSearch && r.item.basename.toLowerCase() === lowerQuery || this.plugin.settings.includeAliasesInSearch && ((_a2 = this.fileCache.get(r.item.path)) == null ? void 0 : _a2.aliases.some((alias) => alias.toLowerCase() === lowerQuery)));
            }
          );
          if (!showExistingOnly && !exactMatch) {
            const { unresolvedLinks } = this.app.metadataCache;
            const unresolvedSet = /* @__PURE__ */ new Set();
            for (const sourcePath in unresolvedLinks) {
              const links = Object.keys(unresolvedLinks[sourcePath]);
              links.forEach((link) => unresolvedSet.add(link));
            }
            exactMatch = Array.from(unresolvedSet).some((link) => link.toLowerCase() === lowerQuery);
          }
          if (!exactMatch && searchQuery) {
            const newItem = { isNewNote: true, newName: searchQuery };
            filteredResults.unshift({
              item: newItem,
              match: { score: 1e3, matches: [[0, searchQuery.length]] }
            });
          }
          return filteredResults.slice(0, this.limit);
        } catch (e) {
          new import_obsidian5.Notice("Error updating quick switcher suggestions. Please check console for details.");
          return [];
        }
      }
      renderSuggestion(suggestion, el) {
        var _a;
        const { item } = suggestion;
        if ("isUnresolved" in item && item.isUnresolved) {
          const unresolvedText = item.unresolvedText;
          el.empty();
          el.addClass("mod-complex");
          const suggestionContent = el.createDiv({ cls: "suggestion-content" });
          const suggestionTitle = suggestionContent.createDiv({ cls: "suggestion-title" });
          suggestionTitle.setText(unresolvedText);
          const suggestionAux = el.createDiv({ cls: "suggestion-aux" });
          const suggestionFlair = suggestionAux.createSpan({
            cls: "suggestion-flair",
            attr: { "aria-label": "Unresolved link - Enter to create" }
          });
          this.createFilePlusIcon(suggestionFlair);
          return;
        }
        const text = this.getItemText(item);
        if ("isNewNote" in item) {
          el.empty();
          el.addClass("mod-complex");
          const suggestionContent = el.createDiv({ cls: "suggestion-content" });
          const suggestionTitle = suggestionContent.createDiv({ cls: "suggestion-title" });
          suggestionTitle.setText(text);
          const suggestionAux = el.createDiv({ cls: "suggestion-aux" });
          const suggestionAction = suggestionAux.createSpan({ cls: "suggestion-action" });
          suggestionAction.setText("Enter to create");
          return;
        }
        if (!this.plugin.settings.enableForQuickSwitcher) {
          if (item instanceof import_obsidian5.TFile) {
            el.setText(item.path.replace(".md", ""));
          } else {
            el.setText(text);
          }
        } else {
          if (!(item instanceof import_obsidian5.TFile)) {
            el.setText(text);
            return;
          }
          const cachedData = this.fileCache.get(item.path);
          const isCustomDisplay = (_a = cachedData == null ? void 0 : cachedData.isCustomDisplay) != null ? _a : false;
          const matchReason = this.matchReasons.get(item.path);
          if (!isCustomDisplay && (matchReason == null ? void 0 : matchReason.matchedInAlias) && matchReason.matchedAliasText) {
            el.addClass("mod-complex");
            const suggestionContent = el.createDiv({ cls: "suggestion-content" });
            const titleEl = suggestionContent.createDiv({ cls: "suggestion-title" });
            titleEl.setText(matchReason.matchedAliasText);
            const pathEl = suggestionContent.createDiv({ cls: "suggestion-note" });
            pathEl.setText(item.path.replace(".md", ""));
            const suggestionAux = el.createDiv({ cls: "suggestion-aux" });
            const suggestionFlair = suggestionAux.createSpan({
              cls: "suggestion-flair",
              attr: { "aria-label": "Alias Match" }
            });
            this.createForwardIcon(suggestionFlair);
          } else if (isCustomDisplay) {
            const shouldShowIcon = matchReason && (matchReason.matchedInTitle || matchReason.matchedInFilename || matchReason.matchedInAlias);
            if (shouldShowIcon) {
              el.addClass("mod-complex");
              const suggestionContent = el.createDiv({ cls: "suggestion-content" });
              const titleEl = suggestionContent.createDiv({ cls: "suggestion-title" });
              titleEl.setText(text);
              const pathEl = suggestionContent.createDiv({ cls: "suggestion-note" });
              pathEl.setText(item.path.replace(".md", ""));
              const suggestionAux = el.createDiv({ cls: "suggestion-aux" });
              const suggestionFlair = suggestionAux.createSpan({
                cls: "suggestion-flair",
                attr: { "aria-label": this.getIconLabel(matchReason) }
              });
              if (matchReason.matchedInTitle) {
                this.createTypeIcon(suggestionFlair);
              } else if (matchReason.matchedInFilename) {
                this.createFileIcon(suggestionFlair);
              } else if (matchReason.matchedInAlias) {
                this.createForwardIcon(suggestionFlair);
              }
            } else {
              el.addClass("mod-complex");
              const suggestionContent = el.createDiv({ cls: "suggestion-content" });
              const titleEl = suggestionContent.createDiv({ cls: "suggestion-title" });
              titleEl.setText(text);
              const pathEl = suggestionContent.createDiv({ cls: "suggestion-note" });
              pathEl.setText(item.path.replace(".md", ""));
              const suggestionAux = el.createDiv({ cls: "suggestion-aux" });
              const suggestionFlair = suggestionAux.createSpan({
                cls: "suggestion-flair",
                attr: { "aria-label": "Property-based title" }
              });
              this.createTypeIcon(suggestionFlair);
            }
          } else {
            el.setText(text);
          }
        }
      }
      getIconLabel(matchReason) {
        if (matchReason.matchedInTitle) {
          return "Title/Property Match";
        } else if (matchReason.matchedInFilename) {
          return "File Name Match";
        } else if (matchReason.matchedInAlias) {
          return "Alias Match";
        }
        return "Match";
      }
      createTypeIcon(container) {
        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute("width", "24");
        svg.setAttribute("height", "24");
        svg.setAttribute("viewBox", "0 0 24 24");
        svg.setAttribute("fill", "none");
        svg.setAttribute("stroke", "currentColor");
        svg.setAttribute("stroke-width", "2");
        svg.setAttribute("stroke-linecap", "round");
        svg.setAttribute("stroke-linejoin", "round");
        svg.classList.add("svg-icon", "lucide-type");
        const polyline1 = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
        polyline1.setAttribute("points", "4 7 4 4 20 4 20 7");
        svg.appendChild(polyline1);
        const line1 = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line1.setAttribute("x1", "9");
        line1.setAttribute("y1", "20");
        line1.setAttribute("x2", "15");
        line1.setAttribute("y2", "20");
        svg.appendChild(line1);
        const line2 = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line2.setAttribute("x1", "12");
        line2.setAttribute("y1", "4");
        line2.setAttribute("x2", "12");
        line2.setAttribute("y2", "20");
        svg.appendChild(line2);
        container.appendChild(svg);
      }
      createFileIcon(container) {
        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute("width", "24");
        svg.setAttribute("height", "24");
        svg.setAttribute("viewBox", "0 0 24 24");
        svg.setAttribute("fill", "none");
        svg.setAttribute("stroke", "currentColor");
        svg.setAttribute("stroke-width", "2");
        svg.setAttribute("stroke-linecap", "round");
        svg.setAttribute("stroke-linejoin", "round");
        svg.classList.add("svg-icon", "lucide-file-text");
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", "M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z");
        svg.appendChild(path);
        const polyline1 = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
        polyline1.setAttribute("points", "14,2 14,8 20,8");
        svg.appendChild(polyline1);
        const line1 = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line1.setAttribute("x1", "16");
        line1.setAttribute("y1", "13");
        line1.setAttribute("x2", "8");
        line1.setAttribute("y2", "13");
        svg.appendChild(line1);
        const line2 = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line2.setAttribute("x1", "16");
        line2.setAttribute("y1", "17");
        line2.setAttribute("x2", "8");
        line2.setAttribute("y2", "17");
        svg.appendChild(line2);
        const polyline2 = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
        polyline2.setAttribute("points", "10,9 9,9 8,9");
        svg.appendChild(polyline2);
        container.appendChild(svg);
      }
      createForwardIcon(container) {
        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute("width", "24");
        svg.setAttribute("height", "24");
        svg.setAttribute("viewBox", "0 0 24 24");
        svg.setAttribute("fill", "none");
        svg.setAttribute("stroke", "currentColor");
        svg.setAttribute("stroke-width", "2");
        svg.setAttribute("stroke-linecap", "round");
        svg.setAttribute("stroke-linejoin", "round");
        svg.classList.add("svg-icon", "lucide-forward");
        const polyline = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
        polyline.setAttribute("points", "15 17 20 12 15 7");
        svg.appendChild(polyline);
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", "M4 18v-2a4 4 0 0 1 4-4h12");
        svg.appendChild(path);
        container.appendChild(svg);
      }
      createFilePlusIcon(container) {
        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute("width", "24");
        svg.setAttribute("height", "24");
        svg.setAttribute("viewBox", "0 0 24 24");
        svg.setAttribute("fill", "none");
        svg.setAttribute("stroke", "currentColor");
        svg.setAttribute("stroke-width", "2");
        svg.setAttribute("stroke-linecap", "round");
        svg.setAttribute("stroke-linejoin", "round");
        svg.classList.add("svg-icon", "lucide-file-plus");
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", "M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z");
        svg.appendChild(path);
        const polyline = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
        polyline.setAttribute("points", "14,2 14,8 20,8");
        svg.appendChild(polyline);
        const line1 = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line1.setAttribute("x1", "12");
        line1.setAttribute("y1", "18");
        line1.setAttribute("x2", "12");
        line1.setAttribute("y2", "12");
        svg.appendChild(line1);
        const line2 = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line2.setAttribute("x1", "9");
        line2.setAttribute("y1", "15");
        line2.setAttribute("x2", "15");
        line2.setAttribute("y2", "15");
        svg.appendChild(line2);
        container.appendChild(svg);
      }
      isUsingCustomProperty(file) {
        const cache = this.app.metadataCache.getFileCache(file);
        const frontmatter = cache == null ? void 0 : cache.frontmatter;
        const propertyValue = frontmatter == null ? void 0 : frontmatter[this.plugin.settings.propertyKey];
        if (propertyValue === void 0 || propertyValue === null) {
          return false;
        }
        const strValue = typeof propertyValue === "string" ? propertyValue : typeof propertyValue === "number" || typeof propertyValue === "boolean" ? String(propertyValue) : "";
        return strValue.trim() !== "";
      }
      isUsingAlias(file) {
        const cache = this.app.metadataCache.getFileCache(file);
        const frontmatter = cache == null ? void 0 : cache.frontmatter;
        const aliases = frontmatter == null ? void 0 : frontmatter.aliases;
        if (!aliases) return false;
        const isUsingCustomProperty = this.isUsingCustomProperty(file);
        return !isUsingCustomProperty && Boolean(aliases);
      }
      onChooseItem(item, evt) {
        var _a, _b;
        if ("isUnresolved" in item && item.isUnresolved) {
          const unresolvedText = item.unresolvedText;
          const activeView = this.app.workspace.getActiveViewOfType(import_obsidian5.MarkdownView);
          const sourcePath = ((_a = activeView == null ? void 0 : activeView.file) == null ? void 0 : _a.path) || "";
          void this.app.workspace.openLinkText(unresolvedText, sourcePath).catch((err) => {
            const message = err instanceof Error ? err.message : String(err);
            new import_obsidian5.Notice(`Error creating note: ${message}`);
          });
          return;
        }
        if ("isNewNote" in item) {
          const activeView = this.app.workspace.getActiveViewOfType(import_obsidian5.MarkdownView);
          const sourcePath = ((_b = activeView == null ? void 0 : activeView.file) == null ? void 0 : _b.path) || "";
          void this.app.workspace.openLinkText(item.newName, sourcePath).catch((err) => {
            const message = err instanceof Error ? err.message : String(err);
            new import_obsidian5.Notice(`Error creating note: ${message}`);
          });
        } else if (item instanceof import_obsidian5.TFile) {
          if (evt instanceof KeyboardEvent) {
            if (evt.ctrlKey && evt.altKey) {
              const leaf = this.app.workspace.getLeaf(true);
              void leaf.openFile(item);
            } else if (evt.ctrlKey) {
              void this.app.workspace.getLeaf().openFile(item);
            } else if (evt.shiftKey) {
              void this.app.workspace.getLeaf().openFile(item);
            } else {
              void this.app.workspace.getLeaf().openFile(item);
            }
          } else {
            void this.app.workspace.getLeaf().openFile(item);
          }
        }
      }
    };
  }
});

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => PropertyOverFileNamePlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian13 = require("obsidian");

// src/settings.ts
var DEFAULT_SETTINGS = {
  propertyKey: "title",
  enableForLinking: true,
  enableForQuickSwitcher: true,
  includeFilenameInSearch: true,
  includeAliasesInSearch: true,
  enableForDragDrop: true,
  useSimpleSearch: false,
  enableForGraphView: true,
  enableForBacklinks: true,
  enableForTabs: true,
  enableForExplorer: false,
  folderNoteFilename: "",
  enableForWindowFrame: true,
  enableForBookmarks: true,
  enableMdxSupport: false
};

// src/ui/LinkTitleSuggest.ts
var import_obsidian2 = require("obsidian");
init_search();
var LinkTitleSuggest = class extends import_obsidian2.EditorSuggest {
  constructor(plugin) {
    super(plugin.app);
    this.fileCache = /* @__PURE__ */ new Map();
    this.searchTimeout = null;
    this.matchReasons = /* @__PURE__ */ new Map();
    this.plugin = plugin;
    void this.buildFileCache();
  }
  open() {
    super.open();
    const el = this.suggestEl;
    if (el) {
      el.addClass("property-over-filename-suggestion");
      if (!el.querySelector(".prompt-instructions")) {
        const instructions = el.createDiv({ cls: "prompt-instructions" });
        instructions.createDiv({ cls: "prompt-instruction" }).setText("Type # to link heading");
        instructions.createDiv({ cls: "prompt-instruction" }).setText("Type ^ to link blocks");
        instructions.createDiv({ cls: "prompt-instruction" }).setText("Type | to change display text");
      }
    }
    this.addKeyboardNavigation();
  }
  addKeyboardNavigation() {
    const el = this.suggestEl;
    if (!el) return;
    el.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        this.close();
        e.preventDefault();
        e.stopPropagation();
      }
    });
  }
  onTrigger(cursor, editor, file) {
    if (!this.plugin.settings.enableForLinking) return null;
    const line = editor.getLine(cursor.line).substring(0, cursor.ch);
    const match = /\[\[([^#^|\]]*)$/.exec(line);
    if (match) {
      return {
        start: { line: cursor.line, ch: line.lastIndexOf("[[") },
        end: cursor,
        query: match[1]
      };
    }
    return null;
  }
  async buildFileCache() {
    const mdFiles = this.app.vault.getMarkdownFiles();
    const allFiles = [...mdFiles];
    if (this.plugin.settings.enableMdxSupport) {
      const mdxFiles = this.app.vault.getFiles().filter(
        (f) => f instanceof import_obsidian2.TFile && f.extension === "mdx"
      );
      allFiles.push(...mdxFiles);
    }
    this.fileCache = await buildFileCache(
      allFiles,
      this.app.metadataCache,
      this.app,
      this.plugin.settings.propertyKey,
      this.plugin.settings
    );
  }
  async updateFileCache(file) {
    const { getFrontmatter: getFrontmatter2, isFileTypeSupported: isFileTypeSupported2 } = await Promise.resolve().then(() => (init_frontmatter(), frontmatter_exports));
    if (!isFileTypeSupported2(file.extension, this.plugin.settings)) {
      return;
    }
    const frontmatter = await getFrontmatter2(this.app, file, this.plugin.settings);
    let displayName = file.basename;
    let isCustomDisplay = false;
    let aliases = [];
    if (frontmatter && frontmatter[this.plugin.settings.propertyKey] !== void 0 && frontmatter[this.plugin.settings.propertyKey] !== null) {
      const propertyValue = String(frontmatter[this.plugin.settings.propertyKey]).trim();
      if (propertyValue !== "") {
        displayName = propertyValue;
        isCustomDisplay = true;
      }
    }
    if (frontmatter == null ? void 0 : frontmatter.aliases) {
      const aliasesRaw = frontmatter.aliases;
      aliases = Array.isArray(aliasesRaw) ? aliasesRaw.map((a) => String(a)) : [String(aliasesRaw)];
      aliases = aliases.map((alias) => alias.trim()).filter((alias) => alias !== "");
    }
    this.fileCache.set(file.path, {
      file,
      displayName,
      aliases,
      lastModified: file.stat.mtime,
      isCustomDisplay
    });
  }
  getSuggestions(context) {
    const query = context.query.trim();
    return this.performSearch(query);
  }
  performSearch(query) {
    var _a;
    if (!query || query.trim() === "") {
      const suggestions2 = [];
      for (const cachedData of this.fileCache.values()) {
        suggestions2.push({
          file: cachedData.file,
          display: cachedData.displayName,
          isCustomDisplay: cachedData.isCustomDisplay
        });
      }
      return suggestions2;
    }
    const search = this.plugin.settings.useSimpleSearch ? (0, import_obsidian2.prepareSimpleSearch)(query) : (0, import_obsidian2.prepareFuzzySearch)(query);
    const searchableSuggestions = [];
    this.matchReasons.clear();
    for (const cachedData of this.fileCache.values()) {
      const { file, displayName, aliases, isCustomDisplay } = cachedData;
      const matchReason = {
        matchedInTitle: false,
        matchedInFilename: false,
        matchedInAlias: false
      };
      let primaryMatch = null;
      let bestMatch = null;
      let matchType = null;
      if (isCustomDisplay) {
        primaryMatch = search(displayName);
        if (primaryMatch && primaryMatch.matches.length > 0) {
          matchReason.matchedInTitle = true;
          bestMatch = primaryMatch;
          matchType = "title";
        }
      }
      if (!matchType) {
        if (this.plugin.settings.includeFilenameInSearch && file.basename !== displayName) {
          const filenameMatch = search(file.basename);
          if (filenameMatch && filenameMatch.matches.length > 0) {
            matchReason.matchedInFilename = true;
            bestMatch = { ...filenameMatch, score: filenameMatch.score - 1 };
            matchType = "filename";
          }
        } else if (!isCustomDisplay) {
          const filenameMatch = search(file.basename);
          if (filenameMatch && filenameMatch.matches.length > 0) {
            matchReason.matchedInFilename = true;
            bestMatch = filenameMatch;
            matchType = "filename";
          }
        }
      }
      if (!matchType && this.plugin.settings.includeAliasesInSearch && aliases.length > 0) {
        for (const alias of aliases) {
          const aliasMatch = search(alias);
          if (aliasMatch && aliasMatch.matches.length > 0) {
            matchReason.matchedInAlias = true;
            matchReason.matchedAliasText = alias;
            bestMatch = { ...aliasMatch, score: aliasMatch.score - 1 };
            matchType = "alias";
            break;
          }
        }
      }
      if (bestMatch && bestMatch.matches.length > 0) {
        const suggestion = {
          file,
          display: displayName,
          isCustomDisplay
        };
        searchableSuggestions.push({ item: suggestion, match: bestMatch });
        this.matchReasons.set(file.path, matchReason);
      }
    }
    const quickSwitcherOptions = this.getQuickSwitcherOptions();
    const showExistingOnly = (_a = quickSwitcherOptions == null ? void 0 : quickSwitcherOptions.showExistingOnly) != null ? _a : false;
    if (!showExistingOnly) {
      const { unresolvedLinks } = this.app.metadataCache;
      const unresolvedSet = /* @__PURE__ */ new Set();
      for (const sourcePath in unresolvedLinks) {
        const links = Object.keys(unresolvedLinks[sourcePath]);
        links.forEach((link) => unresolvedSet.add(link));
      }
      for (const unresolved of unresolvedSet) {
        const unresolvedMatch = search(unresolved);
        if (unresolvedMatch && unresolvedMatch.matches.length > 0) {
          searchableSuggestions.push({
            item: {
              display: unresolved,
              isCustomDisplay: false
              // No file property means it's unresolved
            },
            match: unresolvedMatch
          });
        }
      }
    }
    (0, import_obsidian2.sortSearchResults)(searchableSuggestions);
    let suggestions = searchableSuggestions.map((s) => s.item);
    if (showExistingOnly) {
      suggestions = suggestions.filter((s) => s.file !== void 0);
    }
    if (suggestions.length === 0 && query) {
      suggestions.push({
        display: "No match found",
        isCustomDisplay: false,
        isNoMatch: true
      });
    }
    return suggestions;
  }
  renderSuggestion(suggestion, el) {
    el.empty();
    if (suggestion.isNoMatch) {
      el.setText(suggestion.display);
      return;
    }
    if (suggestion.file) {
      const matchReason = this.matchReasons.get(suggestion.file.path);
      if (!suggestion.isCustomDisplay && (matchReason == null ? void 0 : matchReason.matchedInAlias) && matchReason.matchedAliasText) {
        el.addClass("mod-complex");
        const suggestionContent = el.createDiv({ cls: "suggestion-content" });
        const titleEl = suggestionContent.createDiv({ cls: "suggestion-title" });
        titleEl.setText(matchReason.matchedAliasText);
        const pathEl = suggestionContent.createDiv({ cls: "suggestion-note" });
        pathEl.setText(suggestion.file.path.replace(".md", ""));
        const suggestionAux = el.createDiv({ cls: "suggestion-aux" });
        const suggestionFlair = suggestionAux.createSpan({
          cls: "suggestion-flair",
          attr: { "aria-label": "Alias Match" }
        });
        this.createForwardIcon(suggestionFlair);
      } else if (suggestion.isCustomDisplay) {
        const shouldShowIcon = matchReason && (matchReason.matchedInTitle || matchReason.matchedInFilename || matchReason.matchedInAlias);
        if (shouldShowIcon) {
          el.addClass("mod-complex");
          const suggestionContent = el.createDiv({ cls: "suggestion-content" });
          const titleEl = suggestionContent.createDiv({ cls: "suggestion-title" });
          titleEl.setText(suggestion.display);
          const pathEl = suggestionContent.createDiv({ cls: "suggestion-note" });
          pathEl.setText(suggestion.file.path.replace(".md", ""));
          const suggestionAux = el.createDiv({ cls: "suggestion-aux" });
          const suggestionFlair = suggestionAux.createSpan({
            cls: "suggestion-flair",
            attr: { "aria-label": this.getIconLabel(matchReason) }
          });
          if (matchReason.matchedInTitle) {
            this.createTypeIcon(suggestionFlair);
          } else if (matchReason.matchedInFilename) {
            this.createFileIcon(suggestionFlair);
          } else if (matchReason.matchedInAlias) {
            this.createForwardIcon(suggestionFlair);
          }
        } else {
          el.setText(suggestion.display);
        }
      } else {
        el.setText(suggestion.display);
      }
    }
  }
  getIconLabel(matchReason) {
    if (matchReason.matchedInTitle) {
      return "Title/Property Match";
    } else if (matchReason.matchedInFilename) {
      return "File Name Match";
    } else if (matchReason.matchedInAlias) {
      return "Alias Match";
    }
    return "Match";
  }
  createTypeIcon(container) {
    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg.setAttribute("width", "24");
    svg.setAttribute("height", "24");
    svg.setAttribute("viewBox", "0 0 24 24");
    svg.setAttribute("fill", "none");
    svg.setAttribute("stroke", "currentColor");
    svg.setAttribute("stroke-width", "2");
    svg.setAttribute("stroke-linecap", "round");
    svg.setAttribute("stroke-linejoin", "round");
    svg.classList.add("svg-icon", "lucide-type");
    const polyline1 = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
    polyline1.setAttribute("points", "4 7 4 4 20 4 20 7");
    svg.appendChild(polyline1);
    const line1 = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line1.setAttribute("x1", "9");
    line1.setAttribute("y1", "20");
    line1.setAttribute("x2", "15");
    line1.setAttribute("y2", "20");
    svg.appendChild(line1);
    const line2 = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line2.setAttribute("x1", "12");
    line2.setAttribute("y1", "4");
    line2.setAttribute("x2", "12");
    line2.setAttribute("y2", "20");
    svg.appendChild(line2);
    container.appendChild(svg);
  }
  createFileIcon(container) {
    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg.setAttribute("width", "24");
    svg.setAttribute("height", "24");
    svg.setAttribute("viewBox", "0 0 24 24");
    svg.setAttribute("fill", "none");
    svg.setAttribute("stroke", "currentColor");
    svg.setAttribute("stroke-width", "2");
    svg.setAttribute("stroke-linecap", "round");
    svg.setAttribute("stroke-linejoin", "round");
    svg.classList.add("svg-icon", "lucide-file-text");
    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.setAttribute("d", "M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z");
    svg.appendChild(path);
    const polyline1 = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
    polyline1.setAttribute("points", "14,2 14,8 20,8");
    svg.appendChild(polyline1);
    const line1 = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line1.setAttribute("x1", "16");
    line1.setAttribute("y1", "13");
    line1.setAttribute("x2", "8");
    line1.setAttribute("y2", "13");
    svg.appendChild(line1);
    const line2 = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line2.setAttribute("x1", "16");
    line2.setAttribute("y1", "17");
    line2.setAttribute("x2", "8");
    line2.setAttribute("y2", "17");
    svg.appendChild(line2);
    const polyline2 = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
    polyline2.setAttribute("points", "10,9 9,9 8,9");
    svg.appendChild(polyline2);
    container.appendChild(svg);
  }
  createForwardIcon(container) {
    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg.setAttribute("width", "24");
    svg.setAttribute("height", "24");
    svg.setAttribute("viewBox", "0 0 24 24");
    svg.setAttribute("fill", "none");
    svg.setAttribute("stroke", "currentColor");
    svg.setAttribute("stroke-width", "2");
    svg.setAttribute("stroke-linecap", "round");
    svg.setAttribute("stroke-linejoin", "round");
    svg.classList.add("svg-icon", "lucide-forward");
    const polyline = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
    polyline.setAttribute("points", "15 17 20 12 15 7");
    svg.appendChild(polyline);
    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.setAttribute("d", "M4 18v-2a4 4 0 0 1 4-4h12");
    svg.appendChild(path);
    container.appendChild(svg);
  }
  isUsingCustomProperty(file) {
    const cache = this.app.metadataCache.getFileCache(file);
    const frontmatter = cache == null ? void 0 : cache.frontmatter;
    const propertyValue = frontmatter == null ? void 0 : frontmatter[this.plugin.settings.propertyKey];
    if (propertyValue === void 0 || propertyValue === null) {
      return false;
    }
    const strValue = typeof propertyValue === "string" ? propertyValue : typeof propertyValue === "number" || typeof propertyValue === "boolean" ? String(propertyValue) : "";
    return strValue.trim() !== "";
  }
  isUsingAlias(file) {
    const cache = this.app.metadataCache.getFileCache(file);
    const frontmatter = cache == null ? void 0 : cache.frontmatter;
    const aliases = frontmatter == null ? void 0 : frontmatter.aliases;
    if (!aliases) return false;
    const isUsingCustomProperty = this.isUsingCustomProperty(file);
    return !isUsingCustomProperty && Boolean(aliases);
  }
  selectSuggestion(suggestion, evt) {
    var _a, _b;
    if (suggestion.isNoMatch) {
      return;
    }
    const activeView = this.app.workspace.getActiveViewOfType(import_obsidian2.MarkdownView);
    if (!activeView || !this.context) return;
    const editor = activeView.editor;
    const { start, end } = this.context;
    const line = editor.getLine(start.line);
    let endPos = end;
    if (line.slice(end.ch, end.ch + 2) === "]]") {
      endPos = { line: end.line, ch: end.ch + 2 };
    }
    if (!suggestion.file) {
      return;
    }
    const vault = this.app.vault;
    const useMarkdownLinks = (_b = (_a = vault.getConfig) == null ? void 0 : _a.call(vault, "useMarkdownLinks")) != null ? _b : false;
    let linkText;
    if (suggestion.isCustomDisplay) {
      if (useMarkdownLinks) {
        linkText = `[${suggestion.display}](${encodeURI(suggestion.file.path)})`;
      } else {
        const linkPath = suggestion.file.path.replace(".md", "");
        linkText = `[[${linkPath}|${suggestion.display}]]`;
      }
    } else {
      if (useMarkdownLinks) {
        linkText = `[${suggestion.file.path.replace(".md", "")}](${encodeURI(suggestion.file.path)})`;
      } else {
        const linkPath = suggestion.file.path.replace(".md", "");
        linkText = `[[${linkPath}]]`;
      }
    }
    editor.replaceRange(linkText, { line: start.line, ch: start.ch }, endPos);
    const newCursorPos = start.ch + linkText.length;
    try {
      editor.setCursor({ line: start.line, ch: newCursorPos });
    } catch (e) {
      new import_obsidian2.Notice("Error setting cursor position. Please check console for details.");
    }
  }
  getQuickSwitcherOptions() {
    var _a;
    try {
      const internalPlugins = this.app.internalPlugins;
      if (!internalPlugins) return null;
      const switcherPlugin = (_a = internalPlugins.getPluginById) == null ? void 0 : _a.call(internalPlugins, "switcher");
      if (!switcherPlugin || !switcherPlugin.instance) {
        return null;
      }
      return switcherPlugin.instance.options || null;
    } catch (e) {
      return null;
    }
  }
};

// src/ui/SettingTab.ts
var import_obsidian4 = require("obsidian");

// src/utils/settings-compat.ts
var import_obsidian3 = require("obsidian");
var ObsidianModule = __toESM(require("obsidian"), 1);
function createSettingsGroup(containerEl, heading, manifestId) {
  if ((0, import_obsidian3.requireApiVersion)("1.11.0")) {
    const SettingGroupClass = ObsidianModule.SettingGroup;
    if (SettingGroupClass) {
      const group = heading ? new SettingGroupClass(containerEl).setHeading(heading) : new SettingGroupClass(containerEl);
      return {
        addSetting(cb) {
          group.addSetting(cb);
        }
      };
    }
  }
  if (manifestId) {
    containerEl.addClass(`${manifestId}-settings-compat`);
  }
  {
    if (heading) {
      const headingEl = containerEl.createDiv("setting-group-heading");
      headingEl.createEl("h3", { text: heading });
    }
    return {
      addSetting(cb) {
        const setting = new import_obsidian3.Setting(containerEl);
        cb(setting);
      }
    };
  }
}

// src/ui/SettingTab.ts
var SettingTab = class extends import_obsidian4.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.icon = "lucide-type";
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.addClass("property-over-filename-settings");
    const generalGroup = createSettingsGroup(containerEl, void 0, "property-over-file-name");
    generalGroup.addSetting((setting) => {
      setting.setName("Property key").setDesc("The property to use as the display title. Falls back to the file name when no property is set for that item.").addText(
        (text) => text.setPlaceholder("Title").setValue(this.plugin.settings.propertyKey).onChange(async (value) => {
          this.plugin.settings.propertyKey = value.trim() || "title";
          await this.plugin.saveData(this.plugin.settings);
          this.plugin.updateLinkSuggester();
          this.plugin.updateGraphView();
          this.plugin.updateBacklinks();
          this.plugin.updateTabs();
          this.plugin.updateExplorer();
          this.plugin.updateWindowFrame();
          this.plugin.updateBookmarks();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("When linking notes").setDesc("Enable property-based titles in the link suggester.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.enableForLinking).onChange(async (value) => {
          this.plugin.settings.enableForLinking = value;
          await this.plugin.saveData(this.plugin.settings);
          this.plugin.updateLinkSuggester();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("In quick switcher").setDesc("Enable property-based titles in the quick switcher.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.enableForQuickSwitcher).onChange(async (value) => {
          const prevQuickSwitcherState = this.plugin.settings.enableForQuickSwitcher;
          this.plugin.settings.enableForQuickSwitcher = value;
          await this.plugin.saveSettings(prevQuickSwitcherState);
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("Include file name in fuzzy searches").setDesc("Include note file names in fuzzy search results for link suggester and quick switcher.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.includeFilenameInSearch).onChange(async (value) => {
          this.plugin.settings.includeFilenameInSearch = value;
          await this.plugin.saveData(this.plugin.settings);
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("Include aliases in fuzzy searches").setDesc("Include property aliases in fuzzy search results for link suggester and quick switcher.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.includeAliasesInSearch).onChange(async (value) => {
          this.plugin.settings.includeAliasesInSearch = value;
          await this.plugin.saveData(this.plugin.settings);
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("When dragging notes").setDesc("Use property-based titles when dragging notes from the file explorer.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.enableForDragDrop).onChange(async (value) => {
          this.plugin.settings.enableForDragDrop = value;
          await this.plugin.saveData(this.plugin.settings);
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("When naming bookmarks").setDesc("Automatically use the configured property value as the default name when creating a bookmark.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.enableForBookmarks).onChange(async (value) => {
          this.plugin.settings.enableForBookmarks = value;
          await this.plugin.saveData(this.plugin.settings);
          this.plugin.updateBookmarks();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("In graph view").setDesc("Use the property instead of the file name as the note's title in graph view.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.enableForGraphView).onChange(async (value) => {
          this.plugin.settings.enableForGraphView = value;
          await this.plugin.saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("In backlinks and outgoing links").setDesc("Use the property instead of the file name in the linked mentions footer, dedicated backlinks panel, and outgoing links.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.enableForBacklinks).onChange(async (value) => {
          this.plugin.settings.enableForBacklinks = value;
          await this.plugin.saveData(this.plugin.settings);
          this.plugin.updateBacklinks();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("In tab titles").setDesc("Use the property instead of the file name in tab titles.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.enableForTabs).onChange(async (value) => {
          const prevTabState = this.plugin.settings.enableForTabs;
          this.plugin.settings.enableForTabs = value;
          await this.plugin.saveSettings(void 0, prevTabState);
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("In window frame title").setDesc("Use the property instead of the file name in the browser window title bar.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.enableForWindowFrame).onChange(async (value) => {
          this.plugin.settings.enableForWindowFrame = value;
          await this.plugin.saveData(this.plugin.settings);
          this.plugin.updateWindowFrame();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("In file explorer").setDesc("Use the property instead of the file name in the file explorer.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.enableForExplorer).onChange(async (value) => {
          this.plugin.settings.enableForExplorer = value;
          await this.plugin.saveData(this.plugin.settings);
          this.plugin.updateExplorer();
          this.display();
        })
      );
    });
    if (this.plugin.settings.enableForExplorer) {
      generalGroup.addSetting((setting) => {
        setting.setName("Folder note file name").setDesc("If a folder contains a file with this name that has the configured property, the folder will display that property value instead. This ensures compatibility with folder notes plugins. Leave blank to disable.").addText(
          (text) => text.setPlaceholder("Index").setValue(this.plugin.settings.folderNoteFilename).onChange(async (value) => {
            this.plugin.settings.folderNoteFilename = value.trim();
            await this.plugin.saveData(this.plugin.settings);
            this.plugin.updateExplorer();
          })
        );
      });
    }
    generalGroup.addSetting((setting) => {
      setting.setName("Use simple search").setDesc("Instead of using fuzzy search, simple search provides better performance with very large vaults (thousands of files).").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.useSimpleSearch).onChange(async (value) => {
          this.plugin.settings.useSimpleSearch = value;
          await this.plugin.saveData(this.plugin.settings);
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("Enable Mdx file support").setDesc("Enable support for .mdx files. When enabled, the plugin will read properties from Mdx files manually (Obsidian's metadata cache only works for .md files). Note: Mdx support is partial - graph view is not supported due to technical limitations.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.enableMdxSupport).onChange(async (value) => {
          this.plugin.settings.enableMdxSupport = value;
          await this.plugin.saveSettings();
          this.plugin.rebuildCache();
          this.plugin.updateLinkSuggester();
          this.plugin.updateQuickSwitcher();
          this.plugin.updateGraphView();
          this.plugin.updateBacklinks();
          this.plugin.updateTabs();
          this.plugin.updateExplorer();
          this.plugin.updateWindowFrame();
          this.plugin.updateBookmarks();
        })
      );
    });
  }
};

// src/commands/index.ts
var import_obsidian6 = require("obsidian");
function registerCommands(plugin) {
  plugin.addCommand({
    id: "open-quick-switcher",
    name: "Open quick switcher (property-based)",
    callback: async () => {
      const { QuickSwitchModal: QuickSwitchModal2 } = await Promise.resolve().then(() => (init_QuickSwitchModal(), QuickSwitchModal_exports));
      new QuickSwitchModal2(plugin.app, plugin).open();
    }
  });
  plugin.addCommand({
    id: "toggle-linking",
    name: "Toggle property-based linking",
    callback: async () => {
      plugin.settings.enableForLinking = !plugin.settings.enableForLinking;
      await plugin.saveData(plugin.settings);
      plugin.updateLinkSuggester();
      new import_obsidian6.Notice(`Property-based linking ${plugin.settings.enableForLinking ? "enabled" : "disabled"}`);
    }
  });
  plugin.addCommand({
    id: "toggle-quick-switcher",
    name: "Toggle property-based quick switcher",
    callback: async () => {
      const prevState = plugin.settings.enableForQuickSwitcher;
      plugin.settings.enableForQuickSwitcher = !plugin.settings.enableForQuickSwitcher;
      await plugin.saveSettings(prevState);
      new import_obsidian6.Notice(`Property-based Quick Switcher ${plugin.settings.enableForQuickSwitcher ? "enabled" : "disabled"}`);
    }
  });
  plugin.addCommand({
    id: "rebuild-cache",
    name: "Rebuild file cache",
    callback: () => {
      plugin.rebuildCache();
      new import_obsidian6.Notice("File cache rebuilt");
    }
  });
  plugin.addCommand({
    id: "toggle-drag-drop",
    name: "Toggle property-based drag and drop",
    callback: async () => {
      plugin.settings.enableForDragDrop = !plugin.settings.enableForDragDrop;
      await plugin.saveData(plugin.settings);
      new import_obsidian6.Notice(`Property-based drag and drop ${plugin.settings.enableForDragDrop ? "enabled" : "disabled"}`);
    }
  });
}

// src/services/QuickSwitcherService.ts
var QuickSwitcherService = class {
  constructor(plugin) {
    this.isCommandOverridden = false;
    this.plugin = plugin;
  }
  updateQuickSwitcher() {
    if (this.plugin.settings.enableForQuickSwitcher && !this.isCommandOverridden) {
      this.overrideQuickSwitcherCommand();
    } else if (!this.plugin.settings.enableForQuickSwitcher && this.isCommandOverridden) {
      this.restoreOriginalCommand();
    }
  }
  overrideQuickSwitcherCommand() {
    var _a;
    const commands = this.plugin.app.commands.commands;
    if (commands["switcher:open"] && !this.originalSwitcherCommand) {
      const originalCmd = commands["switcher:open"];
      this.originalSwitcherCommand = {
        id: originalCmd.id || "switcher:open",
        name: originalCmd.name || "Quick Switcher",
        icon: originalCmd.icon,
        hotkeys: originalCmd.hotkeys ? [...originalCmd.hotkeys] : [],
        callback: originalCmd.callback
      };
    }
    if (commands["switcher:open"]) {
      delete commands["switcher:open"];
    }
    const customCommand = {
      id: "switcher:open",
      name: "Quick Switcher",
      icon: (_a = this.originalSwitcherCommand) == null ? void 0 : _a.icon,
      hotkeys: [{ modifiers: ["Mod"], key: "o" }],
      callback: () => {
        const workspace = this.plugin.app.workspace;
        if (workspace.switcher && typeof workspace.switcher.close === "function") {
          workspace.switcher.close();
        }
        const existingModals = document.querySelectorAll(".modal");
        existingModals.forEach((modal) => {
          if (modal instanceof HTMLElement && !modal.classList.contains("hidden")) {
            modal.addClass("hidden");
          }
        });
        try {
          Promise.resolve().then(() => (init_QuickSwitchModal(), QuickSwitchModal_exports)).then(({ QuickSwitchModal: QuickSwitchModal2 }) => {
            const modal = new QuickSwitchModal2(this.plugin.app, this.plugin);
            modal.open();
          }).catch(() => {
            if (this.originalSwitcherCommand && this.originalSwitcherCommand.callback) {
              this.originalSwitcherCommand.callback();
            }
          });
        } catch (e) {
          if (this.originalSwitcherCommand && this.originalSwitcherCommand.callback) {
            this.originalSwitcherCommand.callback();
          }
        }
      }
    };
    commands["switcher:open"] = customCommand;
    this.isCommandOverridden = true;
  }
  restoreOriginalCommand() {
    if (!this.originalSwitcherCommand) {
      return;
    }
    const commands = this.plugin.app.commands.commands;
    if (commands["switcher:open"]) {
      delete commands["switcher:open"];
    }
    commands["switcher:open"] = {
      id: this.originalSwitcherCommand.id,
      name: this.originalSwitcherCommand.name,
      icon: this.originalSwitcherCommand.icon,
      hotkeys: this.originalSwitcherCommand.hotkeys,
      callback: this.originalSwitcherCommand.callback
    };
    this.isCommandOverridden = false;
  }
};

// src/services/DragDropService.ts
var import_obsidian7 = require("obsidian");
init_frontmatter();
var DragDropService = class {
  // Prevent duplicate processing within 100ms
  constructor(plugin) {
    this.lastDropTime = 0;
    this.lastDropData = null;
    this.DROP_DEBOUNCE_MS = 100;
    this.plugin = plugin;
  }
  handleDragDrop(event, editor) {
    const dataTransfer = event.dataTransfer;
    if (!dataTransfer) {
      return;
    }
    const filePath = dataTransfer.getData("text/plain");
    if (!filePath || !filePath.endsWith(".md") && !(filePath.endsWith(".mdx") && this.plugin.settings.enableMdxSupport)) {
      return;
    }
    const now = Date.now();
    if (now - this.lastDropTime < this.DROP_DEBOUNCE_MS && this.lastDropData === filePath) {
      return;
    }
    this.lastDropTime = now;
    this.lastDropData = filePath;
    const file = this.plugin.app.vault.getAbstractFileByPath(filePath);
    if (!file || !(file instanceof import_obsidian7.TFile)) {
      return;
    }
    if (file.extension === "md") {
      const displayName = this.getDisplayNameSync(file);
      if (displayName !== null) {
        setTimeout(() => {
          this.replaceLastInsertedLink(file, displayName, editor);
        }, 50);
      }
    } else if (file.extension === "mdx" && this.plugin.settings.enableMdxSupport) {
      void (async () => {
        const displayName = await this.getDisplayName(file);
        if (displayName !== null) {
          let attempts = 0;
          const maxAttempts = 5;
          const attemptReplace = () => {
            attempts++;
            const replaced = this.replaceLastInsertedLink(file, displayName, editor);
            if (!replaced && attempts < maxAttempts) {
              setTimeout(attemptReplace, 50 * attempts);
            }
          };
          setTimeout(attemptReplace, 150);
        }
      })();
    }
  }
  handleDOMDrop(event) {
    const target = event.target;
    const editorElement = target == null ? void 0 : target.closest(".cm-editor");
    const activeView = this.plugin.app.workspace.getActiveViewOfType(import_obsidian7.MarkdownView);
    const hasActiveEditor = activeView && activeView.editor;
    if (!editorElement && !hasActiveEditor) {
      return;
    }
    const dataTransfer = event.dataTransfer;
    if (!dataTransfer) {
      return;
    }
    const filePath = dataTransfer.getData("text/plain");
    if (!filePath) {
      return;
    }
    let actualFilePath = filePath;
    if (filePath.startsWith("obsidian://open?")) {
      try {
        const url = new URL(filePath);
        const fileParam = url.searchParams.get("file");
        if (fileParam) {
          const decodedPath = decodeURIComponent(fileParam);
          if (decodedPath.endsWith(".mdx")) {
            actualFilePath = decodedPath;
          } else if (decodedPath.endsWith(".md")) {
            actualFilePath = decodedPath;
          } else {
            if (this.plugin.settings.enableMdxSupport) {
              const mdxFile = this.plugin.app.vault.getAbstractFileByPath(decodedPath + ".mdx");
              if (mdxFile) {
                actualFilePath = decodedPath + ".mdx";
              } else {
                actualFilePath = decodedPath + ".md";
              }
            } else {
              actualFilePath = decodedPath + ".md";
            }
          }
        } else {
          return;
        }
      } catch (e) {
        return;
      }
    } else if (!filePath.endsWith(".md") && !(filePath.endsWith(".mdx") && this.plugin.settings.enableMdxSupport)) {
      return;
    }
    const now = Date.now();
    if (now - this.lastDropTime < this.DROP_DEBOUNCE_MS && this.lastDropData === actualFilePath) {
      return;
    }
    this.lastDropTime = now;
    this.lastDropData = actualFilePath;
    const file = this.plugin.app.vault.getAbstractFileByPath(actualFilePath);
    if (!file || !(file instanceof import_obsidian7.TFile)) {
      return;
    }
    (() => {
      if (file.extension === "md") {
        const displayName = this.getDisplayNameSync(file);
        if (displayName !== null) {
          setTimeout(() => {
            const activeView2 = this.plugin.app.workspace.getActiveViewOfType(import_obsidian7.MarkdownView);
            if (activeView2 && activeView2.editor) {
              this.replaceLastInsertedLink(file, displayName, activeView2.editor);
            }
          }, 50);
        }
      } else if (file.extension === "mdx" && this.plugin.settings.enableMdxSupport) {
        void (async () => {
          const displayName = await this.getDisplayName(file);
          if (displayName !== null) {
            let attempts = 0;
            const maxAttempts = 5;
            const attemptReplace = () => {
              attempts++;
              const activeView2 = this.plugin.app.workspace.getActiveViewOfType(import_obsidian7.MarkdownView);
              if (activeView2 && activeView2.editor) {
                const replaced = this.replaceLastInsertedLink(file, displayName, activeView2.editor);
                if (!replaced && attempts < maxAttempts) {
                  setTimeout(attemptReplace, 50 * attempts);
                }
              } else if (attempts < maxAttempts) {
                setTimeout(attemptReplace, 50 * attempts);
              }
            };
            setTimeout(attemptReplace, 150);
          }
        })();
      }
    })();
  }
  /**
   * Synchronous version for .md files (fast, immediate)
   */
  getDisplayNameSync(file) {
    if (file.extension !== "md") {
      return null;
    }
    const frontmatter = getFrontmatterSync(this.plugin.app, file, this.plugin.settings);
    if (frontmatter && frontmatter[this.plugin.settings.propertyKey] !== void 0 && frontmatter[this.plugin.settings.propertyKey] !== null) {
      const propertyValue = String(frontmatter[this.plugin.settings.propertyKey]).trim();
      if (propertyValue !== "") {
        return propertyValue;
      }
    }
    return null;
  }
  /**
   * Async version for .mdx files (needs file reading)
   */
  async getDisplayName(file) {
    const { getFrontmatter: getFrontmatter2, isFileTypeSupported: isFileTypeSupported2 } = await Promise.resolve().then(() => (init_frontmatter(), frontmatter_exports));
    if (!isFileTypeSupported2(file.extension, this.plugin.settings)) {
      return null;
    }
    const frontmatter = await getFrontmatter2(this.plugin.app, file, this.plugin.settings);
    if (frontmatter && frontmatter[this.plugin.settings.propertyKey] !== void 0 && frontmatter[this.plugin.settings.propertyKey] !== null) {
      const propertyValue = String(frontmatter[this.plugin.settings.propertyKey]).trim();
      if (propertyValue !== "") {
        return propertyValue;
      }
    }
    return null;
  }
  replaceLastInsertedLink(file, displayName, editor) {
    var _a, _b;
    const content = editor.getValue();
    const cursor = editor.getCursor();
    const lines = content.split("\n");
    const currentLine = lines[cursor.line];
    const wikiLinkRegex = /\[\[([^\]]+)\]\]/g;
    const markdownLinkRegex = /\[([^\]]*)\]\(([^)]+)\)/g;
    let match;
    let lastMatch = null;
    while ((match = wikiLinkRegex.exec(currentLine)) !== null) {
      lastMatch = match;
    }
    if (lastMatch) {
      const linkPath = lastMatch[1];
      const filePathWithoutExt = file.path.replace(/\.(md|mdx)$/, "");
      const linkPathWithoutExt = linkPath.replace(/\.(md|mdx)$/, "");
      if (filePathWithoutExt === linkPathWithoutExt || file.path === linkPath || file.path.replace(/\.mdx$/, ".md") === linkPath) {
        const newLinkText = `[[${linkPath}|${displayName}]]`;
        const startPos = { line: cursor.line, ch: lastMatch.index };
        const endPos = { line: cursor.line, ch: lastMatch.index + lastMatch[0].length };
        editor.replaceRange(newLinkText, startPos, endPos);
        return true;
      }
    }
    markdownLinkRegex.lastIndex = 0;
    lastMatch = null;
    while ((match = markdownLinkRegex.exec(currentLine)) !== null) {
      lastMatch = match;
    }
    if (lastMatch) {
      const linkUrl = lastMatch[2];
      const linkUrlDecoded = decodeURIComponent(linkUrl);
      const filePathEncoded = encodeURI(file.path);
      const filePathWithoutExt = file.path.replace(/\.(md|mdx)$/, "");
      const linkUrlWithoutExt = linkUrlDecoded.replace(/\.(md|mdx)$/, "");
      const matches = file.path === linkUrlDecoded || filePathEncoded === linkUrl || filePathWithoutExt === linkUrlWithoutExt || file.path.replace(/\.mdx$/, ".md") === linkUrlDecoded || file.path.replace(/\.md$/, ".mdx") === linkUrlDecoded || // Handle relative paths - check if link URL matches file basename
      file.basename === linkUrlDecoded.replace(/\.(md|mdx)$/, "") || file.basename + ".mdx" === linkUrlDecoded || file.basename + ".md" === linkUrlDecoded || // Handle paths with directory
      file.path.endsWith(linkUrlDecoded) || linkUrlDecoded.endsWith(file.path);
      if (matches) {
        const newLinkText = `[${displayName}](${linkUrl})`;
        const startPos = { line: cursor.line, ch: lastMatch.index };
        const endPos = { line: cursor.line, ch: lastMatch.index + lastMatch[0].length };
        editor.replaceRange(newLinkText, startPos, endPos);
        return true;
      }
    } else {
      const searchRange = 3;
      for (let i = Math.max(0, cursor.line - searchRange); i <= Math.min(lines.length - 1, cursor.line + searchRange); i++) {
        const line = lines[i];
        const wikiMatches = [...line.matchAll(/\[\[([^\]]+)\]\]/g)];
        const markdownMatches = [...line.matchAll(/\[([^\]]*)\]\(([^)]+)\)/g)];
        for (const wikiMatch of wikiMatches) {
          const linkPath = wikiMatch[1];
          const filePathWithoutExt = file.path.replace(/\.(md|mdx)$/, "");
          const linkPathWithoutExt = linkPath.replace(/\.(md|mdx)$/, "");
          if (filePathWithoutExt === linkPathWithoutExt || file.path === linkPath || file.path.replace(/\.mdx$/, ".md") === linkPath) {
            const newLinkText = `[[${linkPath}|${displayName}]]`;
            const matchIndex = (_a = wikiMatch.index) != null ? _a : 0;
            const startPos = { line: i, ch: matchIndex };
            const endPos = { line: i, ch: matchIndex + wikiMatch[0].length };
            editor.replaceRange(newLinkText, startPos, endPos);
            return true;
          }
        }
        for (const mdMatch of markdownMatches) {
          const linkUrl = mdMatch[2];
          const linkUrlDecoded = decodeURIComponent(linkUrl);
          const filePathWithoutExt = file.path.replace(/\.(md|mdx)$/, "");
          const linkUrlWithoutExt = linkUrlDecoded.replace(/\.(md|mdx)$/, "");
          const matches = file.path === linkUrlDecoded || encodeURI(file.path) === linkUrl || file.path.replace(/\.mdx$/, ".md") === linkUrlDecoded || file.path.replace(/\.md$/, ".mdx") === linkUrlDecoded || filePathWithoutExt === linkUrlWithoutExt || // Handle relative paths - check if link URL matches file basename
          file.basename === linkUrlDecoded.replace(/\.(md|mdx)$/, "") || file.basename + ".mdx" === linkUrlDecoded || file.basename + ".md" === linkUrlDecoded || // Handle paths with directory
          file.path.endsWith(linkUrlDecoded) || linkUrlDecoded.endsWith(file.path);
          if (matches) {
            const newLinkText = `[${displayName}](${linkUrl})`;
            const matchIndex = (_b = mdMatch.index) != null ? _b : 0;
            const startPos = { line: i, ch: matchIndex };
            const endPos = { line: i, ch: matchIndex + mdMatch[0].length };
            editor.replaceRange(newLinkText, startPos, endPos);
            return true;
          }
        }
      }
    }
    return false;
  }
};

// src/services/CacheService.ts
var CacheService = class {
  constructor(plugin) {
    this.plugin = plugin;
  }
  setSuggest(suggest) {
    this.suggest = suggest;
  }
  invalidateCache(file) {
    if (this.suggest) {
      void this.suggest.updateFileCache(file);
    }
  }
  rebuildCache() {
    if (this.suggest) {
      void this.suggest.buildFileCache();
    }
  }
};

// src/services/GraphViewService.ts
var import_obsidian8 = require("obsidian");

// src/utils/frontmatter-cache.ts
init_frontmatter();
var FrontmatterCache = class {
  constructor() {
    this.cache = /* @__PURE__ */ new Map();
    this.pending = /* @__PURE__ */ new Map();
  }
  async get(app, file, settings) {
    var _a;
    const key = file.path;
    if (this.cache.has(key)) {
      return (_a = this.cache.get(key)) != null ? _a : null;
    }
    if (this.pending.has(key)) {
      return await this.pending.get(key);
    }
    const promise = getFrontmatter(app, file, settings);
    this.pending.set(key, promise);
    try {
      const result = await promise;
      this.cache.set(key, result);
      return result;
    } finally {
      this.pending.delete(key);
    }
  }
  getSync(key) {
    return this.cache.get(key);
  }
  invalidate(key) {
    this.cache.delete(key);
    this.pending.delete(key);
  }
  clear() {
    this.cache.clear();
    this.pending.clear();
  }
};
var frontmatterCache = new FrontmatterCache();

// src/services/GraphViewService.ts
var graphDisplaySettings = null;
function createGetDisplayText(app) {
  return function getDisplayText() {
    if (!(graphDisplaySettings == null ? void 0 : graphDisplaySettings.enableForGraphView)) {
      if (this.pov_originalGetDisplayText) {
        return this.pov_originalGetDisplayText();
      }
      throw new Error("pov_originalGetDisplayText does not exist on node");
    }
    const file = app.vault.getFileByPath(this.id);
    if (file) {
      if (file.extension === "md" || file.extension === "mdx" && graphDisplaySettings.enableMdxSupport) {
        if (file.extension === "md") {
          const fileCache = app.metadataCache.getFileCache(file);
          const mdFrontmatter = fileCache == null ? void 0 : fileCache.frontmatter;
          if (mdFrontmatter && mdFrontmatter[graphDisplaySettings.propertyKey] !== void 0 && mdFrontmatter[graphDisplaySettings.propertyKey] !== null) {
            const propertyValue = String(mdFrontmatter[graphDisplaySettings.propertyKey]).trim();
            if (propertyValue !== "") {
              return propertyValue;
            }
          }
        } else if (file.extension === "mdx") {
          const cached = frontmatterCache.getSync(file.path);
          if (cached !== void 0) {
            if (cached && cached[graphDisplaySettings.propertyKey] !== void 0 && cached[graphDisplaySettings.propertyKey] !== null) {
              const propertyValue = String(cached[graphDisplaySettings.propertyKey]).trim();
              if (propertyValue !== "") {
                return propertyValue;
              }
            }
          } else {
            void frontmatterCache.get(app, file, { enableMdxSupport: graphDisplaySettings.enableMdxSupport, propertyKey: graphDisplaySettings.propertyKey });
          }
        }
      }
    }
    if (this.pov_originalGetDisplayText) {
      return this.pov_originalGetDisplayText();
    }
    throw new Error("pov_originalGetDisplayText does not exist on node");
  };
}
var GraphViewService = class {
  constructor(plugin) {
    this.modifiedPrototypes = [];
    this.observer = null;
    this.timer = null;
    this.plugin = plugin;
    graphDisplaySettings = {
      enableForGraphView: plugin.settings.enableForGraphView,
      propertyKey: plugin.settings.propertyKey,
      enableMdxSupport: plugin.settings.enableMdxSupport,
      app: plugin.app
    };
  }
  getGraphLeaves() {
    const leaves = [];
    leaves.push(...this.plugin.app.workspace.getLeavesOfType("graph"));
    leaves.push(...this.plugin.app.workspace.getLeavesOfType("localgraph"));
    return [...new Set(leaves)];
  }
  async overridePrototypes() {
    const leaves = this.getGraphLeaves();
    for (const leaf of leaves) {
      if (!(leaf.view instanceof import_obsidian8.View) || leaf.isDeferred) continue;
      const view = leaf.view;
      await this.overridePrototype(view);
    }
  }
  async overridePrototype(view) {
    let nodeCount = 0;
    for (const graphNode of view.renderer.nodes) {
      nodeCount++;
    }
    if (nodeCount === 0) {
      setTimeout(() => {
        void this.overridePrototype(view);
      }, 1e3);
      return;
    }
    if (graphDisplaySettings == null ? void 0 : graphDisplaySettings.enableMdxSupport) {
      const mdxPromises = [];
      for (const graphNode of view.renderer.nodes) {
        const file = graphDisplaySettings.app.vault.getFileByPath(graphNode.id);
        if (file && file.extension === "mdx") {
          const promise = frontmatterCache.get(graphDisplaySettings.app, file, { enableMdxSupport: graphDisplaySettings.enableMdxSupport, propertyKey: graphDisplaySettings.propertyKey });
          mdxPromises.push(promise.then(() => {
          }));
        }
      }
      if (mdxPromises.length > 0) {
        await Promise.all(mdxPromises);
      }
    }
    const node = view.renderer.nodes.first();
    if (node) {
      const proto = node.constructor.prototype;
      if (!proto.hasOwnProperty("pov_originalGetDisplayText") && !this.modifiedPrototypes.contains(proto)) {
        proto.pov_originalGetDisplayText = proto.getDisplayText;
        proto.getDisplayText = createGetDisplayText(this.plugin.app);
        let updatedCount = 0;
        for (const node2 of view.renderer.nodes) {
          if (node2.text) {
            node2.text.text = node2.getDisplayText();
            updatedCount++;
          }
        }
        view.renderer.changed();
        this.modifiedPrototypes.push(proto);
      }
    }
  }
  restorePrototypes() {
    for (const proto of this.modifiedPrototypes) {
      if (typeof proto.pov_originalGetDisplayText === "function") {
        proto.getDisplayText = proto.pov_originalGetDisplayText;
        delete proto.pov_originalGetDisplayText;
      }
    }
    this.modifiedPrototypes = [];
    this.rewriteNames();
  }
  rewriteNames() {
    const leaves = this.getGraphLeaves();
    for (const leaf of leaves) {
      if (!(leaf.view instanceof import_obsidian8.View) || leaf.isDeferred) continue;
      const view = leaf.view;
      for (const node of view.renderer.nodes) {
        if (node.text) node.text.text = node.getDisplayText();
      }
      view.renderer.changed();
    }
  }
  onLayoutChange() {
    var _a;
    this.cleanupObserver();
    if (!this.plugin.settings.enableForGraphView) {
      this.restorePrototypes();
      return;
    }
    const appInternal = this.plugin.app;
    const isGraphLoaded = (_a = appInternal.internalPlugins.getPluginById("graph")) == null ? void 0 : _a._loaded;
    if (!isGraphLoaded) return;
    this.setupObserver();
    void this.overridePrototypes();
  }
  setupObserver() {
    const leaves = this.getGraphLeaves();
    for (const leaf of leaves) {
      const container = leaf.view.containerEl;
      if (!container) continue;
      if (!this.observer) {
        this.observer = new MutationObserver(() => {
          if (this.timer) window.clearTimeout(this.timer);
          this.timer = window.setTimeout(() => {
            void this.overridePrototypes();
          }, 500);
        });
      }
      this.observer.observe(container, {
        childList: true,
        subtree: true
      });
    }
  }
  cleanupObserver() {
    if (this.observer) {
      this.observer.disconnect();
      this.observer = null;
    }
    if (this.timer) {
      window.clearTimeout(this.timer);
      this.timer = null;
    }
  }
  updateGraphView() {
    if (graphDisplaySettings) {
      graphDisplaySettings.enableForGraphView = this.plugin.settings.enableForGraphView;
      graphDisplaySettings.propertyKey = this.plugin.settings.propertyKey;
      graphDisplaySettings.enableMdxSupport = this.plugin.settings.enableMdxSupport;
    }
    if (this.plugin.settings.enableForGraphView) {
      void this.overridePrototypes();
    } else {
      this.restorePrototypes();
    }
  }
  refreshGraphView() {
    if (this.plugin.settings.enableForGraphView) {
      this.rewriteNames();
    }
  }
  onunload() {
    this.cleanupObserver();
    this.restorePrototypes();
  }
};

// src/services/BacklinkService.ts
var import_obsidian9 = require("obsidian");
var BacklinkService = class {
  constructor(plugin) {
    this.processedElements = /* @__PURE__ */ new WeakSet();
    this.modifiedElements = /* @__PURE__ */ new WeakSet();
    this.originalTextContentDescriptors = /* @__PURE__ */ new Map();
    this.plugin = plugin;
  }
  /**
   * Get display name from file's frontmatter property
   */
  async getDisplayName(file) {
    if (!this.plugin.settings.enableForBacklinks) {
      return null;
    }
    const { getFrontmatter: getFrontmatter2, isFileTypeSupported: isFileTypeSupported2 } = await Promise.resolve().then(() => (init_frontmatter(), frontmatter_exports));
    if (!isFileTypeSupported2(file.extension, this.plugin.settings)) {
      return null;
    }
    const frontmatter = await getFrontmatter2(this.plugin.app, file, this.plugin.settings);
    if (frontmatter && frontmatter[this.plugin.settings.propertyKey] !== void 0 && frontmatter[this.plugin.settings.propertyKey] !== null) {
      const propertyValue = String(frontmatter[this.plugin.settings.propertyKey]).trim();
      if (propertyValue !== "") {
        return propertyValue;
      }
    }
    return null;
  }
  /**
   * Update all backlink displays
   */
  updateBacklinks() {
    if (!this.plugin.settings.enableForBacklinks) {
      this.stopObserving();
      return;
    }
    this.updateEmbeddedBacklinks();
    void this.updateDedicatedBacklinksPanel();
    this.startObserving();
  }
  /**
   * Update embedded backlinks in markdown views
   */
  updateEmbeddedBacklinks() {
    for (const leaf of this.plugin.app.workspace.getLeavesOfType("markdown")) {
      if (!(leaf.view instanceof import_obsidian9.MarkdownView)) {
        continue;
      }
      const embeddedBacklinks = leaf.view.containerEl.querySelector(".embedded-backlinks");
      if (embeddedBacklinks) {
        this.updateBacklinkContainer(embeddedBacklinks);
      }
    }
  }
  /**
   * Update dedicated backlinks panel
   */
  async updateDedicatedBacklinksPanel() {
    const backlinksLeaves = this.plugin.app.workspace.getLeavesOfType("backlink");
    for (const leaf of backlinksLeaves) {
      await leaf.loadIfDeferred();
      if (leaf.view) {
        const container = leaf.view.containerEl;
        if (container) {
          const backlinksContainer = container.querySelector(".backlinks-pane") || container.querySelector(".backlink-pane");
          if (backlinksContainer) {
            this.updateBacklinkContainer(backlinksContainer);
          }
          const outgoingLinksContainer = container.querySelector(".outgoing-link-pane") || container.querySelector(".outgoing-links");
          if (outgoingLinksContainer) {
            this.updateBacklinkContainer(outgoingLinksContainer);
          }
        }
      }
    }
  }
  /**
   * Extract file path from an element or its parent link
   */
  extractFilePathFromElement(element) {
    var _a;
    const dataPath = element.getAttribute("data-path");
    if (dataPath) {
      const file = this.plugin.app.vault.getAbstractFileByPath(dataPath);
      if (file instanceof import_obsidian9.TFile) {
        return file;
      }
    }
    const link = element.closest("a") || element.querySelector("a");
    if (link) {
      const href = link instanceof HTMLAnchorElement ? link.href : link.getAttribute("href");
      if (href) {
        if (href.startsWith("obsidian://")) {
          try {
            const url = new URL(href);
            const fileParam = url.searchParams.get("file");
            if (fileParam) {
              const decodedPath = decodeURIComponent(fileParam);
              const file = this.plugin.app.vault.getAbstractFileByPath(decodedPath + ".md");
              if (file instanceof import_obsidian9.TFile) {
                return file;
              }
            }
          } catch (e) {
          }
        }
        const internalLinkMatch = href.match(/#file\/(.+)/);
        if (internalLinkMatch) {
          const filePath = decodeURIComponent(internalLinkMatch[1]);
          const file = this.plugin.app.vault.getAbstractFileByPath(filePath);
          if (file instanceof import_obsidian9.TFile) {
            return file;
          }
        }
        const dataHref = link.getAttribute("data-href");
        if (dataHref) {
          const file = this.plugin.app.vault.getAbstractFileByPath(dataHref);
          if (file instanceof import_obsidian9.TFile) {
            return file;
          }
        }
      }
    }
    const textContent = (_a = element.textContent) == null ? void 0 : _a.trim();
    if (textContent) {
      const allFiles = this.plugin.app.vault.getMarkdownFiles();
      const matchingFile = allFiles.find((f) => f.basename === textContent);
      if (matchingFile) {
        return matchingFile;
      }
    }
    return null;
  }
  /**
   * Update a backlink container by replacing file names with property titles
   */
  updateBacklinkContainer(container) {
    const selectors = [
      ".tree-item-inner",
      ".backlink-title",
      ".backlink-file-link",
      ".outgoing-link-file-link",
      ".tree-item-self",
      ".nav-file-title",
      "[data-path]",
      "a.internal-link"
    ];
    const fileElements = /* @__PURE__ */ new Set();
    selectors.forEach((selector) => {
      try {
        container.querySelectorAll(selector).forEach((el) => {
          fileElements.add(el);
        });
      } catch (e) {
      }
    });
    fileElements.forEach((element) => {
      if (this.processedElements.has(element)) {
        return;
      }
      const file = this.extractFilePathFromElement(element);
      if (file && file instanceof import_obsidian9.TFile) {
        this.updateElementWithFile(element, file);
      }
    });
  }
  /**
   * Update an element with file's display name
   */
  updateElementWithFile(element, file) {
    void (async () => {
      var _a;
      const displayName = await this.getDisplayName(file);
      if (displayName === null) {
        return;
      }
      this.processedElements.add(element);
      element.setAttribute("data-pov-processed", "true");
      const currentText = ((_a = element.textContent) == null ? void 0 : _a.trim()) || "";
      const basename = file.basename;
      if (currentText === basename || currentText === file.name || currentText.endsWith(basename)) {
        const link = element.closest("a") || element.querySelector("a");
        const targetElement = link || element;
        const updateTextInElement = (el) => {
          var _a2, _b;
          if (el.childNodes.length === 1 && el.childNodes[0].nodeType === Node.TEXT_NODE) {
            el.textContent = displayName;
            return true;
          }
          const textNodes = Array.from(el.childNodes).filter((node) => node.nodeType === Node.TEXT_NODE);
          if (textNodes.length > 0) {
            textNodes[0].textContent = displayName;
            for (let i = 1; i < textNodes.length; i++) {
              textNodes[i].remove();
            }
            return true;
          }
          if (((_a2 = el.textContent) == null ? void 0 : _a2.trim()) === basename || ((_b = el.textContent) == null ? void 0 : _b.trim()) === file.name) {
            el.textContent = displayName;
            return true;
          }
          return false;
        };
        if (!updateTextInElement(targetElement)) {
          updateTextInElement(element);
        }
      }
    })();
  }
  /**
   * Start observing DOM changes for backlinks
   */
  startObserving() {
    if (this.observer) {
      return;
    }
    this.overrideBacklinkElements();
    let updateTimeout = null;
    this.observer = new MutationObserver((mutations) => {
      let shouldUpdate = false;
      const newElements = [];
      for (const mutation of mutations) {
        if (mutation.type === "childList") {
          for (const node of Array.from(mutation.addedNodes)) {
            if (node instanceof HTMLElement) {
              const embeddedBacklinks = node.closest(".embedded-backlinks");
              const backlinksPanel = node.closest(".backlinks-pane, .backlink-pane, .outgoing-link-pane, .outgoing-links, .backlink-container");
              if (embeddedBacklinks || backlinksPanel) {
                shouldUpdate = true;
                const selectors = [".tree-item-inner", ".backlink-title", ".backlink-file-link", ".outgoing-link-file-link", ".tree-item-self", ".nav-file-title", "[data-path]", "a.internal-link"];
                selectors.forEach((selector) => {
                  var _a;
                  try {
                    const elements = (_a = node.querySelectorAll) == null ? void 0 : _a.call(node, selector);
                    elements == null ? void 0 : elements.forEach((el) => {
                      if (el instanceof HTMLElement) {
                        newElements.push(el);
                      }
                    });
                  } catch (e) {
                  }
                });
              }
            }
          }
        } else if (mutation.type === "characterData") {
          const target = mutation.target;
          if (target instanceof HTMLElement) {
            const embeddedBacklinks = target.closest(".embedded-backlinks");
            const backlinksPanel = target.closest(".backlinks-pane, .backlink-pane, .outgoing-link-pane, .outgoing-links, .backlink-container");
            if (embeddedBacklinks || backlinksPanel) {
              shouldUpdate = true;
            }
          } else if (target.parentElement) {
            const embeddedBacklinks = target.parentElement.closest(".embedded-backlinks");
            const backlinksPanel = target.parentElement.closest(".backlinks-pane, .backlink-pane, .outgoing-link-pane, .outgoing-links, .backlink-container");
            if (embeddedBacklinks || backlinksPanel) {
              shouldUpdate = true;
            }
          }
        }
      }
      newElements.forEach((el) => {
        this.overrideElementTextContent(el);
        const file = this.extractFilePathFromElement(el);
        if (file && file instanceof import_obsidian9.TFile) {
          void (async () => {
            var _a;
            const displayName = await this.getDisplayName(file);
            if (displayName) {
              const currentText = ((_a = el.textContent) == null ? void 0 : _a.trim()) || "";
              if (currentText === file.basename || currentText === file.name) {
                el.textContent = displayName;
                el.setAttribute("data-pov-processed", "true");
                this.processedElements.add(el);
              }
            }
          })();
        }
      });
      if (shouldUpdate) {
        this.processedElements = /* @__PURE__ */ new WeakSet();
        if (updateTimeout) {
          clearTimeout(updateTimeout);
        }
        updateTimeout = setTimeout(() => {
          this.updateBacklinks();
          this.overrideBacklinkElements();
          updateTimeout = null;
        }, 10);
      }
    });
    this.observer.observe(document.body, {
      childList: true,
      subtree: true,
      characterData: true
    });
  }
  /**
   * Override textContent on all backlink elements
   */
  overrideBacklinkElements() {
    const selectors = [
      ".tree-item-inner",
      ".backlink-title",
      ".backlink-file-link",
      ".outgoing-link-file-link",
      ".tree-item-self",
      ".nav-file-title",
      "[data-path]",
      "a.internal-link"
    ];
    const containers = [
      ...Array.from(document.querySelectorAll(".embedded-backlinks")),
      ...Array.from(document.querySelectorAll(".backlinks-pane")),
      ...Array.from(document.querySelectorAll(".backlink-pane")),
      ...Array.from(document.querySelectorAll(".outgoing-link-pane")),
      ...Array.from(document.querySelectorAll(".outgoing-links")),
      ...Array.from(document.querySelectorAll(".backlink-container"))
    ];
    containers.forEach((container) => {
      selectors.forEach((selector) => {
        try {
          container.querySelectorAll(selector).forEach((el) => {
            if (el instanceof HTMLElement) {
              this.overrideElementTextContent(el);
            }
          });
        } catch (e) {
        }
      });
    });
  }
  /**
   * Override textContent setter on an element to intercept Obsidian's updates
   */
  overrideElementTextContent(element) {
    if (this.modifiedElements.has(element)) {
      return;
    }
    const proto = Object.getPrototypeOf(element);
    const originalDescriptor = Object.getOwnPropertyDescriptor(proto, "textContent");
    if (originalDescriptor && originalDescriptor.set) {
      this.originalTextContentDescriptors.set(element, originalDescriptor);
      try {
        Object.defineProperty(element, "textContent", {
          set: (value) => {
            const file = this.extractFilePathFromElement(element);
            if (file && file instanceof import_obsidian9.TFile) {
              void (async () => {
                const displayName = await this.getDisplayName(file);
                if (displayName && (value === file.basename || value === file.name || value.endsWith(file.basename))) {
                  originalDescriptor.set.call(element, displayName);
                  element.setAttribute("data-pov-processed", "true");
                  this.processedElements.add(element);
                  return;
                }
                originalDescriptor.set.call(element, value);
              })();
              return;
            }
            originalDescriptor.set.call(element, value);
            element.setAttribute("data-pov-processed", "true");
          },
          // eslint-disable-next-line @typescript-eslint/unbound-method -- accessing property descriptor original setter
          get: originalDescriptor.get || (() => {
            var _a, _b;
            return ((_b = (_a = Object.getOwnPropertyDescriptor(HTMLElement.prototype, "textContent")) == null ? void 0 : _a.get) == null ? void 0 : _b.call(element)) || "";
          }),
          configurable: true,
          enumerable: true
        });
      } catch (e) {
        element.setAttribute("data-pov-processed", "true");
      }
    } else {
      element.setAttribute("data-pov-processed", "true");
    }
    this.modifiedElements.add(element);
  }
  /**
   * Stop observing DOM changes
   */
  stopObserving() {
    if (this.observer) {
      this.observer.disconnect();
      this.observer = void 0;
    }
  }
  /**
   * Handle layout changes
   */
  onLayoutChange() {
    if (this.plugin.settings.enableForBacklinks) {
      setTimeout(() => {
        this.updateBacklinks();
      }, 100);
    } else {
      this.stopObserving();
    }
  }
  /**
   * Handle file open events
   */
  onFileOpen() {
    if (this.plugin.settings.enableForBacklinks) {
      setTimeout(() => {
        this.updateEmbeddedBacklinks();
      }, 200);
    }
  }
  /**
   * Clean up on unload
   */
  onunload() {
    this.stopObserving();
    this.originalTextContentDescriptors.forEach((descriptor, element) => {
      try {
        Object.defineProperty(element, "textContent", descriptor);
      } catch (e) {
      }
    });
    this.originalTextContentDescriptors.clear();
    this.modifiedElements = /* @__PURE__ */ new WeakSet();
  }
};

// src/services/TabService.ts
init_frontmatter();
var TabService = class {
  constructor(plugin) {
    this.leafEventRefs = /* @__PURE__ */ new Map();
    this.plugin = plugin;
  }
  /**
   * Renames all markdown tabs to use the configured property value
   * Falls back to file basename if property is not found
   * EXACT copy of the working implementation from obsidian-title-only-tab
   */
  renameTabs() {
    const leaves = this.plugin.app.workspace.getLeavesOfType("markdown");
    leaves.forEach((leaf) => {
      var _a;
      const view = leaf.view;
      const state = leaf.getViewState();
      if (((_a = state.state) == null ? void 0 : _a.file) && !(view == null ? void 0 : view.file)) {
        void leaf.setViewState({ type: state.type, state: state.state });
      }
      if (view == null ? void 0 : view.file) {
        const file = view.file;
        void (async () => {
          const frontmatter = await getFrontmatter(this.plugin.app, file, this.plugin.settings);
          const propertyValue = frontmatter == null ? void 0 : frontmatter[this.plugin.settings.propertyKey];
          const tabHeaderEl = leaf.tabHeaderEl;
          if (tabHeaderEl) {
            tabHeaderEl.setAttribute("data-pov-title-set", "true");
            if (this.plugin.settings.enableForTabs) {
              const titleEl = tabHeaderEl.querySelector(".workspace-tab-header-inner-title");
              const displayText = propertyValue ? String(propertyValue) : file.basename;
              if (titleEl) {
                titleEl.setText(displayText);
              }
              tabHeaderEl.setAttribute("aria-label", displayText);
              tabHeaderEl.setAttribute("title", displayText);
            }
          }
        })();
      }
    });
  }
  /**
   * Register pinned-change event listeners on all markdown leaves
   * This ensures tab titles are re-applied when tabs are pinned/unpinned
   */
  registerLeafListeners() {
    const currentLeaves = this.plugin.app.workspace.getLeavesOfType("markdown");
    const currentLeafSet = new Set(currentLeaves);
    currentLeaves.forEach((leaf) => {
      if (!this.leafEventRefs.has(leaf)) {
        const eventRef = leaf.on("pinned-change", () => {
          requestAnimationFrame(() => {
            setTimeout(() => {
              void this.renameTabs();
            }, 50);
          });
        });
        this.leafEventRefs.set(leaf, eventRef);
      }
    });
    for (const [leaf, eventRef] of this.leafEventRefs.entries()) {
      if (!currentLeafSet.has(leaf)) {
        leaf.offref(eventRef);
        this.leafEventRefs.delete(leaf);
      }
    }
  }
  /**
   * Register event listeners for tab renaming
   * EXACT copy of the working implementation from obsidian-title-only-tab
   */
  registerEvents() {
    this.renameTabs();
    this.registerLeafListeners();
    this.plugin.registerEvent(
      this.plugin.app.workspace.on("layout-change", () => {
        void this.renameTabs();
        this.registerLeafListeners();
      })
    );
    this.plugin.registerEvent(
      this.plugin.app.workspace.on("active-leaf-change", () => this.renameTabs())
    );
    this.plugin.registerEvent(
      this.plugin.app.workspace.on("file-open", () => this.renameTabs())
    );
    this.plugin.registerEvent(
      this.plugin.app.vault.on("rename", () => this.renameTabs())
    );
    this.plugin.registerEvent(
      this.plugin.app.metadataCache.on("changed", () => this.renameTabs())
    );
  }
  /**
   * Update tabs (public method for manual updates)
   */
  updateTabs() {
    void this.renameTabs();
  }
  /**
   * Cleanup on unload
   */
  onunload() {
    for (const [leaf, eventRef] of this.leafEventRefs.entries()) {
      leaf.offref(eventRef);
    }
    this.leafEventRefs.clear();
  }
};

// src/services/ExplorerService.ts
var import_obsidian10 = require("obsidian");
var ExplorerService = class {
  constructor(plugin) {
    // Public so ExplorerFileItemMutator can access it
    this.explorerView = null;
    this.modified = /* @__PURE__ */ new WeakMap();
    this.plugin = plugin;
  }
  /**
   * Get the file explorer view
   */
  getExplorerView() {
    if (this.explorerView === null) {
      const leaves = this.plugin.app.workspace.getLeavesOfType("file-explorer");
      if (leaves.length === 0) {
        return null;
      }
      const leaf = leaves[0];
      if (leaf && leaf.view) {
        this.explorerView = leaf.view;
      }
    }
    return this.explorerView;
  }
  /**
   * Get folder note title for a folder
   * Returns the frontmatter title property from the folder note file if it exists
   */
  getFolderNoteTitle(folder) {
    var _a;
    if (!this.plugin.settings.folderNoteFilename || this.plugin.settings.folderNoteFilename.trim() === "") {
      return null;
    }
    const folderNoteFilename = this.plugin.settings.folderNoteFilename.trim();
    const folderNotePath = `${folder.path}/${folderNoteFilename}.md`;
    const folderNoteFile = this.plugin.app.vault.getAbstractFileByPath(folderNotePath);
    if (folderNoteFile instanceof import_obsidian10.TFile) {
      const cache = this.plugin.app.metadataCache.getFileCache(folderNoteFile);
      const propertyValue = (_a = cache == null ? void 0 : cache.frontmatter) == null ? void 0 : _a[this.plugin.settings.propertyKey];
      if (propertyValue) {
        return String(propertyValue);
      }
    }
    return null;
  }
  /**
   * Resolve title for a file or folder
   * Public so ExplorerFileItemMutator can access it
   */
  async resolveTitle(item) {
    if (item.file instanceof import_obsidian10.TFile) {
      const { getFrontmatter: getFrontmatter2, isFileTypeSupported: isFileTypeSupported2 } = await Promise.resolve().then(() => (init_frontmatter(), frontmatter_exports));
      if (!isFileTypeSupported2(item.file.extension, this.plugin.settings)) {
        return null;
      }
      const frontmatter = await getFrontmatter2(this.plugin.app, item.file, this.plugin.settings);
      const propertyValue = frontmatter == null ? void 0 : frontmatter[this.plugin.settings.propertyKey];
      return propertyValue ? String(propertyValue) : null;
    } else if (item.file instanceof import_obsidian10.TFolder) {
      return this.getFolderNoteTitle(item.file);
    }
    return null;
  }
  /**
   * Update all file explorer items
   */
  updateAllItems() {
    const view = this.getExplorerView();
    if (!view || !view.fileItems) {
      return;
    }
    const items = Object.values(view.fileItems);
    for (const item of items) {
      if (!this.modified.has(item)) {
        this.modified.set(item, new ExplorerFileItemMutator(item, this));
      }
      item.updateTitle();
    }
  }
  /**
   * Restore all original titles
   */
  restoreAllItems() {
    const view = this.getExplorerView();
    if (!view || !view.fileItems) {
      return;
    }
    const items = Object.values(view.fileItems);
    for (const item of items) {
      if (this.modified.has(item)) {
        const mutator = this.modified.get(item);
        mutator == null ? void 0 : mutator.destroy();
        this.modified.delete(item);
        item.updateTitle();
      }
    }
  }
  /**
   * Register events and initialize
   */
  registerEvents() {
    if (!this.plugin.settings.enableForExplorer) {
      return;
    }
    this.plugin.app.workspace.onLayoutReady(() => {
      this.explorerView = null;
      this.updateAllItems();
    });
    this.plugin.registerEvent(
      this.plugin.app.workspace.on("layout-change", () => {
        this.explorerView = null;
        if (this.plugin.settings.enableForExplorer) {
          this.updateAllItems();
        }
      })
    );
    this.plugin.registerEvent(
      this.plugin.app.metadataCache.on("changed", () => {
        if (this.plugin.settings.enableForExplorer) {
          this.updateAllItems();
        }
      })
    );
    this.plugin.registerEvent(
      this.plugin.app.vault.on("rename", () => {
        if (this.plugin.settings.enableForExplorer) {
          this.explorerView = null;
          setTimeout(() => this.updateAllItems(), 100);
        }
      })
    );
  }
  /**
   * Update explorer when settings change
   */
  updateExplorer() {
    if (this.plugin.settings.enableForExplorer) {
      this.explorerView = null;
      this.registerEvents();
      setTimeout(() => this.updateAllItems(), 100);
    } else {
      this.restoreAllItems();
    }
  }
  /**
   * Cleanup on unload
   */
  onunload() {
    this.restoreAllItems();
    this.explorerView = null;
  }
};
var ExplorerFileItemMutator = class {
  constructor(item, service) {
    this.item = item;
    this.service = service;
    const proto = Object.getPrototypeOf(item);
    this.originalUpdateTitle = proto.updateTitle.bind(item);
    this.originalStartRename = proto.startRename ? proto.startRename.bind(item) : void 0;
    item.updateTitle = this.updateTitle.bind(this);
    if (proto.startRename) {
      item.startRename = this.startRename.bind(this);
    }
  }
  updateTitle() {
    this.originalUpdateTitle();
    if (this.service.plugin.settings.enableForExplorer) {
      void (async () => {
        const title = await this.service.resolveTitle(this.item);
        if (title && title.length > 0) {
          this.item.innerEl.setText(title);
        }
      })();
    }
  }
  startRename() {
    var _a;
    this.item.innerEl.setText(this.item.getTitle());
    return (_a = this.originalStartRename) == null ? void 0 : _a.call(this);
  }
  destroy() {
    const proto = Object.getPrototypeOf(this.item);
    this.item.updateTitle = this.originalUpdateTitle;
    if (proto.startRename && this.originalStartRename) {
      this.item.startRename = this.originalStartRename;
    }
  }
};

// src/services/WindowFrameService.ts
var import_obsidian11 = require("obsidian");
init_frontmatter();
var WindowFrameService = class {
  constructor(plugin) {
    this.originalUpdateTitle = null;
    this.enabled = false;
    this.plugin = plugin;
  }
  /**
   * Get the title for the active file
   */
  getActiveFileTitle() {
    var _a;
    const activeFile = this.plugin.app.workspace.getActiveFile();
    if (activeFile instanceof import_obsidian11.TFile) {
      if (activeFile.extension === "md") {
        const fileCache = this.plugin.app.metadataCache.getFileCache(activeFile);
        const propertyValue = (_a = fileCache == null ? void 0 : fileCache.frontmatter) == null ? void 0 : _a[this.plugin.settings.propertyKey];
        if (propertyValue) {
          return String(propertyValue);
        }
        return activeFile.basename;
      }
      if (activeFile.extension === "mdx" && this.plugin.settings.enableMdxSupport) {
        void (async () => {
          const frontmatter = await getFrontmatter(this.plugin.app, activeFile, this.plugin.settings);
          const propertyValue = frontmatter == null ? void 0 : frontmatter[this.plugin.settings.propertyKey];
          if (propertyValue) {
            const app = this.plugin.app;
            if (typeof app.getAppTitle === "function") {
              document.title = app.getAppTitle(String(propertyValue));
            } else {
              const vaultName = this.plugin.app.vault.getName();
              document.title = `${String(propertyValue)} - ${vaultName}`;
            }
          }
        })();
        return activeFile.basename;
      }
      return activeFile.basename;
    }
    return "";
  }
  /**
   * Override updateTitle to use property-based title
   */
  updateTitle() {
    if (!this.enabled) {
      if (this.originalUpdateTitle) {
        this.originalUpdateTitle();
      }
      return;
    }
    const title = this.getActiveFileTitle();
    if (title) {
      const app = this.plugin.app;
      if (typeof app.getAppTitle === "function") {
        document.title = app.getAppTitle(title);
      } else {
        const vaultName = this.plugin.app.vault.getName();
        document.title = `${title} - ${vaultName}`;
      }
    } else {
      if (this.originalUpdateTitle) {
        this.originalUpdateTitle();
      }
    }
  }
  /**
   * Enable the window frame feature
   */
  enable() {
    if (this.enabled) {
      return;
    }
    const workspace = this.plugin.app.workspace;
    if (workspace.updateTitle) {
      this.originalUpdateTitle = workspace.updateTitle.bind(workspace);
      workspace.updateTitle = this.updateTitle.bind(this);
      this.updateTitle();
      this.enabled = true;
    }
  }
  /**
   * Disable the window frame feature
   */
  disable() {
    if (!this.enabled) {
      return;
    }
    const workspace = this.plugin.app.workspace;
    if (workspace.updateTitle && this.originalUpdateTitle) {
      workspace.updateTitle = this.originalUpdateTitle;
      workspace.updateTitle();
      this.originalUpdateTitle = null;
      this.enabled = false;
    }
  }
  /**
   * Register events for window frame updates
   */
  registerEvents() {
    if (!this.plugin.settings.enableForWindowFrame) {
      return;
    }
    this.plugin.registerEvent(
      this.plugin.app.workspace.on("file-open", () => {
        if (this.enabled) {
          this.updateTitle();
        }
      })
    );
    this.plugin.registerEvent(
      this.plugin.app.metadataCache.on("changed", () => {
        if (this.enabled) {
          this.updateTitle();
        }
      })
    );
  }
  /**
   * Update window frame when settings change
   */
  updateWindowFrame() {
    if (this.plugin.settings.enableForWindowFrame) {
      this.enable();
      this.registerEvents();
    } else {
      this.disable();
    }
  }
  /**
   * Cleanup on unload
   */
  onunload() {
    this.disable();
  }
};

// src/services/BookmarkService.ts
var import_obsidian12 = require("obsidian");
init_frontmatter();
var BookmarkService = class {
  constructor(plugin) {
    this.isHooked = false;
    this.plugin = plugin;
  }
  /**
   * Update bookmarks hook based on settings
   */
  updateBookmarks() {
    if (this.plugin.settings.enableForBookmarks && !this.isHooked) {
      this.hookBookmarks();
    } else if (!this.plugin.settings.enableForBookmarks && this.isHooked) {
      this.unhookBookmarks();
    }
  }
  /**
   * Hook into bookmark functionality using DOM observation
   */
  hookBookmarks() {
    const existingModal = document.querySelector(".modal");
    if (existingModal instanceof HTMLElement) {
      this.handleModalAppearance(existingModal);
    }
    this.mutationObserver = new MutationObserver((mutations) => {
      for (const mutation of mutations) {
        mutation.addedNodes.forEach((node) => {
          if (node instanceof HTMLElement) {
            const modalEl = node.classList.contains("modal") ? node : node.querySelector(".modal");
            if (modalEl) {
              this.handleModalAppearance(modalEl);
            }
          }
        });
      }
    });
    this.mutationObserver.observe(document.body, {
      childList: true,
      subtree: true
    });
    this.isHooked = true;
  }
  /**
   * Handle when a modal appears
   */
  handleModalAppearance(modalEl) {
    let attempts = 0;
    const maxAttempts = 30;
    const tryIdentifyAndPopulate = async () => {
      var _a;
      const titleEl = modalEl.querySelector(".modal-title");
      const titleText = ((_a = titleEl == null ? void 0 : titleEl.textContent) == null ? void 0 : _a.toLowerCase()) || "";
      const isBookmarkModal = titleText.includes("bookmark") || modalEl.querySelector('input[placeholder*="bookmark"]') !== null || modalEl.querySelector('input[placeholder*="Bookmark"]') !== null;
      if (isBookmarkModal) {
        const settingItems = modalEl.querySelectorAll(".setting-item");
        let titleInput = null;
        let pathInput = null;
        settingItems.forEach((item) => {
          var _a2;
          const nameEl = item.querySelector(".setting-item-name");
          const nameText = ((_a2 = nameEl == null ? void 0 : nameEl.textContent) == null ? void 0 : _a2.toLowerCase().trim()) || "";
          if (nameText === "title") {
            titleInput = item.querySelector('input[type="text"]');
          } else if (nameText === "path") {
            pathInput = item.querySelector('input[type="text"]');
          }
        });
        if (!titleInput) {
          const allInputs = modalEl.querySelectorAll('input[type="text"]');
          if (allInputs.length >= 2) {
            pathInput = allInputs[0];
            titleInput = allInputs[1];
          }
        }
        if (titleInput) {
          let file = this.plugin.app.workspace.getActiveFile();
          if (pathInput && pathInput.value) {
            const path = pathInput.value;
            const abstractFile = this.plugin.app.vault.getAbstractFileByPath(path) || this.plugin.app.vault.getAbstractFileByPath(path + ".md") || this.plugin.app.vault.getAbstractFileByPath(path + ".mdx");
            if (abstractFile instanceof import_obsidian12.TFile) {
              file = abstractFile;
            }
          }
          if (file) {
            const frontmatter = await getFrontmatter(this.plugin.app, file, this.plugin.settings);
            const propertyValue = frontmatter == null ? void 0 : frontmatter[this.plugin.settings.propertyKey];
            if (propertyValue !== void 0 && propertyValue !== null) {
              let displayValue = "";
              if (typeof propertyValue === "string") {
                displayValue = propertyValue;
              } else if (typeof propertyValue === "number" || typeof propertyValue === "boolean") {
                displayValue = String(propertyValue);
              }
              if (displayValue && displayValue.trim() !== "") {
                const currentValue = titleInput.value;
                const isDefault = currentValue === "" || currentValue === file.basename || currentValue === file.name;
                if (isDefault) {
                  titleInput.value = displayValue;
                  titleInput.dispatchEvent(new Event("input", { bubbles: true }));
                  titleInput.select();
                  return true;
                }
              }
            }
          }
        }
      }
      attempts++;
      if (attempts < maxAttempts) {
        setTimeout(() => void tryIdentifyAndPopulate(), 50);
      }
      return false;
    };
    void tryIdentifyAndPopulate();
  }
  /**
   * Stop observing for bookmark modals
   */
  unhookBookmarks() {
    if (this.mutationObserver) {
      this.mutationObserver.disconnect();
      this.mutationObserver = void 0;
    }
    this.isHooked = false;
  }
  /**
   * Cleanup on unload
   */
  onunload() {
    this.unhookBookmarks();
  }
};

// src/main.ts
var PropertyOverFileNamePlugin = class extends import_obsidian13.Plugin {
  constructor(app, manifest) {
    super(app, manifest);
    try {
      this.registerExtensions(["mdx"], "markdown");
    } catch (error) {
      const errorMsg = error.message;
      if (!errorMsg.includes("existing file extension")) {
        console.error("[POV] Unexpected MDX registration error in constructor:", errorMsg);
      }
    }
  }
  async onload() {
    await this.loadSettings();
    if (this.settings.enableMdxSupport) {
      try {
        this.registerExtensions(["mdx"], "markdown");
      } catch (error) {
        const errorMsg = error.message;
        if (!errorMsg.includes("existing file extension")) {
          console.error("Unexpected MDX registration error:", errorMsg);
          this.settings.enableMdxSupport = false;
        }
      }
      const mdxFiles = this.app.vault.getFiles().filter((f) => f.extension === "mdx");
      for (const file of mdxFiles) {
        this.app.metadataCache.trigger("changed", file);
      }
    }
    this.quickSwitcherService = new QuickSwitcherService(this);
    this.dragDropService = new DragDropService(this);
    this.cacheService = new CacheService(this);
    this.graphViewService = new GraphViewService(this);
    this.backlinkService = new BacklinkService(this);
    this.tabService = new TabService(this);
    this.explorerService = new ExplorerService(this);
    this.windowFrameService = new WindowFrameService(this);
    this.bookmarkService = new BookmarkService(this);
    this.tabService.registerEvents();
    this.explorerService.registerEvents();
    this.windowFrameService.registerEvents();
    this.bookmarkService.updateBookmarks();
    if (this.settings.enableMdxSupport) {
      (() => {
        const mdxFiles = this.app.vault.getFiles().filter(
          (f) => f instanceof import_obsidian13.TFile && f.extension === "mdx"
        );
        for (const file of mdxFiles) {
          void frontmatterCache.get(this.app, file, this.settings);
        }
      })();
    }
    setTimeout(() => {
      this.updateLinkSuggester();
      this.updateQuickSwitcher();
      this.updateGraphView();
      this.updateBacklinks();
      this.updateTabs();
      this.updateExplorer();
      this.updateWindowFrame();
      this.updateBookmarks();
    }, 1e3);
    this.app.workspace.onLayoutReady(() => {
      this.graphViewService.onLayoutChange();
      this.backlinkService.onLayoutChange();
      void this.tabService.renameTabs();
      this.updateExplorer();
      this.updateWindowFrame();
      this.updateBookmarks();
      setTimeout(() => {
        this.graphViewService.refreshGraphView();
      }, 500);
    });
    this.registerEvent(
      this.app.workspace.on("layout-change", () => {
        this.graphViewService.onLayoutChange();
        this.backlinkService.onLayoutChange();
      })
    );
    this.registerEvent(
      this.app.workspace.on("file-open", () => {
        this.backlinkService.onFileOpen();
      })
    );
    this.registerEvent(
      this.app.vault.on("modify", (file) => {
        if (file instanceof import_obsidian13.TFile && (file.extension === "md" || file.extension === "mdx" && this.settings.enableMdxSupport)) {
          this.cacheService.invalidateCache(file);
          frontmatterCache.invalidate(file.path);
        }
      })
    );
    this.registerEvent(
      this.app.vault.on("rename", (file, oldPath) => {
        if (file instanceof import_obsidian13.TFile && (file.extension === "md" || file.extension === "mdx" && this.settings.enableMdxSupport)) {
          this.cacheService.invalidateCache(file);
          frontmatterCache.invalidate(file.path);
        }
      })
    );
    this.registerEvent(
      this.app.vault.on("delete", (file) => {
        if (file instanceof import_obsidian13.TFile && (file.extension === "md" || file.extension === "mdx" && this.settings.enableMdxSupport)) {
          this.cacheService.invalidateCache(file);
          frontmatterCache.invalidate(file.path);
        }
      })
    );
    this.registerEvent(
      this.app.metadataCache.on("changed", (file) => {
        if (file instanceof import_obsidian13.TFile && (file.extension === "md" || file.extension === "mdx" && this.settings.enableMdxSupport)) {
          this.cacheService.rebuildCache();
          if (this.settings.enableForGraphView) {
            this.graphViewService.refreshGraphView();
          }
          if (this.settings.enableForBacklinks) {
            this.backlinkService.updateBacklinks();
          }
          if (this.settings.enableForExplorer) {
            this.explorerService.updateExplorer();
          }
          if (this.settings.enableForWindowFrame) {
            this.windowFrameService.updateWindowFrame();
          }
          if (this.settings.enableForBookmarks) {
            this.updateBookmarks();
          }
        }
      })
    );
    this.registerEvent(
      this.app.metadataCache.on("resolved", () => {
        this.cacheService.rebuildCache();
      })
    );
    this.registerEvent(
      this.app.workspace.on("editor-drop", (event, editor) => {
        if (this.settings.enableForDragDrop) {
          this.dragDropService.handleDragDrop(event, editor);
        }
      })
    );
    this.registerDomEvent(document, "drop", (event) => {
      if (this.settings.enableForDragDrop) {
        this.dragDropService.handleDOMDrop(event);
      }
    });
    registerCommands(this);
    this.addSettingTab(new SettingTab(this.app, this));
  }
  updateLinkSuggester() {
    const editorSuggest = this.app.workspace.editorSuggest;
    if (!editorSuggest) return;
    if (this.suggest) {
      editorSuggest.suggests = editorSuggest.suggests.filter((s) => s !== this.suggest);
      this.suggest = void 0;
    }
    if (this.settings.enableForLinking) {
      this.suggest = new LinkTitleSuggest(this);
      this.registerEditorSuggest(this.suggest);
      this.cacheService.setSuggest(this.suggest);
      editorSuggest.suggests = editorSuggest.suggests.filter((s) => !s.constructor.name.includes("LinkSuggest"));
      editorSuggest.suggests.unshift(this.suggest);
    }
  }
  updateQuickSwitcher() {
    this.quickSwitcherService.updateQuickSwitcher();
  }
  updateGraphView() {
    this.graphViewService.updateGraphView();
  }
  updateBacklinks() {
    this.backlinkService.updateBacklinks();
  }
  updateTabs() {
    this.tabService.updateTabs();
  }
  updateExplorer() {
    this.explorerService.updateExplorer();
  }
  updateWindowFrame() {
    this.windowFrameService.updateWindowFrame();
  }
  updateBookmarks() {
    this.bookmarkService.updateBookmarks();
  }
  rebuildCache() {
    this.cacheService.rebuildCache();
  }
  onunload() {
    const editorSuggest = this.app.workspace.editorSuggest;
    if (editorSuggest && this.suggest) {
      editorSuggest.suggests = editorSuggest.suggests.filter((s) => s !== this.suggest);
    }
    this.quickSwitcherService.restoreOriginalCommand();
    this.graphViewService.onunload();
    this.backlinkService.onunload();
    this.tabService.onunload();
    this.explorerService.onunload();
    this.windowFrameService.onunload();
    this.bookmarkService.onunload();
  }
  async loadSettings() {
    const loadedData = await this.loadData();
    this.settings = Object.assign({}, DEFAULT_SETTINGS, loadedData != null ? loadedData : {});
  }
  async saveSettings(prevQuickSwitcherState, prevTabState) {
    await this.saveData(this.settings);
    if (prevQuickSwitcherState !== void 0 && prevQuickSwitcherState !== this.settings.enableForQuickSwitcher) {
      this.updateQuickSwitcher();
    }
    if (prevTabState !== void 0 && prevTabState !== this.settings.enableForTabs) {
      void this.tabService.registerEvents();
      this.updateTabs();
    }
    this.updateGraphView();
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL3V0aWxzL2Zyb250bWF0dGVyLnRzIiwgInNyYy91dGlscy9zZWFyY2gudHMiLCAic3JjL3VpL1F1aWNrU3dpdGNoTW9kYWwudHMiLCAic3JjL21haW4udHMiLCAic3JjL3NldHRpbmdzLnRzIiwgInNyYy91aS9MaW5rVGl0bGVTdWdnZXN0LnRzIiwgInNyYy91aS9TZXR0aW5nVGFiLnRzIiwgInNyYy91dGlscy9zZXR0aW5ncy1jb21wYXQudHMiLCAic3JjL2NvbW1hbmRzL2luZGV4LnRzIiwgInNyYy9zZXJ2aWNlcy9RdWlja1N3aXRjaGVyU2VydmljZS50cyIsICJzcmMvc2VydmljZXMvRHJhZ0Ryb3BTZXJ2aWNlLnRzIiwgInNyYy9zZXJ2aWNlcy9DYWNoZVNlcnZpY2UudHMiLCAic3JjL3NlcnZpY2VzL0dyYXBoVmlld1NlcnZpY2UudHMiLCAic3JjL3V0aWxzL2Zyb250bWF0dGVyLWNhY2hlLnRzIiwgInNyYy9zZXJ2aWNlcy9CYWNrbGlua1NlcnZpY2UudHMiLCAic3JjL3NlcnZpY2VzL1RhYlNlcnZpY2UudHMiLCAic3JjL3NlcnZpY2VzL0V4cGxvcmVyU2VydmljZS50cyIsICJzcmMvc2VydmljZXMvV2luZG93RnJhbWVTZXJ2aWNlLnRzIiwgInNyYy9zZXJ2aWNlcy9Cb29rbWFya1NlcnZpY2UudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IFRGaWxlLCBBcHAsIHBhcnNlWWFtbCB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IFBsdWdpblNldHRpbmdzIH0gZnJvbSAnLi4vdHlwZXMnO1xuXG4vKipcbiAqIEdldCBmcm9udG1hdHRlciBmcm9tIGEgZmlsZSwgc3VwcG9ydGluZyBib3RoIC5tZCAodmlhIG1ldGFkYXRhIGNhY2hlKSBhbmQgLm1keCAodmlhIG1hbnVhbCBwYXJzaW5nKVxuICogXG4gKiBUaGlzIHV0aWxpdHkgZnVuY3Rpb24gaGFuZGxlcyB0aGUgZmFjdCB0aGF0IE9ic2lkaWFuJ3MgbWV0YWRhdGFDYWNoZSBvbmx5IHdvcmtzIGZvciAubWQgZmlsZXMuXG4gKiBGb3IgLm1keCBmaWxlcyAod2hlbiBNRFggc3VwcG9ydCBpcyBlbmFibGVkKSwgd2UgcmVhZCB0aGUgcmF3IGZpbGUgY29udGVudCBhbmQgcGFyc2UgdGhlIGZyb250bWF0dGVyIG1hbnVhbGx5LlxuICogXG4gKiBAcGFyYW0gYXBwIC0gT2JzaWRpYW4gYXBwIGluc3RhbmNlXG4gKiBAcGFyYW0gZmlsZSAtIFRoZSBmaWxlIHRvIGdldCBmcm9udG1hdHRlciBmcm9tXG4gKiBAcGFyYW0gc2V0dGluZ3MgLSBQbHVnaW4gc2V0dGluZ3MgKHRvIGNoZWNrIGVuYWJsZU1keFN1cHBvcnQpXG4gKiBAcmV0dXJucyBUaGUgZnJvbnRtYXR0ZXIgb2JqZWN0LCBvciBudWxsIGlmIG5vdCBmb3VuZC9ub3Qgc3VwcG9ydGVkXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRGcm9udG1hdHRlcihcbiAgYXBwOiBBcHAsXG4gIGZpbGU6IFRGaWxlLFxuICBzZXR0aW5nczogUGx1Z2luU2V0dGluZ3Ncbik6IFByb21pc2U8UmVjb3JkPHN0cmluZywgdW5rbm93bj4gfCBudWxsPiB7XG4gIC8vIEZvciAubWQgZmlsZXMsIHVzZSBPYnNpZGlhbidzIG1ldGFkYXRhIGNhY2hlIChmYXN0IGFuZCByZWxpYWJsZSlcbiAgaWYgKGZpbGUuZXh0ZW5zaW9uID09PSAnbWQnKSB7XG4gICAgY29uc3QgZmlsZUNhY2hlID0gYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGZpbGUpO1xuICAgIHJldHVybiBmaWxlQ2FjaGU/LmZyb250bWF0dGVyIHx8IG51bGw7XG4gIH1cblxuICAvLyBGb3IgLm1keCBmaWxlcywgb25seSBwcm9jZXNzIGlmIE1EWCBzdXBwb3J0IGlzIGVuYWJsZWRcbiAgaWYgKGZpbGUuZXh0ZW5zaW9uID09PSAnbWR4JyAmJiBzZXR0aW5ncy5lbmFibGVNZHhTdXBwb3J0KSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFJlYWQgcmF3IGZpbGUgY29udGVudCAod29ya3MgZm9yIGFueSBmaWxlIHR5cGUpXG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG5cbiAgICAgIC8vIEV4dHJhY3QgZnJvbnRtYXR0ZXIgdXNpbmcgcmVnZXggKHNhbWUgZm9ybWF0IGFzIC5tZCBmaWxlcylcbiAgICAgIC8vIE1hdGNoIHBhdHRlcm46IC0tLVxcbi4uLmNvbnRlbnQuLi5cXG4tLS0gKHdpdGggb3Igd2l0aG91dCB0cmFpbGluZyBuZXdsaW5lKVxuICAgICAgY29uc3QgZnJvbnRtYXR0ZXJSZWdleCA9IC9eLS0tXFxuKFtcXHNcXFNdKj8pXFxuLS0tLztcbiAgICAgIGNvbnN0IG1hdGNoID0gY29udGVudC5tYXRjaChmcm9udG1hdHRlclJlZ2V4KTtcblxuICAgICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdKSB7XG4gICAgICAgIGNvbnN0IGZyb250bWF0dGVyVGV4dCA9IG1hdGNoWzFdO1xuICAgICAgICAvLyBQYXJzZSBZQU1MIHVzaW5nIE9ic2lkaWFuJ3MgcGFyc2VZYW1sIHV0aWxpdHlcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBwYXJzZWQgPSBwYXJzZVlhbWwoZnJvbnRtYXR0ZXJUZXh0KSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB8IG51bGwgfCB1bmRlZmluZWQ7XG4gICAgICAgICAgcmV0dXJuIHBhcnNlZCAmJiB0eXBlb2YgcGFyc2VkID09PSAnb2JqZWN0JyA/IHBhcnNlZCA6IG51bGw7XG4gICAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdNRFggWUFNTCBwYXJzZSBlcnJvcjonLCBwYXJzZUVycm9yKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGNhdGNoIChyZWFkRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlYWRpbmcgTURYIGZpbGU6JywgcmVhZEVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8vIEZvciBvdGhlciBmaWxlIHR5cGVzIG9yIE1EWCB3aGVuIHN1cHBvcnQgaXMgZGlzYWJsZWQsIHJldHVybiBudWxsXG4gIHJldHVybiBudWxsO1xufVxuXG4vKipcbiAqIFN5bmNocm9ub3VzIHZlcnNpb24gdGhhdCB1c2VzIG1ldGFkYXRhIGNhY2hlIGZvciAubWQgZmlsZXNcbiAqIEZvciAubWR4IGZpbGVzLCByZXR1cm5zIG51bGwgKHVzZSBhc3luYyB2ZXJzaW9uIGluc3RlYWQpXG4gKiBcbiAqIEBwYXJhbSBhcHAgLSBPYnNpZGlhbiBhcHAgaW5zdGFuY2VcbiAqIEBwYXJhbSBmaWxlIC0gVGhlIGZpbGUgdG8gZ2V0IGZyb250bWF0dGVyIGZyb21cbiAqIEBwYXJhbSBzZXR0aW5ncyAtIFBsdWdpbiBzZXR0aW5ncyAodG8gY2hlY2sgZW5hYmxlTWR4U3VwcG9ydClcbiAqIEByZXR1cm5zIFRoZSBmcm9udG1hdHRlciBvYmplY3QsIG9yIG51bGwgaWYgbm90IGZvdW5kL25vdCBzdXBwb3J0ZWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEZyb250bWF0dGVyU3luYyhcbiAgYXBwOiBBcHAsXG4gIGZpbGU6IFRGaWxlLFxuICBzZXR0aW5nczogUGx1Z2luU2V0dGluZ3Ncbik6IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHwgbnVsbCB7XG4gIC8vIEZvciAubWQgZmlsZXMsIHVzZSBPYnNpZGlhbidzIG1ldGFkYXRhIGNhY2hlXG4gIGlmIChmaWxlLmV4dGVuc2lvbiA9PT0gJ21kJykge1xuICAgIGNvbnN0IGZpbGVDYWNoZSA9IGFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcbiAgICByZXR1cm4gZmlsZUNhY2hlPy5mcm9udG1hdHRlciB8fCBudWxsO1xuICB9XG5cbiAgLy8gRm9yIC5tZHggZmlsZXMsIHdlIGNhbid0IHVzZSBzeW5jIHZlcnNpb24gKG5lZWQgdG8gcmVhZCBmaWxlKVxuICAvLyBSZXR1cm4gbnVsbCAtIGNhbGxlciBzaG91bGQgdXNlIGFzeW5jIHZlcnNpb24gaWYgTURYIHN1cHBvcnQgaXMgbmVlZGVkXG4gIGlmIChmaWxlLmV4dGVuc2lvbiA9PT0gJ21keCcgJiYgc2V0dGluZ3MuZW5hYmxlTWR4U3VwcG9ydCkge1xuICAgIHJldHVybiBudWxsOyAvLyBJbmRpY2F0ZXMgYXN5bmMgdmVyc2lvbiBzaG91bGQgYmUgdXNlZFxuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYSBmaWxlIGV4dGVuc2lvbiBpcyBzdXBwb3J0ZWQgYmFzZWQgb24gc2V0dGluZ3NcbiAqIFxuICogQHBhcmFtIGV4dGVuc2lvbiAtIEZpbGUgZXh0ZW5zaW9uICh3aXRob3V0IGRvdClcbiAqIEBwYXJhbSBzZXR0aW5ncyAtIFBsdWdpbiBzZXR0aW5nc1xuICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgZmlsZSB0eXBlIGlzIHN1cHBvcnRlZFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNGaWxlVHlwZVN1cHBvcnRlZChleHRlbnNpb246IHN0cmluZywgc2V0dGluZ3M6IFBsdWdpblNldHRpbmdzKTogYm9vbGVhbiB7XG4gIGlmIChleHRlbnNpb24gPT09ICdtZCcpIHtcbiAgICByZXR1cm4gdHJ1ZTsgLy8gQWx3YXlzIHN1cHBvcnRlZFxuICB9XG4gIGlmIChleHRlbnNpb24gPT09ICdtZHgnKSB7XG4gICAgcmV0dXJuIHNldHRpbmdzLmVuYWJsZU1keFN1cHBvcnQ7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuIiwgImltcG9ydCB7IFRGaWxlLCBNZXRhZGF0YUNhY2hlLCBBcHAgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBDYWNoZWRGaWxlRGF0YSwgUGx1Z2luU2V0dGluZ3MgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBpc0ZpbGVUeXBlU3VwcG9ydGVkIH0gZnJvbSAnLi9mcm9udG1hdHRlcic7XG5cbmV4cG9ydCBmdW5jdGlvbiBmdXp6eU1hdGNoKHN0cjogc3RyaW5nLCBxdWVyeTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIGxldCBpID0gMDtcbiAgY29uc3QgbG93ZXJTdHIgPSBzdHIudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgbG93ZXJRdWVyeSA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7XG4gIGZvciAoY29uc3QgY2hhciBvZiBsb3dlclF1ZXJ5KSB7XG4gICAgaSA9IGxvd2VyU3RyLmluZGV4T2YoY2hhciwgaSkgKyAxO1xuICAgIGlmIChpID09PSAwKSByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRNYXRjaFNjb3JlKGRpc3BsYXk6IHN0cmluZywgcXVlcnk6IHN0cmluZywgYmFzZW5hbWU6IHN0cmluZywgaW5jbHVkZUZpbGVuYW1lSW5TZWFyY2g6IGJvb2xlYW4pOiBudW1iZXIge1xuICBsZXQgc2NvcmUgPSAwO1xuICBjb25zdCBsb3dlckRpc3BsYXkgPSBkaXNwbGF5LnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IGxvd2VyQmFzZW5hbWUgPSBiYXNlbmFtZS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBsb3dlclF1ZXJ5ID0gcXVlcnkudG9Mb3dlckNhc2UoKTtcbiAgXG4gIC8vIEV4YWN0IG1hdGNoZXMgZ2V0IGhpZ2hlc3Qgc2NvcmVcbiAgaWYgKGxvd2VyRGlzcGxheSA9PT0gbG93ZXJRdWVyeSkgc2NvcmUgKz0gMTAwMDtcbiAgZWxzZSBpZiAobG93ZXJCYXNlbmFtZSA9PT0gbG93ZXJRdWVyeSkgc2NvcmUgKz0gOTAwO1xuICBcbiAgLy8gU3RhcnRzIHdpdGggcXVlcnkgZ2V0cyBoaWdoIHNjb3JlXG4gIGVsc2UgaWYgKGxvd2VyRGlzcGxheS5zdGFydHNXaXRoKGxvd2VyUXVlcnkpKSBzY29yZSArPSAxMDA7XG4gIGVsc2UgaWYgKGluY2x1ZGVGaWxlbmFtZUluU2VhcmNoICYmIGxvd2VyQmFzZW5hbWUuc3RhcnRzV2l0aChsb3dlclF1ZXJ5KSkgc2NvcmUgKz0gODA7XG4gIFxuICAvLyBDb250YWlucyBxdWVyeSBnZXRzIG1lZGl1bSBzY29yZVxuICBlbHNlIGlmIChsb3dlckRpc3BsYXkuaW5jbHVkZXMobG93ZXJRdWVyeSkpIHNjb3JlICs9IDUwO1xuICBlbHNlIGlmIChpbmNsdWRlRmlsZW5hbWVJblNlYXJjaCAmJiBsb3dlckJhc2VuYW1lLmluY2x1ZGVzKGxvd2VyUXVlcnkpKSBzY29yZSArPSAzMDtcbiAgXG4gIC8vIFdvcmQgYm91bmRhcnkgbWF0Y2hlcyBnZXQgYm9udXNcbiAgY29uc3Qgd29yZEJvdW5kYXJ5UmVnZXggPSBuZXcgUmVnRXhwKGBcXFxcYiR7bG93ZXJRdWVyeX1gLCAnaScpO1xuICBpZiAod29yZEJvdW5kYXJ5UmVnZXgudGVzdChsb3dlckRpc3BsYXkpKSBzY29yZSArPSAyMDtcbiAgaWYgKGluY2x1ZGVGaWxlbmFtZUluU2VhcmNoICYmIHdvcmRCb3VuZGFyeVJlZ2V4LnRlc3QobG93ZXJCYXNlbmFtZSkpIHNjb3JlICs9IDE1O1xuICBcbiAgLy8gUGVuYWx0eSBmb3IgdmVyeSBsb25nIG5hbWVzXG4gIGNvbnN0IGxlbmd0aFBlbmFsdHkgPSBNYXRoLm1heCgwLCAoZGlzcGxheS5sZW5ndGggLSBxdWVyeS5sZW5ndGgpICogMC4xKTtcbiAgc2NvcmUgLT0gbGVuZ3RoUGVuYWx0eTtcbiAgXG4gIHJldHVybiBNYXRoLm1heCgwLCBzY29yZSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBidWlsZEZpbGVDYWNoZShcbiAgZmlsZXM6IFRGaWxlW10sIFxuICBtZXRhZGF0YUNhY2hlOiBNZXRhZGF0YUNhY2hlLFxuICBhcHA6IEFwcCxcbiAgcHJvcGVydHlLZXk6IHN0cmluZyxcbiAgc2V0dGluZ3M6IFBsdWdpblNldHRpbmdzXG4pOiBQcm9taXNlPE1hcDxzdHJpbmcsIENhY2hlZEZpbGVEYXRhPj4ge1xuICBjb25zdCBjYWNoZSA9IG5ldyBNYXA8c3RyaW5nLCBDYWNoZWRGaWxlRGF0YT4oKTtcbiAgY29uc3QgeyBnZXRGcm9udG1hdHRlciB9ID0gYXdhaXQgaW1wb3J0KCcuL2Zyb250bWF0dGVyJyk7XG4gIFxuICAvLyBQcm9jZXNzIGZpbGVzIGluIHBhcmFsbGVsIGZvciBiZXR0ZXIgcGVyZm9ybWFuY2VcbiAgYXdhaXQgUHJvbWlzZS5hbGwoZmlsZXMubWFwKGFzeW5jIChmaWxlKSA9PiB7XG4gICAgLy8gU2tpcCB1bnN1cHBvcnRlZCBmaWxlIHR5cGVzXG4gICAgaWYgKCFpc0ZpbGVUeXBlU3VwcG9ydGVkKGZpbGUuZXh0ZW5zaW9uLCBzZXR0aW5ncykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBVc2Ugc3luYyB2ZXJzaW9uIGZvciAubWQgZmlsZXMsIGFzeW5jIGZvciAubWR4IGZpbGVzXG4gICAgbGV0IGZyb250bWF0dGVyOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB8IG51bGw7XG4gICAgaWYgKGZpbGUuZXh0ZW5zaW9uID09PSAnbWQnKSB7XG4gICAgICAvLyBGb3IgLm1kIGZpbGVzLCB1c2UgbWV0YWRhdGEgY2FjaGUgKGZhc3Qgc3luYyBhY2Nlc3MpXG4gICAgICBjb25zdCBmaWxlQ2FjaGUgPSBhcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7XG4gICAgICBmcm9udG1hdHRlciA9IGZpbGVDYWNoZT8uZnJvbnRtYXR0ZXIgfHwgbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gTURYIGZpbGVzIG5lZWQgYXN5bmMgcmVhZGluZ1xuICAgICAgZnJvbnRtYXR0ZXIgPSBhd2FpdCBnZXRGcm9udG1hdHRlcihhcHAsIGZpbGUsIHNldHRpbmdzKTtcbiAgICB9XG5cbiAgICBsZXQgZGlzcGxheU5hbWUgPSBmaWxlLmJhc2VuYW1lO1xuICAgIGxldCBpc0N1c3RvbURpc3BsYXkgPSBmYWxzZTtcbiAgICBsZXQgYWxpYXNlczogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmIChmcm9udG1hdHRlciAmJiBmcm9udG1hdHRlcltwcm9wZXJ0eUtleV0gIT09IHVuZGVmaW5lZCAmJiBmcm9udG1hdHRlcltwcm9wZXJ0eUtleV0gIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWVSYXcgPSBmcm9udG1hdHRlcltwcm9wZXJ0eUtleV07XG4gICAgICBsZXQgcHJvcGVydHlWYWx1ZTogc3RyaW5nO1xuICAgICAgaWYgKHR5cGVvZiBwcm9wZXJ0eVZhbHVlUmF3ID09PSAnc3RyaW5nJykge1xuICAgICAgICBwcm9wZXJ0eVZhbHVlID0gcHJvcGVydHlWYWx1ZVJhdy50cmltKCk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBwcm9wZXJ0eVZhbHVlUmF3ID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgcHJvcGVydHlWYWx1ZVJhdyA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIHByb3BlcnR5VmFsdWUgPSBTdHJpbmcocHJvcGVydHlWYWx1ZVJhdykudHJpbSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gU2tpcCBvYmplY3RzL2FycmF5cyAtIHRoZXkgY2FuJ3QgYmUgdXNlZCBhcyBkaXNwbGF5IG5hbWVzXG4gICAgICAgIHByb3BlcnR5VmFsdWUgPSAnJztcbiAgICAgIH1cbiAgICAgIGlmIChwcm9wZXJ0eVZhbHVlICYmIHByb3BlcnR5VmFsdWUgIT09ICcnKSB7XG4gICAgICAgIGRpc3BsYXlOYW1lID0gcHJvcGVydHlWYWx1ZTtcbiAgICAgICAgaXNDdXN0b21EaXNwbGF5ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZnJvbnRtYXR0ZXI/LmFsaWFzZXMpIHtcbiAgICAgIGNvbnN0IGFsaWFzZXNSYXcgPSBmcm9udG1hdHRlci5hbGlhc2VzIGFzIHVua25vd247XG4gICAgICBhbGlhc2VzID0gQXJyYXkuaXNBcnJheShhbGlhc2VzUmF3KSA/IGFsaWFzZXNSYXcubWFwKGEgPT4gU3RyaW5nKGEpKSA6IFtTdHJpbmcoYWxpYXNlc1JhdyldO1xuICAgICAgYWxpYXNlcyA9IGFsaWFzZXMubWFwKGFsaWFzID0+IGFsaWFzLnRyaW0oKSkuZmlsdGVyKGFsaWFzID0+IGFsaWFzICE9PSAnJyk7XG4gICAgfVxuXG4gICAgY2FjaGUuc2V0KGZpbGUucGF0aCwge1xuICAgICAgZmlsZSxcbiAgICAgIGRpc3BsYXlOYW1lLFxuICAgICAgYWxpYXNlcyxcbiAgICAgIGxhc3RNb2RpZmllZDogZmlsZS5zdGF0Lm10aW1lLFxuICAgICAgaXNDdXN0b21EaXNwbGF5XG4gICAgfSk7XG4gIH0pKTtcbiAgXG4gIHJldHVybiBjYWNoZTtcbn1cbiIsICJpbXBvcnQgeyBBcHAsIEZ1enp5U3VnZ2VzdE1vZGFsLCBNYXJrZG93blZpZXcsIE5vdGljZSwgVEZpbGUsIHByZXBhcmVGdXp6eVNlYXJjaCwgcHJlcGFyZVNpbXBsZVNlYXJjaCwgRnV6enlNYXRjaCwgc29ydFNlYXJjaFJlc3VsdHMsIFNlYXJjaFJlc3VsdCB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IFF1aWNrU3dpdGNoSXRlbSwgQ2FjaGVkRmlsZURhdGEsIFNlYXJjaE1hdGNoUmVhc29uLCBQcm9wZXJ0eU92ZXJGaWxlTmFtZVBsdWdpbiwgV29ya3NwYWNlSW50ZXJuYWwsIFF1aWNrU3dpdGNoZXJQbHVnaW5JbnN0YW5jZSwgVW5yZXNvbHZlZExpbmtJdGVtLCBOZXdOb3RlSXRlbSwgQXBwSW50ZXJuYWwgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBidWlsZEZpbGVDYWNoZSB9IGZyb20gJy4uL3V0aWxzL3NlYXJjaCc7XG5pbXBvcnQgeyBnZXRGcm9udG1hdHRlclN5bmMgfSBmcm9tICcuLi91dGlscy9mcm9udG1hdHRlcic7XG5cbmV4cG9ydCBjbGFzcyBRdWlja1N3aXRjaE1vZGFsIGV4dGVuZHMgRnV6enlTdWdnZXN0TW9kYWw8UXVpY2tTd2l0Y2hJdGVtWydpdGVtJ10+IHtcbiAgcHJpdmF0ZSBwbHVnaW46IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luO1xuICBwcml2YXRlIGZpbGVDYWNoZTogTWFwPHN0cmluZywgQ2FjaGVkRmlsZURhdGE+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHJlY2VudEZpbGVzOiBURmlsZVtdID0gW107XG4gIHByaXZhdGUgc2VhcmNoVGltZW91dDogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgbWF0Y2hSZWFzb25zOiBNYXA8c3RyaW5nLCBTZWFyY2hNYXRjaFJlYXNvbj4gPSBuZXcgTWFwKCk7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogUHJvcGVydHlPdmVyRmlsZU5hbWVQbHVnaW4pIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMubGltaXQgPSA4OyAvLyBMaW1pdCB0byA4IGl0ZW1zIGZvciBjb21mb3J0YWJsZSBkaXNwbGF5XG4gICAgXG4gICAgLy8gU2V0IHBsYWNlaG9sZGVyIGJhc2VkIG9uIHNldHRpbmdcbiAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yUXVpY2tTd2l0Y2hlcikge1xuICAgICAgdGhpcy5zZXRQbGFjZWhvbGRlcignVHlwZSB0byBzZWFyY2ggbm90ZXMgYnkgdGl0bGUgb3IgZmlsZSBuYW1lLi4uJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0UGxhY2Vob2xkZXIoJ1R5cGUgdG8gc2VhcmNoIGZpbGVzLi4uJyk7XG4gICAgfVxuICAgIFxuICAgIHZvaWQgdGhpcy5idWlsZEZpbGVDYWNoZSgpO1xuICAgIHRoaXMudXBkYXRlUmVjZW50RmlsZXMoKTtcbiAgICB0aGlzLmFkZEtleWJvYXJkTmF2aWdhdGlvbigpO1xuICAgIHRoaXMuYWRkRm9vdGVyKCk7XG4gICAgXG4gICAgLy8gT25seSBhZGQgc2NvcGluZyBjbGFzcyB3aGVuIGVuYWJsZWRcbiAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yUXVpY2tTd2l0Y2hlcikge1xuICAgICAgdGhpcy5jb250YWluZXJFbC5hZGRDbGFzcygncHJvcGVydHktb3Zlci1maWxlbmFtZS1tb2RhbCcpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWRkS2V5Ym9hcmROYXZpZ2F0aW9uKCk6IHZvaWQge1xuICAgIC8vIEFkZCBlc2NhcGUga2V5IGhhbmRsaW5nXG4gICAgdGhpcy5pbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4ge1xuICAgICAgaWYgKGUua2V5ID09PSAnRXNjYXBlJykge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYWRkRm9vdGVyKCk6IHZvaWQge1xuICAgIC8vIEZpbmQgdGhlIC5wcm9tcHQgY29udGFpbmVyIGFuZCBhZGQgZm9vdGVyIGluc2lkZSBpdFxuICAgIGNvbnN0IHByb21wdENvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyRWwucXVlcnlTZWxlY3RvcignLnByb21wdCcpO1xuICAgIGlmIChwcm9tcHRDb250YWluZXIpIHtcbiAgICAgIGNvbnN0IGZvb3RlciA9IHByb21wdENvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6ICdwcm9tcHQtaW5zdHJ1Y3Rpb25zJyB9KTtcbiAgICAgIC8vIENyZWF0ZSBuYXZpZ2F0aW9uIGluc3RydWN0aW9ucyB1c2luZyBET00gQVBJXG4gICAgICBjb25zdCBpbnN0cnVjdGlvbnMgPSBbXG4gICAgICAgIHsgY29tbWFuZDogJ1x1MjE5MVx1MjE5MycsIGFjdGlvbjogJ3RvIG5hdmlnYXRlJyB9LFxuICAgICAgICB7IGNvbW1hbmQ6ICdcdTIxQjUnLCBhY3Rpb246ICd0byBvcGVuJyB9LFxuICAgICAgICB7IGNvbW1hbmQ6ICdjdHJsIFx1MjFCNScsIGFjdGlvbjogJ3RvIG9wZW4gaW4gbmV3IHRhYicgfSxcbiAgICAgICAgeyBjb21tYW5kOiAnY3RybCBhbHQgXHUyMUI1JywgYWN0aW9uOiAndG8gb3BlbiB0byB0aGUgcmlnaHQnIH0sXG4gICAgICAgIHsgY29tbWFuZDogJ3NoaWZ0IFx1MjFCNScsIGFjdGlvbjogJ3RvIGNyZWF0ZScgfSxcbiAgICAgICAgeyBjb21tYW5kOiAnZXNjJywgYWN0aW9uOiAndG8gZGlzbWlzcycgfVxuICAgICAgXTtcbiAgICAgIFxuICAgICAgaW5zdHJ1Y3Rpb25zLmZvckVhY2goKHsgY29tbWFuZCwgYWN0aW9uIH0pID0+IHtcbiAgICAgICAgY29uc3QgaW5zdHJ1Y3Rpb24gPSBmb290ZXIuY3JlYXRlRGl2KHsgY2xzOiAncHJvbXB0LWluc3RydWN0aW9uJyB9KTtcbiAgICAgICAgaW5zdHJ1Y3Rpb24uY3JlYXRlU3Bhbih7IGNsczogJ3Byb21wdC1pbnN0cnVjdGlvbi1jb21tYW5kJywgdGV4dDogY29tbWFuZCB9KTtcbiAgICAgICAgaW5zdHJ1Y3Rpb24uY3JlYXRlU3Bhbih7IHRleHQ6IGFjdGlvbiB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGJ1aWxkRmlsZUNhY2hlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGZpbGVzID0gdGhpcy5nZXRGaWx0ZXJlZEZpbGVzKCk7XG4gICAgdGhpcy5maWxlQ2FjaGUgPSBhd2FpdCBidWlsZEZpbGVDYWNoZShcbiAgICAgIGZpbGVzLFxuICAgICAgdGhpcy5hcHAubWV0YWRhdGFDYWNoZSxcbiAgICAgIHRoaXMuYXBwLFxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvcGVydHlLZXksXG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5nc1xuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZUZpbGVDYWNoZShmaWxlOiBURmlsZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHsgZ2V0RnJvbnRtYXR0ZXIsIGlzRmlsZVR5cGVTdXBwb3J0ZWQgfSA9IGF3YWl0IGltcG9ydCgnLi4vdXRpbHMvZnJvbnRtYXR0ZXInKTtcbiAgICBcbiAgICAvLyBTa2lwIHVuc3VwcG9ydGVkIGZpbGUgdHlwZXNcbiAgICBpZiAoIWlzRmlsZVR5cGVTdXBwb3J0ZWQoZmlsZS5leHRlbnNpb24sIHRoaXMucGx1Z2luLnNldHRpbmdzKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGZyb250bWF0dGVyID0gYXdhaXQgZ2V0RnJvbnRtYXR0ZXIodGhpcy5hcHAsIGZpbGUsIHRoaXMucGx1Z2luLnNldHRpbmdzKTtcbiAgICBsZXQgZGlzcGxheU5hbWUgPSBmaWxlLmJhc2VuYW1lO1xuICAgIGxldCBpc0N1c3RvbURpc3BsYXkgPSBmYWxzZTtcbiAgICBsZXQgYWxpYXNlczogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmIChmcm9udG1hdHRlciAmJiBmcm9udG1hdHRlclt0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9wZXJ0eUtleV0gIT09IHVuZGVmaW5lZCAmJiBmcm9udG1hdHRlclt0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9wZXJ0eUtleV0gIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSBTdHJpbmcoZnJvbnRtYXR0ZXJbdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvcGVydHlLZXldKS50cmltKCk7XG4gICAgICBpZiAocHJvcGVydHlWYWx1ZSAhPT0gJycpIHtcbiAgICAgICAgZGlzcGxheU5hbWUgPSBwcm9wZXJ0eVZhbHVlO1xuICAgICAgICBpc0N1c3RvbURpc3BsYXkgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChmcm9udG1hdHRlcj8uYWxpYXNlcykge1xuICAgICAgY29uc3QgYWxpYXNlc1JhdyA9IGZyb250bWF0dGVyLmFsaWFzZXMgYXMgdW5rbm93bjtcbiAgICAgIGFsaWFzZXMgPSBBcnJheS5pc0FycmF5KGFsaWFzZXNSYXcpID8gYWxpYXNlc1Jhdy5tYXAoYSA9PiBTdHJpbmcoYSkpIDogW1N0cmluZyhhbGlhc2VzUmF3KV07XG4gICAgICBhbGlhc2VzID0gYWxpYXNlcy5tYXAoYWxpYXMgPT4gYWxpYXMudHJpbSgpKS5maWx0ZXIoYWxpYXMgPT4gYWxpYXMgIT09ICcnKTtcbiAgICB9XG5cbiAgICB0aGlzLmZpbGVDYWNoZS5zZXQoZmlsZS5wYXRoLCB7XG4gICAgICBmaWxlLFxuICAgICAgZGlzcGxheU5hbWUsXG4gICAgICBhbGlhc2VzLFxuICAgICAgbGFzdE1vZGlmaWVkOiBmaWxlLnN0YXQubXRpbWUsXG4gICAgICBpc0N1c3RvbURpc3BsYXlcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlUmVjZW50RmlsZXMoKTogdm9pZCB7XG4gICAgLy8gVXNlIE9ic2lkaWFuJ3MgaW50ZXJuYWwgcmVjZW50IGZpbGVzIG1lY2hhbmlzbSBmb3IgcGVyZmVjdCBjb21wYXRpYmlsaXR5XG4gICAgbGV0IHJlY2VudEZpbGVzOiBURmlsZVtdID0gW107XG4gICAgXG4gICAgY29uc3Qgd29ya3NwYWNlID0gdGhpcy5hcHAud29ya3NwYWNlIGFzIHVua25vd24gYXMgV29ya3NwYWNlSW50ZXJuYWwgJiB7IHJlY2VudEZpbGVUcmFja2VyPzogeyBnZXRMYXN0T3BlbkZpbGVzKCk6IHN0cmluZ1tdIH0gfTtcbiAgICBcbiAgICAvLyBDaGVjayBRdWljayBTd2l0Y2hlciBzZXR0aW5ncyB0byBkZXRlcm1pbmUgd2hhdCBmaWxlIHR5cGVzIHRvIGluY2x1ZGVcbiAgICBjb25zdCBxdWlja1N3aXRjaGVyT3B0aW9ucyA9IHRoaXMuZ2V0UXVpY2tTd2l0Y2hlck9wdGlvbnMoKTtcbiAgICBjb25zdCBzaG93QXR0YWNobWVudHMgPSBxdWlja1N3aXRjaGVyT3B0aW9ucz8uc2hvd0F0dGFjaG1lbnRzID8/IHRydWU7XG4gICAgXG4gICAgLy8gQWNjZXNzIE9ic2lkaWFuJ3MgcmVjZW50RmlsZVRyYWNrZXIgdG8gZ2V0IHRoZSBzYW1lIGZpbGVzIGFzIGRlZmF1bHQgcXVpY2sgc3dpdGNoZXJcbiAgICBpZiAod29ya3NwYWNlLnJlY2VudEZpbGVUcmFja2VyPy5nZXRMYXN0T3BlbkZpbGVzKSB7XG4gICAgICBjb25zdCBsYXN0T3BlbkZpbGVzID0gd29ya3NwYWNlLnJlY2VudEZpbGVUcmFja2VyLmdldExhc3RPcGVuRmlsZXMoKTtcbiAgICAgIFxuICAgICAgLy8gQ29udmVydCBmaWxlIHBhdGhzIHRvIFRGaWxlIG9iamVjdHNcbiAgICAgIHJlY2VudEZpbGVzID0gbGFzdE9wZW5GaWxlc1xuICAgICAgICAubWFwKChmaWxlUGF0aDogc3RyaW5nKSA9PiB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpKVxuICAgICAgICAuZmlsdGVyKChmaWxlOiB1bmtub3duKTogZmlsZSBpcyBURmlsZSA9PiBmaWxlIGluc3RhbmNlb2YgVEZpbGUpO1xuICAgIH1cbiAgICBcbiAgICAvLyBGYWxsYmFjayBpZiByZWNlbnRGaWxlVHJhY2tlciBpcyBub3QgYXZhaWxhYmxlXG4gICAgaWYgKHJlY2VudEZpbGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc3Qgb3BlbkZpbGVzID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZSgnbWFya2Rvd24nKVxuICAgICAgICAubWFwKGxlYWYgPT4gbGVhZi52aWV3KVxuICAgICAgICAuZmlsdGVyKCh2aWV3KTogdmlldyBpcyBNYXJrZG93blZpZXcgPT4gdmlldyBpbnN0YW5jZW9mIE1hcmtkb3duVmlldylcbiAgICAgICAgLm1hcCh2aWV3ID0+IHZpZXcuZmlsZSlcbiAgICAgICAgLmZpbHRlcigoZmlsZSk6IGZpbGUgaXMgVEZpbGUgPT4gZmlsZSAhPT0gbnVsbClcbiAgICAgICAgLmZpbHRlcigoZmlsZSwgaW5kZXgsIHNlbGYpID0+IHNlbGYuaW5kZXhPZihmaWxlKSA9PT0gaW5kZXgpO1xuICAgICAgXG4gICAgICByZWNlbnRGaWxlcyA9IFsuLi5vcGVuRmlsZXNdO1xuICAgIH1cbiAgICBcbiAgICAvLyBGaWx0ZXIgYmFzZWQgb24gUXVpY2sgU3dpdGNoZXIgc2V0dGluZ3MgQkVGT1JFIGJhY2tmaWxsaW5nXG4gICAgaWYgKCFzaG93QXR0YWNobWVudHMpIHtcbiAgICAgIC8vIEZpbHRlciBvdXQgYXR0YWNobWVudHMgLSBvbmx5IHNob3cgbWFya2Rvd24gZmlsZXMgKGFuZCBNRFggaWYgZW5hYmxlZClcbiAgICAgIHJlY2VudEZpbGVzID0gcmVjZW50RmlsZXMuZmlsdGVyKGZpbGUgPT4gXG4gICAgICAgIGZpbGUuZXh0ZW5zaW9uID09PSAnbWQnIHx8IFxuICAgICAgICAoZmlsZS5leHRlbnNpb24gPT09ICdtZHgnICYmIHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZU1keFN1cHBvcnQpXG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBBbHdheXMgYmFja2ZpbGwgdG8gOCBpdGVtcyAob3IgYXMgbWFueSBhcyBhdmFpbGFibGUpXG4gICAgY29uc3QgdGFyZ2V0Q291bnQgPSA4O1xuICAgIGNvbnN0IGV4aXN0aW5nUGF0aHMgPSBuZXcgU2V0KHJlY2VudEZpbGVzLm1hcChmID0+IGYucGF0aCkpO1xuICAgIFxuICAgIGlmIChyZWNlbnRGaWxlcy5sZW5ndGggPCB0YXJnZXRDb3VudCkge1xuICAgICAgaWYgKHNob3dBdHRhY2htZW50cykge1xuICAgICAgICAvLyBJbmNsdWRlIGFsbCBmaWxlIHR5cGVzIChtYXJrZG93biArIGF0dGFjaG1lbnRzKVxuICAgICAgICBjb25zdCBhbGxGaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVzKCkuZmlsdGVyKChmaWxlKTogZmlsZSBpcyBURmlsZSA9PiBmaWxlIGluc3RhbmNlb2YgVEZpbGUpO1xuICAgICAgICBjb25zdCBhZGRpdGlvbmFsRmlsZXMgPSBhbGxGaWxlc1xuICAgICAgICAgIC5maWx0ZXIoZmlsZSA9PiAhZXhpc3RpbmdQYXRocy5oYXMoZmlsZS5wYXRoKSlcbiAgICAgICAgICAuc2xpY2UoMCwgdGFyZ2V0Q291bnQgLSByZWNlbnRGaWxlcy5sZW5ndGgpO1xuICAgICAgICByZWNlbnRGaWxlcy5wdXNoKC4uLmFkZGl0aW9uYWxGaWxlcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBPbmx5IG1hcmtkb3duIGZpbGVzIChhbmQgTURYIGlmIGVuYWJsZWQpXG4gICAgICAgIGNvbnN0IGFsbE1hcmtkb3duRmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCk7XG4gICAgICAgIGNvbnN0IG1keEZpbGVzID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlTWR4U3VwcG9ydFxuICAgICAgICAgID8gdGhpcy5hcHAudmF1bHQuZ2V0RmlsZXMoKS5maWx0ZXIoXG4gICAgICAgICAgICAgIChmKTogZiBpcyBURmlsZSA9PiBmIGluc3RhbmNlb2YgVEZpbGUgJiYgZi5leHRlbnNpb24gPT09ICdtZHgnXG4gICAgICAgICAgICApXG4gICAgICAgICAgOiBbXTtcbiAgICAgICAgY29uc3QgYWxsU3VwcG9ydGVkRmlsZXMgPSBbLi4uYWxsTWFya2Rvd25GaWxlcywgLi4ubWR4RmlsZXNdO1xuICAgICAgICBjb25zdCBhZGRpdGlvbmFsRmlsZXMgPSBhbGxTdXBwb3J0ZWRGaWxlc1xuICAgICAgICAgIC5maWx0ZXIoZmlsZSA9PiAhZXhpc3RpbmdQYXRocy5oYXMoZmlsZS5wYXRoKSlcbiAgICAgICAgICAuc2xpY2UoMCwgdGFyZ2V0Q291bnQgLSByZWNlbnRGaWxlcy5sZW5ndGgpO1xuICAgICAgICByZWNlbnRGaWxlcy5wdXNoKC4uLmFkZGl0aW9uYWxGaWxlcyk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIExpbWl0IHRvIDggZmlsZXNcbiAgICB0aGlzLnJlY2VudEZpbGVzID0gcmVjZW50RmlsZXMuc2xpY2UoMCwgdGFyZ2V0Q291bnQpO1xuICB9XG5cbiAgZ2V0SXRlbXMoKTogUXVpY2tTd2l0Y2hJdGVtWydpdGVtJ11bXSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0RmlsdGVyZWRGaWxlcygpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRGaWx0ZXJlZEZpbGVzKCk6IFRGaWxlW10ge1xuICAgIGNvbnN0IHF1aWNrU3dpdGNoZXJPcHRpb25zID0gdGhpcy5nZXRRdWlja1N3aXRjaGVyT3B0aW9ucygpO1xuICAgIFxuICAgIC8vIFN0YXJ0IHdpdGggbWFya2Rvd24gZmlsZXNcbiAgICBsZXQgZmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCk7XG4gICAgXG4gICAgLy8gQWRkIE1EWCBmaWxlcyBpZiBNRFggc3VwcG9ydCBpcyBlbmFibGVkXG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZU1keFN1cHBvcnQpIHtcbiAgICAgIGNvbnN0IG1keEZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0RmlsZXMoKS5maWx0ZXIoXG4gICAgICAgIChmKTogZiBpcyBURmlsZSA9PiBmIGluc3RhbmNlb2YgVEZpbGUgJiYgZi5leHRlbnNpb24gPT09ICdtZHgnXG4gICAgICApO1xuICAgICAgZmlsZXMgPSBbLi4uZmlsZXMsIC4uLm1keEZpbGVzXTtcbiAgICB9XG4gICAgXG4gICAgLy8gSWYgd2UgY2FuIGFjY2VzcyBRdWljayBTd2l0Y2hlciBvcHRpb25zIGFuZCBhdHRhY2htZW50cyBhcmUgZW5hYmxlZCwgaW5jbHVkZSB0aGVtXG4gICAgaWYgKHF1aWNrU3dpdGNoZXJPcHRpb25zPy5zaG93QXR0YWNobWVudHMpIHtcbiAgICAgIGNvbnN0IGFsbEZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0RmlsZXMoKS5maWx0ZXIoKGZpbGUpOiBmaWxlIGlzIFRGaWxlID0+IGZpbGUgaW5zdGFuY2VvZiBURmlsZSk7XG4gICAgICAvLyBJbmNsdWRlIG1hcmtkb3duIGZpbGVzLCBNRFggZmlsZXMgKGlmIGVuYWJsZWQpLCBhbmQgYXR0YWNobWVudHNcbiAgICAgIGZpbGVzID0gYWxsRmlsZXMuZmlsdGVyKChmaWxlKTogZmlsZSBpcyBURmlsZSA9PiBcbiAgICAgICAgZmlsZSBpbnN0YW5jZW9mIFRGaWxlICYmIChcbiAgICAgICAgICBmaWxlLmV4dGVuc2lvbiA9PT0gJ21kJyB8fCBcbiAgICAgICAgICAoZmlsZS5leHRlbnNpb24gPT09ICdtZHgnICYmIHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZU1keFN1cHBvcnQpIHx8XG4gICAgICAgICAgdGhpcy5pc0F0dGFjaG1lbnQoZmlsZSlcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG4gICAgLy8gSWYgc2hvd0F0dGFjaG1lbnRzIGlzIGZhbHNlIG9yIHdlIGNhbid0IGFjY2VzcyBvcHRpb25zLCBvbmx5IHNob3cgbWFya2Rvd24gZmlsZXMgKGFuZCBNRFggaWYgZW5hYmxlZClcblxuICAgIHJldHVybiBmaWxlcztcbiAgfVxuXG4gIHByaXZhdGUgaXNBdHRhY2htZW50KGZpbGU6IFRGaWxlKTogYm9vbGVhbiB7XG4gICAgY29uc3QgYXR0YWNobWVudEV4dGVuc2lvbnMgPSBbJ3BuZycsICdqcGcnLCAnanBlZycsICdnaWYnLCAnc3ZnJywgJ3dlYnAnLCAncGRmJywgJ21wNCcsICdtcDMnLCAnd2F2JywgJ29nZycsICd3ZWJtJ107XG4gICAgcmV0dXJuIGF0dGFjaG1lbnRFeHRlbnNpb25zLmluY2x1ZGVzKGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRRdWlja1N3aXRjaGVyT3B0aW9ucygpOiBRdWlja1N3aXRjaGVyUGx1Z2luSW5zdGFuY2VbJ29wdGlvbnMnXSB8IG51bGwge1xuICAgIHRyeSB7XG4gICAgICAvLyBBY2Nlc3MgdGhlIGludGVybmFsIFF1aWNrIFN3aXRjaGVyIHBsdWdpbiB0aGUgc2FtZSB3YXkgUXVpY2sgU3dpdGNoICsrIGRvZXNcbiAgICAgIGNvbnN0IGludGVybmFsUGx1Z2lucyA9ICh0aGlzLmFwcCBhcyB1bmtub3duIGFzIEFwcEludGVybmFsKS5pbnRlcm5hbFBsdWdpbnM7XG4gICAgICBpZiAoIWludGVybmFsUGx1Z2lucykgcmV0dXJuIG51bGw7XG4gICAgICBcbiAgICAgIGNvbnN0IHN3aXRjaGVyUGx1Z2luID0gaW50ZXJuYWxQbHVnaW5zLmdldFBsdWdpbkJ5SWQ/Lignc3dpdGNoZXInKTtcbiAgICAgIGlmICghc3dpdGNoZXJQbHVnaW4gfHwgIXN3aXRjaGVyUGx1Z2luLmluc3RhbmNlKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc3dpdGNoZXJQbHVnaW4uaW5zdGFuY2Uub3B0aW9ucyB8fCBudWxsO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgZ2V0SXRlbVRleHQoaXRlbTogUXVpY2tTd2l0Y2hJdGVtWydpdGVtJ10pOiBzdHJpbmcge1xuICAgIGlmICgnaXNOZXdOb3RlJyBpbiBpdGVtKSB7XG4gICAgICByZXR1cm4gaXRlbS5uZXdOYW1lOyAvLyBKdXN0IHJldHVybiB0aGUgbmFtZSwgT2JzaWRpYW4gd2lsbCBoYW5kbGUgdGhlIFwiRW50ZXIgdG8gY3JlYXRlXCIgdGV4dFxuICAgIH1cbiAgICBcbiAgICBpZiAoJ2lzVW5yZXNvbHZlZCcgaW4gaXRlbSkge1xuICAgICAgcmV0dXJuIGl0ZW0udW5yZXNvbHZlZFRleHQ7XG4gICAgfVxuICAgIFxuICAgIC8vIFdoZW4gZGlzYWJsZWQsIHNob3cganVzdCB0aGUgZmlsZSBuYW1lIGxpa2UgZGVmYXVsdCBPYnNpZGlhblxuICAgIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yUXVpY2tTd2l0Y2hlcikge1xuICAgICAgcmV0dXJuIGl0ZW0uYmFzZW5hbWU7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGRpc3BsYXkgPSB0aGlzLmdldERpc3BsYXlOYW1lKGl0ZW0pO1xuICAgIHJldHVybiBkaXNwbGF5O1xuICB9XG5cbiAgZ2V0RGlzcGxheU5hbWUoZmlsZTogVEZpbGUpOiBzdHJpbmcge1xuICAgIC8vIFRyeSB0byBnZXQgZnJvbSBjYWNoZSBmaXJzdCAoZmFzdCwgd29ya3MgZm9yIGJvdGggTUQgYW5kIE1EWCBpZiBjYWNoZWQpXG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5maWxlQ2FjaGUuZ2V0KGZpbGUucGF0aCk7XG4gICAgaWYgKGNhY2hlZCkge1xuICAgICAgcmV0dXJuIGNhY2hlZC5kaXNwbGF5TmFtZTtcbiAgICB9XG4gICAgXG4gICAgLy8gRmFsbGJhY2s6IHVzZSBzeW5jIHZlcnNpb24gZm9yIC5tZCBmaWxlcywgb3IgcmV0dXJuIGJhc2VuYW1lIGZvciAubWR4ICh3aWxsIGJlIGNhY2hlZCBhc3luYylcbiAgICBjb25zdCBmcm9udG1hdHRlciA9IGdldEZyb250bWF0dGVyU3luYyh0aGlzLmFwcCwgZmlsZSwgdGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xuICAgIFxuICAgIGlmIChmcm9udG1hdHRlcikge1xuICAgICAgY29uc3QgcHJvcGVydHlWYWx1ZSA9IGZyb250bWF0dGVyW3RoaXMucGx1Z2luLnNldHRpbmdzLnByb3BlcnR5S2V5XTtcbiAgICAgIGlmIChwcm9wZXJ0eVZhbHVlICE9PSB1bmRlZmluZWQgJiYgcHJvcGVydHlWYWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICBjb25zdCB0cmltbWVkID0gdHlwZW9mIHByb3BlcnR5VmFsdWUgPT09ICdzdHJpbmcnID8gcHJvcGVydHlWYWx1ZS50cmltKCkgOiAodHlwZW9mIHByb3BlcnR5VmFsdWUgPT09ICdudW1iZXInIHx8IHR5cGVvZiBwcm9wZXJ0eVZhbHVlID09PSAnYm9vbGVhbicgPyBTdHJpbmcocHJvcGVydHlWYWx1ZSkgOiAnJykudHJpbSgpO1xuICAgICAgICBpZiAodHJpbW1lZCAhPT0gJycpIHtcbiAgICAgICAgICByZXR1cm4gdHJpbW1lZDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZmlsZS5iYXNlbmFtZTtcbiAgfVxuXG4gIGdldFN1Z2dlc3Rpb25zKHF1ZXJ5OiBzdHJpbmcpOiBGdXp6eU1hdGNoPFF1aWNrU3dpdGNoSXRlbVsnaXRlbSddPltdIHtcbiAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvclF1aWNrU3dpdGNoZXIpIHtcbiAgICAgIC8vIFdoZW4gZGlzYWJsZWQsIHVzZSBkZWZhdWx0IE9ic2lkaWFuIGJlaGF2aW9yIC0gc2hvdyBhbGwgZmlsZXMgd2l0aCBkZWZhdWx0IHNlYXJjaFxuICAgICAgY29uc3Qgc2VhcmNoUXVlcnkgPSBxdWVyeS50cmltKCk7XG4gICAgICBcbiAgICAgIGlmICghc2VhcmNoUXVlcnkpIHtcbiAgICAgICAgLy8gU2hvdyByZWNlbnQgZmlsZXMgbGlrZSBkZWZhdWx0IE9ic2lkaWFuXG4gICAgICAgIHJldHVybiB0aGlzLmdldFJlY2VudEZpbGVzUmVzdWx0cygpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBVc2UgZGVmYXVsdCBPYnNpZGlhbiBzZWFyY2ggLSBqdXN0IHNob3cgZmlsZXMgd2l0aCBmaWxlIG5hbWUgbWF0Y2hpbmdcbiAgICAgIGNvbnN0IGZpbGVzID0gdGhpcy5nZXRGaWx0ZXJlZEZpbGVzKCk7XG4gICAgICBjb25zdCBzZWFyY2ggPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy51c2VTaW1wbGVTZWFyY2ggXG4gICAgICAgID8gcHJlcGFyZVNpbXBsZVNlYXJjaChzZWFyY2hRdWVyeSlcbiAgICAgICAgOiBwcmVwYXJlRnV6enlTZWFyY2goc2VhcmNoUXVlcnkpO1xuICAgICAgY29uc3QgcmVzdWx0czogRnV6enlNYXRjaDxRdWlja1N3aXRjaEl0ZW1bJ2l0ZW0nXT5bXSA9IFtdO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSBzZWFyY2goZmlsZS5iYXNlbmFtZSkgPz8geyBzY29yZTogMCwgbWF0Y2hlczogW10gfTtcbiAgICAgICAgaWYgKG1hdGNoLm1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJlc3VsdHMucHVzaCh7IGl0ZW06IGZpbGUsIG1hdGNoIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFVzZSBPYnNpZGlhbidzIG5hdGl2ZSBzb3J0aW5nIGZvciBleGFjdCB2YW5pbGxhIGNvbXBhdGliaWxpdHlcbiAgICAgIHNvcnRTZWFyY2hSZXN1bHRzKHJlc3VsdHMpO1xuICAgICAgXG4gICAgICAvLyBBbHdheXMgYWRkIG5ldyBub3RlIG9wdGlvbiBpZiBubyByZXN1bHRzXG4gICAgICAvLyBcIlNob3cgZXhpc3Rpbmcgb25seVwiIG9ubHkgYWZmZWN0cyBzaG93aW5nIHVucmVzb2x2ZWQgbGlua3MsIG5vdCBjcmVhdGluZyBuZXcgbm90ZXNcbiAgICAgIGlmIChyZXN1bHRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBjb25zdCBuZXdJdGVtOiBOZXdOb3RlSXRlbSA9IHsgaXNOZXdOb3RlOiB0cnVlLCBuZXdOYW1lOiBzZWFyY2hRdWVyeSB9O1xuICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgIGl0ZW06IG5ld0l0ZW0sXG4gICAgICAgICAgbWF0Y2g6IHsgc2NvcmU6IDEwMDAsIG1hdGNoZXM6IFtbMCwgc2VhcmNoUXVlcnkubGVuZ3RoXV0gfSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHRzLnNsaWNlKDAsIHRoaXMubGltaXQpO1xuICAgIH1cblxuICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0gcXVlcnkudHJpbSgpO1xuICAgIFxuICAgIC8vIENsZWFyIHByZXZpb3VzIHRpbWVvdXRcbiAgICBpZiAodGhpcy5zZWFyY2hUaW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5zZWFyY2hUaW1lb3V0KTtcbiAgICB9XG5cbiAgICAvLyBJZiBubyBxdWVyeSwgc2hvdyByZWNlbnQgZmlsZXNcbiAgICBpZiAoIXNlYXJjaFF1ZXJ5KSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRSZWNlbnRGaWxlc1Jlc3VsdHMoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wZXJmb3JtU2VhcmNoKHNlYXJjaFF1ZXJ5KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UmVjZW50RmlsZXNSZXN1bHRzKCk6IEZ1enp5TWF0Y2g8UXVpY2tTd2l0Y2hJdGVtWydpdGVtJ10+W10ge1xuICAgIC8vIFVwZGF0ZSByZWNlbnQgZmlsZXMgKHRoaXMgYWxyZWFkeSBoYW5kbGVzIGZpbHRlcmluZyBhbmQgYmFja2ZpbGxpbmcpXG4gICAgdGhpcy51cGRhdGVSZWNlbnRGaWxlcygpO1xuICAgIFxuICAgIC8vIENsZWFyIG1hdGNoIHJlYXNvbnMgZm9yIHJlY2VudCBmaWxlcyBzaW5jZSB0aGV5J3JlIG5vdCBzZWFyY2ggcmVzdWx0c1xuICAgIHRoaXMubWF0Y2hSZWFzb25zLmNsZWFyKCk7XG4gICAgXG4gICAgLy8gUmV0dXJuIHRoZSByZWNlbnQgZmlsZXMgKGFscmVhZHkgZmlsdGVyZWQgYW5kIGJhY2tmaWxsZWQgaW4gdXBkYXRlUmVjZW50RmlsZXMpXG4gICAgcmV0dXJuIHRoaXMucmVjZW50RmlsZXMubWFwKGZpbGUgPT4gKHtcbiAgICAgIGl0ZW06IGZpbGUsXG4gICAgICBtYXRjaDogeyBzY29yZTogMTAwMCwgbWF0Y2hlczogW10gfVxuICAgIH0pKTtcbiAgfVxuXG4gIHByaXZhdGUgcGVyZm9ybVNlYXJjaChzZWFyY2hRdWVyeTogc3RyaW5nKTogRnV6enlNYXRjaDxRdWlja1N3aXRjaEl0ZW1bJ2l0ZW0nXT5bXSB7XG4gICAgLy8gVXNlIHNpbXBsZSBzZWFyY2ggZm9yIGxhcmdlIHZhdWx0cyBpZiBlbmFibGVkLCBvdGhlcndpc2UgdXNlIGZ1enp5IHNlYXJjaFxuICAgIGNvbnN0IHNlYXJjaCA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnVzZVNpbXBsZVNlYXJjaCBcbiAgICAgID8gcHJlcGFyZVNpbXBsZVNlYXJjaChzZWFyY2hRdWVyeSlcbiAgICAgIDogcHJlcGFyZUZ1enp5U2VhcmNoKHNlYXJjaFF1ZXJ5KTtcbiAgICBjb25zdCByZXN1bHRzOiBGdXp6eU1hdGNoPFF1aWNrU3dpdGNoSXRlbVsnaXRlbSddPltdID0gW107XG4gICAgdGhpcy5tYXRjaFJlYXNvbnMuY2xlYXIoKTsgLy8gQ2xlYXIgcHJldmlvdXMgbWF0Y2ggcmVhc29uc1xuXG4gICAgLy8gVXNlIGNhY2hlZCBkYXRhIGZvciBtdWNoIGZhc3RlciBzZWFyY2hcbiAgICBmb3IgKGNvbnN0IGNhY2hlZERhdGEgb2YgdGhpcy5maWxlQ2FjaGUudmFsdWVzKCkpIHtcbiAgICAgIGNvbnN0IHsgZmlsZSwgZGlzcGxheU5hbWUsIGFsaWFzZXMsIGlzQ3VzdG9tRGlzcGxheSB9ID0gY2FjaGVkRGF0YTtcbiAgICAgIFxuICAgICAgLy8gVHJhY2sgd2hpY2ggZmllbGRzIGNhdXNlZCB0aGUgbWF0Y2hcbiAgICAgIGNvbnN0IG1hdGNoUmVhc29uOiBTZWFyY2hNYXRjaFJlYXNvbiA9IHtcbiAgICAgICAgbWF0Y2hlZEluVGl0bGU6IGZhbHNlLFxuICAgICAgICBtYXRjaGVkSW5GaWxlbmFtZTogZmFsc2UsXG4gICAgICAgIG1hdGNoZWRJbkFsaWFzOiBmYWxzZVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgLy8gUHJpbWFyeSBtYXRjaDogc2VhcmNoIHRpdGxlL3Byb3BlcnR5IGZpcnN0IChvbmx5IGlmIG5vdGUgaGFzIGN1c3RvbSBkaXNwbGF5KVxuICAgICAgbGV0IHByaW1hcnlNYXRjaDogU2VhcmNoUmVzdWx0IHwgbnVsbCA9IG51bGw7XG4gICAgICBsZXQgYmVzdE1hdGNoOiBTZWFyY2hSZXN1bHQgfCBudWxsID0gbnVsbDtcbiAgICAgIGxldCBtYXRjaFR5cGU6ICd0aXRsZScgfCAnZmlsZW5hbWUnIHwgJ2FsaWFzJyB8IG51bGwgPSBudWxsO1xuICAgICAgXG4gICAgICBpZiAoaXNDdXN0b21EaXNwbGF5KSB7XG4gICAgICAgIC8vIE9ubHkgc2VhcmNoIHRpdGxlL3Byb3BlcnR5IGlmIG5vdGUgYWN0dWFsbHkgaGFzIGEgY3VzdG9tIHByb3BlcnR5XG4gICAgICAgIHByaW1hcnlNYXRjaCA9IHNlYXJjaChkaXNwbGF5TmFtZSk7XG4gICAgICAgIGlmIChwcmltYXJ5TWF0Y2ggJiYgcHJpbWFyeU1hdGNoLm1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIG1hdGNoUmVhc29uLm1hdGNoZWRJblRpdGxlID0gdHJ1ZTtcbiAgICAgICAgICBiZXN0TWF0Y2ggPSBwcmltYXJ5TWF0Y2g7XG4gICAgICAgICAgbWF0Y2hUeXBlID0gJ3RpdGxlJztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBJZiBubyB0aXRsZSBtYXRjaCAob3Igbm90ZSBkb2Vzbid0IGhhdmUgcHJvcGVydHkpLCBzZWFyY2ggZmlsZW5hbWVcbiAgICAgIGlmICghbWF0Y2hUeXBlKSB7XG4gICAgICAgIC8vIFNlYXJjaCBmaWxlbmFtZSBpZiBpdCdzIGRpZmZlcmVudCBmcm9tIGRpc3BsYXlOYW1lLCBvciBpZiBub3RlIGRvZXNuJ3QgaGF2ZSBwcm9wZXJ0eVxuICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuaW5jbHVkZUZpbGVuYW1lSW5TZWFyY2ggJiYgZmlsZS5iYXNlbmFtZSAhPT0gZGlzcGxheU5hbWUpIHtcbiAgICAgICAgICBjb25zdCBmaWxlbmFtZU1hdGNoID0gc2VhcmNoKGZpbGUuYmFzZW5hbWUpO1xuICAgICAgICAgIGlmIChmaWxlbmFtZU1hdGNoICYmIGZpbGVuYW1lTWF0Y2gubWF0Y2hlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBtYXRjaFJlYXNvbi5tYXRjaGVkSW5GaWxlbmFtZSA9IHRydWU7XG4gICAgICAgICAgICAvLyBEb3ducmFuayBmaWxlbmFtZSBtYXRjaGVzIGJ5IC0xXG4gICAgICAgICAgICBiZXN0TWF0Y2ggPSB7IC4uLmZpbGVuYW1lTWF0Y2gsIHNjb3JlOiBmaWxlbmFtZU1hdGNoLnNjb3JlIC0gMSB9O1xuICAgICAgICAgICAgbWF0Y2hUeXBlID0gJ2ZpbGVuYW1lJztcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoIWlzQ3VzdG9tRGlzcGxheSkge1xuICAgICAgICAgIC8vIElmIG5vdGUgZG9lc24ndCBoYXZlIHByb3BlcnR5LCBkaXNwbGF5TmFtZSBlcXVhbHMgZmlsZW5hbWUsIHNvIHNlYXJjaCBmaWxlbmFtZVxuICAgICAgICAgIGNvbnN0IGZpbGVuYW1lTWF0Y2ggPSBzZWFyY2goZmlsZS5iYXNlbmFtZSk7XG4gICAgICAgICAgaWYgKGZpbGVuYW1lTWF0Y2ggJiYgZmlsZW5hbWVNYXRjaC5tYXRjaGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIG1hdGNoUmVhc29uLm1hdGNoZWRJbkZpbGVuYW1lID0gdHJ1ZTtcbiAgICAgICAgICAgIGJlc3RNYXRjaCA9IGZpbGVuYW1lTWF0Y2g7XG4gICAgICAgICAgICBtYXRjaFR5cGUgPSAnZmlsZW5hbWUnO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBUZXJ0aWFyeSBtYXRjaDogc2VhcmNoIGFsaWFzZXMgKHdpdGggZG93bnJhbmtpbmcpXG4gICAgICBpZiAoIW1hdGNoVHlwZSAmJiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5pbmNsdWRlQWxpYXNlc0luU2VhcmNoICYmIGFsaWFzZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBmb3IgKGNvbnN0IGFsaWFzIG9mIGFsaWFzZXMpIHtcbiAgICAgICAgICBjb25zdCBhbGlhc01hdGNoID0gc2VhcmNoKGFsaWFzKTtcbiAgICAgICAgICBpZiAoYWxpYXNNYXRjaCAmJiBhbGlhc01hdGNoLm1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbWF0Y2hSZWFzb24ubWF0Y2hlZEluQWxpYXMgPSB0cnVlO1xuICAgICAgICAgICAgbWF0Y2hSZWFzb24ubWF0Y2hlZEFsaWFzVGV4dCA9IGFsaWFzOyAvLyBTdG9yZSB3aGljaCBhbGlhcyBtYXRjaGVkXG4gICAgICAgICAgICAvLyBEb3ducmFuayBhbGlhcyBtYXRjaGVzIGJ5IC0xXG4gICAgICAgICAgICBiZXN0TWF0Y2ggPSB7IC4uLmFsaWFzTWF0Y2gsIHNjb3JlOiBhbGlhc01hdGNoLnNjb3JlIC0gMSB9O1xuICAgICAgICAgICAgbWF0Y2hUeXBlID0gJ2FsaWFzJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBJZiB3ZSBoYXZlIGFueSBtYXRjaCwgYWRkIHRvIHJlc3VsdHNcbiAgICAgIGlmIChiZXN0TWF0Y2ggJiYgYmVzdE1hdGNoLm1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgICByZXN1bHRzLnB1c2goeyBpdGVtOiBmaWxlLCBtYXRjaDogYmVzdE1hdGNoIH0pO1xuICAgICAgICB0aGlzLm1hdGNoUmVhc29ucy5zZXQoZmlsZS5wYXRoLCBtYXRjaFJlYXNvbik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIHVucmVzb2x2ZWQgbGlua3MgaWYgXCJTaG93IGV4aXN0aW5nIG9ubHlcIiBpcyBkaXNhYmxlZFxuICAgIC8vIFRoaXMgbWF0Y2hlcyBRdWljayBTd2l0Y2ggKysgYmVoYXZpb3I6IHVucmVzb2x2ZWQ6ICFzZXR0aW5ncy5zaG93RXhpc3RpbmdPbmx5XG4gICAgY29uc3QgcXVpY2tTd2l0Y2hlck9wdGlvbnMgPSB0aGlzLmdldFF1aWNrU3dpdGNoZXJPcHRpb25zKCk7XG4gICAgY29uc3Qgc2hvd0V4aXN0aW5nT25seSA9IHF1aWNrU3dpdGNoZXJPcHRpb25zPy5zaG93RXhpc3RpbmdPbmx5ID8/IGZhbHNlO1xuICAgIFxuICAgIGlmICghc2hvd0V4aXN0aW5nT25seSkge1xuICAgICAgLy8gR2V0IHVucmVzb2x2ZWQgbGlua3MgZnJvbSBtZXRhZGF0YSBjYWNoZSAobGlrZSBRdWljayBTd2l0Y2ggKysgZG9lcylcbiAgICAgIGNvbnN0IHsgdW5yZXNvbHZlZExpbmtzIH0gPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlO1xuICAgICAgY29uc3QgdW5yZXNvbHZlZFNldCA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgICAgXG4gICAgICAvLyBDb2xsZWN0IGFsbCB1bnJlc29sdmVkIGxpbmtzIGZyb20gYWxsIGZpbGVzXG4gICAgICBmb3IgKGNvbnN0IHNvdXJjZVBhdGggaW4gdW5yZXNvbHZlZExpbmtzKSB7XG4gICAgICAgIGNvbnN0IGxpbmtzID0gT2JqZWN0LmtleXModW5yZXNvbHZlZExpbmtzW3NvdXJjZVBhdGhdKTtcbiAgICAgICAgbGlua3MuZm9yRWFjaChsaW5rID0+IHVucmVzb2x2ZWRTZXQuYWRkKGxpbmspKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gU2VhcmNoIHVucmVzb2x2ZWQgbGlua3MgYW5kIGFkZCBtYXRjaGVzXG4gICAgICBmb3IgKGNvbnN0IHVucmVzb2x2ZWQgb2YgdW5yZXNvbHZlZFNldCkge1xuICAgICAgICBjb25zdCB1bnJlc29sdmVkTWF0Y2ggPSBzZWFyY2godW5yZXNvbHZlZCk7XG4gICAgICAgIGlmICh1bnJlc29sdmVkTWF0Y2ggJiYgdW5yZXNvbHZlZE1hdGNoLm1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIC8vIEFkZCBhcyBhIHN1Z2dlc3Rpb24gd2l0aG91dCBhIGZpbGUgKHVucmVzb2x2ZWQgbGluaylcbiAgICAgICAgICAvLyBVc2UgYSBzcGVjaWFsIG9iamVjdCB0byByZXByZXNlbnQgdW5yZXNvbHZlZCBsaW5rc1xuICAgICAgICAgIGNvbnN0IHVucmVzb2x2ZWRJdGVtOiBVbnJlc29sdmVkTGlua0l0ZW0gPSB7IGlzVW5yZXNvbHZlZDogdHJ1ZSwgdW5yZXNvbHZlZFRleHQ6IHVucmVzb2x2ZWQgfTtcbiAgICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgICAgaXRlbTogdW5yZXNvbHZlZEl0ZW0sXG4gICAgICAgICAgICBtYXRjaDogdW5yZXNvbHZlZE1hdGNoXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gVXNlIE9ic2lkaWFuJ3MgbmF0aXZlIHNvcnRpbmcgZm9yIGV4YWN0IHZhbmlsbGEgY29tcGF0aWJpbGl0eVxuICAgICAgc29ydFNlYXJjaFJlc3VsdHMocmVzdWx0cyk7XG4gICAgICBcbiAgICAgIC8vIEZpbHRlciBvdXQgdW5yZXNvbHZlZCBsaW5rcyBpZiBcIlNob3cgZXhpc3Rpbmcgb25seVwiIGlzIGVuYWJsZWRcbiAgICAgIC8vIFVucmVzb2x2ZWQgbGlua3MgYXJlIGl0ZW1zIHdpdGggaXNVbnJlc29sdmVkIHByb3BlcnR5LCBidXQga2VlcCBcImNyZWF0ZSBuZXcgbm90ZVwiIG9wdGlvbnNcbiAgICAgIGxldCBmaWx0ZXJlZFJlc3VsdHMgPSByZXN1bHRzO1xuICAgICAgaWYgKHNob3dFeGlzdGluZ09ubHkpIHtcbiAgICAgICAgZmlsdGVyZWRSZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiB7XG4gICAgICAgICAgLy8gS2VlcCBmaWxlcyBhbmQgbmV3IG5vdGUgaXRlbXMsIGZpbHRlciBvdXQgdW5yZXNvbHZlZCBsaW5rc1xuICAgICAgICAgIHJldHVybiByLml0ZW0gaW5zdGFuY2VvZiBURmlsZSB8fCAoJ2lzTmV3Tm90ZScgaW4gci5pdGVtICYmIHIuaXRlbS5pc05ld05vdGUgPT09IHRydWUpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgZm9yIGV4YWN0IG1hdGNoZXMgaW4gZXhpc3RpbmcgZmlsZXNcbiAgICAgIGNvbnN0IGxvd2VyUXVlcnkgPSBzZWFyY2hRdWVyeS50b0xvd2VyQ2FzZSgpO1xuICAgICAgbGV0IGV4YWN0TWF0Y2ggPSBmaWx0ZXJlZFJlc3VsdHMuc29tZShyID0+IFxuICAgICAgICByLml0ZW0gaW5zdGFuY2VvZiBURmlsZSAmJiAoXG4gICAgICAgICAgdGhpcy5nZXREaXNwbGF5TmFtZShyLml0ZW0pLnRvTG93ZXJDYXNlKCkgPT09IGxvd2VyUXVlcnkgfHxcbiAgICAgICAgICAodGhpcy5wbHVnaW4uc2V0dGluZ3MuaW5jbHVkZUZpbGVuYW1lSW5TZWFyY2ggJiYgci5pdGVtLmJhc2VuYW1lLnRvTG93ZXJDYXNlKCkgPT09IGxvd2VyUXVlcnkpIHx8XG4gICAgICAgICAgKHRoaXMucGx1Z2luLnNldHRpbmdzLmluY2x1ZGVBbGlhc2VzSW5TZWFyY2ggJiYgdGhpcy5maWxlQ2FjaGUuZ2V0KHIuaXRlbS5wYXRoKT8uYWxpYXNlcy5zb21lKGFsaWFzID0+IGFsaWFzLnRvTG93ZXJDYXNlKCkgPT09IGxvd2VyUXVlcnkpKVxuICAgICAgICApXG4gICAgICApO1xuICAgICAgXG4gICAgICAvLyBBbHNvIGNoZWNrIHVucmVzb2x2ZWQgbGlua3MgaWYgdGhleSdyZSBiZWluZyBzaG93blxuICAgICAgaWYgKCFzaG93RXhpc3RpbmdPbmx5ICYmICFleGFjdE1hdGNoKSB7XG4gICAgICAgIGNvbnN0IHsgdW5yZXNvbHZlZExpbmtzIH0gPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlO1xuICAgICAgICBjb25zdCB1bnJlc29sdmVkU2V0ID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgICAgIGZvciAoY29uc3Qgc291cmNlUGF0aCBpbiB1bnJlc29sdmVkTGlua3MpIHtcbiAgICAgICAgICBjb25zdCBsaW5rcyA9IE9iamVjdC5rZXlzKHVucmVzb2x2ZWRMaW5rc1tzb3VyY2VQYXRoXSk7XG4gICAgICAgICAgbGlua3MuZm9yRWFjaChsaW5rID0+IHVucmVzb2x2ZWRTZXQuYWRkKGxpbmspKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayBpZiBxdWVyeSBleGFjdGx5IG1hdGNoZXMgYW55IHVucmVzb2x2ZWQgbGlua1xuICAgICAgICBleGFjdE1hdGNoID0gQXJyYXkuZnJvbSh1bnJlc29sdmVkU2V0KS5zb21lKGxpbmsgPT4gbGluay50b0xvd2VyQ2FzZSgpID09PSBsb3dlclF1ZXJ5KTtcbiAgICAgIH1cblxuICAgICAgLy8gQWx3YXlzIGFkZCBuZXcgbm90ZSBvcHRpb24gaWYgbm8gZXhhY3QgbWF0Y2ggZXhpc3RzXG4gICAgICAvLyBcIlNob3cgZXhpc3Rpbmcgb25seVwiIG9ubHkgYWZmZWN0cyBzaG93aW5nIHVucmVzb2x2ZWQgbGlua3MsIG5vdCBjcmVhdGluZyBuZXcgbm90ZXNcbiAgICAgIGlmICghZXhhY3RNYXRjaCAmJiBzZWFyY2hRdWVyeSkge1xuICAgICAgICBjb25zdCBuZXdJdGVtOiBOZXdOb3RlSXRlbSA9IHsgaXNOZXdOb3RlOiB0cnVlLCBuZXdOYW1lOiBzZWFyY2hRdWVyeSB9O1xuICAgICAgICBmaWx0ZXJlZFJlc3VsdHMudW5zaGlmdCh7XG4gICAgICAgICAgaXRlbTogbmV3SXRlbSxcbiAgICAgICAgICBtYXRjaDogeyBzY29yZTogMTAwMCwgbWF0Y2hlczogW1swLCBzZWFyY2hRdWVyeS5sZW5ndGhdXSB9LFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZpbHRlcmVkUmVzdWx0cy5zbGljZSgwLCB0aGlzLmxpbWl0KTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIG5ldyBOb3RpY2UoJ0Vycm9yIHVwZGF0aW5nIHF1aWNrIHN3aXRjaGVyIHN1Z2dlc3Rpb25zLiBQbGVhc2UgY2hlY2sgY29uc29sZSBmb3IgZGV0YWlscy4nKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICByZW5kZXJTdWdnZXN0aW9uKHN1Z2dlc3Rpb246IEZ1enp5TWF0Y2g8UXVpY2tTd2l0Y2hJdGVtWydpdGVtJ10+LCBlbDogSFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICBjb25zdCB7IGl0ZW0gfSA9IHN1Z2dlc3Rpb247XG4gICAgXG4gICAgLy8gSGFuZGxlIHVucmVzb2x2ZWQgbGlua3MgLSBzaG93IGZpbGUtcGx1cyBpY29uIGluc3RlYWQgb2YgXCJFbnRlciB0byBjcmVhdGVcIiB0ZXh0XG4gICAgaWYgKCdpc1VucmVzb2x2ZWQnIGluIGl0ZW0gJiYgaXRlbS5pc1VucmVzb2x2ZWQpIHtcbiAgICAgIGNvbnN0IHVucmVzb2x2ZWRUZXh0ID0gaXRlbS51bnJlc29sdmVkVGV4dDtcbiAgICAgIGVsLmVtcHR5KCk7XG4gICAgICBlbC5hZGRDbGFzcygnbW9kLWNvbXBsZXgnKTtcbiAgICAgIGNvbnN0IHN1Z2dlc3Rpb25Db250ZW50ID0gZWwuY3JlYXRlRGl2KHsgY2xzOiAnc3VnZ2VzdGlvbi1jb250ZW50JyB9KTtcbiAgICAgIGNvbnN0IHN1Z2dlc3Rpb25UaXRsZSA9IHN1Z2dlc3Rpb25Db250ZW50LmNyZWF0ZURpdih7IGNsczogJ3N1Z2dlc3Rpb24tdGl0bGUnIH0pO1xuICAgICAgc3VnZ2VzdGlvblRpdGxlLnNldFRleHQodW5yZXNvbHZlZFRleHQpO1xuICAgICAgY29uc3Qgc3VnZ2VzdGlvbkF1eCA9IGVsLmNyZWF0ZURpdih7IGNsczogJ3N1Z2dlc3Rpb24tYXV4JyB9KTtcbiAgICAgIGNvbnN0IHN1Z2dlc3Rpb25GbGFpciA9IHN1Z2dlc3Rpb25BdXguY3JlYXRlU3Bhbih7IFxuICAgICAgICBjbHM6ICdzdWdnZXN0aW9uLWZsYWlyJywgXG4gICAgICAgIGF0dHI6IHsgJ2FyaWEtbGFiZWwnOiAnVW5yZXNvbHZlZCBsaW5rIC0gRW50ZXIgdG8gY3JlYXRlJyB9IFxuICAgICAgfSk7XG4gICAgICB0aGlzLmNyZWF0ZUZpbGVQbHVzSWNvbihzdWdnZXN0aW9uRmxhaXIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCB0ZXh0ID0gdGhpcy5nZXRJdGVtVGV4dChpdGVtKTtcbiAgICBcbiAgICBpZiAoJ2lzTmV3Tm90ZScgaW4gaXRlbSkge1xuICAgICAgLy8gRm9yIG5ldyBub3RlcywgdXNlIHRoZSBleGFjdCBIVE1MIHN0cnVjdHVyZSBmcm9tIGRlZmF1bHQgT2JzaWRpYW5cbiAgICAgIGVsLmVtcHR5KCk7XG4gICAgICBlbC5hZGRDbGFzcygnbW9kLWNvbXBsZXgnKTtcbiAgICAgIFxuICAgICAgLy8gTWFpbiBzdWdnZXN0aW9uIGNvbnRlbnRcbiAgICAgIGNvbnN0IHN1Z2dlc3Rpb25Db250ZW50ID0gZWwuY3JlYXRlRGl2KHsgY2xzOiAnc3VnZ2VzdGlvbi1jb250ZW50JyB9KTtcbiAgICAgIGNvbnN0IHN1Z2dlc3Rpb25UaXRsZSA9IHN1Z2dlc3Rpb25Db250ZW50LmNyZWF0ZURpdih7IGNsczogJ3N1Z2dlc3Rpb24tdGl0bGUnIH0pO1xuICAgICAgc3VnZ2VzdGlvblRpdGxlLnNldFRleHQodGV4dCk7XG4gICAgICBcbiAgICAgIC8vIEFkZCBcIkVudGVyIHRvIGNyZWF0ZVwiIHRleHQgb24gdGhlIHJpZ2h0IHVzaW5nIHRoZSBjb3JyZWN0IGNsYXNzXG4gICAgICBjb25zdCBzdWdnZXN0aW9uQXV4ID0gZWwuY3JlYXRlRGl2KHsgY2xzOiAnc3VnZ2VzdGlvbi1hdXgnIH0pO1xuICAgICAgY29uc3Qgc3VnZ2VzdGlvbkFjdGlvbiA9IHN1Z2dlc3Rpb25BdXguY3JlYXRlU3Bhbih7IGNsczogJ3N1Z2dlc3Rpb24tYWN0aW9uJyB9KTtcbiAgICAgIHN1Z2dlc3Rpb25BY3Rpb24uc2V0VGV4dCgnRW50ZXIgdG8gY3JlYXRlJyk7XG4gICAgICBcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBXaGVuIGRpc2FibGVkLCB1c2UgZGVmYXVsdCBPYnNpZGlhbiBzdHlsaW5nIChubyBjdXN0b20gY2xhc3NlcyBvciBpY29ucylcbiAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvclF1aWNrU3dpdGNoZXIpIHtcbiAgICAgIC8vIFVzZSBkZWZhdWx0IE9ic2lkaWFuIHNpbmdsZS1saW5lIGRpc3BsYXlcbiAgICAgIGlmIChpdGVtIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgZWwuc2V0VGV4dChpdGVtLnBhdGgucmVwbGFjZSgnLm1kJywgJycpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsLnNldFRleHQodGV4dCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFdoZW4gZW5hYmxlZCwgdXNlIG91ciBjdXN0b20gc3R5bGluZyB3aXRoIGljb25zXG4gICAgICAvLyBPbmx5IHNob3cgaWNvbnMgZm9yIFRGaWxlIGl0ZW1zLCBub3QgdW5yZXNvbHZlZCBsaW5rc1xuICAgICAgaWYgKCEoaXRlbSBpbnN0YW5jZW9mIFRGaWxlKSkge1xuICAgICAgICBlbC5zZXRUZXh0KHRleHQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGlmIHRoaXMgZmlsZSBoYXMgYSBjdXN0b20gcHJvcGVydHlcbiAgICAgIGNvbnN0IGNhY2hlZERhdGEgPSB0aGlzLmZpbGVDYWNoZS5nZXQoaXRlbS5wYXRoKTtcbiAgICAgIGNvbnN0IGlzQ3VzdG9tRGlzcGxheSA9IGNhY2hlZERhdGE/LmlzQ3VzdG9tRGlzcGxheSA/PyBmYWxzZTtcbiAgICAgIGNvbnN0IG1hdGNoUmVhc29uID0gdGhpcy5tYXRjaFJlYXNvbnMuZ2V0KGl0ZW0ucGF0aCk7XG4gICAgICBcbiAgICAgIC8vIFNwZWNpYWwgY2FzZTogbm90ZXMgd2l0aG91dCBwcm9wZXJ0eSB0aGF0IG1hdGNoZWQgdmlhIGFsaWFzIHNob3VsZCBzaG93IGFsaWFzIHdpdGggaWNvblxuICAgICAgaWYgKCFpc0N1c3RvbURpc3BsYXkgJiYgbWF0Y2hSZWFzb24/Lm1hdGNoZWRJbkFsaWFzICYmIG1hdGNoUmVhc29uLm1hdGNoZWRBbGlhc1RleHQpIHtcbiAgICAgICAgLy8gU2hvdyBhbGlhcyBhcyBtYWluIHRleHQsIGZpbGVuYW1lIGJlbG93LCB3aXRoIGFsaWFzIGljb24gKGxpa2UgZGVmYXVsdCBPYnNpZGlhbilcbiAgICAgICAgZWwuYWRkQ2xhc3MoJ21vZC1jb21wbGV4Jyk7XG4gICAgICAgIGNvbnN0IHN1Z2dlc3Rpb25Db250ZW50ID0gZWwuY3JlYXRlRGl2KHsgY2xzOiAnc3VnZ2VzdGlvbi1jb250ZW50JyB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIE1haW4gdGl0bGUgLSBzaG93IHRoZSBhbGlhcyB0aGF0IG1hdGNoZWRcbiAgICAgICAgY29uc3QgdGl0bGVFbCA9IHN1Z2dlc3Rpb25Db250ZW50LmNyZWF0ZURpdih7IGNsczogJ3N1Z2dlc3Rpb24tdGl0bGUnIH0pO1xuICAgICAgICB0aXRsZUVsLnNldFRleHQobWF0Y2hSZWFzb24ubWF0Y2hlZEFsaWFzVGV4dCk7XG4gICAgICAgIFxuICAgICAgICAvLyBGaWxlIHBhdGggYmVsb3dcbiAgICAgICAgY29uc3QgcGF0aEVsID0gc3VnZ2VzdGlvbkNvbnRlbnQuY3JlYXRlRGl2KHsgY2xzOiAnc3VnZ2VzdGlvbi1ub3RlJyB9KTtcbiAgICAgICAgcGF0aEVsLnNldFRleHQoaXRlbS5wYXRoLnJlcGxhY2UoJy5tZCcsICcnKSk7XG4gICAgICAgIFxuICAgICAgICAvLyBBZGQgc3VnZ2VzdGlvbi1hdXggd2l0aCBhbGlhcyBpY29uXG4gICAgICAgIGNvbnN0IHN1Z2dlc3Rpb25BdXggPSBlbC5jcmVhdGVEaXYoeyBjbHM6ICdzdWdnZXN0aW9uLWF1eCcgfSk7XG4gICAgICAgIGNvbnN0IHN1Z2dlc3Rpb25GbGFpciA9IHN1Z2dlc3Rpb25BdXguY3JlYXRlU3Bhbih7IFxuICAgICAgICAgIGNsczogJ3N1Z2dlc3Rpb24tZmxhaXInLCBcbiAgICAgICAgICBhdHRyOiB7ICdhcmlhLWxhYmVsJzogJ0FsaWFzIE1hdGNoJyB9IFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5jcmVhdGVGb3J3YXJkSWNvbihzdWdnZXN0aW9uRmxhaXIpO1xuICAgICAgfSBlbHNlIGlmIChpc0N1c3RvbURpc3BsYXkpIHtcbiAgICAgICAgLy8gTm90ZXMgd2l0aCB0aGUgcHJvcGVydHkgLSBrZWVwIGV4aXN0aW5nIGJlaGF2aW9yXG4gICAgICAgIGNvbnN0IHNob3VsZFNob3dJY29uID0gbWF0Y2hSZWFzb24gJiYgKG1hdGNoUmVhc29uLm1hdGNoZWRJblRpdGxlIHx8IG1hdGNoUmVhc29uLm1hdGNoZWRJbkZpbGVuYW1lIHx8IG1hdGNoUmVhc29uLm1hdGNoZWRJbkFsaWFzKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChzaG91bGRTaG93SWNvbikge1xuICAgICAgICAgIC8vIEFkZCBtb2QtY29tcGxleCBjbGFzcyB0byBtYXRjaCBPYnNpZGlhbidzIHN0cnVjdHVyZVxuICAgICAgICAgIGVsLmFkZENsYXNzKCdtb2QtY29tcGxleCcpO1xuXG4gICAgICAgICAgLy8gQ3JlYXRlIHRoZSBtYWluIHN1Z2dlc3Rpb24gY29udGFpbmVyXG4gICAgICAgICAgY29uc3Qgc3VnZ2VzdGlvbkNvbnRlbnQgPSBlbC5jcmVhdGVEaXYoeyBjbHM6ICdzdWdnZXN0aW9uLWNvbnRlbnQnIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIE1haW4gdGl0bGVcbiAgICAgICAgICBjb25zdCB0aXRsZUVsID0gc3VnZ2VzdGlvbkNvbnRlbnQuY3JlYXRlRGl2KHsgY2xzOiAnc3VnZ2VzdGlvbi10aXRsZScgfSk7XG4gICAgICAgICAgdGl0bGVFbC5zZXRUZXh0KHRleHQpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEZpbGUgcGF0aCBiZWxvd1xuICAgICAgICAgIGNvbnN0IHBhdGhFbCA9IHN1Z2dlc3Rpb25Db250ZW50LmNyZWF0ZURpdih7IGNsczogJ3N1Z2dlc3Rpb24tbm90ZScgfSk7XG4gICAgICAgICAgcGF0aEVsLnNldFRleHQoaXRlbS5wYXRoLnJlcGxhY2UoJy5tZCcsICcnKSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQWRkIHN1Z2dlc3Rpb24tYXV4IHdpdGggYXBwcm9wcmlhdGUgaWNvbiBiYXNlZCBvbiBtYXRjaCByZWFzb25cbiAgICAgICAgICBjb25zdCBzdWdnZXN0aW9uQXV4ID0gZWwuY3JlYXRlRGl2KHsgY2xzOiAnc3VnZ2VzdGlvbi1hdXgnIH0pO1xuICAgICAgICAgIGNvbnN0IHN1Z2dlc3Rpb25GbGFpciA9IHN1Z2dlc3Rpb25BdXguY3JlYXRlU3Bhbih7IFxuICAgICAgICAgICAgY2xzOiAnc3VnZ2VzdGlvbi1mbGFpcicsIFxuICAgICAgICAgICAgYXR0cjogeyAnYXJpYS1sYWJlbCc6IHRoaXMuZ2V0SWNvbkxhYmVsKG1hdGNoUmVhc29uKSB9IFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIERldGVybWluZSBpY29uIGJhc2VkIG9uIHByaW9yaXR5OiB0aXRsZSA+IGZpbGUgbmFtZSA+IGFsaWFzXG4gICAgICAgICAgaWYgKG1hdGNoUmVhc29uLm1hdGNoZWRJblRpdGxlKSB7XG4gICAgICAgICAgICAvLyBUeXBlIGljb24gZm9yIHRpdGxlL3Byb3BlcnR5IG1hdGNoZXNcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlVHlwZUljb24oc3VnZ2VzdGlvbkZsYWlyKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoUmVhc29uLm1hdGNoZWRJbkZpbGVuYW1lKSB7XG4gICAgICAgICAgICAvLyBGaWxlIGljb24gZm9yIGZpbGUgbmFtZSBtYXRjaGVzXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUZpbGVJY29uKHN1Z2dlc3Rpb25GbGFpcik7XG4gICAgICAgICAgfSBlbHNlIGlmIChtYXRjaFJlYXNvbi5tYXRjaGVkSW5BbGlhcykge1xuICAgICAgICAgICAgLy8gQXJyb3cgaWNvbiBmb3IgYWxpYXMgbWF0Y2hlc1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVGb3J3YXJkSWNvbihzdWdnZXN0aW9uRmxhaXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBOb3RlIGhhcyBwcm9wZXJ0eSBidXQgbm8gbWF0Y2ggcmVhc29uIChlLmcuLCByZWNlbnQgZmlsZXMpXG4gICAgICAgICAgLy8gU2hvdyBjb21wbGV4IGxheW91dCB3aXRoIGljb24gaWYgdXNpbmcgcHJvcGVydHktYmFzZWQgdGl0bGVcbiAgICAgICAgICBlbC5hZGRDbGFzcygnbW9kLWNvbXBsZXgnKTtcbiAgICAgICAgICBjb25zdCBzdWdnZXN0aW9uQ29udGVudCA9IGVsLmNyZWF0ZURpdih7IGNsczogJ3N1Z2dlc3Rpb24tY29udGVudCcgfSk7XG4gICAgICAgICAgY29uc3QgdGl0bGVFbCA9IHN1Z2dlc3Rpb25Db250ZW50LmNyZWF0ZURpdih7IGNsczogJ3N1Z2dlc3Rpb24tdGl0bGUnIH0pO1xuICAgICAgICAgIHRpdGxlRWwuc2V0VGV4dCh0ZXh0KTtcbiAgICAgICAgICBjb25zdCBwYXRoRWwgPSBzdWdnZXN0aW9uQ29udGVudC5jcmVhdGVEaXYoeyBjbHM6ICdzdWdnZXN0aW9uLW5vdGUnIH0pO1xuICAgICAgICAgIHBhdGhFbC5zZXRUZXh0KGl0ZW0ucGF0aC5yZXBsYWNlKCcubWQnLCAnJykpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIFNob3cgXCJUXCIgaWNvbiBmb3IgcHJvcGVydHktYmFzZWQgdGl0bGVzXG4gICAgICAgICAgY29uc3Qgc3VnZ2VzdGlvbkF1eCA9IGVsLmNyZWF0ZURpdih7IGNsczogJ3N1Z2dlc3Rpb24tYXV4JyB9KTtcbiAgICAgICAgICBjb25zdCBzdWdnZXN0aW9uRmxhaXIgPSBzdWdnZXN0aW9uQXV4LmNyZWF0ZVNwYW4oeyBcbiAgICAgICAgICAgIGNsczogJ3N1Z2dlc3Rpb24tZmxhaXInLCBcbiAgICAgICAgICAgIGF0dHI6IHsgJ2FyaWEtbGFiZWwnOiAnUHJvcGVydHktYmFzZWQgdGl0bGUnIH0gXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhpcy5jcmVhdGVUeXBlSWNvbihzdWdnZXN0aW9uRmxhaXIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGb3Igbm90ZXMgd2l0aG91dCB0aGUgcHJvcGVydHkgKGFuZCBub3QgbWF0Y2hlZCB2aWEgYWxpYXMpLCBzaG93IHNpbXBsZSBkaXNwbGF5IChubyBpY29uLCBubyBkdXBsaWNhdGUgbmFtZSlcbiAgICAgICAgZWwuc2V0VGV4dCh0ZXh0KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldEljb25MYWJlbChtYXRjaFJlYXNvbjogU2VhcmNoTWF0Y2hSZWFzb24pOiBzdHJpbmcge1xuICAgIGlmIChtYXRjaFJlYXNvbi5tYXRjaGVkSW5UaXRsZSkge1xuICAgICAgcmV0dXJuICdUaXRsZS9Qcm9wZXJ0eSBNYXRjaCc7XG4gICAgfSBlbHNlIGlmIChtYXRjaFJlYXNvbi5tYXRjaGVkSW5GaWxlbmFtZSkge1xuICAgICAgcmV0dXJuICdGaWxlIE5hbWUgTWF0Y2gnO1xuICAgIH0gZWxzZSBpZiAobWF0Y2hSZWFzb24ubWF0Y2hlZEluQWxpYXMpIHtcbiAgICAgIHJldHVybiAnQWxpYXMgTWF0Y2gnO1xuICAgIH1cbiAgICByZXR1cm4gJ01hdGNoJztcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlVHlwZUljb24oY29udGFpbmVyOiBIVE1MRWxlbWVudCk6IHZvaWQge1xuICAgIGNvbnN0IHN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnc3ZnJyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCAnMjQnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCAnMjQnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCd2aWV3Qm94JywgJzAgMCAyNCAyNCcpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAnbm9uZScpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsICdjdXJyZW50Q29sb3InKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCAnMicpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1saW5lY2FwJywgJ3JvdW5kJyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLWxpbmVqb2luJywgJ3JvdW5kJyk7XG4gICAgc3ZnLmNsYXNzTGlzdC5hZGQoJ3N2Zy1pY29uJywgJ2x1Y2lkZS10eXBlJyk7XG4gICAgXG4gICAgY29uc3QgcG9seWxpbmUxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdwb2x5bGluZScpO1xuICAgIHBvbHlsaW5lMS5zZXRBdHRyaWJ1dGUoJ3BvaW50cycsICc0IDcgNCA0IDIwIDQgMjAgNycpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChwb2x5bGluZTEpO1xuICAgIFxuICAgIGNvbnN0IGxpbmUxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdsaW5lJyk7XG4gICAgbGluZTEuc2V0QXR0cmlidXRlKCd4MScsICc5Jyk7XG4gICAgbGluZTEuc2V0QXR0cmlidXRlKCd5MScsICcyMCcpO1xuICAgIGxpbmUxLnNldEF0dHJpYnV0ZSgneDInLCAnMTUnKTtcbiAgICBsaW5lMS5zZXRBdHRyaWJ1dGUoJ3kyJywgJzIwJyk7XG4gICAgc3ZnLmFwcGVuZENoaWxkKGxpbmUxKTtcbiAgICBcbiAgICBjb25zdCBsaW5lMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnbGluZScpO1xuICAgIGxpbmUyLnNldEF0dHJpYnV0ZSgneDEnLCAnMTInKTtcbiAgICBsaW5lMi5zZXRBdHRyaWJ1dGUoJ3kxJywgJzQnKTtcbiAgICBsaW5lMi5zZXRBdHRyaWJ1dGUoJ3gyJywgJzEyJyk7XG4gICAgbGluZTIuc2V0QXR0cmlidXRlKCd5MicsICcyMCcpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChsaW5lMik7XG4gICAgXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHN2Zyk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUZpbGVJY29uKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICBjb25zdCBzdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3N2ZycpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgJzI0Jyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgJzI0Jyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgndmlld0JveCcsICcwIDAgMjQgMjQnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdmaWxsJywgJ25vbmUnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnY3VycmVudENvbG9yJyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgJzInKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdzdHJva2UtbGluZWNhcCcsICdyb3VuZCcpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1saW5lam9pbicsICdyb3VuZCcpO1xuICAgIHN2Zy5jbGFzc0xpc3QuYWRkKCdzdmctaWNvbicsICdsdWNpZGUtZmlsZS10ZXh0Jyk7XG4gICAgXG4gICAgY29uc3QgcGF0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAncGF0aCcpO1xuICAgIHBhdGguc2V0QXR0cmlidXRlKCdkJywgJ00xNC41IDJINmEyIDIgMCAwIDAtMiAydjE2YTIgMiAwIDAgMCAyIDJoMTJhMiAyIDAgMCAwIDItMlY3LjVMMTQuNSAyeicpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChwYXRoKTtcbiAgICBcbiAgICBjb25zdCBwb2x5bGluZTEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3BvbHlsaW5lJyk7XG4gICAgcG9seWxpbmUxLnNldEF0dHJpYnV0ZSgncG9pbnRzJywgJzE0LDIgMTQsOCAyMCw4Jyk7XG4gICAgc3ZnLmFwcGVuZENoaWxkKHBvbHlsaW5lMSk7XG4gICAgXG4gICAgY29uc3QgbGluZTEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ2xpbmUnKTtcbiAgICBsaW5lMS5zZXRBdHRyaWJ1dGUoJ3gxJywgJzE2Jyk7XG4gICAgbGluZTEuc2V0QXR0cmlidXRlKCd5MScsICcxMycpO1xuICAgIGxpbmUxLnNldEF0dHJpYnV0ZSgneDInLCAnOCcpO1xuICAgIGxpbmUxLnNldEF0dHJpYnV0ZSgneTInLCAnMTMnKTtcbiAgICBzdmcuYXBwZW5kQ2hpbGQobGluZTEpO1xuICAgIFxuICAgIGNvbnN0IGxpbmUyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdsaW5lJyk7XG4gICAgbGluZTIuc2V0QXR0cmlidXRlKCd4MScsICcxNicpO1xuICAgIGxpbmUyLnNldEF0dHJpYnV0ZSgneTEnLCAnMTcnKTtcbiAgICBsaW5lMi5zZXRBdHRyaWJ1dGUoJ3gyJywgJzgnKTtcbiAgICBsaW5lMi5zZXRBdHRyaWJ1dGUoJ3kyJywgJzE3Jyk7XG4gICAgc3ZnLmFwcGVuZENoaWxkKGxpbmUyKTtcbiAgICBcbiAgICBjb25zdCBwb2x5bGluZTIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3BvbHlsaW5lJyk7XG4gICAgcG9seWxpbmUyLnNldEF0dHJpYnV0ZSgncG9pbnRzJywgJzEwLDkgOSw5IDgsOScpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChwb2x5bGluZTIpO1xuICAgIFxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzdmcpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVGb3J3YXJkSWNvbihjb250YWluZXI6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgY29uc3Qgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCd3aWR0aCcsICcyNCcpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsICcyNCcpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3ZpZXdCb3gnLCAnMCAwIDI0IDI0Jyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnZmlsbCcsICdub25lJyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJ2N1cnJlbnRDb2xvcicpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS13aWR0aCcsICcyJyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLWxpbmVjYXAnLCAncm91bmQnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdzdHJva2UtbGluZWpvaW4nLCAncm91bmQnKTtcbiAgICBzdmcuY2xhc3NMaXN0LmFkZCgnc3ZnLWljb24nLCAnbHVjaWRlLWZvcndhcmQnKTtcbiAgICBcbiAgICBjb25zdCBwb2x5bGluZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAncG9seWxpbmUnKTtcbiAgICBwb2x5bGluZS5zZXRBdHRyaWJ1dGUoJ3BvaW50cycsICcxNSAxNyAyMCAxMiAxNSA3Jyk7XG4gICAgc3ZnLmFwcGVuZENoaWxkKHBvbHlsaW5lKTtcbiAgICBcbiAgICBjb25zdCBwYXRoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdwYXRoJyk7XG4gICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ2QnLCAnTTQgMTh2LTJhNCA0IDAgMCAxIDQtNGgxMicpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChwYXRoKTtcbiAgICBcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3ZnKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRmlsZVBsdXNJY29uKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICBjb25zdCBzdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3N2ZycpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgJzI0Jyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgJzI0Jyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgndmlld0JveCcsICcwIDAgMjQgMjQnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdmaWxsJywgJ25vbmUnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnY3VycmVudENvbG9yJyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgJzInKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdzdHJva2UtbGluZWNhcCcsICdyb3VuZCcpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1saW5lam9pbicsICdyb3VuZCcpO1xuICAgIHN2Zy5jbGFzc0xpc3QuYWRkKCdzdmctaWNvbicsICdsdWNpZGUtZmlsZS1wbHVzJyk7XG4gICAgXG4gICAgY29uc3QgcGF0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAncGF0aCcpO1xuICAgIHBhdGguc2V0QXR0cmlidXRlKCdkJywgJ00xNC41IDJINmEyIDIgMCAwIDAtMiAydjE2YTIgMiAwIDAgMCAyIDJoMTJhMiAyIDAgMCAwIDItMlY3LjVMMTQuNSAyeicpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChwYXRoKTtcbiAgICBcbiAgICBjb25zdCBwb2x5bGluZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAncG9seWxpbmUnKTtcbiAgICBwb2x5bGluZS5zZXRBdHRyaWJ1dGUoJ3BvaW50cycsICcxNCwyIDE0LDggMjAsOCcpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChwb2x5bGluZSk7XG4gICAgXG4gICAgY29uc3QgbGluZTEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ2xpbmUnKTtcbiAgICBsaW5lMS5zZXRBdHRyaWJ1dGUoJ3gxJywgJzEyJyk7XG4gICAgbGluZTEuc2V0QXR0cmlidXRlKCd5MScsICcxOCcpO1xuICAgIGxpbmUxLnNldEF0dHJpYnV0ZSgneDInLCAnMTInKTtcbiAgICBsaW5lMS5zZXRBdHRyaWJ1dGUoJ3kyJywgJzEyJyk7XG4gICAgc3ZnLmFwcGVuZENoaWxkKGxpbmUxKTtcbiAgICBcbiAgICBjb25zdCBsaW5lMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnbGluZScpO1xuICAgIGxpbmUyLnNldEF0dHJpYnV0ZSgneDEnLCAnOScpO1xuICAgIGxpbmUyLnNldEF0dHJpYnV0ZSgneTEnLCAnMTUnKTtcbiAgICBsaW5lMi5zZXRBdHRyaWJ1dGUoJ3gyJywgJzE1Jyk7XG4gICAgbGluZTIuc2V0QXR0cmlidXRlKCd5MicsICcxNScpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChsaW5lMik7XG4gICAgXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHN2Zyk7XG4gIH1cblxuICBwcml2YXRlIGlzVXNpbmdDdXN0b21Qcm9wZXJ0eShmaWxlOiBURmlsZSk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGNhY2hlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7XG4gICAgY29uc3QgZnJvbnRtYXR0ZXIgPSBjYWNoZT8uZnJvbnRtYXR0ZXI7XG4gICAgY29uc3QgcHJvcGVydHlWYWx1ZSA9IGZyb250bWF0dGVyPy5bdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvcGVydHlLZXldIGFzIHVua25vd247XG4gICAgaWYgKHByb3BlcnR5VmFsdWUgPT09IHVuZGVmaW5lZCB8fCBwcm9wZXJ0eVZhbHVlID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IHN0clZhbHVlID0gdHlwZW9mIHByb3BlcnR5VmFsdWUgPT09ICdzdHJpbmcnID8gcHJvcGVydHlWYWx1ZSA6ICh0eXBlb2YgcHJvcGVydHlWYWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHByb3BlcnR5VmFsdWUgPT09ICdib29sZWFuJyA/IFN0cmluZyhwcm9wZXJ0eVZhbHVlKSA6ICcnKTtcbiAgICByZXR1cm4gc3RyVmFsdWUudHJpbSgpICE9PSAnJztcbiAgfVxuXG4gIHByaXZhdGUgaXNVc2luZ0FsaWFzKGZpbGU6IFRGaWxlKTogYm9vbGVhbiB7XG4gICAgLy8gQ2hlY2sgaWYgdGhpcyBmaWxlIGhhcyBhbGlhc2VzIGFuZCBpZiB3ZSdyZSBjdXJyZW50bHkgc2VhcmNoaW5nXG4gICAgY29uc3QgY2FjaGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcbiAgICBjb25zdCBmcm9udG1hdHRlciA9IGNhY2hlPy5mcm9udG1hdHRlcjtcbiAgICBjb25zdCBhbGlhc2VzID0gZnJvbnRtYXR0ZXI/LmFsaWFzZXMgYXMgdW5rbm93bjtcbiAgICBcbiAgICBpZiAoIWFsaWFzZXMpIHJldHVybiBmYWxzZTtcbiAgICBcbiAgICAvLyBGb3Igbm93LCBzaG93IGFsaWFzIGljb24gaWYgdGhlIGZpbGUgaGFzIGFsaWFzZXMgYW5kIHdlJ3JlIG5vdCB1c2luZyBhIGN1c3RvbSBwcm9wZXJ0eVxuICAgIGNvbnN0IGlzVXNpbmdDdXN0b21Qcm9wZXJ0eSA9IHRoaXMuaXNVc2luZ0N1c3RvbVByb3BlcnR5KGZpbGUpO1xuICAgIHJldHVybiAhaXNVc2luZ0N1c3RvbVByb3BlcnR5ICYmIEJvb2xlYW4oYWxpYXNlcyk7XG4gIH1cblxuICBvbkNob29zZUl0ZW0oaXRlbTogUXVpY2tTd2l0Y2hJdGVtWydpdGVtJ10sIGV2dDogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICAvLyBIYW5kbGUgdW5yZXNvbHZlZCBsaW5rcyAtIGNyZWF0ZSB0aGUgZmlsZSB1c2luZyBvcGVuTGlua1RleHQgdG8gcmVzcGVjdCBuZXcgbm90ZSBsb2NhdGlvbiBzZXR0aW5nc1xuICAgIGlmICgnaXNVbnJlc29sdmVkJyBpbiBpdGVtICYmIGl0ZW0uaXNVbnJlc29sdmVkKSB7XG4gICAgICBjb25zdCB1bnJlc29sdmVkVGV4dCA9IGl0ZW0udW5yZXNvbHZlZFRleHQ7XG4gICAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICAgIGNvbnN0IHNvdXJjZVBhdGggPSBhY3RpdmVWaWV3Py5maWxlPy5wYXRoIHx8ICcnO1xuICAgICAgXG4gICAgICAvLyBVc2Ugb3BlbkxpbmtUZXh0IHdoaWNoIHJlc3BlY3RzIE9ic2lkaWFuJ3MgZGVmYXVsdCBuZXcgbm90ZSBsb2NhdGlvbiBzZXR0aW5nc1xuICAgICAgdm9pZCB0aGlzLmFwcC53b3Jrc3BhY2Uub3BlbkxpbmtUZXh0KHVucmVzb2x2ZWRUZXh0LCBzb3VyY2VQYXRoKS5jYXRjaCgoZXJyOiB1bmtub3duKSA9PiB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyci5tZXNzYWdlIDogU3RyaW5nKGVycik7XG4gICAgICAgIG5ldyBOb3RpY2UoYEVycm9yIGNyZWF0aW5nIG5vdGU6ICR7bWVzc2FnZX1gKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICBpZiAoJ2lzTmV3Tm90ZScgaW4gaXRlbSkge1xuICAgICAgY29uc3QgYWN0aXZlVmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG4gICAgICBjb25zdCBzb3VyY2VQYXRoID0gYWN0aXZlVmlldz8uZmlsZT8ucGF0aCB8fCAnJztcbiAgICAgIFxuICAgICAgLy8gVXNlIG9wZW5MaW5rVGV4dCB3aGljaCByZXNwZWN0cyBPYnNpZGlhbidzIGRlZmF1bHQgbmV3IG5vdGUgbG9jYXRpb24gc2V0dGluZ3NcbiAgICAgIHZvaWQgdGhpcy5hcHAud29ya3NwYWNlLm9wZW5MaW5rVGV4dChpdGVtLm5ld05hbWUsIHNvdXJjZVBhdGgpLmNhdGNoKChlcnI6IHVua25vd24pID0+IHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiBTdHJpbmcoZXJyKTtcbiAgICAgICAgbmV3IE5vdGljZShgRXJyb3IgY3JlYXRpbmcgbm90ZTogJHttZXNzYWdlfWApO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChpdGVtIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgIC8vIEhhbmRsZSBkaWZmZXJlbnQgbW9kaWZpZXIga2V5cyBsaWtlIGRlZmF1bHQgT2JzaWRpYW5cbiAgICAgIGlmIChldnQgaW5zdGFuY2VvZiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGlmIChldnQuY3RybEtleSAmJiBldnQuYWx0S2V5KSB7XG4gICAgICAgICAgLy8gT3BlbiB0byB0aGUgcmlnaHRcbiAgICAgICAgICBjb25zdCBsZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYodHJ1ZSk7XG4gICAgICAgICAgdm9pZCBsZWFmLm9wZW5GaWxlKGl0ZW0pO1xuICAgICAgICB9IGVsc2UgaWYgKGV2dC5jdHJsS2V5KSB7XG4gICAgICAgICAgLy8gT3BlbiBpbiBuZXcgdGFiXG4gICAgICAgICAgdm9pZCB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZigpLm9wZW5GaWxlKGl0ZW0pO1xuICAgICAgICB9IGVsc2UgaWYgKGV2dC5zaGlmdEtleSkge1xuICAgICAgICAgIC8vIENyZWF0ZSBuZXcgbm90ZSAodGhpcyBzaG91bGRuJ3QgaGFwcGVuIGZvciBleGlzdGluZyBmaWxlcywgYnV0IGtlZXBpbmcgZm9yIGNvbnNpc3RlbmN5KVxuICAgICAgICAgIHZvaWQgdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoKS5vcGVuRmlsZShpdGVtKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBEZWZhdWx0OiBvcGVuIGluIGN1cnJlbnQgdGFiXG4gICAgICAgICAgdm9pZCB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZigpLm9wZW5GaWxlKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBNb3VzZSBjbGljazogZGVmYXVsdCBiZWhhdmlvclxuICAgICAgICB2b2lkIHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKCkub3BlbkZpbGUoaXRlbSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbiIsICJpbXBvcnQgeyBQbHVnaW4sIFRGaWxlLCBBcHAsIFBsdWdpbk1hbmlmZXN0IH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgUGx1Z2luU2V0dGluZ3MsIFdvcmtzcGFjZUludGVybmFsLCBFZGl0b3JTdWdnZXN0IH0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyBERUZBVUxUX1NFVFRJTkdTIH0gZnJvbSAnLi9zZXR0aW5ncyc7XG5pbXBvcnQgeyBMaW5rVGl0bGVTdWdnZXN0IH0gZnJvbSAnLi91aS9MaW5rVGl0bGVTdWdnZXN0JztcbmltcG9ydCB7IFNldHRpbmdUYWIgfSBmcm9tICcuL3VpL1NldHRpbmdUYWInO1xuaW1wb3J0IHsgcmVnaXN0ZXJDb21tYW5kcyB9IGZyb20gJy4vY29tbWFuZHMnO1xuaW1wb3J0IHsgUXVpY2tTd2l0Y2hlclNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL1F1aWNrU3dpdGNoZXJTZXJ2aWNlJztcbmltcG9ydCB7IERyYWdEcm9wU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvRHJhZ0Ryb3BTZXJ2aWNlJztcbmltcG9ydCB7IENhY2hlU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvQ2FjaGVTZXJ2aWNlJztcbmltcG9ydCB7IEdyYXBoVmlld1NlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL0dyYXBoVmlld1NlcnZpY2UnO1xuaW1wb3J0IHsgQmFja2xpbmtTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9CYWNrbGlua1NlcnZpY2UnO1xuaW1wb3J0IHsgVGFiU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvVGFiU2VydmljZSc7XG5pbXBvcnQgeyBFeHBsb3JlclNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL0V4cGxvcmVyU2VydmljZSc7XG5pbXBvcnQgeyBXaW5kb3dGcmFtZVNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL1dpbmRvd0ZyYW1lU2VydmljZSc7XG5pbXBvcnQgeyBCb29rbWFya1NlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL0Jvb2ttYXJrU2VydmljZSc7XG5pbXBvcnQgeyBmcm9udG1hdHRlckNhY2hlIH0gZnJvbSAnLi91dGlscy9mcm9udG1hdHRlci1jYWNoZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcbiAgc2V0dGluZ3MhOiBQbHVnaW5TZXR0aW5ncztcbiAgc3VnZ2VzdD86IExpbmtUaXRsZVN1Z2dlc3Q7XG4gIHByaXZhdGUgcXVpY2tTd2l0Y2hlclNlcnZpY2UhOiBRdWlja1N3aXRjaGVyU2VydmljZTtcbiAgcHJpdmF0ZSBkcmFnRHJvcFNlcnZpY2UhOiBEcmFnRHJvcFNlcnZpY2U7XG4gIHByaXZhdGUgY2FjaGVTZXJ2aWNlITogQ2FjaGVTZXJ2aWNlO1xuICBwcml2YXRlIGdyYXBoVmlld1NlcnZpY2UhOiBHcmFwaFZpZXdTZXJ2aWNlO1xuICBwcml2YXRlIGJhY2tsaW5rU2VydmljZSE6IEJhY2tsaW5rU2VydmljZTtcbiAgcHJpdmF0ZSB0YWJTZXJ2aWNlITogVGFiU2VydmljZTtcbiAgcHJpdmF0ZSBleHBsb3JlclNlcnZpY2UhOiBFeHBsb3JlclNlcnZpY2U7XG4gIHByaXZhdGUgd2luZG93RnJhbWVTZXJ2aWNlITogV2luZG93RnJhbWVTZXJ2aWNlO1xuICBwcml2YXRlIGJvb2ttYXJrU2VydmljZSE6IEJvb2ttYXJrU2VydmljZTtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgbWFuaWZlc3Q6IFBsdWdpbk1hbmlmZXN0KSB7XG4gICAgc3VwZXIoYXBwLCBtYW5pZmVzdCk7XG5cbiAgICAvLyBSZWdpc3RlciBNRFggZXh0ZW5zaW9uIGFzIGVhcmx5IGFzIHBvc3NpYmxlXG4gICAgdHJ5IHtcbiAgICAgIHRoaXMucmVnaXN0ZXJFeHRlbnNpb25zKFsnbWR4J10sICdtYXJrZG93bicpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBNRFggZXh0ZW5zaW9uIGFscmVhZHkgcmVnaXN0ZXJlZCBieSBhbm90aGVyIHBsdWdpbiBpcyBub3JtYWxcbiAgICAgIGNvbnN0IGVycm9yTXNnID0gKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlO1xuICAgICAgaWYgKCFlcnJvck1zZy5pbmNsdWRlcygnZXhpc3RpbmcgZmlsZSBleHRlbnNpb24nKSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbUE9WXSBVbmV4cGVjdGVkIE1EWCByZWdpc3RyYXRpb24gZXJyb3IgaW4gY29uc3RydWN0b3I6JywgZXJyb3JNc2cpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9ubG9hZCgpIHtcbiAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuXG4gICAgLy8gcmVnaXN0ZXIgdGhlIHZpZXcgYW5kIGV4dGVuc2lvbnNcbiAgICBpZiAodGhpcy5zZXR0aW5ncy5lbmFibGVNZHhTdXBwb3J0KSB7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyRXh0ZW5zaW9ucyhbJ21keCddLCAnbWFya2Rvd24nKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnN0IGVycm9yTXNnID0gKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlO1xuICAgICAgICBpZiAoIWVycm9yTXNnLmluY2x1ZGVzKCdleGlzdGluZyBmaWxlIGV4dGVuc2lvbicpKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignVW5leHBlY3RlZCBNRFggcmVnaXN0cmF0aW9uIGVycm9yOicsIGVycm9yTXNnKTtcbiAgICAgICAgICB0aGlzLnNldHRpbmdzLmVuYWJsZU1keFN1cHBvcnQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBGb3JjZSBtZXRhZGF0YSBjYWNoZSByZWZyZXNoIGZvciBNRFggZmlsZXMgdG8gZW5zdXJlIHRoZXkncmUgcmVjb2duaXplZFxuICAgICAgY29uc3QgbWR4RmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlcygpLmZpbHRlcihmID0+IGYuZXh0ZW5zaW9uID09PSAnbWR4Jyk7XG4gICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgbWR4RmlsZXMpIHtcbiAgICAgICAgdGhpcy5hcHAubWV0YWRhdGFDYWNoZS50cmlnZ2VyKCdjaGFuZ2VkJywgZmlsZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSW5pdGlhbGl6ZSBzZXJ2aWNlc1xuICAgIHRoaXMucXVpY2tTd2l0Y2hlclNlcnZpY2UgPSBuZXcgUXVpY2tTd2l0Y2hlclNlcnZpY2UodGhpcyk7XG4gICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UgPSBuZXcgRHJhZ0Ryb3BTZXJ2aWNlKHRoaXMpO1xuICAgIHRoaXMuY2FjaGVTZXJ2aWNlID0gbmV3IENhY2hlU2VydmljZSh0aGlzKTtcbiAgICB0aGlzLmdyYXBoVmlld1NlcnZpY2UgPSBuZXcgR3JhcGhWaWV3U2VydmljZSh0aGlzKTtcbiAgICB0aGlzLmJhY2tsaW5rU2VydmljZSA9IG5ldyBCYWNrbGlua1NlcnZpY2UodGhpcyk7XG4gICAgdGhpcy50YWJTZXJ2aWNlID0gbmV3IFRhYlNlcnZpY2UodGhpcyk7XG4gICAgdGhpcy5leHBsb3JlclNlcnZpY2UgPSBuZXcgRXhwbG9yZXJTZXJ2aWNlKHRoaXMpO1xuICAgIHRoaXMud2luZG93RnJhbWVTZXJ2aWNlID0gbmV3IFdpbmRvd0ZyYW1lU2VydmljZSh0aGlzKTtcbiAgICB0aGlzLmJvb2ttYXJrU2VydmljZSA9IG5ldyBCb29rbWFya1NlcnZpY2UodGhpcyk7XG5cbiAgICAvLyBSZWdpc3RlciB0YWIgc2VydmljZSBldmVudHMgYW5kIHJlbmFtZSB0YWJzIGltbWVkaWF0ZWx5XG4gICAgdGhpcy50YWJTZXJ2aWNlLnJlZ2lzdGVyRXZlbnRzKCk7XG5cbiAgICAvLyBSZWdpc3RlciBleHBsb3JlciBhbmQgd2luZG93IGZyYW1lIHNlcnZpY2VzXG4gICAgdGhpcy5leHBsb3JlclNlcnZpY2UucmVnaXN0ZXJFdmVudHMoKTtcbiAgICB0aGlzLndpbmRvd0ZyYW1lU2VydmljZS5yZWdpc3RlckV2ZW50cygpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBib29rbWFya3Mgc2VydmljZVxuICAgIHRoaXMuYm9va21hcmtTZXJ2aWNlLnVwZGF0ZUJvb2ttYXJrcygpO1xuXG4gICAgLy8gUHJlLXBvcHVsYXRlIGZyb250bWF0dGVyIGNhY2hlIGZvciBNRFggZmlsZXMgaWYgZW5hYmxlZFxuICAgIGlmICh0aGlzLnNldHRpbmdzLmVuYWJsZU1keFN1cHBvcnQpIHtcbiAgICAgICgoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1keEZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0RmlsZXMoKS5maWx0ZXIoXG4gICAgICAgICAgKGYpOiBmIGlzIFRGaWxlID0+IGYgaW5zdGFuY2VvZiBURmlsZSAmJiBmLmV4dGVuc2lvbiA9PT0gJ21keCdcbiAgICAgICAgKTtcbiAgICAgICAgLy8gUHJlLXBvcHVsYXRlIGNhY2hlIGluIGJhY2tncm91bmRcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIG1keEZpbGVzKSB7XG4gICAgICAgICAgdm9pZCBmcm9udG1hdHRlckNhY2hlLmdldCh0aGlzLmFwcCwgZmlsZSwgdGhpcy5zZXR0aW5ncyk7XG4gICAgICAgIH1cbiAgICAgIH0pKCk7XG4gICAgfVxuXG4gICAgLy8gV2FpdCBhIGJpdCBmb3IgbWV0YWRhdGEgY2FjaGUgdG8gYmUgZnVsbHkgcG9wdWxhdGVkXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLnVwZGF0ZUxpbmtTdWdnZXN0ZXIoKTtcbiAgICAgIHRoaXMudXBkYXRlUXVpY2tTd2l0Y2hlcigpO1xuICAgICAgdGhpcy51cGRhdGVHcmFwaFZpZXcoKTtcbiAgICAgIHRoaXMudXBkYXRlQmFja2xpbmtzKCk7XG4gICAgICB0aGlzLnVwZGF0ZVRhYnMoKTtcbiAgICAgIHRoaXMudXBkYXRlRXhwbG9yZXIoKTtcbiAgICAgIHRoaXMudXBkYXRlV2luZG93RnJhbWUoKTtcbiAgICAgIHRoaXMudXBkYXRlQm9va21hcmtzKCk7XG4gICAgfSwgMTAwMCk7XG5cbiAgICAvLyBTZXQgdXAgZ3JhcGggdmlldyBoYW5kbGluZ1xuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbkxheW91dFJlYWR5KCgpID0+IHtcbiAgICAgIHRoaXMuZ3JhcGhWaWV3U2VydmljZS5vbkxheW91dENoYW5nZSgpO1xuICAgICAgdGhpcy5iYWNrbGlua1NlcnZpY2Uub25MYXlvdXRDaGFuZ2UoKTtcbiAgICAgIHZvaWQgdGhpcy50YWJTZXJ2aWNlLnJlbmFtZVRhYnMoKTtcbiAgICAgIHRoaXMudXBkYXRlRXhwbG9yZXIoKTtcbiAgICAgIHRoaXMudXBkYXRlV2luZG93RnJhbWUoKTtcbiAgICAgIHRoaXMudXBkYXRlQm9va21hcmtzKCk7XG4gICAgICAvLyBBbHNvIHJlZnJlc2ggZ3JhcGggdmlldyB0byBlbnN1cmUgaXQncyB1cGRhdGVkXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5ncmFwaFZpZXdTZXJ2aWNlLnJlZnJlc2hHcmFwaFZpZXcoKTtcbiAgICAgIH0sIDUwMCk7XG4gICAgfSk7XG5cbiAgICAvLyBMaXN0ZW4gZm9yIGxheW91dCBjaGFuZ2VzIC0gZXhhY3RseSBsaWtlIE5vZGUgTWFzcXVlcmFkZVxuICAgIHRoaXMucmVnaXN0ZXJFdmVudChcbiAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbignbGF5b3V0LWNoYW5nZScsICgpID0+IHtcbiAgICAgICAgdGhpcy5ncmFwaFZpZXdTZXJ2aWNlLm9uTGF5b3V0Q2hhbmdlKCk7XG4gICAgICAgIHRoaXMuYmFja2xpbmtTZXJ2aWNlLm9uTGF5b3V0Q2hhbmdlKCk7XG4gICAgICB9KVxuICAgICk7XG5cbiAgICAvLyBMYXlvdXQgY2hhbmdlcyBhcmUgbm93IGhhbmRsZWQgcHJpbWFyaWx5IHZpYSBNdXRhdGlvbk9ic2VydmVyIGluIEdyYXBoVmlld1NlcnZpY2VcblxuICAgIC8vIFNldCB1cCBiYWNrbGlua3MgaGFuZGxpbmdcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXG4gICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub24oJ2ZpbGUtb3BlbicsICgpID0+IHtcbiAgICAgICAgdGhpcy5iYWNrbGlua1NlcnZpY2Uub25GaWxlT3BlbigpO1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgLy8gUmVnaXN0ZXIgZmlsZSBjaGFuZ2UgZXZlbnRzIHRvIGludmFsaWRhdGUgY2FjaGVcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXG4gICAgICB0aGlzLmFwcC52YXVsdC5vbignbW9kaWZ5JywgKGZpbGUpID0+IHtcbiAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSAmJiAoZmlsZS5leHRlbnNpb24gPT09ICdtZCcgfHwgKGZpbGUuZXh0ZW5zaW9uID09PSAnbWR4JyAmJiB0aGlzLnNldHRpbmdzLmVuYWJsZU1keFN1cHBvcnQpKSkge1xuICAgICAgICAgIHRoaXMuY2FjaGVTZXJ2aWNlLmludmFsaWRhdGVDYWNoZShmaWxlKTtcbiAgICAgICAgICAvLyBBbHNvIGludmFsaWRhdGUgZnJvbnRtYXR0ZXIgY2FjaGVcbiAgICAgICAgICBmcm9udG1hdHRlckNhY2hlLmludmFsaWRhdGUoZmlsZS5wYXRoKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApO1xuXG4gICAgdGhpcy5yZWdpc3RlckV2ZW50KFxuICAgICAgdGhpcy5hcHAudmF1bHQub24oJ3JlbmFtZScsIChmaWxlLCBvbGRQYXRoKSA9PiB7XG4gICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUgJiYgKGZpbGUuZXh0ZW5zaW9uID09PSAnbWQnIHx8IChmaWxlLmV4dGVuc2lvbiA9PT0gJ21keCcgJiYgdGhpcy5zZXR0aW5ncy5lbmFibGVNZHhTdXBwb3J0KSkpIHtcbiAgICAgICAgICB0aGlzLmNhY2hlU2VydmljZS5pbnZhbGlkYXRlQ2FjaGUoZmlsZSk7XG4gICAgICAgICAgLy8gQWxzbyBpbnZhbGlkYXRlIGZyb250bWF0dGVyIGNhY2hlXG4gICAgICAgICAgZnJvbnRtYXR0ZXJDYWNoZS5pbnZhbGlkYXRlKGZpbGUucGF0aCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcblxuICAgIHRoaXMucmVnaXN0ZXJFdmVudChcbiAgICAgIHRoaXMuYXBwLnZhdWx0Lm9uKCdkZWxldGUnLCAoZmlsZSkgPT4ge1xuICAgICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlICYmIChmaWxlLmV4dGVuc2lvbiA9PT0gJ21kJyB8fCAoZmlsZS5leHRlbnNpb24gPT09ICdtZHgnICYmIHRoaXMuc2V0dGluZ3MuZW5hYmxlTWR4U3VwcG9ydCkpKSB7XG4gICAgICAgICAgdGhpcy5jYWNoZVNlcnZpY2UuaW52YWxpZGF0ZUNhY2hlKGZpbGUpO1xuICAgICAgICAgIC8vIEFsc28gaW52YWxpZGF0ZSBmcm9udG1hdHRlciBjYWNoZVxuICAgICAgICAgIGZyb250bWF0dGVyQ2FjaGUuaW52YWxpZGF0ZShmaWxlLnBhdGgpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG5cbiAgICAvLyBSZWdpc3RlciBtZXRhZGF0YSBjYWNoZSBjaGFuZ2UgZXZlbnRzIHRvIHJlYnVpbGQgY2FjaGVcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXG4gICAgICB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLm9uKCdjaGFuZ2VkJywgKGZpbGUpID0+IHtcbiAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSAmJiAoZmlsZS5leHRlbnNpb24gPT09ICdtZCcgfHwgKGZpbGUuZXh0ZW5zaW9uID09PSAnbWR4JyAmJiB0aGlzLnNldHRpbmdzLmVuYWJsZU1keFN1cHBvcnQpKSkge1xuICAgICAgICAgIHRoaXMuY2FjaGVTZXJ2aWNlLnJlYnVpbGRDYWNoZSgpO1xuICAgICAgICAgIC8vIFJlZnJlc2ggZ3JhcGggdmlldyB3aGVuIG1ldGFkYXRhIGNoYW5nZXMgKHRvIHVwZGF0ZSB2aXNpYmxlIG5vZGVzKVxuICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmVuYWJsZUZvckdyYXBoVmlldykge1xuICAgICAgICAgICAgdGhpcy5ncmFwaFZpZXdTZXJ2aWNlLnJlZnJlc2hHcmFwaFZpZXcoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gUmVmcmVzaCBiYWNrbGlua3Mgd2hlbiBtZXRhZGF0YSBjaGFuZ2VzXG4gICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZW5hYmxlRm9yQmFja2xpbmtzKSB7XG4gICAgICAgICAgICB0aGlzLmJhY2tsaW5rU2VydmljZS51cGRhdGVCYWNrbGlua3MoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gUmVmcmVzaCBleHBsb3JlciB3aGVuIG1ldGFkYXRhIGNoYW5nZXNcbiAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5lbmFibGVGb3JFeHBsb3Jlcikge1xuICAgICAgICAgICAgdGhpcy5leHBsb3JlclNlcnZpY2UudXBkYXRlRXhwbG9yZXIoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gUmVmcmVzaCB3aW5kb3cgZnJhbWUgd2hlbiBtZXRhZGF0YSBjaGFuZ2VzXG4gICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZW5hYmxlRm9yV2luZG93RnJhbWUpIHtcbiAgICAgICAgICAgIHRoaXMud2luZG93RnJhbWVTZXJ2aWNlLnVwZGF0ZVdpbmRvd0ZyYW1lKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIFJlZnJlc2ggYm9va21hcmtzIHdoZW4gbWV0YWRhdGEgY2hhbmdlc1xuICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmVuYWJsZUZvckJvb2ttYXJrcykge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVCb29rbWFya3MoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcblxuICAgIHRoaXMucmVnaXN0ZXJFdmVudChcbiAgICAgIHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUub24oJ3Jlc29sdmVkJywgKCkgPT4ge1xuICAgICAgICAvLyBSZWJ1aWxkIGNhY2hlIHdoZW4gbWV0YWRhdGEgY2FjaGUgaXMgZnVsbHkgcmVzb2x2ZWRcbiAgICAgICAgdGhpcy5jYWNoZVNlcnZpY2UucmVidWlsZENhY2hlKCk7XG4gICAgICB9KVxuICAgICk7XG5cbiAgICAvLyBSZWdpc3RlciBkcmFnIGFuZCBkcm9wIGV2ZW50IGhhbmRsaW5nXG4gICAgdGhpcy5yZWdpc3RlckV2ZW50KFxuICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9uKCdlZGl0b3ItZHJvcCcsIChldmVudCwgZWRpdG9yKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmVuYWJsZUZvckRyYWdEcm9wKSB7XG4gICAgICAgICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuaGFuZGxlRHJhZ0Ryb3AoZXZlbnQsIGVkaXRvcik7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcblxuICAgIC8vIEFsc28gdHJ5IERPTSBldmVudHMgYXMgYmFja3VwXG4gICAgdGhpcy5yZWdpc3RlckRvbUV2ZW50KGRvY3VtZW50LCAnZHJvcCcsIChldmVudCkgPT4ge1xuICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZW5hYmxlRm9yRHJhZ0Ryb3ApIHtcbiAgICAgICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuaGFuZGxlRE9NRHJvcChldmVudCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBOb3RlOiBNb2JpbGUgcXVpY2sgc3dpdGNoZXIgaXMgaGFuZGxlZCBieSB0aGUgUXVpY2tTd2l0Y2hlclNlcnZpY2VcbiAgICAvLyB3aGljaCBvdmVycmlkZXMgdGhlICdzd2l0Y2hlcjpvcGVuJyBjb21tYW5kLiBUaGUgcXVpY2stcHJldmlldyBldmVudFxuICAgIC8vIHdhcyBjYXVzaW5nIGNvbmZsaWN0cyB3aXRoIG5vcm1hbCB0eXBpbmcsIHNvIHdlIHJlbW92ZWQgdGhhdCBhcHByb2FjaC5cblxuICAgIC8vIFJlZ2lzdGVyIGNvbW1hbmRzXG4gICAgcmVnaXN0ZXJDb21tYW5kcyh0aGlzKTtcblxuICAgIC8vIEFkZCBzZXR0aW5nIHRhYlxuICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuICB9XG5cbiAgdXBkYXRlTGlua1N1Z2dlc3RlcigpIHtcbiAgICBjb25zdCBlZGl0b3JTdWdnZXN0ID0gKHRoaXMuYXBwLndvcmtzcGFjZSBhcyBXb3Jrc3BhY2VJbnRlcm5hbCkuZWRpdG9yU3VnZ2VzdDtcbiAgICBpZiAoIWVkaXRvclN1Z2dlc3QpIHJldHVybjtcblxuICAgIGlmICh0aGlzLnN1Z2dlc3QpIHtcbiAgICAgIGVkaXRvclN1Z2dlc3Quc3VnZ2VzdHMgPSBlZGl0b3JTdWdnZXN0LnN1Z2dlc3RzLmZpbHRlcigoczogRWRpdG9yU3VnZ2VzdCkgPT4gcyAhPT0gdGhpcy5zdWdnZXN0KTtcbiAgICAgIHRoaXMuc3VnZ2VzdCA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zZXR0aW5ncy5lbmFibGVGb3JMaW5raW5nKSB7XG4gICAgICB0aGlzLnN1Z2dlc3QgPSBuZXcgTGlua1RpdGxlU3VnZ2VzdCh0aGlzKTtcbiAgICAgIHRoaXMucmVnaXN0ZXJFZGl0b3JTdWdnZXN0KHRoaXMuc3VnZ2VzdCk7XG4gICAgICB0aGlzLmNhY2hlU2VydmljZS5zZXRTdWdnZXN0KHRoaXMuc3VnZ2VzdCk7XG4gICAgICBlZGl0b3JTdWdnZXN0LnN1Z2dlc3RzID0gZWRpdG9yU3VnZ2VzdC5zdWdnZXN0cy5maWx0ZXIoKHM6IEVkaXRvclN1Z2dlc3QpID0+ICFzLmNvbnN0cnVjdG9yLm5hbWUuaW5jbHVkZXMoJ0xpbmtTdWdnZXN0JykpO1xuICAgICAgZWRpdG9yU3VnZ2VzdC5zdWdnZXN0cy51bnNoaWZ0KHRoaXMuc3VnZ2VzdCk7XG4gICAgfVxuICB9XG5cbiAgdXBkYXRlUXVpY2tTd2l0Y2hlcigpIHtcbiAgICB0aGlzLnF1aWNrU3dpdGNoZXJTZXJ2aWNlLnVwZGF0ZVF1aWNrU3dpdGNoZXIoKTtcbiAgfVxuXG4gIHVwZGF0ZUdyYXBoVmlldygpIHtcbiAgICB0aGlzLmdyYXBoVmlld1NlcnZpY2UudXBkYXRlR3JhcGhWaWV3KCk7XG4gIH1cblxuICB1cGRhdGVCYWNrbGlua3MoKSB7XG4gICAgdGhpcy5iYWNrbGlua1NlcnZpY2UudXBkYXRlQmFja2xpbmtzKCk7XG4gIH1cblxuICB1cGRhdGVUYWJzKCkge1xuICAgIHRoaXMudGFiU2VydmljZS51cGRhdGVUYWJzKCk7XG4gIH1cblxuICB1cGRhdGVFeHBsb3JlcigpIHtcbiAgICB0aGlzLmV4cGxvcmVyU2VydmljZS51cGRhdGVFeHBsb3JlcigpO1xuICB9XG5cbiAgdXBkYXRlV2luZG93RnJhbWUoKSB7XG4gICAgdGhpcy53aW5kb3dGcmFtZVNlcnZpY2UudXBkYXRlV2luZG93RnJhbWUoKTtcbiAgfVxuXG4gIHVwZGF0ZUJvb2ttYXJrcygpIHtcbiAgICB0aGlzLmJvb2ttYXJrU2VydmljZS51cGRhdGVCb29rbWFya3MoKTtcbiAgfVxuXG4gIHJlYnVpbGRDYWNoZSgpIHtcbiAgICB0aGlzLmNhY2hlU2VydmljZS5yZWJ1aWxkQ2FjaGUoKTtcbiAgfVxuXG4gIG9udW5sb2FkKCkge1xuICAgIC8vIENsZWFuIHVwIGVkaXRvciBzdWdnZXN0ZXJcbiAgICBjb25zdCBlZGl0b3JTdWdnZXN0ID0gKHRoaXMuYXBwLndvcmtzcGFjZSBhcyBXb3Jrc3BhY2VJbnRlcm5hbCkuZWRpdG9yU3VnZ2VzdDtcbiAgICBpZiAoZWRpdG9yU3VnZ2VzdCAmJiB0aGlzLnN1Z2dlc3QpIHtcbiAgICAgIGVkaXRvclN1Z2dlc3Quc3VnZ2VzdHMgPSBlZGl0b3JTdWdnZXN0LnN1Z2dlc3RzLmZpbHRlcigoczogRWRpdG9yU3VnZ2VzdCkgPT4gcyAhPT0gdGhpcy5zdWdnZXN0KTtcbiAgICB9XG5cbiAgICAvLyBSZXN0b3JlIHRoZSBvcmlnaW5hbCBRdWljayBTd2l0Y2hlciBjb21tYW5kXG4gICAgdGhpcy5xdWlja1N3aXRjaGVyU2VydmljZS5yZXN0b3JlT3JpZ2luYWxDb21tYW5kKCk7XG5cbiAgICAvLyBDbGVhbiB1cCBncmFwaCB2aWV3XG4gICAgdGhpcy5ncmFwaFZpZXdTZXJ2aWNlLm9udW5sb2FkKCk7XG5cbiAgICAvLyBDbGVhbiB1cCBiYWNrbGlua3Mgc2VydmljZVxuICAgIHRoaXMuYmFja2xpbmtTZXJ2aWNlLm9udW5sb2FkKCk7XG5cbiAgICAvLyBDbGVhbiB1cCB0YWIgc2VydmljZVxuICAgIHRoaXMudGFiU2VydmljZS5vbnVubG9hZCgpO1xuXG4gICAgLy8gQ2xlYW4gdXAgZXhwbG9yZXIgc2VydmljZVxuICAgIHRoaXMuZXhwbG9yZXJTZXJ2aWNlLm9udW5sb2FkKCk7XG5cbiAgICAvLyBDbGVhbiB1cCB3aW5kb3cgZnJhbWUgc2VydmljZVxuICAgIHRoaXMud2luZG93RnJhbWVTZXJ2aWNlLm9udW5sb2FkKCk7XG5cbiAgICAvLyBDbGVhbiB1cCBib29rbWFya3Mgc2VydmljZVxuICAgIHRoaXMuYm9va21hcmtTZXJ2aWNlLm9udW5sb2FkKCk7XG4gIH1cblxuICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG4gICAgY29uc3QgbG9hZGVkRGF0YSA9IChhd2FpdCB0aGlzLmxvYWREYXRhKCkpIGFzIFBsdWdpblNldHRpbmdzIHwgbnVsbDtcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgbG9hZGVkRGF0YSA/PyB7fSk7XG4gIH1cblxuICBhc3luYyBzYXZlU2V0dGluZ3MocHJldlF1aWNrU3dpdGNoZXJTdGF0ZT86IGJvb2xlYW4sIHByZXZUYWJTdGF0ZT86IGJvb2xlYW4pIHtcbiAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICAgIC8vIE9ubHkgdXBkYXRlIGNvbXBvbmVudHMgd2hlbiByZWxldmFudCBzZXR0aW5ncyBjaGFuZ2VcbiAgICBpZiAocHJldlF1aWNrU3dpdGNoZXJTdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHByZXZRdWlja1N3aXRjaGVyU3RhdGUgIT09IHRoaXMuc2V0dGluZ3MuZW5hYmxlRm9yUXVpY2tTd2l0Y2hlcikge1xuICAgICAgdGhpcy51cGRhdGVRdWlja1N3aXRjaGVyKCk7XG4gICAgfVxuICAgIGlmIChwcmV2VGFiU3RhdGUgIT09IHVuZGVmaW5lZCAmJiBwcmV2VGFiU3RhdGUgIT09IHRoaXMuc2V0dGluZ3MuZW5hYmxlRm9yVGFicykge1xuICAgICAgLy8gQWx3YXlzIHJlLXJlZ2lzdGVyIGV2ZW50cyB0byBlbnN1cmUgdGFicyBhcmUgbWFya2VkIGFzIHByb2Nlc3NlZFxuICAgICAgLy8gKGV2ZW4gd2hlbiBkaXNhYmxlZCwgd2UgbmVlZCB0byBtYXJrIHRhYnMgc28gdGhleSdyZSB2aXNpYmxlKVxuICAgICAgdm9pZCB0aGlzLnRhYlNlcnZpY2UucmVnaXN0ZXJFdmVudHMoKTtcbiAgICAgIHRoaXMudXBkYXRlVGFicygpO1xuICAgIH1cbiAgICAvLyBBbHdheXMgdXBkYXRlIGdyYXBoIHZpZXcgc2luY2UgZ3JhcGggdmlldyBhbmQgTURYIHNldHRpbmdzIGNhbiBjaGFuZ2VcbiAgICB0aGlzLnVwZGF0ZUdyYXBoVmlldygpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgUGx1Z2luU2V0dGluZ3MgfSBmcm9tICcuL3R5cGVzJztcclxuXHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFVFRJTkdTOiBQbHVnaW5TZXR0aW5ncyA9IHtcclxuICBwcm9wZXJ0eUtleTogJ3RpdGxlJyxcclxuICBlbmFibGVGb3JMaW5raW5nOiB0cnVlLFxyXG4gIGVuYWJsZUZvclF1aWNrU3dpdGNoZXI6IHRydWUsXHJcbiAgaW5jbHVkZUZpbGVuYW1lSW5TZWFyY2g6IHRydWUsXHJcbiAgaW5jbHVkZUFsaWFzZXNJblNlYXJjaDogdHJ1ZSxcclxuICBlbmFibGVGb3JEcmFnRHJvcDogdHJ1ZSxcclxuICB1c2VTaW1wbGVTZWFyY2g6IGZhbHNlLFxyXG4gIGVuYWJsZUZvckdyYXBoVmlldzogdHJ1ZSxcclxuICBlbmFibGVGb3JCYWNrbGlua3M6IHRydWUsXHJcbiAgZW5hYmxlRm9yVGFiczogdHJ1ZSxcclxuICBlbmFibGVGb3JFeHBsb3JlcjogZmFsc2UsXHJcbiAgZm9sZGVyTm90ZUZpbGVuYW1lOiAnJyxcclxuICBlbmFibGVGb3JXaW5kb3dGcmFtZTogdHJ1ZSxcclxuICBlbmFibGVGb3JCb29rbWFya3M6IHRydWUsXHJcbiAgZW5hYmxlTWR4U3VwcG9ydDogZmFsc2UsXHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVTZXR0aW5ncyhzZXR0aW5nczogUGx1Z2luU2V0dGluZ3MpOiB7IGlzVmFsaWQ6IGJvb2xlYW47IGVycm9yczogc3RyaW5nW10gfSB7XHJcbiAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xyXG4gIFxyXG4gIGlmICghc2V0dGluZ3MucHJvcGVydHlLZXkgfHwgc2V0dGluZ3MucHJvcGVydHlLZXkudHJpbSgpID09PSAnJykge1xyXG4gICAgZXJyb3JzLnB1c2goJ1Byb3BlcnR5IGtleSBjYW5ub3QgYmUgZW1wdHknKTtcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIHtcclxuICAgIGlzVmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsXHJcbiAgICBlcnJvcnNcclxuICB9O1xyXG59XHJcbiIsICJpbXBvcnQgeyBFZGl0b3IsIEVkaXRvclBvc2l0aW9uLCBFZGl0b3JTdWdnZXN0LCBFZGl0b3JTdWdnZXN0Q29udGV4dCwgRWRpdG9yU3VnZ2VzdFRyaWdnZXJJbmZvLCBNYXJrZG93blZpZXcsIE5vdGljZSwgVEZpbGUsIHByZXBhcmVGdXp6eVNlYXJjaCwgcHJlcGFyZVNpbXBsZVNlYXJjaCwgU2VhcmNoUmVzdWx0LCBzb3J0U2VhcmNoUmVzdWx0cyB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IFN1Z2dlc3Rpb25JdGVtLCBDYWNoZWRGaWxlRGF0YSwgRWRpdG9yU3VnZ2VzdEludGVybmFsLCBTZWFyY2hNYXRjaFJlYXNvbiwgUHJvcGVydHlPdmVyRmlsZU5hbWVQbHVnaW4sIFZhdWx0SW50ZXJuYWwsIFF1aWNrU3dpdGNoZXJQbHVnaW5JbnN0YW5jZSwgQXBwSW50ZXJuYWwgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBidWlsZEZpbGVDYWNoZSB9IGZyb20gJy4uL3V0aWxzL3NlYXJjaCc7XG5cbmV4cG9ydCBjbGFzcyBMaW5rVGl0bGVTdWdnZXN0IGV4dGVuZHMgRWRpdG9yU3VnZ2VzdDxTdWdnZXN0aW9uSXRlbT4ge1xuICBwcml2YXRlIHBsdWdpbjogUHJvcGVydHlPdmVyRmlsZU5hbWVQbHVnaW47XG4gIHByaXZhdGUgZmlsZUNhY2hlOiBNYXA8c3RyaW5nLCBDYWNoZWRGaWxlRGF0YT4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgc2VhcmNoVGltZW91dDogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgbWF0Y2hSZWFzb25zOiBNYXA8c3RyaW5nLCBTZWFyY2hNYXRjaFJlYXNvbj4gPSBuZXcgTWFwKCk7XG5cbiAgY29uc3RydWN0b3IocGx1Z2luOiBQcm9wZXJ0eU92ZXJGaWxlTmFtZVBsdWdpbikge1xuICAgIHN1cGVyKHBsdWdpbi5hcHApO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHZvaWQgdGhpcy5idWlsZEZpbGVDYWNoZSgpO1xuICB9XG5cbiAgb3BlbigpOiB2b2lkIHtcbiAgICBzdXBlci5vcGVuKCk7XG4gICAgY29uc3QgZWwgPSAodGhpcyBhcyBFZGl0b3JTdWdnZXN0SW50ZXJuYWwpLnN1Z2dlc3RFbDtcbiAgICBpZiAoZWwpIHtcbiAgICAgIC8vIEFkZCBzY29waW5nIGNsYXNzIHRvIHByZXZlbnQgQ1NTIGZyb20gYWZmZWN0aW5nIG90aGVyIHN1Z2dlc3Rpb24gc3lzdGVtc1xuICAgICAgZWwuYWRkQ2xhc3MoJ3Byb3BlcnR5LW92ZXItZmlsZW5hbWUtc3VnZ2VzdGlvbicpO1xuICAgICAgXG4gICAgICBpZiAoIWVsLnF1ZXJ5U2VsZWN0b3IoJy5wcm9tcHQtaW5zdHJ1Y3Rpb25zJykpIHtcbiAgICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25zID0gZWwuY3JlYXRlRGl2KHsgY2xzOiAncHJvbXB0LWluc3RydWN0aW9ucycgfSk7XG4gICAgICAgIGluc3RydWN0aW9ucy5jcmVhdGVEaXYoeyBjbHM6ICdwcm9tcHQtaW5zdHJ1Y3Rpb24nIH0pLnNldFRleHQoJ1R5cGUgIyB0byBsaW5rIGhlYWRpbmcnKTtcbiAgICAgICAgaW5zdHJ1Y3Rpb25zLmNyZWF0ZURpdih7IGNsczogJ3Byb21wdC1pbnN0cnVjdGlvbicgfSkuc2V0VGV4dCgnVHlwZSBeIHRvIGxpbmsgYmxvY2tzJyk7XG4gICAgICAgIGluc3RydWN0aW9ucy5jcmVhdGVEaXYoeyBjbHM6ICdwcm9tcHQtaW5zdHJ1Y3Rpb24nIH0pLnNldFRleHQoJ1R5cGUgfCB0byBjaGFuZ2UgZGlzcGxheSB0ZXh0Jyk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIEFkZCBrZXlib2FyZCBuYXZpZ2F0aW9uIGltcHJvdmVtZW50c1xuICAgIHRoaXMuYWRkS2V5Ym9hcmROYXZpZ2F0aW9uKCk7XG4gIH1cblxuICBwcml2YXRlIGFkZEtleWJvYXJkTmF2aWdhdGlvbigpOiB2b2lkIHtcbiAgICBjb25zdCBlbCA9ICh0aGlzIGFzIEVkaXRvclN1Z2dlc3RJbnRlcm5hbCkuc3VnZ2VzdEVsO1xuICAgIGlmICghZWwpIHJldHVybjtcblxuICAgIC8vIEFkZCBlc2NhcGUga2V5IGhhbmRsaW5nXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7XG4gICAgICBpZiAoZS5rZXkgPT09ICdFc2NhcGUnKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgb25UcmlnZ2VyKGN1cnNvcjogRWRpdG9yUG9zaXRpb24sIGVkaXRvcjogRWRpdG9yLCBmaWxlOiBURmlsZSB8IG51bGwpOiBFZGl0b3JTdWdnZXN0VHJpZ2dlckluZm8gfCBudWxsIHtcbiAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckxpbmtpbmcpIHJldHVybiBudWxsO1xuICAgIGNvbnN0IGxpbmUgPSBlZGl0b3IuZ2V0TGluZShjdXJzb3IubGluZSkuc3Vic3RyaW5nKDAsIGN1cnNvci5jaCk7XG4gICAgY29uc3QgbWF0Y2ggPSAvXFxbXFxbKFteI158XFxdXSopJC8uZXhlYyhsaW5lKTtcbiAgICBpZiAobWF0Y2gpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXJ0OiB7IGxpbmU6IGN1cnNvci5saW5lLCBjaDogbGluZS5sYXN0SW5kZXhPZignW1snKSB9LFxuICAgICAgICBlbmQ6IGN1cnNvcixcbiAgICAgICAgcXVlcnk6IG1hdGNoWzFdLFxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBhc3luYyBidWlsZEZpbGVDYWNoZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBHZXQgYWxsIG1hcmtkb3duIGZpbGVzIGFuZCBNRFggZmlsZXMgKGlmIGVuYWJsZWQpXG4gICAgY29uc3QgbWRGaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKTtcbiAgICBjb25zdCBhbGxGaWxlcyA9IFsuLi5tZEZpbGVzXTtcbiAgICBcbiAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlTWR4U3VwcG9ydCkge1xuICAgICAgY29uc3QgbWR4RmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlcygpLmZpbHRlcihcbiAgICAgICAgKGYpOiBmIGlzIFRGaWxlID0+IGYgaW5zdGFuY2VvZiBURmlsZSAmJiBmLmV4dGVuc2lvbiA9PT0gJ21keCdcbiAgICAgICk7XG4gICAgICBhbGxGaWxlcy5wdXNoKC4uLm1keEZpbGVzKTtcbiAgICB9XG4gICAgXG4gICAgdGhpcy5maWxlQ2FjaGUgPSBhd2FpdCBidWlsZEZpbGVDYWNoZShcbiAgICAgIGFsbEZpbGVzLFxuICAgICAgdGhpcy5hcHAubWV0YWRhdGFDYWNoZSxcbiAgICAgIHRoaXMuYXBwLFxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvcGVydHlLZXksXG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5nc1xuICAgICk7XG4gIH1cblxuICBhc3luYyB1cGRhdGVGaWxlQ2FjaGUoZmlsZTogVEZpbGUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB7IGdldEZyb250bWF0dGVyLCBpc0ZpbGVUeXBlU3VwcG9ydGVkIH0gPSBhd2FpdCBpbXBvcnQoJy4uL3V0aWxzL2Zyb250bWF0dGVyJyk7XG4gICAgXG4gICAgLy8gU2tpcCB1bnN1cHBvcnRlZCBmaWxlIHR5cGVzXG4gICAgaWYgKCFpc0ZpbGVUeXBlU3VwcG9ydGVkKGZpbGUuZXh0ZW5zaW9uLCB0aGlzLnBsdWdpbi5zZXR0aW5ncykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBmcm9udG1hdHRlciA9IGF3YWl0IGdldEZyb250bWF0dGVyKHRoaXMuYXBwLCBmaWxlLCB0aGlzLnBsdWdpbi5zZXR0aW5ncyk7XG4gICAgbGV0IGRpc3BsYXlOYW1lID0gZmlsZS5iYXNlbmFtZTtcbiAgICBsZXQgaXNDdXN0b21EaXNwbGF5ID0gZmFsc2U7XG4gICAgbGV0IGFsaWFzZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICBpZiAoZnJvbnRtYXR0ZXIgJiYgZnJvbnRtYXR0ZXJbdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvcGVydHlLZXldICE9PSB1bmRlZmluZWQgJiYgZnJvbnRtYXR0ZXJbdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvcGVydHlLZXldICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBwcm9wZXJ0eVZhbHVlID0gU3RyaW5nKGZyb250bWF0dGVyW3RoaXMucGx1Z2luLnNldHRpbmdzLnByb3BlcnR5S2V5XSkudHJpbSgpO1xuICAgICAgaWYgKHByb3BlcnR5VmFsdWUgIT09ICcnKSB7XG4gICAgICAgIGRpc3BsYXlOYW1lID0gcHJvcGVydHlWYWx1ZTtcbiAgICAgICAgaXNDdXN0b21EaXNwbGF5ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZnJvbnRtYXR0ZXI/LmFsaWFzZXMpIHtcbiAgICAgIGNvbnN0IGFsaWFzZXNSYXcgPSBmcm9udG1hdHRlci5hbGlhc2VzIGFzIHVua25vd247XG4gICAgICBhbGlhc2VzID0gQXJyYXkuaXNBcnJheShhbGlhc2VzUmF3KSA/IGFsaWFzZXNSYXcubWFwKGEgPT4gU3RyaW5nKGEpKSA6IFtTdHJpbmcoYWxpYXNlc1JhdyldO1xuICAgICAgYWxpYXNlcyA9IGFsaWFzZXMubWFwKGFsaWFzID0+IGFsaWFzLnRyaW0oKSkuZmlsdGVyKGFsaWFzID0+IGFsaWFzICE9PSAnJyk7XG4gICAgfVxuXG4gICAgdGhpcy5maWxlQ2FjaGUuc2V0KGZpbGUucGF0aCwge1xuICAgICAgZmlsZSxcbiAgICAgIGRpc3BsYXlOYW1lLFxuICAgICAgYWxpYXNlcyxcbiAgICAgIGxhc3RNb2RpZmllZDogZmlsZS5zdGF0Lm10aW1lLFxuICAgICAgaXNDdXN0b21EaXNwbGF5XG4gICAgfSk7XG4gIH1cblxuICBnZXRTdWdnZXN0aW9ucyhjb250ZXh0OiBFZGl0b3JTdWdnZXN0Q29udGV4dCk6IFN1Z2dlc3Rpb25JdGVtW10ge1xuICAgIGNvbnN0IHF1ZXJ5ID0gY29udGV4dC5xdWVyeS50cmltKCk7XG4gICAgcmV0dXJuIHRoaXMucGVyZm9ybVNlYXJjaChxdWVyeSk7XG4gIH1cblxuICBwcml2YXRlIHBlcmZvcm1TZWFyY2gocXVlcnk6IHN0cmluZyk6IFN1Z2dlc3Rpb25JdGVtW10ge1xuICAgIC8vIElmIG5vIHF1ZXJ5LCBzaG93IGFsbCBmaWxlc1xuICAgIGlmICghcXVlcnkgfHwgcXVlcnkudHJpbSgpID09PSAnJykge1xuICAgICAgY29uc3Qgc3VnZ2VzdGlvbnM6IFN1Z2dlc3Rpb25JdGVtW10gPSBbXTtcbiAgICAgIGZvciAoY29uc3QgY2FjaGVkRGF0YSBvZiB0aGlzLmZpbGVDYWNoZS52YWx1ZXMoKSkge1xuICAgICAgICBzdWdnZXN0aW9ucy5wdXNoKHsgXG4gICAgICAgICAgZmlsZTogY2FjaGVkRGF0YS5maWxlLCBcbiAgICAgICAgICBkaXNwbGF5OiBjYWNoZWREYXRhLmRpc3BsYXlOYW1lLCBcbiAgICAgICAgICBpc0N1c3RvbURpc3BsYXk6IGNhY2hlZERhdGEuaXNDdXN0b21EaXNwbGF5IFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdWdnZXN0aW9ucztcbiAgICB9XG5cbiAgICAvLyBVc2Ugc2ltcGxlIHNlYXJjaCBmb3IgbGFyZ2UgdmF1bHRzIGlmIGVuYWJsZWQsIG90aGVyd2lzZSB1c2UgZnV6enkgc2VhcmNoXG4gICAgY29uc3Qgc2VhcmNoID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MudXNlU2ltcGxlU2VhcmNoIFxuICAgICAgPyBwcmVwYXJlU2ltcGxlU2VhcmNoKHF1ZXJ5KVxuICAgICAgOiBwcmVwYXJlRnV6enlTZWFyY2gocXVlcnkpO1xuICAgIFxuICAgIC8vIENyZWF0ZSBhIHN0cnVjdHVyZSBjb21wYXRpYmxlIHdpdGggc29ydFNlYXJjaFJlc3VsdHNcbiAgICBpbnRlcmZhY2UgU2VhcmNoYWJsZVN1Z2dlc3Rpb24ge1xuICAgICAgaXRlbTogU3VnZ2VzdGlvbkl0ZW07XG4gICAgICBtYXRjaDogU2VhcmNoUmVzdWx0O1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBzZWFyY2hhYmxlU3VnZ2VzdGlvbnM6IFNlYXJjaGFibGVTdWdnZXN0aW9uW10gPSBbXTtcbiAgICB0aGlzLm1hdGNoUmVhc29ucy5jbGVhcigpOyAvLyBDbGVhciBwcmV2aW91cyBtYXRjaCByZWFzb25zXG5cbiAgICAvLyBVc2UgY2FjaGVkIGRhdGEgZm9yIG11Y2ggZmFzdGVyIHNlYXJjaFxuICAgIGZvciAoY29uc3QgY2FjaGVkRGF0YSBvZiB0aGlzLmZpbGVDYWNoZS52YWx1ZXMoKSkge1xuICAgICAgY29uc3QgeyBmaWxlLCBkaXNwbGF5TmFtZSwgYWxpYXNlcywgaXNDdXN0b21EaXNwbGF5IH0gPSBjYWNoZWREYXRhO1xuICAgICAgXG4gICAgICAvLyBUcmFjayB3aGljaCBmaWVsZHMgY2F1c2VkIHRoZSBtYXRjaFxuICAgICAgY29uc3QgbWF0Y2hSZWFzb246IFNlYXJjaE1hdGNoUmVhc29uID0ge1xuICAgICAgICBtYXRjaGVkSW5UaXRsZTogZmFsc2UsXG4gICAgICAgIG1hdGNoZWRJbkZpbGVuYW1lOiBmYWxzZSxcbiAgICAgICAgbWF0Y2hlZEluQWxpYXM6IGZhbHNlXG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBQcmltYXJ5IG1hdGNoOiBzZWFyY2ggdGl0bGUvcHJvcGVydHkgZmlyc3QgKG9ubHkgaWYgbm90ZSBoYXMgY3VzdG9tIGRpc3BsYXkpXG4gICAgICBsZXQgcHJpbWFyeU1hdGNoOiBTZWFyY2hSZXN1bHQgfCBudWxsID0gbnVsbDtcbiAgICAgIGxldCBiZXN0TWF0Y2g6IFNlYXJjaFJlc3VsdCB8IG51bGwgPSBudWxsO1xuICAgICAgbGV0IG1hdGNoVHlwZTogJ3RpdGxlJyB8ICdmaWxlbmFtZScgfCAnYWxpYXMnIHwgbnVsbCA9IG51bGw7XG4gICAgICBcbiAgICAgIGlmIChpc0N1c3RvbURpc3BsYXkpIHtcbiAgICAgICAgLy8gT25seSBzZWFyY2ggdGl0bGUvcHJvcGVydHkgaWYgbm90ZSBhY3R1YWxseSBoYXMgYSBjdXN0b20gcHJvcGVydHlcbiAgICAgICAgcHJpbWFyeU1hdGNoID0gc2VhcmNoKGRpc3BsYXlOYW1lKTtcbiAgICAgICAgaWYgKHByaW1hcnlNYXRjaCAmJiBwcmltYXJ5TWF0Y2gubWF0Y2hlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgbWF0Y2hSZWFzb24ubWF0Y2hlZEluVGl0bGUgPSB0cnVlO1xuICAgICAgICAgIGJlc3RNYXRjaCA9IHByaW1hcnlNYXRjaDtcbiAgICAgICAgICBtYXRjaFR5cGUgPSAndGl0bGUnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIElmIG5vIHRpdGxlIG1hdGNoIChvciBub3RlIGRvZXNuJ3QgaGF2ZSBwcm9wZXJ0eSksIHNlYXJjaCBmaWxlbmFtZVxuICAgICAgaWYgKCFtYXRjaFR5cGUpIHtcbiAgICAgICAgLy8gU2VhcmNoIGZpbGVuYW1lIGlmIGl0J3MgZGlmZmVyZW50IGZyb20gZGlzcGxheU5hbWUsIG9yIGlmIG5vdGUgZG9lc24ndCBoYXZlIHByb3BlcnR5XG4gICAgICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5pbmNsdWRlRmlsZW5hbWVJblNlYXJjaCAmJiBmaWxlLmJhc2VuYW1lICE9PSBkaXNwbGF5TmFtZSkge1xuICAgICAgICAgIGNvbnN0IGZpbGVuYW1lTWF0Y2ggPSBzZWFyY2goZmlsZS5iYXNlbmFtZSk7XG4gICAgICAgICAgaWYgKGZpbGVuYW1lTWF0Y2ggJiYgZmlsZW5hbWVNYXRjaC5tYXRjaGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIG1hdGNoUmVhc29uLm1hdGNoZWRJbkZpbGVuYW1lID0gdHJ1ZTtcbiAgICAgICAgICAgIC8vIERvd25yYW5rIGZpbGVuYW1lIG1hdGNoZXMgYnkgLTFcbiAgICAgICAgICAgIGJlc3RNYXRjaCA9IHsgLi4uZmlsZW5hbWVNYXRjaCwgc2NvcmU6IGZpbGVuYW1lTWF0Y2guc2NvcmUgLSAxIH07XG4gICAgICAgICAgICBtYXRjaFR5cGUgPSAnZmlsZW5hbWUnO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICghaXNDdXN0b21EaXNwbGF5KSB7XG4gICAgICAgICAgLy8gSWYgbm90ZSBkb2Vzbid0IGhhdmUgcHJvcGVydHksIGRpc3BsYXlOYW1lIGVxdWFscyBmaWxlbmFtZSwgc28gc2VhcmNoIGZpbGVuYW1lXG4gICAgICAgICAgY29uc3QgZmlsZW5hbWVNYXRjaCA9IHNlYXJjaChmaWxlLmJhc2VuYW1lKTtcbiAgICAgICAgICBpZiAoZmlsZW5hbWVNYXRjaCAmJiBmaWxlbmFtZU1hdGNoLm1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbWF0Y2hSZWFzb24ubWF0Y2hlZEluRmlsZW5hbWUgPSB0cnVlO1xuICAgICAgICAgICAgYmVzdE1hdGNoID0gZmlsZW5hbWVNYXRjaDtcbiAgICAgICAgICAgIG1hdGNoVHlwZSA9ICdmaWxlbmFtZSc7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgICAgLy8gVGVydGlhcnkgbWF0Y2g6IHNlYXJjaCBhbGlhc2VzICh3aXRoIGRvd25yYW5raW5nKVxuICAgICAgICBpZiAoIW1hdGNoVHlwZSAmJiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5pbmNsdWRlQWxpYXNlc0luU2VhcmNoICYmIGFsaWFzZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGZvciAoY29uc3QgYWxpYXMgb2YgYWxpYXNlcykge1xuICAgICAgICAgICAgY29uc3QgYWxpYXNNYXRjaCA9IHNlYXJjaChhbGlhcyk7XG4gICAgICAgICAgICBpZiAoYWxpYXNNYXRjaCAmJiBhbGlhc01hdGNoLm1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICBtYXRjaFJlYXNvbi5tYXRjaGVkSW5BbGlhcyA9IHRydWU7XG4gICAgICAgICAgICAgIG1hdGNoUmVhc29uLm1hdGNoZWRBbGlhc1RleHQgPSBhbGlhczsgLy8gU3RvcmUgd2hpY2ggYWxpYXMgbWF0Y2hlZFxuICAgICAgICAgICAgICAvLyBEb3ducmFuayBhbGlhcyBtYXRjaGVzIGJ5IC0xXG4gICAgICAgICAgICAgIGJlc3RNYXRjaCA9IHsgLi4uYWxpYXNNYXRjaCwgc2NvcmU6IGFsaWFzTWF0Y2guc2NvcmUgLSAxIH07XG4gICAgICAgICAgICAgIG1hdGNoVHlwZSA9ICdhbGlhcyc7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgXG4gICAgICAvLyBJZiB3ZSBoYXZlIGFueSBtYXRjaCwgYWRkIHRvIHJlc3VsdHNcbiAgICAgIGlmIChiZXN0TWF0Y2ggJiYgYmVzdE1hdGNoLm1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBzdWdnZXN0aW9uOiBTdWdnZXN0aW9uSXRlbSA9IHsgXG4gICAgICAgICAgZmlsZSwgXG4gICAgICAgICAgZGlzcGxheTogZGlzcGxheU5hbWUsIFxuICAgICAgICAgIGlzQ3VzdG9tRGlzcGxheSBcbiAgICAgICAgfTtcbiAgICAgICAgc2VhcmNoYWJsZVN1Z2dlc3Rpb25zLnB1c2goeyBpdGVtOiBzdWdnZXN0aW9uLCBtYXRjaDogYmVzdE1hdGNoIH0pO1xuICAgICAgICB0aGlzLm1hdGNoUmVhc29ucy5zZXQoZmlsZS5wYXRoLCBtYXRjaFJlYXNvbik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIHVucmVzb2x2ZWQgbGlua3MgaWYgXCJTaG93IGV4aXN0aW5nIG9ubHlcIiBpcyBkaXNhYmxlZFxuICAgIC8vIFRoaXMgbWF0Y2hlcyBRdWljayBTd2l0Y2ggKysgYmVoYXZpb3I6IHVucmVzb2x2ZWQ6ICFzZXR0aW5ncy5zaG93RXhpc3RpbmdPbmx5XG4gICAgY29uc3QgcXVpY2tTd2l0Y2hlck9wdGlvbnMgPSB0aGlzLmdldFF1aWNrU3dpdGNoZXJPcHRpb25zKCk7XG4gICAgY29uc3Qgc2hvd0V4aXN0aW5nT25seSA9IHF1aWNrU3dpdGNoZXJPcHRpb25zPy5zaG93RXhpc3RpbmdPbmx5ID8/IGZhbHNlO1xuICAgIFxuICAgIGlmICghc2hvd0V4aXN0aW5nT25seSkge1xuICAgICAgLy8gR2V0IHVucmVzb2x2ZWQgbGlua3MgZnJvbSBtZXRhZGF0YSBjYWNoZSAobGlrZSBRdWljayBTd2l0Y2ggKysgZG9lcylcbiAgICAgIGNvbnN0IHsgdW5yZXNvbHZlZExpbmtzIH0gPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlO1xuICAgICAgY29uc3QgdW5yZXNvbHZlZFNldCA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgICAgXG4gICAgICAvLyBDb2xsZWN0IGFsbCB1bnJlc29sdmVkIGxpbmtzIGZyb20gYWxsIGZpbGVzXG4gICAgICBmb3IgKGNvbnN0IHNvdXJjZVBhdGggaW4gdW5yZXNvbHZlZExpbmtzKSB7XG4gICAgICAgIGNvbnN0IGxpbmtzID0gT2JqZWN0LmtleXModW5yZXNvbHZlZExpbmtzW3NvdXJjZVBhdGhdKTtcbiAgICAgICAgbGlua3MuZm9yRWFjaChsaW5rID0+IHVucmVzb2x2ZWRTZXQuYWRkKGxpbmspKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gU2VhcmNoIHVucmVzb2x2ZWQgbGlua3MgYW5kIGFkZCBtYXRjaGVzXG4gICAgICBmb3IgKGNvbnN0IHVucmVzb2x2ZWQgb2YgdW5yZXNvbHZlZFNldCkge1xuICAgICAgICBjb25zdCB1bnJlc29sdmVkTWF0Y2ggPSBzZWFyY2godW5yZXNvbHZlZCk7XG4gICAgICAgIGlmICh1bnJlc29sdmVkTWF0Y2ggJiYgdW5yZXNvbHZlZE1hdGNoLm1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIC8vIEFkZCBhcyBhIHN1Z2dlc3Rpb24gd2l0aG91dCBhIGZpbGUgKHVucmVzb2x2ZWQgbGluaylcbiAgICAgICAgICBzZWFyY2hhYmxlU3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgICAgICBpdGVtOiB7XG4gICAgICAgICAgICAgIGRpc3BsYXk6IHVucmVzb2x2ZWQsXG4gICAgICAgICAgICAgIGlzQ3VzdG9tRGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgIC8vIE5vIGZpbGUgcHJvcGVydHkgbWVhbnMgaXQncyB1bnJlc29sdmVkXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWF0Y2g6IHVucmVzb2x2ZWRNYXRjaFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVXNlIE9ic2lkaWFuJ3MgbmF0aXZlIHNvcnRpbmcgZm9yIGV4YWN0IHZhbmlsbGEgY29tcGF0aWJpbGl0eVxuICAgIHNvcnRTZWFyY2hSZXN1bHRzKHNlYXJjaGFibGVTdWdnZXN0aW9ucyk7XG4gICAgXG4gICAgLy8gRXh0cmFjdCBzdWdnZXN0aW9ucyBmcm9tIHNvcnRlZCByZXN1bHRzXG4gICAgbGV0IHN1Z2dlc3Rpb25zID0gc2VhcmNoYWJsZVN1Z2dlc3Rpb25zLm1hcChzID0+IHMuaXRlbSk7XG4gICAgXG4gICAgLy8gRmlsdGVyIG91dCB1bnJlc29sdmVkIGxpbmtzIGlmIFwiU2hvdyBleGlzdGluZyBvbmx5XCIgaXMgZW5hYmxlZFxuICAgIC8vIFVucmVzb2x2ZWQgbGlua3MgYXJlIGl0ZW1zIHdpdGhvdXQgYSBmaWxlIHByb3BlcnR5XG4gICAgaWYgKHNob3dFeGlzdGluZ09ubHkpIHtcbiAgICAgIHN1Z2dlc3Rpb25zID0gc3VnZ2VzdGlvbnMuZmlsdGVyKHMgPT4gcy5maWxlICE9PSB1bmRlZmluZWQpO1xuICAgIH1cblxuICAgIC8vIExpbmsgc3VnZ2VzdGVyIHNob3VsZCBOT1Qgc2hvdyBcImNyZWF0ZSBuZXcgbm90ZVwiIG9wdGlvbiAtIHRoYXQncyBRdWljayBTd2l0Y2hlciBiZWhhdmlvclxuICAgIC8vIEJ1dCBpZiB0aGVyZSBhcmUgbm8gbWF0Y2hlcyBhbmQgdGhlcmUncyBhIHF1ZXJ5LCBzaG93IFwiTm8gbWF0Y2ggZm91bmRcIiBsaWtlIHZhbmlsbGEgT2JzaWRpYW5cbiAgICBpZiAoc3VnZ2VzdGlvbnMubGVuZ3RoID09PSAwICYmIHF1ZXJ5KSB7XG4gICAgICBzdWdnZXN0aW9ucy5wdXNoKHtcbiAgICAgICAgZGlzcGxheTogJ05vIG1hdGNoIGZvdW5kJyxcbiAgICAgICAgaXNDdXN0b21EaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgaXNOb01hdGNoOiB0cnVlXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHN1Z2dlc3Rpb25zO1xuICB9XG5cbiAgcmVuZGVyU3VnZ2VzdGlvbihzdWdnZXN0aW9uOiBTdWdnZXN0aW9uSXRlbSwgZWw6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgZWwuZW1wdHkoKTtcbiAgICBcbiAgICBpZiAoc3VnZ2VzdGlvbi5pc05vTWF0Y2gpIHtcbiAgICAgIC8vIEZvciBcIk5vIG1hdGNoIGZvdW5kXCIsIHNob3cganVzdCB0aGUgdGV4dFxuICAgICAgZWwuc2V0VGV4dChzdWdnZXN0aW9uLmRpc3BsYXkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICBpZiAoc3VnZ2VzdGlvbi5maWxlKSB7XG4gICAgICAvLyBHZXQgdGhlIG1hdGNoIHJlYXNvbiBmb3IgdGhpcyBmaWxlXG4gICAgICBjb25zdCBtYXRjaFJlYXNvbiA9IHRoaXMubWF0Y2hSZWFzb25zLmdldChzdWdnZXN0aW9uLmZpbGUucGF0aCk7XG4gICAgICBcbiAgICAgIC8vIFNwZWNpYWwgY2FzZTogbm90ZXMgd2l0aG91dCBwcm9wZXJ0eSB0aGF0IG1hdGNoZWQgdmlhIGFsaWFzIHNob3VsZCBzaG93IGFsaWFzIHdpdGggaWNvblxuICAgICAgaWYgKCFzdWdnZXN0aW9uLmlzQ3VzdG9tRGlzcGxheSAmJiBtYXRjaFJlYXNvbj8ubWF0Y2hlZEluQWxpYXMgJiYgbWF0Y2hSZWFzb24ubWF0Y2hlZEFsaWFzVGV4dCkge1xuICAgICAgICAvLyBTaG93IGFsaWFzIGFzIG1haW4gdGV4dCwgZmlsZW5hbWUgYmVsb3csIHdpdGggYWxpYXMgaWNvbiAobGlrZSBkZWZhdWx0IE9ic2lkaWFuKVxuICAgICAgICBlbC5hZGRDbGFzcygnbW9kLWNvbXBsZXgnKTtcbiAgICAgICAgY29uc3Qgc3VnZ2VzdGlvbkNvbnRlbnQgPSBlbC5jcmVhdGVEaXYoeyBjbHM6ICdzdWdnZXN0aW9uLWNvbnRlbnQnIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gTWFpbiB0aXRsZSAtIHNob3cgdGhlIGFsaWFzIHRoYXQgbWF0Y2hlZFxuICAgICAgICBjb25zdCB0aXRsZUVsID0gc3VnZ2VzdGlvbkNvbnRlbnQuY3JlYXRlRGl2KHsgY2xzOiAnc3VnZ2VzdGlvbi10aXRsZScgfSk7XG4gICAgICAgIHRpdGxlRWwuc2V0VGV4dChtYXRjaFJlYXNvbi5tYXRjaGVkQWxpYXNUZXh0KTtcbiAgICAgICAgXG4gICAgICAgIC8vIEZpbGUgcGF0aCBiZWxvd1xuICAgICAgICBjb25zdCBwYXRoRWwgPSBzdWdnZXN0aW9uQ29udGVudC5jcmVhdGVEaXYoeyBjbHM6ICdzdWdnZXN0aW9uLW5vdGUnIH0pO1xuICAgICAgICBwYXRoRWwuc2V0VGV4dChzdWdnZXN0aW9uLmZpbGUucGF0aC5yZXBsYWNlKCcubWQnLCAnJykpO1xuICAgICAgICBcbiAgICAgICAgLy8gQWRkIHN1Z2dlc3Rpb24tYXV4IHdpdGggYWxpYXMgaWNvblxuICAgICAgICBjb25zdCBzdWdnZXN0aW9uQXV4ID0gZWwuY3JlYXRlRGl2KHsgY2xzOiAnc3VnZ2VzdGlvbi1hdXgnIH0pO1xuICAgICAgICBjb25zdCBzdWdnZXN0aW9uRmxhaXIgPSBzdWdnZXN0aW9uQXV4LmNyZWF0ZVNwYW4oeyBcbiAgICAgICAgICBjbHM6ICdzdWdnZXN0aW9uLWZsYWlyJywgXG4gICAgICAgICAgYXR0cjogeyAnYXJpYS1sYWJlbCc6ICdBbGlhcyBNYXRjaCcgfSBcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY3JlYXRlRm9yd2FyZEljb24oc3VnZ2VzdGlvbkZsYWlyKTtcbiAgICAgIH0gZWxzZSBpZiAoc3VnZ2VzdGlvbi5pc0N1c3RvbURpc3BsYXkpIHtcbiAgICAgICAgLy8gTm90ZXMgd2l0aCB0aGUgcHJvcGVydHkgLSBrZWVwIGV4aXN0aW5nIGJlaGF2aW9yXG4gICAgICAgIGNvbnN0IHNob3VsZFNob3dJY29uID0gbWF0Y2hSZWFzb24gJiYgKG1hdGNoUmVhc29uLm1hdGNoZWRJblRpdGxlIHx8IG1hdGNoUmVhc29uLm1hdGNoZWRJbkZpbGVuYW1lIHx8IG1hdGNoUmVhc29uLm1hdGNoZWRJbkFsaWFzKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChzaG91bGRTaG93SWNvbikge1xuICAgICAgICAgIC8vIEFkZCBtb2QtY29tcGxleCBjbGFzcyB0byBtYXRjaCBPYnNpZGlhbidzIHN0cnVjdHVyZVxuICAgICAgICAgIGVsLmFkZENsYXNzKCdtb2QtY29tcGxleCcpO1xuXG4gICAgICAgICAgLy8gQ3JlYXRlIHRoZSBtYWluIHN1Z2dlc3Rpb24gY29udGFpbmVyXG4gICAgICAgICAgY29uc3Qgc3VnZ2VzdGlvbkNvbnRlbnQgPSBlbC5jcmVhdGVEaXYoeyBjbHM6ICdzdWdnZXN0aW9uLWNvbnRlbnQnIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIE1haW4gdGl0bGVcbiAgICAgICAgICBjb25zdCB0aXRsZUVsID0gc3VnZ2VzdGlvbkNvbnRlbnQuY3JlYXRlRGl2KHsgY2xzOiAnc3VnZ2VzdGlvbi10aXRsZScgfSk7XG4gICAgICAgICAgdGl0bGVFbC5zZXRUZXh0KHN1Z2dlc3Rpb24uZGlzcGxheSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRmlsZSBwYXRoIGJlbG93XG4gICAgICAgICAgY29uc3QgcGF0aEVsID0gc3VnZ2VzdGlvbkNvbnRlbnQuY3JlYXRlRGl2KHsgY2xzOiAnc3VnZ2VzdGlvbi1ub3RlJyB9KTtcbiAgICAgICAgICBwYXRoRWwuc2V0VGV4dChzdWdnZXN0aW9uLmZpbGUucGF0aC5yZXBsYWNlKCcubWQnLCAnJykpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFkZCBzdWdnZXN0aW9uLWF1eCB3aXRoIGFwcHJvcHJpYXRlIGljb24gYmFzZWQgb24gbWF0Y2ggcmVhc29uXG4gICAgICAgICAgY29uc3Qgc3VnZ2VzdGlvbkF1eCA9IGVsLmNyZWF0ZURpdih7IGNsczogJ3N1Z2dlc3Rpb24tYXV4JyB9KTtcbiAgICAgICAgICBjb25zdCBzdWdnZXN0aW9uRmxhaXIgPSBzdWdnZXN0aW9uQXV4LmNyZWF0ZVNwYW4oeyBcbiAgICAgICAgICAgIGNsczogJ3N1Z2dlc3Rpb24tZmxhaXInLCBcbiAgICAgICAgICAgIGF0dHI6IHsgJ2FyaWEtbGFiZWwnOiB0aGlzLmdldEljb25MYWJlbChtYXRjaFJlYXNvbikgfSBcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBEZXRlcm1pbmUgaWNvbiBiYXNlZCBvbiBwcmlvcml0eTogdGl0bGUgPiBmaWxlIG5hbWUgPiBhbGlhc1xuICAgICAgICAgIGlmIChtYXRjaFJlYXNvbi5tYXRjaGVkSW5UaXRsZSkge1xuICAgICAgICAgICAgLy8gVHlwZSBpY29uIGZvciB0aXRsZS9wcm9wZXJ0eSBtYXRjaGVzXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVR5cGVJY29uKHN1Z2dlc3Rpb25GbGFpcik7XG4gICAgICAgICAgfSBlbHNlIGlmIChtYXRjaFJlYXNvbi5tYXRjaGVkSW5GaWxlbmFtZSkge1xuICAgICAgICAgICAgLy8gRmlsZSBpY29uIGZvciBmaWxlIG5hbWUgbWF0Y2hlc1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVGaWxlSWNvbihzdWdnZXN0aW9uRmxhaXIpO1xuICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2hSZWFzb24ubWF0Y2hlZEluQWxpYXMpIHtcbiAgICAgICAgICAgIC8vIEFycm93IGljb24gZm9yIGFsaWFzIG1hdGNoZXNcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlRm9yd2FyZEljb24oc3VnZ2VzdGlvbkZsYWlyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gTm90ZSBoYXMgcHJvcGVydHkgYnV0IG5vIG1hdGNoIHJlYXNvbiAoc2hvdWxkbid0IGhhcHBlbiwgYnV0IGhhbmRsZSBncmFjZWZ1bGx5KVxuICAgICAgICAgIC8vIFNob3cgc2ltcGxlIGRpc3BsYXkgd2l0aCBqdXN0IHRoZSBkaXNwbGF5IG5hbWVcbiAgICAgICAgICBlbC5zZXRUZXh0KHN1Z2dlc3Rpb24uZGlzcGxheSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZvciBub3RlcyB3aXRob3V0IHRoZSBwcm9wZXJ0eSAoYW5kIG5vdCBtYXRjaGVkIHZpYSBhbGlhcyksIHNob3cgc2ltcGxlIGRpc3BsYXkgKG5vIGljb24sIG5vIGR1cGxpY2F0ZSBuYW1lKVxuICAgICAgICBlbC5zZXRUZXh0KHN1Z2dlc3Rpb24uZGlzcGxheSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRJY29uTGFiZWwobWF0Y2hSZWFzb246IFNlYXJjaE1hdGNoUmVhc29uKTogc3RyaW5nIHtcbiAgICBpZiAobWF0Y2hSZWFzb24ubWF0Y2hlZEluVGl0bGUpIHtcbiAgICAgIHJldHVybiAnVGl0bGUvUHJvcGVydHkgTWF0Y2gnO1xuICAgIH0gZWxzZSBpZiAobWF0Y2hSZWFzb24ubWF0Y2hlZEluRmlsZW5hbWUpIHtcbiAgICAgIHJldHVybiAnRmlsZSBOYW1lIE1hdGNoJztcbiAgICB9IGVsc2UgaWYgKG1hdGNoUmVhc29uLm1hdGNoZWRJbkFsaWFzKSB7XG4gICAgICByZXR1cm4gJ0FsaWFzIE1hdGNoJztcbiAgICB9XG4gICAgcmV0dXJuICdNYXRjaCc7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVR5cGVJY29uKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICBjb25zdCBzdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3N2ZycpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgJzI0Jyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgJzI0Jyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgndmlld0JveCcsICcwIDAgMjQgMjQnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdmaWxsJywgJ25vbmUnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnY3VycmVudENvbG9yJyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgJzInKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdzdHJva2UtbGluZWNhcCcsICdyb3VuZCcpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1saW5lam9pbicsICdyb3VuZCcpO1xuICAgIHN2Zy5jbGFzc0xpc3QuYWRkKCdzdmctaWNvbicsICdsdWNpZGUtdHlwZScpO1xuICAgIFxuICAgIGNvbnN0IHBvbHlsaW5lMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAncG9seWxpbmUnKTtcbiAgICBwb2x5bGluZTEuc2V0QXR0cmlidXRlKCdwb2ludHMnLCAnNCA3IDQgNCAyMCA0IDIwIDcnKTtcbiAgICBzdmcuYXBwZW5kQ2hpbGQocG9seWxpbmUxKTtcbiAgICBcbiAgICBjb25zdCBsaW5lMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnbGluZScpO1xuICAgIGxpbmUxLnNldEF0dHJpYnV0ZSgneDEnLCAnOScpO1xuICAgIGxpbmUxLnNldEF0dHJpYnV0ZSgneTEnLCAnMjAnKTtcbiAgICBsaW5lMS5zZXRBdHRyaWJ1dGUoJ3gyJywgJzE1Jyk7XG4gICAgbGluZTEuc2V0QXR0cmlidXRlKCd5MicsICcyMCcpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChsaW5lMSk7XG4gICAgXG4gICAgY29uc3QgbGluZTIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ2xpbmUnKTtcbiAgICBsaW5lMi5zZXRBdHRyaWJ1dGUoJ3gxJywgJzEyJyk7XG4gICAgbGluZTIuc2V0QXR0cmlidXRlKCd5MScsICc0Jyk7XG4gICAgbGluZTIuc2V0QXR0cmlidXRlKCd4MicsICcxMicpO1xuICAgIGxpbmUyLnNldEF0dHJpYnV0ZSgneTInLCAnMjAnKTtcbiAgICBzdmcuYXBwZW5kQ2hpbGQobGluZTIpO1xuICAgIFxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzdmcpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVGaWxlSWNvbihjb250YWluZXI6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgY29uc3Qgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCd3aWR0aCcsICcyNCcpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsICcyNCcpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3ZpZXdCb3gnLCAnMCAwIDI0IDI0Jyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnZmlsbCcsICdub25lJyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJ2N1cnJlbnRDb2xvcicpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS13aWR0aCcsICcyJyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLWxpbmVjYXAnLCAncm91bmQnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdzdHJva2UtbGluZWpvaW4nLCAncm91bmQnKTtcbiAgICBzdmcuY2xhc3NMaXN0LmFkZCgnc3ZnLWljb24nLCAnbHVjaWRlLWZpbGUtdGV4dCcpO1xuICAgIFxuICAgIGNvbnN0IHBhdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3BhdGgnKTtcbiAgICBwYXRoLnNldEF0dHJpYnV0ZSgnZCcsICdNMTQuNSAySDZhMiAyIDAgMCAwLTIgMnYxNmEyIDIgMCAwIDAgMiAyaDEyYTIgMiAwIDAgMCAyLTJWNy41TDE0LjUgMnonKTtcbiAgICBzdmcuYXBwZW5kQ2hpbGQocGF0aCk7XG4gICAgXG4gICAgY29uc3QgcG9seWxpbmUxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdwb2x5bGluZScpO1xuICAgIHBvbHlsaW5lMS5zZXRBdHRyaWJ1dGUoJ3BvaW50cycsICcxNCwyIDE0LDggMjAsOCcpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChwb2x5bGluZTEpO1xuICAgIFxuICAgIGNvbnN0IGxpbmUxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdsaW5lJyk7XG4gICAgbGluZTEuc2V0QXR0cmlidXRlKCd4MScsICcxNicpO1xuICAgIGxpbmUxLnNldEF0dHJpYnV0ZSgneTEnLCAnMTMnKTtcbiAgICBsaW5lMS5zZXRBdHRyaWJ1dGUoJ3gyJywgJzgnKTtcbiAgICBsaW5lMS5zZXRBdHRyaWJ1dGUoJ3kyJywgJzEzJyk7XG4gICAgc3ZnLmFwcGVuZENoaWxkKGxpbmUxKTtcbiAgICBcbiAgICBjb25zdCBsaW5lMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnbGluZScpO1xuICAgIGxpbmUyLnNldEF0dHJpYnV0ZSgneDEnLCAnMTYnKTtcbiAgICBsaW5lMi5zZXRBdHRyaWJ1dGUoJ3kxJywgJzE3Jyk7XG4gICAgbGluZTIuc2V0QXR0cmlidXRlKCd4MicsICc4Jyk7XG4gICAgbGluZTIuc2V0QXR0cmlidXRlKCd5MicsICcxNycpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChsaW5lMik7XG4gICAgXG4gICAgY29uc3QgcG9seWxpbmUyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdwb2x5bGluZScpO1xuICAgIHBvbHlsaW5lMi5zZXRBdHRyaWJ1dGUoJ3BvaW50cycsICcxMCw5IDksOSA4LDknKTtcbiAgICBzdmcuYXBwZW5kQ2hpbGQocG9seWxpbmUyKTtcbiAgICBcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3ZnKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRm9yd2FyZEljb24oY29udGFpbmVyOiBIVE1MRWxlbWVudCk6IHZvaWQge1xuICAgIGNvbnN0IHN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnc3ZnJyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCAnMjQnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCAnMjQnKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCd2aWV3Qm94JywgJzAgMCAyNCAyNCcpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAnbm9uZScpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsICdjdXJyZW50Q29sb3InKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCAnMicpO1xuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1saW5lY2FwJywgJ3JvdW5kJyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLWxpbmVqb2luJywgJ3JvdW5kJyk7XG4gICAgc3ZnLmNsYXNzTGlzdC5hZGQoJ3N2Zy1pY29uJywgJ2x1Y2lkZS1mb3J3YXJkJyk7XG4gICAgXG4gICAgY29uc3QgcG9seWxpbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3BvbHlsaW5lJyk7XG4gICAgcG9seWxpbmUuc2V0QXR0cmlidXRlKCdwb2ludHMnLCAnMTUgMTcgMjAgMTIgMTUgNycpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChwb2x5bGluZSk7XG4gICAgXG4gICAgY29uc3QgcGF0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAncGF0aCcpO1xuICAgIHBhdGguc2V0QXR0cmlidXRlKCdkJywgJ000IDE4di0yYTQgNCAwIDAgMSA0LTRoMTInKTtcbiAgICBzdmcuYXBwZW5kQ2hpbGQocGF0aCk7XG4gICAgXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHN2Zyk7XG4gIH1cblxuICBwcml2YXRlIGlzVXNpbmdDdXN0b21Qcm9wZXJ0eShmaWxlOiBURmlsZSk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGNhY2hlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7XG4gICAgY29uc3QgZnJvbnRtYXR0ZXIgPSBjYWNoZT8uZnJvbnRtYXR0ZXI7XG4gICAgY29uc3QgcHJvcGVydHlWYWx1ZSA9IGZyb250bWF0dGVyPy5bdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvcGVydHlLZXldIGFzIHVua25vd247XG4gICAgaWYgKHByb3BlcnR5VmFsdWUgPT09IHVuZGVmaW5lZCB8fCBwcm9wZXJ0eVZhbHVlID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IHN0clZhbHVlID0gdHlwZW9mIHByb3BlcnR5VmFsdWUgPT09ICdzdHJpbmcnID8gcHJvcGVydHlWYWx1ZSA6ICh0eXBlb2YgcHJvcGVydHlWYWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHByb3BlcnR5VmFsdWUgPT09ICdib29sZWFuJyA/IFN0cmluZyhwcm9wZXJ0eVZhbHVlKSA6ICcnKTtcbiAgICByZXR1cm4gc3RyVmFsdWUudHJpbSgpICE9PSAnJztcbiAgfVxuXG4gIHByaXZhdGUgaXNVc2luZ0FsaWFzKGZpbGU6IFRGaWxlKTogYm9vbGVhbiB7XG4gICAgLy8gQ2hlY2sgaWYgdGhpcyBmaWxlIGhhcyBhbGlhc2VzIGFuZCBpZiB3ZSdyZSBjdXJyZW50bHkgc2VhcmNoaW5nXG4gICAgY29uc3QgY2FjaGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcbiAgICBjb25zdCBmcm9udG1hdHRlciA9IGNhY2hlPy5mcm9udG1hdHRlcjtcbiAgICBjb25zdCBhbGlhc2VzID0gZnJvbnRtYXR0ZXI/LmFsaWFzZXMgYXMgdW5rbm93bjtcbiAgICBcbiAgICBpZiAoIWFsaWFzZXMpIHJldHVybiBmYWxzZTtcbiAgICBcbiAgICAvLyBGb3Igbm93LCBzaG93IGFsaWFzIGljb24gaWYgdGhlIGZpbGUgaGFzIGFsaWFzZXMgYW5kIHdlJ3JlIG5vdCB1c2luZyBhIGN1c3RvbSBwcm9wZXJ0eVxuICAgIGNvbnN0IGlzVXNpbmdDdXN0b21Qcm9wZXJ0eSA9IHRoaXMuaXNVc2luZ0N1c3RvbVByb3BlcnR5KGZpbGUpO1xuICAgIHJldHVybiAhaXNVc2luZ0N1c3RvbVByb3BlcnR5ICYmIEJvb2xlYW4oYWxpYXNlcyk7XG4gIH1cblxuICBzZWxlY3RTdWdnZXN0aW9uKHN1Z2dlc3Rpb246IFN1Z2dlc3Rpb25JdGVtLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgLy8gRG9uJ3QgZG8gYW55dGhpbmcgZm9yIFwiTm8gbWF0Y2ggZm91bmRcIlxuICAgIGlmIChzdWdnZXN0aW9uLmlzTm9NYXRjaCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICBpZiAoIWFjdGl2ZVZpZXcgfHwgIXRoaXMuY29udGV4dCkgcmV0dXJuO1xuICAgIGNvbnN0IGVkaXRvciA9IGFjdGl2ZVZpZXcuZWRpdG9yO1xuICAgIGNvbnN0IHsgc3RhcnQsIGVuZCB9ID0gdGhpcy5jb250ZXh0O1xuICAgIGNvbnN0IGxpbmUgPSBlZGl0b3IuZ2V0TGluZShzdGFydC5saW5lKTtcbiAgICBsZXQgZW5kUG9zID0gZW5kO1xuICAgIGlmIChsaW5lLnNsaWNlKGVuZC5jaCwgZW5kLmNoICsgMikgPT09ICddXScpIHtcbiAgICAgIGVuZFBvcyA9IHsgbGluZTogZW5kLmxpbmUsIGNoOiBlbmQuY2ggKyAyIH07XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBleGlzdGluZyBmaWxlXG4gICAgaWYgKCFzdWdnZXN0aW9uLmZpbGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgdmF1bHQgPSB0aGlzLmFwcC52YXVsdCBhcyB1bmtub3duIGFzIFZhdWx0SW50ZXJuYWw7XG4gICAgY29uc3QgdXNlTWFya2Rvd25MaW5rcyA9IHZhdWx0LmdldENvbmZpZz8uKCd1c2VNYXJrZG93bkxpbmtzJykgPz8gZmFsc2U7XG4gICAgbGV0IGxpbmtUZXh0OiBzdHJpbmc7XG5cbiAgICAvLyBPbmx5IGFkZCBkaXNwbGF5IHRleHQgaWYgdGhlIG5vdGUgaGFzIHRoZSBjdXN0b20gcHJvcGVydHlcbiAgICAvLyBPdGhlcndpc2UsIHVzZSBkZWZhdWx0IE9ic2lkaWFuIGJlaGF2aW9yIChubyBkaXNwbGF5IHRleHQpXG4gICAgaWYgKHN1Z2dlc3Rpb24uaXNDdXN0b21EaXNwbGF5KSB7XG4gICAgICBpZiAodXNlTWFya2Rvd25MaW5rcykge1xuICAgICAgICBsaW5rVGV4dCA9IGBbJHtzdWdnZXN0aW9uLmRpc3BsYXl9XSgke2VuY29kZVVSSShzdWdnZXN0aW9uLmZpbGUucGF0aCl9KWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBsaW5rUGF0aCA9IHN1Z2dlc3Rpb24uZmlsZS5wYXRoLnJlcGxhY2UoJy5tZCcsICcnKTtcbiAgICAgICAgbGlua1RleHQgPSBgW1ske2xpbmtQYXRofXwke3N1Z2dlc3Rpb24uZGlzcGxheX1dXWA7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIERlZmF1bHQgT2JzaWRpYW4gYmVoYXZpb3IgLSBubyBkaXNwbGF5IHRleHRcbiAgICAgIGlmICh1c2VNYXJrZG93bkxpbmtzKSB7XG4gICAgICAgIGxpbmtUZXh0ID0gYFske3N1Z2dlc3Rpb24uZmlsZS5wYXRoLnJlcGxhY2UoJy5tZCcsICcnKX1dKCR7ZW5jb2RlVVJJKHN1Z2dlc3Rpb24uZmlsZS5wYXRoKX0pYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGxpbmtQYXRoID0gc3VnZ2VzdGlvbi5maWxlLnBhdGgucmVwbGFjZSgnLm1kJywgJycpO1xuICAgICAgICBsaW5rVGV4dCA9IGBbWyR7bGlua1BhdGh9XV1gO1xuICAgICAgfVxuICAgIH1cbiAgICBlZGl0b3IucmVwbGFjZVJhbmdlKGxpbmtUZXh0LCB7IGxpbmU6IHN0YXJ0LmxpbmUsIGNoOiBzdGFydC5jaCB9LCBlbmRQb3MpO1xuICAgIGNvbnN0IG5ld0N1cnNvclBvcyA9IHN0YXJ0LmNoICsgbGlua1RleHQubGVuZ3RoO1xuICAgIHRyeSB7XG4gICAgICBlZGl0b3Iuc2V0Q3Vyc29yKHsgbGluZTogc3RhcnQubGluZSwgY2g6IG5ld0N1cnNvclBvcyB9KTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIG5ldyBOb3RpY2UoJ0Vycm9yIHNldHRpbmcgY3Vyc29yIHBvc2l0aW9uLiBQbGVhc2UgY2hlY2sgY29uc29sZSBmb3IgZGV0YWlscy4nKTtcbiAgICB9XG4gIH1cbiAgXG4gIHByaXZhdGUgZ2V0UXVpY2tTd2l0Y2hlck9wdGlvbnMoKTogUXVpY2tTd2l0Y2hlclBsdWdpbkluc3RhbmNlWydvcHRpb25zJ10gfCBudWxsIHtcbiAgICB0cnkge1xuICAgICAgLy8gQWNjZXNzIHRoZSBpbnRlcm5hbCBRdWljayBTd2l0Y2hlciBwbHVnaW4gdGhlIHNhbWUgd2F5IFF1aWNrIFN3aXRjaCArKyBkb2VzXG4gICAgICBjb25zdCBpbnRlcm5hbFBsdWdpbnMgPSAodGhpcy5hcHAgYXMgdW5rbm93biBhcyBBcHBJbnRlcm5hbCkuaW50ZXJuYWxQbHVnaW5zO1xuICAgICAgaWYgKCFpbnRlcm5hbFBsdWdpbnMpIHJldHVybiBudWxsO1xuICAgICAgXG4gICAgICBjb25zdCBzd2l0Y2hlclBsdWdpbiA9IGludGVybmFsUGx1Z2lucy5nZXRQbHVnaW5CeUlkPy4oJ3N3aXRjaGVyJyk7XG4gICAgICBpZiAoIXN3aXRjaGVyUGx1Z2luIHx8ICFzd2l0Y2hlclBsdWdpbi5pbnN0YW5jZSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHN3aXRjaGVyUGx1Z2luLmluc3RhbmNlLm9wdGlvbnMgfHwgbnVsbDtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxufSIsICJpbXBvcnQgeyBBcHAsIFBsdWdpblNldHRpbmdUYWIgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBQcm9wZXJ0eU92ZXJGaWxlTmFtZVBsdWdpbiB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IGNyZWF0ZVNldHRpbmdzR3JvdXAgfSBmcm9tICcuLi91dGlscy9zZXR0aW5ncy1jb21wYXQnO1xuXG5leHBvcnQgY2xhc3MgU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICBwbHVnaW46IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luO1xuICBwdWJsaWMgaWNvbiA9ICdsdWNpZGUtdHlwZSc7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogUHJvcGVydHlPdmVyRmlsZU5hbWVQbHVnaW4pIHtcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBkaXNwbGF5KCk6IHZvaWQge1xuICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcblxuICAgIC8vIEFkZCBzY29waW5nIGNsYXNzIHRvIHByZXZlbnQgQ1NTIGZyb20gYWZmZWN0aW5nIG90aGVyIHNldHRpbmdzXG4gICAgY29udGFpbmVyRWwuYWRkQ2xhc3MoJ3Byb3BlcnR5LW92ZXItZmlsZW5hbWUtc2V0dGluZ3MnKTtcblxuICAgIC8vIENyZWF0ZSBhIHNpbmdsZSBzZXR0aW5ncyBncm91cCB3aXRoIG5vIGhlYWRpbmcgKGZvbGxvd2luZyBVSSBUd2Vha2VyIHBhdHRlcm4pXG4gICAgY29uc3QgZ2VuZXJhbEdyb3VwID0gY3JlYXRlU2V0dGluZ3NHcm91cChjb250YWluZXJFbCwgdW5kZWZpbmVkLCAncHJvcGVydHktb3Zlci1maWxlLW5hbWUnKTtcblxuICAgIGdlbmVyYWxHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XG4gICAgICBzZXR0aW5nXG4gICAgICAgIC5zZXROYW1lKCdQcm9wZXJ0eSBrZXknKVxuICAgICAgICAuc2V0RGVzYygnVGhlIHByb3BlcnR5IHRvIHVzZSBhcyB0aGUgZGlzcGxheSB0aXRsZS4gRmFsbHMgYmFjayB0byB0aGUgZmlsZSBuYW1lIHdoZW4gbm8gcHJvcGVydHkgaXMgc2V0IGZvciB0aGF0IGl0ZW0uJylcbiAgICAgICAgLmFkZFRleHQoKHRleHQpID0+XG4gICAgICAgICAgdGV4dFxuICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdUaXRsZScpXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvcGVydHlLZXkpXG4gICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnByb3BlcnR5S2V5ID0gdmFsdWUudHJpbSgpIHx8ICd0aXRsZSc7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMucGx1Z2luLnNldHRpbmdzKTtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4udXBkYXRlTGlua1N1Z2dlc3RlcigpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi51cGRhdGVHcmFwaFZpZXcoKTtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4udXBkYXRlQmFja2xpbmtzKCk7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnVwZGF0ZVRhYnMoKTtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4udXBkYXRlRXhwbG9yZXIoKTtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4udXBkYXRlV2luZG93RnJhbWUoKTtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4udXBkYXRlQm9va21hcmtzKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH0pO1xuXG4gICAgZ2VuZXJhbEdyb3VwLmFkZFNldHRpbmcoKHNldHRpbmcpID0+IHtcbiAgICAgIHNldHRpbmdcbiAgICAgICAgLnNldE5hbWUoJ1doZW4gbGlua2luZyBub3RlcycpXG4gICAgICAgIC5zZXREZXNjKCdFbmFibGUgcHJvcGVydHktYmFzZWQgdGl0bGVzIGluIHRoZSBsaW5rIHN1Z2dlc3Rlci4nKVxuICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XG4gICAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yTGlua2luZylcbiAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yTGlua2luZyA9IHZhbHVlO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlRGF0YSh0aGlzLnBsdWdpbi5zZXR0aW5ncyk7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnVwZGF0ZUxpbmtTdWdnZXN0ZXIoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfSk7XG5cbiAgICBnZW5lcmFsR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xuICAgICAgc2V0dGluZ1xuICAgICAgICAuc2V0TmFtZSgnSW4gcXVpY2sgc3dpdGNoZXInKVxuICAgICAgICAuc2V0RGVzYygnRW5hYmxlIHByb3BlcnR5LWJhc2VkIHRpdGxlcyBpbiB0aGUgcXVpY2sgc3dpdGNoZXIuJylcbiAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICAgIHRvZ2dsZVxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvclF1aWNrU3dpdGNoZXIpXG4gICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHByZXZRdWlja1N3aXRjaGVyU3RhdGUgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JRdWlja1N3aXRjaGVyO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JRdWlja1N3aXRjaGVyID0gdmFsdWU7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncyhwcmV2UXVpY2tTd2l0Y2hlclN0YXRlKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfSk7XG5cbiAgICBnZW5lcmFsR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xuICAgICAgc2V0dGluZ1xuICAgICAgICAuc2V0TmFtZSgnSW5jbHVkZSBmaWxlIG5hbWUgaW4gZnV6enkgc2VhcmNoZXMnKVxuICAgICAgICAuc2V0RGVzYygnSW5jbHVkZSBub3RlIGZpbGUgbmFtZXMgaW4gZnV6enkgc2VhcmNoIHJlc3VsdHMgZm9yIGxpbmsgc3VnZ2VzdGVyIGFuZCBxdWljayBzd2l0Y2hlci4nKVxuICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XG4gICAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuaW5jbHVkZUZpbGVuYW1lSW5TZWFyY2gpXG4gICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmluY2x1ZGVGaWxlbmFtZUluU2VhcmNoID0gdmFsdWU7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMucGx1Z2luLnNldHRpbmdzKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfSk7XG5cbiAgICBnZW5lcmFsR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xuICAgICAgc2V0dGluZ1xuICAgICAgICAuc2V0TmFtZSgnSW5jbHVkZSBhbGlhc2VzIGluIGZ1enp5IHNlYXJjaGVzJylcbiAgICAgICAgLnNldERlc2MoJ0luY2x1ZGUgcHJvcGVydHkgYWxpYXNlcyBpbiBmdXp6eSBzZWFyY2ggcmVzdWx0cyBmb3IgbGluayBzdWdnZXN0ZXIgYW5kIHF1aWNrIHN3aXRjaGVyLicpXG4gICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cbiAgICAgICAgICB0b2dnbGVcbiAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5pbmNsdWRlQWxpYXNlc0luU2VhcmNoKVxuICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5pbmNsdWRlQWxpYXNlc0luU2VhcmNoID0gdmFsdWU7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMucGx1Z2luLnNldHRpbmdzKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfSk7XG5cbiAgICBnZW5lcmFsR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xuICAgICAgc2V0dGluZ1xuICAgICAgICAuc2V0TmFtZSgnV2hlbiBkcmFnZ2luZyBub3RlcycpXG4gICAgICAgIC5zZXREZXNjKCdVc2UgcHJvcGVydHktYmFzZWQgdGl0bGVzIHdoZW4gZHJhZ2dpbmcgbm90ZXMgZnJvbSB0aGUgZmlsZSBleHBsb3Jlci4nKVxuICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XG4gICAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yRHJhZ0Ryb3ApXG4gICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckRyYWdEcm9wID0gdmFsdWU7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMucGx1Z2luLnNldHRpbmdzKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfSk7XG5cbiAgICBnZW5lcmFsR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xuICAgICAgc2V0dGluZ1xuICAgICAgICAuc2V0TmFtZSgnV2hlbiBuYW1pbmcgYm9va21hcmtzJylcbiAgICAgICAgLnNldERlc2MoJ0F1dG9tYXRpY2FsbHkgdXNlIHRoZSBjb25maWd1cmVkIHByb3BlcnR5IHZhbHVlIGFzIHRoZSBkZWZhdWx0IG5hbWUgd2hlbiBjcmVhdGluZyBhIGJvb2ttYXJrLicpXG4gICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cbiAgICAgICAgICB0b2dnbGVcbiAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JCb29rbWFya3MpXG4gICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckJvb2ttYXJrcyA9IHZhbHVlO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlRGF0YSh0aGlzLnBsdWdpbi5zZXR0aW5ncyk7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnVwZGF0ZUJvb2ttYXJrcygpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICB9KTtcblxuICAgIGdlbmVyYWxHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XG4gICAgICBzZXR0aW5nXG4gICAgICAgIC5zZXROYW1lKCdJbiBncmFwaCB2aWV3JylcbiAgICAgICAgLnNldERlc2MoJ1VzZSB0aGUgcHJvcGVydHkgaW5zdGVhZCBvZiB0aGUgZmlsZSBuYW1lIGFzIHRoZSBub3RlXFwncyB0aXRsZSBpbiBncmFwaCB2aWV3LicpXG4gICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cbiAgICAgICAgICB0b2dnbGVcbiAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JHcmFwaFZpZXcpXG4gICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckdyYXBoVmlldyA9IHZhbHVlO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfSk7XG5cbiAgICBnZW5lcmFsR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xuICAgICAgc2V0dGluZ1xuICAgICAgICAuc2V0TmFtZSgnSW4gYmFja2xpbmtzIGFuZCBvdXRnb2luZyBsaW5rcycpXG4gICAgICAgIC5zZXREZXNjKCdVc2UgdGhlIHByb3BlcnR5IGluc3RlYWQgb2YgdGhlIGZpbGUgbmFtZSBpbiB0aGUgbGlua2VkIG1lbnRpb25zIGZvb3RlciwgZGVkaWNhdGVkIGJhY2tsaW5rcyBwYW5lbCwgYW5kIG91dGdvaW5nIGxpbmtzLicpXG4gICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cbiAgICAgICAgICB0b2dnbGVcbiAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JCYWNrbGlua3MpXG4gICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckJhY2tsaW5rcyA9IHZhbHVlO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlRGF0YSh0aGlzLnBsdWdpbi5zZXR0aW5ncyk7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnVwZGF0ZUJhY2tsaW5rcygpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICB9KTtcblxuICAgIGdlbmVyYWxHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XG4gICAgICBzZXR0aW5nXG4gICAgICAgIC5zZXROYW1lKCdJbiB0YWIgdGl0bGVzJylcbiAgICAgICAgLnNldERlc2MoJ1VzZSB0aGUgcHJvcGVydHkgaW5zdGVhZCBvZiB0aGUgZmlsZSBuYW1lIGluIHRhYiB0aXRsZXMuJylcbiAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICAgIHRvZ2dsZVxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvclRhYnMpXG4gICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHByZXZUYWJTdGF0ZSA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvclRhYnM7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvclRhYnMgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKHVuZGVmaW5lZCwgcHJldlRhYlN0YXRlKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfSk7XG5cbiAgICBnZW5lcmFsR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xuICAgICAgc2V0dGluZ1xuICAgICAgICAuc2V0TmFtZSgnSW4gd2luZG93IGZyYW1lIHRpdGxlJylcbiAgICAgICAgLnNldERlc2MoJ1VzZSB0aGUgcHJvcGVydHkgaW5zdGVhZCBvZiB0aGUgZmlsZSBuYW1lIGluIHRoZSBicm93c2VyIHdpbmRvdyB0aXRsZSBiYXIuJylcbiAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICAgIHRvZ2dsZVxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvcldpbmRvd0ZyYW1lKVxuICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JXaW5kb3dGcmFtZSA9IHZhbHVlO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlRGF0YSh0aGlzLnBsdWdpbi5zZXR0aW5ncyk7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnVwZGF0ZVdpbmRvd0ZyYW1lKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH0pO1xuXG4gICAgZ2VuZXJhbEdyb3VwLmFkZFNldHRpbmcoKHNldHRpbmcpID0+IHtcbiAgICAgIHNldHRpbmdcbiAgICAgICAgLnNldE5hbWUoJ0luIGZpbGUgZXhwbG9yZXInKVxuICAgICAgICAuc2V0RGVzYygnVXNlIHRoZSBwcm9wZXJ0eSBpbnN0ZWFkIG9mIHRoZSBmaWxlIG5hbWUgaW4gdGhlIGZpbGUgZXhwbG9yZXIuJylcbiAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICAgIHRvZ2dsZVxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckV4cGxvcmVyKVxuICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JFeHBsb3JlciA9IHZhbHVlO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlRGF0YSh0aGlzLnBsdWdpbi5zZXR0aW5ncyk7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnVwZGF0ZUV4cGxvcmVyKCk7XG4gICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpOyAvLyBSZWZyZXNoIHRvIHNob3cvaGlkZSBmb2xkZXIgbm90ZSBzZXR0aW5nXG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH0pO1xuXG4gICAgLy8gU2hvdyBmb2xkZXIgbm90ZSBmaWxlIG5hbWUgc2V0dGluZyBvbmx5IGlmIGV4cGxvcmVyIGlzIGVuYWJsZWRcbiAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yRXhwbG9yZXIpIHtcbiAgICAgIGdlbmVyYWxHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XG4gICAgICAgIHNldHRpbmdcbiAgICAgICAgICAuc2V0TmFtZSgnRm9sZGVyIG5vdGUgZmlsZSBuYW1lJylcbiAgICAgICAgICAuc2V0RGVzYygnSWYgYSBmb2xkZXIgY29udGFpbnMgYSBmaWxlIHdpdGggdGhpcyBuYW1lIHRoYXQgaGFzIHRoZSBjb25maWd1cmVkIHByb3BlcnR5LCB0aGUgZm9sZGVyIHdpbGwgZGlzcGxheSB0aGF0IHByb3BlcnR5IHZhbHVlIGluc3RlYWQuIFRoaXMgZW5zdXJlcyBjb21wYXRpYmlsaXR5IHdpdGggZm9sZGVyIG5vdGVzIHBsdWdpbnMuIExlYXZlIGJsYW5rIHRvIGRpc2FibGUuJylcbiAgICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT5cbiAgICAgICAgICAgIHRleHRcbiAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdJbmRleCcpXG4gICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5mb2xkZXJOb3RlRmlsZW5hbWUpXG4gICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mb2xkZXJOb3RlRmlsZW5hbWUgPSB2YWx1ZS50cmltKCk7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZURhdGEodGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xuICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnVwZGF0ZUV4cGxvcmVyKCk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGdlbmVyYWxHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XG4gICAgICBzZXR0aW5nXG4gICAgICAgIC5zZXROYW1lKCdVc2Ugc2ltcGxlIHNlYXJjaCcpXG4gICAgICAgIC5zZXREZXNjKCdJbnN0ZWFkIG9mIHVzaW5nIGZ1enp5IHNlYXJjaCwgc2ltcGxlIHNlYXJjaCBwcm92aWRlcyBiZXR0ZXIgcGVyZm9ybWFuY2Ugd2l0aCB2ZXJ5IGxhcmdlIHZhdWx0cyAodGhvdXNhbmRzIG9mIGZpbGVzKS4nKVxuICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XG4gICAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MudXNlU2ltcGxlU2VhcmNoKVxuICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy51c2VTaW1wbGVTZWFyY2ggPSB2YWx1ZTtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZURhdGEodGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICB9KTtcblxuICAgIGdlbmVyYWxHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XG4gICAgICBzZXR0aW5nXG4gICAgICAgIC5zZXROYW1lKCdFbmFibGUgTWR4IGZpbGUgc3VwcG9ydCcpXG4gICAgICAgIC5zZXREZXNjKCdFbmFibGUgc3VwcG9ydCBmb3IgLm1keCBmaWxlcy4gV2hlbiBlbmFibGVkLCB0aGUgcGx1Z2luIHdpbGwgcmVhZCBwcm9wZXJ0aWVzIGZyb20gTWR4IGZpbGVzIG1hbnVhbGx5IChPYnNpZGlhblxcJ3MgbWV0YWRhdGEgY2FjaGUgb25seSB3b3JrcyBmb3IgLm1kIGZpbGVzKS4gTm90ZTogTWR4IHN1cHBvcnQgaXMgcGFydGlhbCAtIGdyYXBoIHZpZXcgaXMgbm90IHN1cHBvcnRlZCBkdWUgdG8gdGVjaG5pY2FsIGxpbWl0YXRpb25zLicpXG4gICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cbiAgICAgICAgICB0b2dnbGVcbiAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVNZHhTdXBwb3J0KVxuICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVNZHhTdXBwb3J0ID0gdmFsdWU7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAvLyBSZWJ1aWxkIGNhY2hlIGFuZCByZWZyZXNoIGFsbCBjb21wb25lbnRzIHdoZW4gTURYIHN1cHBvcnQgaXMgdG9nZ2xlZFxuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5yZWJ1aWxkQ2FjaGUoKTtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4udXBkYXRlTGlua1N1Z2dlc3RlcigpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi51cGRhdGVRdWlja1N3aXRjaGVyKCk7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnVwZGF0ZUdyYXBoVmlldygpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi51cGRhdGVCYWNrbGlua3MoKTtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4udXBkYXRlVGFicygpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi51cGRhdGVFeHBsb3JlcigpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi51cGRhdGVXaW5kb3dGcmFtZSgpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi51cGRhdGVCb29rbWFya3MoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfSk7XG4gIH1cbn1cbiIsICIvKipcclxuICogQ29tcGF0aWJpbGl0eSB1dGlsaXRpZXMgZm9yIHNldHRpbmdzXHJcbiAqIFByb3ZpZGVzIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgZm9yIFNldHRpbmdHcm91cCAocmVxdWlyZXMgQVBJIDEuMTEuMCspXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgU2V0dGluZywgcmVxdWlyZUFwaVZlcnNpb24gfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCAqIGFzIE9ic2lkaWFuTW9kdWxlIGZyb20gJ29ic2lkaWFuJztcclxuXHJcbi8qKlxyXG4gKiBJbnRlcmZhY2UgdGhhdCB3b3JrcyB3aXRoIGJvdGggU2V0dGluZ0dyb3VwIGFuZCBmYWxsYmFjayBjb250YWluZXJcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgU2V0dGluZ3NDb250YWluZXIge1xyXG5cdGFkZFNldHRpbmcoY2I6IChzZXR0aW5nOiBTZXR0aW5nKSA9PiB2b2lkKTogdm9pZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZXMgYSBzZXR0aW5ncyBjb250YWluZXIgdGhhdCB1c2VzIFNldHRpbmdHcm91cCBpZiBhdmFpbGFibGUgKEFQSSAxLjExLjArKSxcclxuICogb3RoZXJ3aXNlIGZhbGxzIGJhY2sgdG8gY3JlYXRpbmcgYSBoZWFkaW5nIGFuZCB1c2luZyB0aGUgY29udGFpbmVyIGRpcmVjdGx5LlxyXG4gKiBcclxuICogVXNlcyByZXF1aXJlQXBpVmVyc2lvbignMS4xMS4wJykgdG8gY2hlY2sgaWYgU2V0dGluZ0dyb3VwIGlzIGF2YWlsYWJsZS5cclxuICogVGhpcyBpcyB0aGUgb2ZmaWNpYWwgT2JzaWRpYW4gQVBJIG1ldGhvZCBmb3IgdmVyc2lvbiBjaGVja2luZy5cclxuICogXHJcbiAqIEBwYXJhbSBjb250YWluZXJFbCAtIFRoZSBjb250YWluZXIgZWxlbWVudCBmb3Igc2V0dGluZ3NcclxuICogQHBhcmFtIGhlYWRpbmcgLSBUaGUgaGVhZGluZyB0ZXh0IGZvciB0aGUgc2V0dGluZ3MgZ3JvdXAgKG9wdGlvbmFsKVxyXG4gKiBAcGFyYW0gbWFuaWZlc3RJZCAtIFRoZSBwbHVnaW4ncyBtYW5pZmVzdCBJRCBmb3IgQ1NTIHNjb3BpbmcgKHJlcXVpcmVkIGZvciBmYWxsYmFjayBtb2RlKVxyXG4gKiBAcmV0dXJucyBBIGNvbnRhaW5lciB0aGF0IGNhbiBiZSB1c2VkIHRvIGFkZCBzZXR0aW5nc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNldHRpbmdzR3JvdXAoXHJcblx0Y29udGFpbmVyRWw6IEhUTUxFbGVtZW50LFxyXG5cdGhlYWRpbmc/OiBzdHJpbmcsXHJcblx0bWFuaWZlc3RJZD86IHN0cmluZ1xyXG4pOiBTZXR0aW5nc0NvbnRhaW5lciB7XHJcblx0Ly8gQ2hlY2sgaWYgU2V0dGluZ0dyb3VwIGlzIGF2YWlsYWJsZSAoQVBJIDEuMTEuMCspXHJcblx0Ly8gcmVxdWlyZUFwaVZlcnNpb24gaXMgdGhlIG9mZmljaWFsIE9ic2lkaWFuIEFQSSBtZXRob2QgZm9yIHZlcnNpb24gY2hlY2tpbmdcclxuXHRpZiAocmVxdWlyZUFwaVZlcnNpb24oJzEuMTEuMCcpKSB7XHJcblx0XHQvLyBVc2UgU2V0dGluZ0dyb3VwIC0gaXQncyBndWFyYW50ZWVkIHRvIGV4aXN0IGlmIHJlcXVpcmVBcGlWZXJzaW9uIHJldHVybnMgdHJ1ZVxyXG5cdFx0Ly8gQWNjZXNzIFNldHRpbmdHcm91cCB2aWEgdHlwZSBhc3NlcnRpb24gc2luY2UgaXQgbWF5IG5vdCBiZSBpbiB0eXBlIGRlZmluaXRpb25zXHJcblx0XHQvLyBmb3Igb2xkZXIgVHlwZVNjcmlwdCB2ZXJzaW9ucywgYnV0IGV4aXN0cyBhdCBydW50aW1lIGluIE9ic2lkaWFuIDEuMTEuMCtcclxuXHRcdC8vIFVzaW5nIHVua25vd24gaW5zdGVhZCBvZiBhbnkgdG8gc2F0aXNmeSBlc2xpbnQgd2hpbGUgbWFpbnRhaW5pbmcgdHlwZSBzYWZldHlcclxuXHRcdGNvbnN0IFNldHRpbmdHcm91cENsYXNzID0gKE9ic2lkaWFuTW9kdWxlIGFzIHVua25vd24gYXMgeyBTZXR0aW5nR3JvdXA/OiBuZXcgKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCkgPT4ge1xyXG5cdFx0XHRzZXRIZWFkaW5nKGhlYWRpbmc6IHN0cmluZyk6IHtcclxuXHRcdFx0XHRhZGRTZXR0aW5nKGNiOiAoc2V0dGluZzogU2V0dGluZykgPT4gdm9pZCk6IHZvaWQ7XHJcblx0XHRcdH07XHJcblx0XHRcdGFkZFNldHRpbmcoY2I6IChzZXR0aW5nOiBTZXR0aW5nKSA9PiB2b2lkKTogdm9pZDtcclxuXHRcdH0gfSkuU2V0dGluZ0dyb3VwO1xyXG5cdFx0XHJcblx0XHRpZiAoU2V0dGluZ0dyb3VwQ2xhc3MpIHtcclxuXHRcdFx0Y29uc3QgZ3JvdXAgPSBoZWFkaW5nIFxyXG5cdFx0XHRcdD8gbmV3IFNldHRpbmdHcm91cENsYXNzKGNvbnRhaW5lckVsKS5zZXRIZWFkaW5nKGhlYWRpbmcpXHJcblx0XHRcdFx0OiBuZXcgU2V0dGluZ0dyb3VwQ2xhc3MoY29udGFpbmVyRWwpO1xyXG5cdFx0XHRyZXR1cm4ge1xyXG5cdFx0XHRcdGFkZFNldHRpbmcoY2I6IChzZXR0aW5nOiBTZXR0aW5nKSA9PiB2b2lkKSB7XHJcblx0XHRcdFx0XHRncm91cC5hZGRTZXR0aW5nKGNiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH07XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8vIEZhbGxiYWNrIHBhdGggKGVpdGhlciBBUEkgPCAxLjExLjAgb3IgU2V0dGluZ0dyb3VwIG5vdCBmb3VuZClcclxuXHQvLyBBZGQgc2NvcGluZyBjbGFzcyB0byBjb250YWluZXJFbCB0byBzY29wZSBDU1MgdG8gb25seSB0aGlzIHBsdWdpbidzIHNldHRpbmdzXHJcblx0aWYgKG1hbmlmZXN0SWQpIHtcclxuXHRcdGNvbnRhaW5lckVsLmFkZENsYXNzKGAke21hbmlmZXN0SWR9LXNldHRpbmdzLWNvbXBhdGApO1xyXG5cdH1cclxuXHJcblx0e1xyXG5cdFx0Ly8gRmFsbGJhY2s6IENyZWF0ZSBhIGhlYWRpbmcgbWFudWFsbHkgZm9yIG9sZGVyIEFQSSB2ZXJzaW9uc1xyXG5cdFx0Ly8gTm90ZTogV2hpbGUgYmVzdCBwcmFjdGljZSBwcmVmZXJzIFNldHRpbmcuc2V0SGVhZGluZygpLCB0aGUgZmFsbGJhY2sgcGF0aFxyXG5cdFx0Ly8gaXMgZm9yIHZlcnNpb25zIHRoYXQgbWF5IG5vdCBzdXBwb3J0IGl0LCBzbyBtYW51YWwgaGVhZGluZyBpcyBhcHByb3ByaWF0ZSBoZXJlXHJcblx0XHRpZiAoaGVhZGluZykge1xyXG5cdFx0XHRjb25zdCBoZWFkaW5nRWwgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoJ3NldHRpbmctZ3JvdXAtaGVhZGluZycpO1xyXG5cdFx0XHRoZWFkaW5nRWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiBoZWFkaW5nIH0pO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRhZGRTZXR0aW5nKGNiOiAoc2V0dGluZzogU2V0dGluZykgPT4gdm9pZCkge1xyXG5cdFx0XHRcdGNvbnN0IHNldHRpbmcgPSBuZXcgU2V0dGluZyhjb250YWluZXJFbCk7XHJcblx0XHRcdFx0Y2Ioc2V0dGluZyk7XHJcblx0XHRcdH1cclxuXHRcdH07XHJcblx0fVxyXG59XHJcblxyXG4iLCAiaW1wb3J0IHsgTm90aWNlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcbmltcG9ydCB7IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luIH0gZnJvbSBcIi4uL3R5cGVzXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJDb21tYW5kcyhwbHVnaW46IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luKSB7XHJcbiAgLy8gUXVpY2sgU3dpdGNoZXIgY29tbWFuZFxyXG4gIHBsdWdpbi5hZGRDb21tYW5kKHtcclxuICAgIGlkOiAnb3Blbi1xdWljay1zd2l0Y2hlcicsXHJcbiAgICBuYW1lOiAnT3BlbiBxdWljayBzd2l0Y2hlciAocHJvcGVydHktYmFzZWQpJyxcclxuICAgIGNhbGxiYWNrOiBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHsgUXVpY2tTd2l0Y2hNb2RhbCB9ID0gYXdhaXQgaW1wb3J0KCcuLi91aS9RdWlja1N3aXRjaE1vZGFsJyk7XHJcbiAgICAgIG5ldyBRdWlja1N3aXRjaE1vZGFsKHBsdWdpbi5hcHAsIHBsdWdpbikub3BlbigpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICAvLyBUb2dnbGUgbGlua2luZyBjb21tYW5kXHJcbiAgcGx1Z2luLmFkZENvbW1hbmQoe1xyXG4gICAgaWQ6ICd0b2dnbGUtbGlua2luZycsXHJcbiAgICBuYW1lOiAnVG9nZ2xlIHByb3BlcnR5LWJhc2VkIGxpbmtpbmcnLFxyXG4gICAgY2FsbGJhY2s6IGFzeW5jICgpID0+IHtcclxuICAgICAgcGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckxpbmtpbmcgPSAhcGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckxpbmtpbmc7XHJcbiAgICAgIGF3YWl0IHBsdWdpbi5zYXZlRGF0YShwbHVnaW4uc2V0dGluZ3MpO1xyXG4gICAgICBwbHVnaW4udXBkYXRlTGlua1N1Z2dlc3RlcigpO1xyXG4gICAgICBuZXcgTm90aWNlKGBQcm9wZXJ0eS1iYXNlZCBsaW5raW5nICR7cGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckxpbmtpbmcgPyAnZW5hYmxlZCcgOiAnZGlzYWJsZWQnfWApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICAvLyBUb2dnbGUgUXVpY2sgU3dpdGNoZXIgY29tbWFuZFxyXG4gIHBsdWdpbi5hZGRDb21tYW5kKHtcclxuICAgIGlkOiAndG9nZ2xlLXF1aWNrLXN3aXRjaGVyJyxcclxuICAgIG5hbWU6ICdUb2dnbGUgcHJvcGVydHktYmFzZWQgcXVpY2sgc3dpdGNoZXInLFxyXG4gICAgY2FsbGJhY2s6IGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcHJldlN0YXRlID0gcGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvclF1aWNrU3dpdGNoZXI7XHJcbiAgICAgIHBsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JRdWlja1N3aXRjaGVyID0gIXBsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JRdWlja1N3aXRjaGVyO1xyXG4gICAgICBhd2FpdCBwbHVnaW4uc2F2ZVNldHRpbmdzKHByZXZTdGF0ZSk7XHJcbiAgICAgIG5ldyBOb3RpY2UoYFByb3BlcnR5LWJhc2VkIFF1aWNrIFN3aXRjaGVyICR7cGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvclF1aWNrU3dpdGNoZXIgPyAnZW5hYmxlZCcgOiAnZGlzYWJsZWQnfWApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICAvLyBSZWJ1aWxkIGNhY2hlIGNvbW1hbmRcclxuICBwbHVnaW4uYWRkQ29tbWFuZCh7XHJcbiAgICBpZDogJ3JlYnVpbGQtY2FjaGUnLFxyXG4gICAgbmFtZTogJ1JlYnVpbGQgZmlsZSBjYWNoZScsXHJcbiAgICBjYWxsYmFjazogKCkgPT4ge1xyXG4gICAgICBwbHVnaW4ucmVidWlsZENhY2hlKCk7XHJcbiAgICAgIG5ldyBOb3RpY2UoJ0ZpbGUgY2FjaGUgcmVidWlsdCcpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICAvLyBUb2dnbGUgZHJhZyBhbmQgZHJvcCBjb21tYW5kXHJcbiAgcGx1Z2luLmFkZENvbW1hbmQoe1xyXG4gICAgaWQ6ICd0b2dnbGUtZHJhZy1kcm9wJyxcclxuICAgIG5hbWU6ICdUb2dnbGUgcHJvcGVydHktYmFzZWQgZHJhZyBhbmQgZHJvcCcsXHJcbiAgICBjYWxsYmFjazogYXN5bmMgKCkgPT4ge1xyXG4gICAgICBwbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yRHJhZ0Ryb3AgPSAhcGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckRyYWdEcm9wO1xyXG4gICAgICBhd2FpdCBwbHVnaW4uc2F2ZURhdGEocGx1Z2luLnNldHRpbmdzKTtcclxuICAgICAgbmV3IE5vdGljZShgUHJvcGVydHktYmFzZWQgZHJhZyBhbmQgZHJvcCAke3BsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JEcmFnRHJvcCA/ICdlbmFibGVkJyA6ICdkaXNhYmxlZCd9YCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuIiwgImltcG9ydCB7IEFwcEludGVybmFsLCBQcm9wZXJ0eU92ZXJGaWxlTmFtZVBsdWdpbiwgV29ya3NwYWNlSW50ZXJuYWwgfSBmcm9tIFwiLi4vdHlwZXNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBRdWlja1N3aXRjaGVyU2VydmljZSB7XHJcbiAgcHJpdmF0ZSBwbHVnaW46IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luO1xyXG4gIHByaXZhdGUgb3JpZ2luYWxTd2l0Y2hlckNvbW1hbmQ/OiB7XHJcbiAgICBpZDogc3RyaW5nO1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAgaWNvbj86IHN0cmluZztcclxuICAgIGhvdGtleXM6IEFycmF5PHsgbW9kaWZpZXJzOiBzdHJpbmdbXTsga2V5OiBzdHJpbmcgfT47XHJcbiAgICBjYWxsYmFjazogKCkgPT4gdm9pZDtcclxuICB9O1xyXG4gIHByaXZhdGUgaXNDb21tYW5kT3ZlcnJpZGRlbiA9IGZhbHNlO1xyXG5cclxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luKSB7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICB9XHJcblxyXG4gIHVwZGF0ZVF1aWNrU3dpdGNoZXIoKSB7XHJcbiAgICAvLyBPbmx5IG92ZXJyaWRlIHRoZSBjb21tYW5kIGlmIG91ciBRdWljayBTd2l0Y2hlciBpcyBlbmFibGVkXHJcbiAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yUXVpY2tTd2l0Y2hlciAmJiAhdGhpcy5pc0NvbW1hbmRPdmVycmlkZGVuKSB7XHJcbiAgICAgIHRoaXMub3ZlcnJpZGVRdWlja1N3aXRjaGVyQ29tbWFuZCgpO1xyXG4gICAgfSBlbHNlIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yUXVpY2tTd2l0Y2hlciAmJiB0aGlzLmlzQ29tbWFuZE92ZXJyaWRkZW4pIHtcclxuICAgICAgLy8gUmVzdG9yZSBvcmlnaW5hbCBjb21tYW5kIHdoZW4gZGlzYWJsZWRcclxuICAgICAgdGhpcy5yZXN0b3JlT3JpZ2luYWxDb21tYW5kKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG92ZXJyaWRlUXVpY2tTd2l0Y2hlckNvbW1hbmQoKSB7XHJcbiAgICAvLyBHZXQgdGhlIGNvbW1hbmQgcmVnaXN0cnlcclxuICAgIGNvbnN0IGNvbW1hbmRzID0gKHRoaXMucGx1Z2luLmFwcCBhcyB1bmtub3duIGFzIEFwcEludGVybmFsKS5jb21tYW5kcy5jb21tYW5kcztcclxuXHJcbiAgICAvLyBTdG9yZSB0aGUgb3JpZ2luYWwgY29tbWFuZCBCRUZPUkUgd2UgZGVsZXRlIGl0XHJcbiAgICBpZiAoY29tbWFuZHNbJ3N3aXRjaGVyOm9wZW4nXSAmJiAhdGhpcy5vcmlnaW5hbFN3aXRjaGVyQ29tbWFuZCkge1xyXG4gICAgICBjb25zdCBvcmlnaW5hbENtZCA9IGNvbW1hbmRzWydzd2l0Y2hlcjpvcGVuJ107XHJcbiAgICAgIHRoaXMub3JpZ2luYWxTd2l0Y2hlckNvbW1hbmQgPSB7XHJcbiAgICAgICAgaWQ6IG9yaWdpbmFsQ21kLmlkIHx8ICdzd2l0Y2hlcjpvcGVuJyxcclxuICAgICAgICBuYW1lOiBvcmlnaW5hbENtZC5uYW1lIHx8ICdRdWljayBTd2l0Y2hlcicsXHJcbiAgICAgICAgaWNvbjogb3JpZ2luYWxDbWQuaWNvbixcclxuICAgICAgICBob3RrZXlzOiBvcmlnaW5hbENtZC5ob3RrZXlzID8gWy4uLm9yaWdpbmFsQ21kLmhvdGtleXNdIDogW10sXHJcbiAgICAgICAgY2FsbGJhY2s6IG9yaWdpbmFsQ21kLmNhbGxiYWNrXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmVtb3ZlIHRoZSBvcmlnaW5hbCBjb21tYW5kIGNvbXBsZXRlbHkgdG8gYXZvaWQgY29uZmxpY3RzXHJcbiAgICBpZiAoY29tbWFuZHNbJ3N3aXRjaGVyOm9wZW4nXSkge1xyXG4gICAgICBkZWxldGUgY29tbWFuZHNbJ3N3aXRjaGVyOm9wZW4nXTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgb3VyIGN1c3RvbSBjb21tYW5kIG9iamVjdFxyXG4gICAgY29uc3QgY3VzdG9tQ29tbWFuZCA9IHtcclxuICAgICAgaWQ6ICdzd2l0Y2hlcjpvcGVuJyxcclxuICAgICAgbmFtZTogJ1F1aWNrIFN3aXRjaGVyJyxcclxuICAgICAgaWNvbjogdGhpcy5vcmlnaW5hbFN3aXRjaGVyQ29tbWFuZD8uaWNvbixcclxuICAgICAgaG90a2V5czogW3sgbW9kaWZpZXJzOiBbXCJNb2RcIl0sIGtleTogXCJvXCIgfV0sXHJcbiAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XHJcbiAgICAgICAgLy8gUHJldmVudCBhbnkgZGVmYXVsdCBRdWljayBTd2l0Y2hlciBmcm9tIG9wZW5pbmdcclxuICAgICAgICBjb25zdCB3b3Jrc3BhY2UgPSB0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlIGFzIHVua25vd24gYXMgV29ya3NwYWNlSW50ZXJuYWwgJiB7IHN3aXRjaGVyPzogeyBjbG9zZSgpOiB2b2lkIH0gfTtcclxuICAgICAgICBpZiAod29ya3NwYWNlLnN3aXRjaGVyICYmIHR5cGVvZiB3b3Jrc3BhY2Uuc3dpdGNoZXIuY2xvc2UgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgIHdvcmtzcGFjZS5zd2l0Y2hlci5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvLyBVc2Ugb3VyIGN1c3RvbSBtb2RhbCB3aGVuIHRoaXMgY29tbWFuZCBpcyBhY3RpdmVcclxuICAgICAgICAvLyBDbG9zZSBhbnkgZXhpc3RpbmcgbW9kYWxzIGZpcnN0XHJcbiAgICAgICAgY29uc3QgZXhpc3RpbmdNb2RhbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW9kYWwnKTtcclxuICAgICAgICBleGlzdGluZ01vZGFscy5mb3JFYWNoKG1vZGFsID0+IHtcclxuICAgICAgICAgIGlmIChtb2RhbCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ICYmICFtb2RhbC5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpKSB7XHJcbiAgICAgICAgICAgIG1vZGFsLmFkZENsYXNzKCdoaWRkZW4nKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgaW1wb3J0KCcuLi91aS9RdWlja1N3aXRjaE1vZGFsJykudGhlbigoeyBRdWlja1N3aXRjaE1vZGFsIH0pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9kYWwgPSBuZXcgUXVpY2tTd2l0Y2hNb2RhbCh0aGlzLnBsdWdpbi5hcHAsIHRoaXMucGx1Z2luKTtcclxuICAgICAgICAgICAgbW9kYWwub3BlbigpO1xyXG4gICAgICAgICAgfSkuY2F0Y2goKCkgPT4ge1xyXG4gICAgICAgICAgICAvLyBGYWxsYmFjayB0byBvcmlnaW5hbCBjb21tYW5kIGlmIG91ciBtb2RhbCBmYWlsc1xyXG4gICAgICAgICAgICBpZiAodGhpcy5vcmlnaW5hbFN3aXRjaGVyQ29tbWFuZCAmJiB0aGlzLm9yaWdpbmFsU3dpdGNoZXJDb21tYW5kLmNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbFN3aXRjaGVyQ29tbWFuZC5jYWxsYmFjaygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9IGNhdGNoIHtcclxuICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIG9yaWdpbmFsIGNvbW1hbmQgaWYgb3VyIG1vZGFsIGZhaWxzXHJcbiAgICAgICAgICBpZiAodGhpcy5vcmlnaW5hbFN3aXRjaGVyQ29tbWFuZCAmJiB0aGlzLm9yaWdpbmFsU3dpdGNoZXJDb21tYW5kLmNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxTd2l0Y2hlckNvbW1hbmQuY2FsbGJhY2soKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gRGlyZWN0bHkgYXNzaWduIHRvIHRoZSBjb21tYW5kIHJlZ2lzdHJ5IGluc3RlYWQgb2YgdXNpbmcgYWRkQ29tbWFuZFxyXG4gICAgY29tbWFuZHNbJ3N3aXRjaGVyOm9wZW4nXSA9IGN1c3RvbUNvbW1hbmQ7XHJcblxyXG4gICAgdGhpcy5pc0NvbW1hbmRPdmVycmlkZGVuID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHJlc3RvcmVPcmlnaW5hbENvbW1hbmQoKSB7XHJcbiAgICBpZiAoIXRoaXMub3JpZ2luYWxTd2l0Y2hlckNvbW1hbmQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJlbW92ZSBvdXIgY29tbWFuZFxyXG4gICAgY29uc3QgY29tbWFuZHMgPSAodGhpcy5wbHVnaW4uYXBwIGFzIHVua25vd24gYXMgQXBwSW50ZXJuYWwpLmNvbW1hbmRzLmNvbW1hbmRzO1xyXG4gICAgaWYgKGNvbW1hbmRzWydzd2l0Y2hlcjpvcGVuJ10pIHtcclxuICAgICAgZGVsZXRlIGNvbW1hbmRzWydzd2l0Y2hlcjpvcGVuJ107XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmVzdG9yZSB0aGUgb3JpZ2luYWwgY29tbWFuZFxyXG4gICAgY29tbWFuZHNbJ3N3aXRjaGVyOm9wZW4nXSA9IHtcclxuICAgICAgaWQ6IHRoaXMub3JpZ2luYWxTd2l0Y2hlckNvbW1hbmQuaWQsXHJcbiAgICAgIG5hbWU6IHRoaXMub3JpZ2luYWxTd2l0Y2hlckNvbW1hbmQubmFtZSxcclxuICAgICAgaWNvbjogdGhpcy5vcmlnaW5hbFN3aXRjaGVyQ29tbWFuZC5pY29uLFxyXG4gICAgICBob3RrZXlzOiB0aGlzLm9yaWdpbmFsU3dpdGNoZXJDb21tYW5kLmhvdGtleXMsXHJcbiAgICAgIGNhbGxiYWNrOiB0aGlzLm9yaWdpbmFsU3dpdGNoZXJDb21tYW5kLmNhbGxiYWNrXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaXNDb21tYW5kT3ZlcnJpZGRlbiA9IGZhbHNlO1xyXG4gIH1cclxufVxyXG4iLCAiaW1wb3J0IHsgVEZpbGUsIE1hcmtkb3duVmlldywgRWRpdG9yIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBQcm9wZXJ0eU92ZXJGaWxlTmFtZVBsdWdpbiB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgZ2V0RnJvbnRtYXR0ZXJTeW5jIH0gZnJvbSBcIi4uL3V0aWxzL2Zyb250bWF0dGVyXCI7XG5cbmV4cG9ydCBjbGFzcyBEcmFnRHJvcFNlcnZpY2Uge1xuICBwcml2YXRlIHBsdWdpbjogUHJvcGVydHlPdmVyRmlsZU5hbWVQbHVnaW47XG4gIHByaXZhdGUgbGFzdERyb3BUaW1lOiBudW1iZXIgPSAwO1xuICBwcml2YXRlIGxhc3REcm9wRGF0YTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcmVhZG9ubHkgRFJPUF9ERUJPVU5DRV9NUyA9IDEwMDsgLy8gUHJldmVudCBkdXBsaWNhdGUgcHJvY2Vzc2luZyB3aXRoaW4gMTAwbXNcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBoYW5kbGVEcmFnRHJvcChldmVudDogRHJhZ0V2ZW50LCBlZGl0b3I6IEVkaXRvcik6IHZvaWQge1xuICAgIC8vIENSSVRJQ0FMOiBDYXB0dXJlIGRhdGFUcmFuc2ZlciBzeW5jaHJvbm91c2x5IGluIGEgbG9jYWwgdmFyaWFibGVcbiAgICAvLyBUaGUgZXZlbnQuZGF0YVRyYW5zZmVyIGNhbiBiZWNvbWUgbnVsbC91bmRlZmluZWQgYWZ0ZXIgdGhlIGV2ZW50IGhhbmRsZXIgY29tcGxldGVzLFxuICAgIC8vIHNvIHdlIG11c3QgY2FwdHVyZSBpdCBpbW1lZGlhdGVseSBhbmQgdXNlIHRoZSBsb2NhbCByZWZlcmVuY2VcbiAgICBjb25zdCBkYXRhVHJhbnNmZXIgPSBldmVudC5kYXRhVHJhbnNmZXI7XG4gICAgaWYgKCFkYXRhVHJhbnNmZXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBHZXQgdGhlIGZpbGUgcGF0aCBmcm9tIHRoZSBkcmFnIGV2ZW50IHN5bmNocm9ub3VzbHlcbiAgICAvLyBUaGlzIG11c3QgYmUgZG9uZSBkdXJpbmcgdGhlIGV2ZW50LCBub3QgaW4gc2V0VGltZW91dFxuICAgIC8vIFVzZSB0aGUgY2FwdHVyZWQgZGF0YVRyYW5zZmVyIHJlZmVyZW5jZSwgbm90IGV2ZW50LmRhdGFUcmFuc2ZlclxuICAgIGNvbnN0IGZpbGVQYXRoID0gZGF0YVRyYW5zZmVyLmdldERhdGEoJ3RleHQvcGxhaW4nKTtcbiAgICBcbiAgICBpZiAoIWZpbGVQYXRoIHx8ICghZmlsZVBhdGguZW5kc1dpdGgoJy5tZCcpICYmICEoZmlsZVBhdGguZW5kc1dpdGgoJy5tZHgnKSAmJiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVNZHhTdXBwb3J0KSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBQcmV2ZW50IGR1cGxpY2F0ZSBwcm9jZXNzaW5nIGlmIGJvdGggaGFuZGxlcnMgZmlyZSBmb3IgdGhlIHNhbWUgZHJvcFxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgaWYgKG5vdyAtIHRoaXMubGFzdERyb3BUaW1lIDwgdGhpcy5EUk9QX0RFQk9VTkNFX01TICYmIHRoaXMubGFzdERyb3BEYXRhID09PSBmaWxlUGF0aCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmxhc3REcm9wVGltZSA9IG5vdztcbiAgICB0aGlzLmxhc3REcm9wRGF0YSA9IGZpbGVQYXRoO1xuXG4gICAgLy8gRmluZCB0aGUgZmlsZSBpbiB0aGUgdmF1bHRcbiAgICBjb25zdCBmaWxlID0gdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG4gICAgaWYgKCFmaWxlIHx8ICEoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEZvciAubWQgZmlsZXMsIHVzZSBzeW5jaHJvbm91cyBsb2dpYyAoZmFzdCwgaW1tZWRpYXRlKVxuICAgIC8vIEZvciAubWR4IGZpbGVzLCB1c2UgYXN5bmMgbG9naWMgd2l0aCByZXRyaWVzIChuZWVkcyBmaWxlIHJlYWRpbmcpXG4gICAgaWYgKGZpbGUuZXh0ZW5zaW9uID09PSAnbWQnKSB7XG4gICAgICBjb25zdCBkaXNwbGF5TmFtZSA9IHRoaXMuZ2V0RGlzcGxheU5hbWVTeW5jKGZpbGUpO1xuICAgICAgaWYgKGRpc3BsYXlOYW1lICE9PSBudWxsKSB7XG4gICAgICAgIC8vIEltbWVkaWF0ZSByZXBsYWNlbWVudCBmb3IgLm1kIGZpbGVzIChubyByZXRyaWVzIG5lZWRlZClcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5yZXBsYWNlTGFzdEluc2VydGVkTGluayhmaWxlLCBkaXNwbGF5TmFtZSwgZWRpdG9yKTtcbiAgICAgICAgfSwgNTApOyAvLyBTaG9ydCBkZWxheSBqdXN0IHRvIGxldCBPYnNpZGlhbiBpbnNlcnQgdGhlIGxpbmsgZmlyc3RcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGZpbGUuZXh0ZW5zaW9uID09PSAnbWR4JyAmJiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVNZHhTdXBwb3J0KSB7XG4gICAgICAvLyBBc3luYyBsb2dpYyB3aXRoIHJldHJpZXMgZm9yIC5tZHggZmlsZXNcbiAgICAgIHZvaWQgKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZGlzcGxheU5hbWUgPSBhd2FpdCB0aGlzLmdldERpc3BsYXlOYW1lKGZpbGUpO1xuXG4gICAgICAgIGlmIChkaXNwbGF5TmFtZSAhPT0gbnVsbCkge1xuICAgICAgICAgIC8vIFVzZSBtdWx0aXBsZSBhdHRlbXB0cyB3aXRoIGluY3JlYXNpbmcgZGVsYXlzIHRvIGNhdGNoIHRoZSBsaW5rIGluc2VydGlvblxuICAgICAgICAgIGxldCBhdHRlbXB0cyA9IDA7XG4gICAgICAgICAgY29uc3QgbWF4QXR0ZW1wdHMgPSA1O1xuICAgICAgICAgIGNvbnN0IGF0dGVtcHRSZXBsYWNlID0gKCkgPT4ge1xuICAgICAgICAgICAgYXR0ZW1wdHMrKztcbiAgICAgICAgICAgIGNvbnN0IHJlcGxhY2VkID0gdGhpcy5yZXBsYWNlTGFzdEluc2VydGVkTGluayhmaWxlLCBkaXNwbGF5TmFtZSwgZWRpdG9yKTtcbiAgICAgICAgICAgIGlmICghcmVwbGFjZWQgJiYgYXR0ZW1wdHMgPCBtYXhBdHRlbXB0cykge1xuICAgICAgICAgICAgICBzZXRUaW1lb3V0KGF0dGVtcHRSZXBsYWNlLCA1MCAqIGF0dGVtcHRzKTsgLy8gSW5jcmVhc2luZyBkZWxheTogNTBtcywgMTAwbXMsIDE1MG1zLCBldGMuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgICBzZXRUaW1lb3V0KGF0dGVtcHRSZXBsYWNlLCAxNTApOyAvLyBTdGFydCBhZnRlciAxNTBtc1xuICAgICAgICB9XG4gICAgICB9KSgpO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZURPTURyb3AoZXZlbnQ6IERyYWdFdmVudCk6IHZvaWQge1xuICAgIC8vIENoZWNrIGlmIHdlJ3JlIGRyb3BwaW5nIG9uIGFuIGVkaXRvclxuICAgIC8vIFVzZSBtdWx0aXBsZSBtZXRob2RzIHRvIGRldGVjdCBlZGl0b3IgY29udGV4dCwgYXMgY2xvc2VzdCgpIGNhbiBmYWlsXG4gICAgLy8gd2hlbiBkcm9wcGluZyBvbiBjbS1saW5lIGVsZW1lbnRzIHRoYXQgYXJlbid0IGZ1bGx5IGF0dGFjaGVkIHRvIERPTSAobGFyZ2UgdmF1bHQgbGFnKVxuICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudDtcbiAgICBcbiAgICAvLyBNZXRob2QgMTogVHJ5IERPTSB0cmF2ZXJzYWwgKHdvcmtzIHdoZW4gZWxlbWVudCBpcyBmdWxseSBhdHRhY2hlZClcbiAgICBjb25zdCBlZGl0b3JFbGVtZW50ID0gdGFyZ2V0Py5jbG9zZXN0KCcuY20tZWRpdG9yJyk7XG4gICAgXG4gICAgLy8gTWV0aG9kIDI6IEZhbGxiYWNrIC0gY2hlY2sgaWYgdGhlcmUncyBhbiBhY3RpdmUgbWFya2Rvd24gdmlldyB3aXRoIGFuIGVkaXRvclxuICAgIC8vIFRoaXMgd29ya3MgZXZlbiB3aGVuIERPTSB0cmF2ZXJzYWwgZmFpbHMgZHVlIHRvIHRpbWluZy9sYWcgaXNzdWVzIGluIGxhcmdlIHZhdWx0c1xuICAgIGNvbnN0IGFjdGl2ZVZpZXcgPSB0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICBjb25zdCBoYXNBY3RpdmVFZGl0b3IgPSBhY3RpdmVWaWV3ICYmIGFjdGl2ZVZpZXcuZWRpdG9yO1xuICAgIFxuICAgIC8vIFdlIG5lZWQgYXQgbGVhc3Qgb25lIG9mIHRoZXNlIHRvIGJlIHRydWUgdG8gcHJvY2VlZFxuICAgIGlmICghZWRpdG9yRWxlbWVudCAmJiAhaGFzQWN0aXZlRWRpdG9yKSB7XG4gICAgICAvLyBOb3QgZHJvcHBpbmcgb24gYW4gZWRpdG9yIG9yIG5vIGFjdGl2ZSBlZGl0b3IgYXZhaWxhYmxlXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFxuICAgIC8vIElmIGNsb3Nlc3QoKSBmYWlsZWQgYnV0IHdlIGhhdmUgYW4gYWN0aXZlIGVkaXRvciwgd2UgY2FuIHN0aWxsIHByb2NlZWRcbiAgICAvLyBUaGUgYWN0aXZlVmlldy5lZGl0b3Igd2lsbCBiZSB1c2VkIGxhdGVyIGluIHRoZSBzZXRUaW1lb3V0XG5cbiAgICAvLyBDUklUSUNBTDogQ2FwdHVyZSBkYXRhVHJhbnNmZXIgc3luY2hyb25vdXNseSBpbiBhIGxvY2FsIHZhcmlhYmxlXG4gICAgLy8gVGhlIGV2ZW50LmRhdGFUcmFuc2ZlciBjYW4gYmVjb21lIG51bGwvdW5kZWZpbmVkIGFmdGVyIHRoZSBldmVudCBoYW5kbGVyIGNvbXBsZXRlcyxcbiAgICAvLyBzbyB3ZSBtdXN0IGNhcHR1cmUgaXQgaW1tZWRpYXRlbHkgYW5kIHVzZSB0aGUgbG9jYWwgcmVmZXJlbmNlXG4gICAgY29uc3QgZGF0YVRyYW5zZmVyID0gZXZlbnQuZGF0YVRyYW5zZmVyO1xuICAgIGlmICghZGF0YVRyYW5zZmVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gR2V0IHRoZSBmaWxlIHBhdGggZnJvbSB0aGUgZHJhZyBldmVudCBzeW5jaHJvbm91c2x5XG4gICAgLy8gVGhpcyBtdXN0IGJlIGRvbmUgZHVyaW5nIHRoZSBldmVudCwgbm90IGluIHNldFRpbWVvdXRcbiAgICAvLyBVc2UgdGhlIGNhcHR1cmVkIGRhdGFUcmFuc2ZlciByZWZlcmVuY2UsIG5vdCBldmVudC5kYXRhVHJhbnNmZXJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGRhdGFUcmFuc2Zlci5nZXREYXRhKCd0ZXh0L3BsYWluJyk7XG4gICAgXG4gICAgaWYgKCFmaWxlUGF0aCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFBhcnNlIE9ic2lkaWFuIFVSTCBmb3JtYXQ6IG9ic2lkaWFuOi8vb3Blbj92YXVsdD0uLi4mZmlsZT0uLi5cbiAgICBsZXQgYWN0dWFsRmlsZVBhdGggPSBmaWxlUGF0aDtcbiAgICBpZiAoZmlsZVBhdGguc3RhcnRzV2l0aCgnb2JzaWRpYW46Ly9vcGVuPycpKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKGZpbGVQYXRoKTtcbiAgICAgICAgY29uc3QgZmlsZVBhcmFtID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2ZpbGUnKTtcbiAgICAgICAgaWYgKGZpbGVQYXJhbSkge1xuICAgICAgICAgIGNvbnN0IGRlY29kZWRQYXRoID0gZGVjb2RlVVJJQ29tcG9uZW50KGZpbGVQYXJhbSk7XG4gICAgICAgICAgLy8gT2JzaWRpYW4gVVJMcyBtaWdodCBub3QgaW5jbHVkZSB0aGUgZXh0ZW5zaW9uXG4gICAgICAgICAgLy8gVHJ5IHRvIGZpbmQgdGhlIGZpbGUgd2l0aCBib3RoIC5tZCBhbmQgLm1keCBleHRlbnNpb25zXG4gICAgICAgICAgaWYgKGRlY29kZWRQYXRoLmVuZHNXaXRoKCcubWR4JykpIHtcbiAgICAgICAgICAgIC8vIEFscmVhZHkgaGFzIC5tZHggZXh0ZW5zaW9uXG4gICAgICAgICAgICBhY3R1YWxGaWxlUGF0aCA9IGRlY29kZWRQYXRoO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZGVjb2RlZFBhdGguZW5kc1dpdGgoJy5tZCcpKSB7XG4gICAgICAgICAgICAvLyBBbHJlYWR5IGhhcyAubWQgZXh0ZW5zaW9uXG4gICAgICAgICAgICBhY3R1YWxGaWxlUGF0aCA9IGRlY29kZWRQYXRoO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBObyBleHRlbnNpb24gLSB0cnkgLm1keCBmaXJzdCBpZiBNRFggc3VwcG9ydCBpcyBlbmFibGVkLCB0aGVuIGZhbGwgYmFjayB0byAubWRcbiAgICAgICAgICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVNZHhTdXBwb3J0KSB7XG4gICAgICAgICAgICAgIGNvbnN0IG1keEZpbGUgPSB0aGlzLnBsdWdpbi5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGRlY29kZWRQYXRoICsgJy5tZHgnKTtcbiAgICAgICAgICAgICAgaWYgKG1keEZpbGUpIHtcbiAgICAgICAgICAgICAgICBhY3R1YWxGaWxlUGF0aCA9IGRlY29kZWRQYXRoICsgJy5tZHgnO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFjdHVhbEZpbGVQYXRoID0gZGVjb2RlZFBhdGggKyAnLm1kJztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgYWN0dWFsRmlsZVBhdGggPSBkZWNvZGVkUGF0aCArICcubWQnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2gge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICghZmlsZVBhdGguZW5kc1dpdGgoJy5tZCcpICYmICEoZmlsZVBhdGguZW5kc1dpdGgoJy5tZHgnKSAmJiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVNZHhTdXBwb3J0KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFByZXZlbnQgZHVwbGljYXRlIHByb2Nlc3NpbmcgaWYgYm90aCBoYW5kbGVycyBmaXJlIGZvciB0aGUgc2FtZSBkcm9wXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBpZiAobm93IC0gdGhpcy5sYXN0RHJvcFRpbWUgPCB0aGlzLkRST1BfREVCT1VOQ0VfTVMgJiYgdGhpcy5sYXN0RHJvcERhdGEgPT09IGFjdHVhbEZpbGVQYXRoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMubGFzdERyb3BUaW1lID0gbm93O1xuICAgIHRoaXMubGFzdERyb3BEYXRhID0gYWN0dWFsRmlsZVBhdGg7XG5cbiAgICAvLyBGaW5kIHRoZSBmaWxlIGluIHRoZSB2YXVsdFxuICAgIGNvbnN0IGZpbGUgPSB0aGlzLnBsdWdpbi5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGFjdHVhbEZpbGVQYXRoKTtcbiAgICBcbiAgICBpZiAoIWZpbGUgfHwgIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gR2V0IHRoZSBkaXNwbGF5IG5hbWUgZnJvbSBmcm9udG1hdHRlciAob25seSBpZiBwcm9wZXJ0eSBleGlzdHMpXG4gICAgKCgpID0+IHtcbiAgICAgIC8vIEZvciAubWQgZmlsZXMsIHVzZSBzeW5jaHJvbm91cyBsb2dpYyAoZmFzdCwgaW1tZWRpYXRlKVxuICAgICAgLy8gRm9yIC5tZHggZmlsZXMsIHVzZSBhc3luYyBsb2dpYyB3aXRoIHJldHJpZXMgKG5lZWRzIGZpbGUgcmVhZGluZylcbiAgICAgIGlmIChmaWxlLmV4dGVuc2lvbiA9PT0gJ21kJykge1xuICAgICAgICBjb25zdCBkaXNwbGF5TmFtZSA9IHRoaXMuZ2V0RGlzcGxheU5hbWVTeW5jKGZpbGUpO1xuICAgICAgICBpZiAoZGlzcGxheU5hbWUgIT09IG51bGwpIHtcbiAgICAgICAgICAvLyBJbW1lZGlhdGUgcmVwbGFjZW1lbnQgZm9yIC5tZCBmaWxlcyAobm8gcmV0cmllcyBuZWVkZWQpXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG4gICAgICAgICAgICBpZiAoYWN0aXZlVmlldyAmJiBhY3RpdmVWaWV3LmVkaXRvcikge1xuICAgICAgICAgICAgICB0aGlzLnJlcGxhY2VMYXN0SW5zZXJ0ZWRMaW5rKGZpbGUsIGRpc3BsYXlOYW1lLCBhY3RpdmVWaWV3LmVkaXRvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgNTApOyAvLyBTaG9ydCBkZWxheSBqdXN0IHRvIGxldCBPYnNpZGlhbiBpbnNlcnQgdGhlIGxpbmsgZmlyc3RcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChmaWxlLmV4dGVuc2lvbiA9PT0gJ21keCcgJiYgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlTWR4U3VwcG9ydCkge1xuICAgICAgICAvLyBBc3luYyBsb2dpYyB3aXRoIHJldHJpZXMgZm9yIC5tZHggZmlsZXNcbiAgICAgICAgdm9pZCAoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gYXdhaXQgdGhpcy5nZXREaXNwbGF5TmFtZShmaWxlKTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoZGlzcGxheU5hbWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIFVzZSBtdWx0aXBsZSBhdHRlbXB0cyB3aXRoIGluY3JlYXNpbmcgZGVsYXlzIHRvIGNhdGNoIHRoZSBsaW5rIGluc2VydGlvblxuICAgICAgICAgICAgbGV0IGF0dGVtcHRzID0gMDtcbiAgICAgICAgICAgIGNvbnN0IG1heEF0dGVtcHRzID0gNTtcbiAgICAgICAgICAgIGNvbnN0IGF0dGVtcHRSZXBsYWNlID0gKCkgPT4ge1xuICAgICAgICAgICAgICBhdHRlbXB0cysrO1xuICAgICAgICAgICAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG4gICAgICAgICAgICAgIGlmIChhY3RpdmVWaWV3ICYmIGFjdGl2ZVZpZXcuZWRpdG9yKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVwbGFjZWQgPSB0aGlzLnJlcGxhY2VMYXN0SW5zZXJ0ZWRMaW5rKGZpbGUsIGRpc3BsYXlOYW1lLCBhY3RpdmVWaWV3LmVkaXRvcik7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXBsYWNlZCAmJiBhdHRlbXB0cyA8IG1heEF0dGVtcHRzKSB7XG4gICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGF0dGVtcHRSZXBsYWNlLCA1MCAqIGF0dGVtcHRzKTsgLy8gSW5jcmVhc2luZyBkZWxheTogNTBtcywgMTAwbXMsIDE1MG1zLCBldGMuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGF0dGVtcHRzIDwgbWF4QXR0ZW1wdHMpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGF0dGVtcHRSZXBsYWNlLCA1MCAqIGF0dGVtcHRzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoYXR0ZW1wdFJlcGxhY2UsIDE1MCk7IC8vIFN0YXJ0IGFmdGVyIDE1MG1zXG4gICAgICAgICAgfVxuICAgICAgICB9KSgpO1xuICAgICAgfVxuICAgIH0pKCk7XG4gIH1cblxuICAvKipcbiAgICogU3luY2hyb25vdXMgdmVyc2lvbiBmb3IgLm1kIGZpbGVzIChmYXN0LCBpbW1lZGlhdGUpXG4gICAqL1xuICBwcml2YXRlIGdldERpc3BsYXlOYW1lU3luYyhmaWxlOiBURmlsZSk6IHN0cmluZyB8IG51bGwge1xuICAgIGlmIChmaWxlLmV4dGVuc2lvbiAhPT0gJ21kJykge1xuICAgICAgcmV0dXJuIG51bGw7IC8vIE9ubHkgZm9yIC5tZCBmaWxlc1xuICAgIH1cblxuICAgIGNvbnN0IGZyb250bWF0dGVyID0gZ2V0RnJvbnRtYXR0ZXJTeW5jKHRoaXMucGx1Z2luLmFwcCwgZmlsZSwgdGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xuICAgIFxuICAgIGlmIChmcm9udG1hdHRlciAmJiBmcm9udG1hdHRlclt0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9wZXJ0eUtleV0gIT09IHVuZGVmaW5lZCAmJiBmcm9udG1hdHRlclt0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9wZXJ0eUtleV0gIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSBTdHJpbmcoZnJvbnRtYXR0ZXJbdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvcGVydHlLZXldKS50cmltKCk7XG4gICAgICBpZiAocHJvcGVydHlWYWx1ZSAhPT0gJycpIHtcbiAgICAgICAgcmV0dXJuIHByb3BlcnR5VmFsdWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7IC8vIE5vIHByb3BlcnR5IC0gdXNlIGRlZmF1bHQgT2JzaWRpYW4gYmVoYXZpb3JcbiAgfVxuXG4gIC8qKlxuICAgKiBBc3luYyB2ZXJzaW9uIGZvciAubWR4IGZpbGVzIChuZWVkcyBmaWxlIHJlYWRpbmcpXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldERpc3BsYXlOYW1lKGZpbGU6IFRGaWxlKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgY29uc3QgeyBnZXRGcm9udG1hdHRlciwgaXNGaWxlVHlwZVN1cHBvcnRlZCB9ID0gYXdhaXQgaW1wb3J0KCcuLi91dGlscy9mcm9udG1hdHRlcicpO1xuICAgIFxuICAgIC8vIFNraXAgdW5zdXBwb3J0ZWQgZmlsZSB0eXBlc1xuICAgIGlmICghaXNGaWxlVHlwZVN1cHBvcnRlZChmaWxlLmV4dGVuc2lvbiwgdGhpcy5wbHVnaW4uc2V0dGluZ3MpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBmcm9udG1hdHRlciA9IGF3YWl0IGdldEZyb250bWF0dGVyKHRoaXMucGx1Z2luLmFwcCwgZmlsZSwgdGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xuICAgIFxuICAgIC8vIE9ubHkgcmV0dXJuIGRpc3BsYXkgbmFtZSBpZiB0aGUgcHJvcGVydHkgZXhpc3RzIGFuZCBoYXMgYSB2YWx1ZVxuICAgIC8vIFJldHVybiBudWxsIGlmIHByb3BlcnR5IGRvZXNuJ3QgZXhpc3QgKHRvIGluZGljYXRlIHdlIHNob3VsZCB1c2UgZGVmYXVsdCBiZWhhdmlvcilcbiAgICBpZiAoZnJvbnRtYXR0ZXIgJiYgZnJvbnRtYXR0ZXJbdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvcGVydHlLZXldICE9PSB1bmRlZmluZWQgJiYgZnJvbnRtYXR0ZXJbdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvcGVydHlLZXldICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBwcm9wZXJ0eVZhbHVlID0gU3RyaW5nKGZyb250bWF0dGVyW3RoaXMucGx1Z2luLnNldHRpbmdzLnByb3BlcnR5S2V5XSkudHJpbSgpO1xuICAgICAgaWYgKHByb3BlcnR5VmFsdWUgIT09ICcnKSB7XG4gICAgICAgIHJldHVybiBwcm9wZXJ0eVZhbHVlOyAvLyBVc2UgZnJvbnRtYXR0ZXIgdGl0bGVcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDsgLy8gTm8gcHJvcGVydHkgLSB1c2UgZGVmYXVsdCBPYnNpZGlhbiBiZWhhdmlvclxuICB9XG5cbiAgcHJpdmF0ZSByZXBsYWNlTGFzdEluc2VydGVkTGluayhmaWxlOiBURmlsZSwgZGlzcGxheU5hbWU6IHN0cmluZywgZWRpdG9yOiBFZGl0b3IpOiBib29sZWFuIHtcbiAgICBjb25zdCBjb250ZW50ID0gZWRpdG9yLmdldFZhbHVlKCk7XG4gICAgY29uc3QgY3Vyc29yID0gZWRpdG9yLmdldEN1cnNvcigpO1xuICAgIFxuICAgIC8vIExvb2sgZm9yIHRoZSBtb3N0IHJlY2VudGx5IGluc2VydGVkIGxpbmsgbmVhciB0aGUgY3Vyc29yXG4gICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcbiAgICBjb25zdCBjdXJyZW50TGluZSA9IGxpbmVzW2N1cnNvci5saW5lXTtcbiAgICBcbiAgICAvLyBGaW5kIHdpa2kgbGlua3Mgb3IgbWFya2Rvd24gbGlua3Mgb24gdGhlIGN1cnJlbnQgbGluZVxuICAgIC8vIFVwZGF0ZWQgcmVnZXggdG8gaGFuZGxlIE1EWCBmaWxlcyAtIHRoZXkgbWlnaHQgaGF2ZSAubWR4IGV4dGVuc2lvbiBpbiB0aGUgbGlua1xuICAgIC8vIE5vdGU6IG1hcmtkb3duIGxpbmtzIGNhbiBoYXZlIGVtcHR5IGJyYWNrZXRzOiBbXShmaWxlLm1keClcbiAgICBjb25zdCB3aWtpTGlua1JlZ2V4ID0gL1xcW1xcWyhbXlxcXV0rKVxcXVxcXS9nO1xuICAgIGNvbnN0IG1hcmtkb3duTGlua1JlZ2V4ID0gL1xcWyhbXlxcXV0qKVxcXVxcKChbXildKylcXCkvZzsgLy8gQWxsb3cgZW1wdHkgYnJhY2tldHMgd2l0aCAqXG4gICAgXG4gICAgbGV0IG1hdGNoO1xuICAgIGxldCBsYXN0TWF0Y2ggPSBudWxsO1xuICAgIFxuICAgIC8vIEZpbmQgdGhlIGxhc3Qgd2lraSBsaW5rIG9uIHRoZSBjdXJyZW50IGxpbmVcbiAgICB3aGlsZSAoKG1hdGNoID0gd2lraUxpbmtSZWdleC5leGVjKGN1cnJlbnRMaW5lKSkgIT09IG51bGwpIHtcbiAgICAgIGxhc3RNYXRjaCA9IG1hdGNoO1xuICAgIH1cbiAgICBcbiAgICBpZiAobGFzdE1hdGNoKSB7XG4gICAgICBjb25zdCBsaW5rUGF0aCA9IGxhc3RNYXRjaFsxXTtcbiAgICAgIC8vIENoZWNrIGlmIHRoaXMgbGluayBtYXRjaGVzIG91ciBmaWxlICh3aXRoIG9yIHdpdGhvdXQgZXh0ZW5zaW9uKVxuICAgICAgY29uc3QgZmlsZVBhdGhXaXRob3V0RXh0ID0gZmlsZS5wYXRoLnJlcGxhY2UoL1xcLihtZHxtZHgpJC8sICcnKTtcbiAgICAgIGNvbnN0IGxpbmtQYXRoV2l0aG91dEV4dCA9IGxpbmtQYXRoLnJlcGxhY2UoL1xcLihtZHxtZHgpJC8sICcnKTtcbiAgICAgIFxuICAgICAgaWYgKGZpbGVQYXRoV2l0aG91dEV4dCA9PT0gbGlua1BhdGhXaXRob3V0RXh0IHx8IGZpbGUucGF0aCA9PT0gbGlua1BhdGggfHwgZmlsZS5wYXRoLnJlcGxhY2UoL1xcLm1keCQvLCAnLm1kJykgPT09IGxpbmtQYXRoKSB7XG4gICAgICAgIGNvbnN0IG5ld0xpbmtUZXh0ID0gYFtbJHtsaW5rUGF0aH18JHtkaXNwbGF5TmFtZX1dXWA7XG4gICAgICAgIGNvbnN0IHN0YXJ0UG9zID0geyBsaW5lOiBjdXJzb3IubGluZSwgY2g6IGxhc3RNYXRjaC5pbmRleCB9O1xuICAgICAgICBjb25zdCBlbmRQb3MgPSB7IGxpbmU6IGN1cnNvci5saW5lLCBjaDogbGFzdE1hdGNoLmluZGV4ICsgbGFzdE1hdGNoWzBdLmxlbmd0aCB9O1xuICAgICAgICBlZGl0b3IucmVwbGFjZVJhbmdlKG5ld0xpbmtUZXh0LCBzdGFydFBvcywgZW5kUG9zKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIFJlc2V0IHJlZ2V4IGZvciBtYXJrZG93biBsaW5rc1xuICAgIG1hcmtkb3duTGlua1JlZ2V4Lmxhc3RJbmRleCA9IDA7XG4gICAgbGFzdE1hdGNoID0gbnVsbDtcbiAgICBcbiAgICAvLyBGaW5kIHRoZSBsYXN0IG1hcmtkb3duIGxpbmsgb24gdGhlIGN1cnJlbnQgbGluZVxuICAgIHdoaWxlICgobWF0Y2ggPSBtYXJrZG93bkxpbmtSZWdleC5leGVjKGN1cnJlbnRMaW5lKSkgIT09IG51bGwpIHtcbiAgICAgIGxhc3RNYXRjaCA9IG1hdGNoO1xuICAgIH1cbiAgICBcbiAgICBpZiAobGFzdE1hdGNoKSB7XG4gICAgICBjb25zdCBsaW5rVXJsID0gbGFzdE1hdGNoWzJdO1xuICAgICAgY29uc3QgbGlua1VybERlY29kZWQgPSBkZWNvZGVVUklDb21wb25lbnQobGlua1VybCk7XG4gICAgICAvLyBDaGVjayBpZiB0aGlzIGxpbmsgbWF0Y2hlcyBvdXIgZmlsZVxuICAgICAgY29uc3QgZmlsZVBhdGhFbmNvZGVkID0gZW5jb2RlVVJJKGZpbGUucGF0aCk7XG4gICAgICBjb25zdCBmaWxlUGF0aFdpdGhvdXRFeHQgPSBmaWxlLnBhdGgucmVwbGFjZSgvXFwuKG1kfG1keCkkLywgJycpO1xuICAgICAgY29uc3QgbGlua1VybFdpdGhvdXRFeHQgPSBsaW5rVXJsRGVjb2RlZC5yZXBsYWNlKC9cXC4obWR8bWR4KSQvLCAnJyk7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIHZhcmlvdXMgbWF0Y2hpbmcgc2NlbmFyaW9zXG4gICAgICBjb25zdCBtYXRjaGVzID0gXG4gICAgICAgIGZpbGUucGF0aCA9PT0gbGlua1VybERlY29kZWQgfHwgXG4gICAgICAgIGZpbGVQYXRoRW5jb2RlZCA9PT0gbGlua1VybCB8fFxuICAgICAgICBmaWxlUGF0aFdpdGhvdXRFeHQgPT09IGxpbmtVcmxXaXRob3V0RXh0IHx8XG4gICAgICAgIGZpbGUucGF0aC5yZXBsYWNlKC9cXC5tZHgkLywgJy5tZCcpID09PSBsaW5rVXJsRGVjb2RlZCB8fFxuICAgICAgICBmaWxlLnBhdGgucmVwbGFjZSgvXFwubWQkLywgJy5tZHgnKSA9PT0gbGlua1VybERlY29kZWQgfHxcbiAgICAgICAgLy8gSGFuZGxlIHJlbGF0aXZlIHBhdGhzIC0gY2hlY2sgaWYgbGluayBVUkwgbWF0Y2hlcyBmaWxlIGJhc2VuYW1lXG4gICAgICAgIGZpbGUuYmFzZW5hbWUgPT09IGxpbmtVcmxEZWNvZGVkLnJlcGxhY2UoL1xcLihtZHxtZHgpJC8sICcnKSB8fFxuICAgICAgICBmaWxlLmJhc2VuYW1lICsgJy5tZHgnID09PSBsaW5rVXJsRGVjb2RlZCB8fFxuICAgICAgICBmaWxlLmJhc2VuYW1lICsgJy5tZCcgPT09IGxpbmtVcmxEZWNvZGVkIHx8XG4gICAgICAgIC8vIEhhbmRsZSBwYXRocyB3aXRoIGRpcmVjdG9yeVxuICAgICAgICBmaWxlLnBhdGguZW5kc1dpdGgobGlua1VybERlY29kZWQpIHx8XG4gICAgICAgIGxpbmtVcmxEZWNvZGVkLmVuZHNXaXRoKGZpbGUucGF0aCk7XG4gICAgICBcbiAgICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICAgIGNvbnN0IG5ld0xpbmtUZXh0ID0gYFske2Rpc3BsYXlOYW1lfV0oJHtsaW5rVXJsfSlgO1xuICAgICAgICBjb25zdCBzdGFydFBvcyA9IHsgbGluZTogY3Vyc29yLmxpbmUsIGNoOiBsYXN0TWF0Y2guaW5kZXggfTtcbiAgICAgICAgY29uc3QgZW5kUG9zID0geyBsaW5lOiBjdXJzb3IubGluZSwgY2g6IGxhc3RNYXRjaC5pbmRleCArIGxhc3RNYXRjaFswXS5sZW5ndGggfTtcbiAgICAgICAgZWRpdG9yLnJlcGxhY2VSYW5nZShuZXdMaW5rVGV4dCwgc3RhcnRQb3MsIGVuZFBvcyk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBUcnkgc2VhcmNoaW5nIGEgZmV3IGxpbmVzIGFyb3VuZCB0aGUgY3Vyc29yXG4gICAgICBjb25zdCBzZWFyY2hSYW5nZSA9IDM7XG4gICAgICBmb3IgKGxldCBpID0gTWF0aC5tYXgoMCwgY3Vyc29yLmxpbmUgLSBzZWFyY2hSYW5nZSk7IGkgPD0gTWF0aC5taW4obGluZXMubGVuZ3RoIC0gMSwgY3Vyc29yLmxpbmUgKyBzZWFyY2hSYW5nZSk7IGkrKykge1xuICAgICAgICBjb25zdCBsaW5lID0gbGluZXNbaV07XG4gICAgICAgIGNvbnN0IHdpa2lNYXRjaGVzID0gWy4uLmxpbmUubWF0Y2hBbGwoL1xcW1xcWyhbXlxcXV0rKVxcXVxcXS9nKV07XG4gICAgICAgIGNvbnN0IG1hcmtkb3duTWF0Y2hlcyA9IFsuLi5saW5lLm1hdGNoQWxsKC9cXFsoW15cXF1dKilcXF1cXCgoW14pXSspXFwpL2cpXTtcbiAgICAgICAgXG4gICAgICAgIC8vIENoZWNrIHdpa2kgbGlua3NcbiAgICAgICAgZm9yIChjb25zdCB3aWtpTWF0Y2ggb2Ygd2lraU1hdGNoZXMpIHtcbiAgICAgICAgICBjb25zdCBsaW5rUGF0aCA9IHdpa2lNYXRjaFsxXTtcbiAgICAgICAgICBjb25zdCBmaWxlUGF0aFdpdGhvdXRFeHQgPSBmaWxlLnBhdGgucmVwbGFjZSgvXFwuKG1kfG1keCkkLywgJycpO1xuICAgICAgICAgIGNvbnN0IGxpbmtQYXRoV2l0aG91dEV4dCA9IGxpbmtQYXRoLnJlcGxhY2UoL1xcLihtZHxtZHgpJC8sICcnKTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoZmlsZVBhdGhXaXRob3V0RXh0ID09PSBsaW5rUGF0aFdpdGhvdXRFeHQgfHwgZmlsZS5wYXRoID09PSBsaW5rUGF0aCB8fCBmaWxlLnBhdGgucmVwbGFjZSgvXFwubWR4JC8sICcubWQnKSA9PT0gbGlua1BhdGgpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0xpbmtUZXh0ID0gYFtbJHtsaW5rUGF0aH18JHtkaXNwbGF5TmFtZX1dXWA7XG4gICAgICAgICAgICBjb25zdCBtYXRjaEluZGV4ID0gd2lraU1hdGNoLmluZGV4ID8/IDA7XG4gICAgICAgICAgICBjb25zdCBzdGFydFBvcyA9IHsgbGluZTogaSwgY2g6IG1hdGNoSW5kZXggfTtcbiAgICAgICAgICAgIGNvbnN0IGVuZFBvcyA9IHsgbGluZTogaSwgY2g6IG1hdGNoSW5kZXggKyB3aWtpTWF0Y2hbMF0ubGVuZ3RoIH07XG4gICAgICAgICAgICBlZGl0b3IucmVwbGFjZVJhbmdlKG5ld0xpbmtUZXh0LCBzdGFydFBvcywgZW5kUG9zKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gQ2hlY2sgbWFya2Rvd24gbGlua3NcbiAgICAgICAgZm9yIChjb25zdCBtZE1hdGNoIG9mIG1hcmtkb3duTWF0Y2hlcykge1xuICAgICAgICAgIGNvbnN0IGxpbmtVcmwgPSBtZE1hdGNoWzJdO1xuICAgICAgICAgIC8vIEhhbmRsZSBib3RoIHJlbGF0aXZlIHBhdGhzIChiaWctdGVzdC5tZHgpIGFuZCBmdWxsIHBhdGhzIChwb3N0cy9iaWctdGVzdC5tZHgpXG4gICAgICAgICAgY29uc3QgbGlua1VybERlY29kZWQgPSBkZWNvZGVVUklDb21wb25lbnQobGlua1VybCk7XG4gICAgICAgICAgY29uc3QgZmlsZVBhdGhXaXRob3V0RXh0ID0gZmlsZS5wYXRoLnJlcGxhY2UoL1xcLihtZHxtZHgpJC8sICcnKTtcbiAgICAgICAgICBjb25zdCBsaW5rVXJsV2l0aG91dEV4dCA9IGxpbmtVcmxEZWNvZGVkLnJlcGxhY2UoL1xcLihtZHxtZHgpJC8sICcnKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDaGVjayB2YXJpb3VzIG1hdGNoaW5nIHNjZW5hcmlvc1xuICAgICAgICAgIGNvbnN0IG1hdGNoZXMgPSBcbiAgICAgICAgICAgIGZpbGUucGF0aCA9PT0gbGlua1VybERlY29kZWQgfHwgXG4gICAgICAgICAgICBlbmNvZGVVUkkoZmlsZS5wYXRoKSA9PT0gbGlua1VybCB8fFxuICAgICAgICAgICAgZmlsZS5wYXRoLnJlcGxhY2UoL1xcLm1keCQvLCAnLm1kJykgPT09IGxpbmtVcmxEZWNvZGVkIHx8XG4gICAgICAgICAgICBmaWxlLnBhdGgucmVwbGFjZSgvXFwubWQkLywgJy5tZHgnKSA9PT0gbGlua1VybERlY29kZWQgfHxcbiAgICAgICAgICAgIGZpbGVQYXRoV2l0aG91dEV4dCA9PT0gbGlua1VybFdpdGhvdXRFeHQgfHxcbiAgICAgICAgICAgIC8vIEhhbmRsZSByZWxhdGl2ZSBwYXRocyAtIGNoZWNrIGlmIGxpbmsgVVJMIG1hdGNoZXMgZmlsZSBiYXNlbmFtZVxuICAgICAgICAgICAgZmlsZS5iYXNlbmFtZSA9PT0gbGlua1VybERlY29kZWQucmVwbGFjZSgvXFwuKG1kfG1keCkkLywgJycpIHx8XG4gICAgICAgICAgICBmaWxlLmJhc2VuYW1lICsgJy5tZHgnID09PSBsaW5rVXJsRGVjb2RlZCB8fFxuICAgICAgICAgICAgZmlsZS5iYXNlbmFtZSArICcubWQnID09PSBsaW5rVXJsRGVjb2RlZCB8fFxuICAgICAgICAgICAgLy8gSGFuZGxlIHBhdGhzIHdpdGggZGlyZWN0b3J5XG4gICAgICAgICAgICBmaWxlLnBhdGguZW5kc1dpdGgobGlua1VybERlY29kZWQpIHx8XG4gICAgICAgICAgICBsaW5rVXJsRGVjb2RlZC5lbmRzV2l0aChmaWxlLnBhdGgpO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdMaW5rVGV4dCA9IGBbJHtkaXNwbGF5TmFtZX1dKCR7bGlua1VybH0pYDtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoSW5kZXggPSBtZE1hdGNoLmluZGV4ID8/IDA7XG4gICAgICAgICAgICBjb25zdCBzdGFydFBvcyA9IHsgbGluZTogaSwgY2g6IG1hdGNoSW5kZXggfTtcbiAgICAgICAgICAgIGNvbnN0IGVuZFBvcyA9IHsgbGluZTogaSwgY2g6IG1hdGNoSW5kZXggKyBtZE1hdGNoWzBdLmxlbmd0aCB9O1xuICAgICAgICAgICAgZWRpdG9yLnJlcGxhY2VSYW5nZShuZXdMaW5rVGV4dCwgc3RhcnRQb3MsIGVuZFBvcyk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuaW1wb3J0IHsgRWRpdG9yU3VnZ2VzdCwgUHJvcGVydHlPdmVyRmlsZU5hbWVQbHVnaW4gfSBmcm9tIFwiLi4vdHlwZXNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBDYWNoZVNlcnZpY2Uge1xyXG4gIHByaXZhdGUgcGx1Z2luOiBQcm9wZXJ0eU92ZXJGaWxlTmFtZVBsdWdpbjtcclxuICBwcml2YXRlIHN1Z2dlc3Q/OiBFZGl0b3JTdWdnZXN0O1xyXG5cclxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luKSB7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICB9XHJcblxyXG4gIHNldFN1Z2dlc3Qoc3VnZ2VzdDogRWRpdG9yU3VnZ2VzdCkge1xyXG4gICAgdGhpcy5zdWdnZXN0ID0gc3VnZ2VzdDtcclxuICB9XHJcblxyXG4gIGludmFsaWRhdGVDYWNoZShmaWxlOiBURmlsZSk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuc3VnZ2VzdCkge1xyXG4gICAgICAvLyB1cGRhdGVGaWxlQ2FjaGUgaXMgbm93IGFzeW5jLCBidXQgd2UgY2FuJ3QgYXdhaXQgaGVyZVxyXG4gICAgICAvLyBUaGUgY2FjaGUgd2lsbCBiZSB1cGRhdGVkIGFzeW5jaHJvbm91c2x5XHJcbiAgICAgIHZvaWQgdGhpcy5zdWdnZXN0LnVwZGF0ZUZpbGVDYWNoZShmaWxlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlYnVpbGRDYWNoZSgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLnN1Z2dlc3QpIHtcclxuICAgICAgLy8gYnVpbGRGaWxlQ2FjaGUgaXMgbm93IGFzeW5jLCBidXQgd2UgY2FuJ3QgYXdhaXQgaGVyZVxyXG4gICAgICAvLyBUaGUgY2FjaGUgd2lsbCBiZSByZWJ1aWx0IGFzeW5jaHJvbm91c2x5XHJcbiAgICAgIHZvaWQgdGhpcy5zdWdnZXN0LmJ1aWxkRmlsZUNhY2hlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiIsICIvKipcclxuICogR3JhcGggVmlldyBTZXJ2aWNlXHJcbiAqXHJcbiAqIFRoaXMgZmlsZSBjb250YWlucyBjb2RlIGFkYXB0ZWQgZnJvbSB0aGUgTm9kZSBNYXNxdWVyYWRlIHBsdWdpbiBieSBFbHNhVGFtLlxyXG4gKiBPcmlnaW5hbCBzb3VyY2U6IGh0dHBzOi8vZ2l0aHViLmNvbS9LYXBpcmtsYWEvb2JzaWRpYW4tbm9kZS1tYXNxdWVyYWRlXHJcbiAqXHJcbiAqIFRoZSBjb2RlIGhhcyBiZWVuIG1vZGlmaWVkIHRvIGludGVncmF0ZSB3aXRoIHRoZSBQcm9wZXJ0eSBPdmVyIEZpbGUgTmFtZSBwbHVnaW5cclxuICogYW5kIHVzZSB0aGUgcGx1Z2luJ3MgcHJvcGVydHkga2V5IHNldHRpbmcgaW5zdGVhZCBvZiBOb2RlIE1hc3F1ZXJhZGUncyBjb25maWd1cmF0aW9uLlxyXG4gKlxyXG4gKiBPcmlnaW5hbCBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIEdQTHYzLiBUaGlzIGZpbGUgaXMgYWxzbyBsaWNlbnNlZCB1bmRlciBHUEx2My5cclxuICovXHJcblxyXG5pbXBvcnQgeyBBcHAsIFZpZXcsIFdvcmtzcGFjZUxlYWYgfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCB7IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luIH0gZnJvbSAnLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBmcm9udG1hdHRlckNhY2hlIH0gZnJvbSAnLi4vdXRpbHMvZnJvbnRtYXR0ZXItY2FjaGUnO1xyXG5cclxuLy8gU3RhdGljIGRpc3BsYXkgc2V0dGluZ3MgLSBleGFjdGx5IGxpa2UgTm9kZSBNYXNxdWVyYWRlXHJcbmxldCBncmFwaERpc3BsYXlTZXR0aW5nczogeyBlbmFibGVGb3JHcmFwaFZpZXc6IGJvb2xlYW47IHByb3BlcnR5S2V5OiBzdHJpbmc7IGVuYWJsZU1keFN1cHBvcnQ6IGJvb2xlYW47IGFwcDogQXBwIH0gfCBudWxsID0gbnVsbDtcclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUdldERpc3BsYXlUZXh0KGFwcDogQXBwKSB7XHJcblx0cmV0dXJuIGZ1bmN0aW9uIGdldERpc3BsYXlUZXh0KHRoaXM6IEdyYXBoTm9kZSk6IHN0cmluZyB7XHJcblx0XHRpZiAoIWdyYXBoRGlzcGxheVNldHRpbmdzPy5lbmFibGVGb3JHcmFwaFZpZXcpIHtcclxuXHRcdFx0Ly8gSWYgZGlzYWJsZWQsIHVzZSBvcmlnaW5hbFxyXG5cdFx0XHRpZiAodGhpcy5wb3Zfb3JpZ2luYWxHZXREaXNwbGF5VGV4dCkge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLnBvdl9vcmlnaW5hbEdldERpc3BsYXlUZXh0KCk7XHJcblx0XHRcdH1cclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdwb3Zfb3JpZ2luYWxHZXREaXNwbGF5VGV4dCBkb2VzIG5vdCBleGlzdCBvbiBub2RlJyk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gVHJ5IHRvIGdldCBwcm9wZXJ0eSB2YWx1ZSAtIGV4YWN0bHkgbGlrZSBOb2RlIE1hc3F1ZXJhZGUgbG9naWMgYnV0IGZvciBwcm9wZXJ0aWVzXHJcblx0XHRjb25zdCBmaWxlID0gYXBwLnZhdWx0LmdldEZpbGVCeVBhdGgodGhpcy5pZCk7XHJcblxyXG5cdFx0aWYgKGZpbGUpIHtcclxuXHRcdFx0Ly8gRm9yIGJvdGggTUQgYW5kIE1EWCBmaWxlcywgdHJ5IGZyb250bWF0dGVyIHBhcnNpbmdcclxuXHRcdFx0aWYgKChmaWxlLmV4dGVuc2lvbiA9PT0gJ21kJyB8fCAoZmlsZS5leHRlbnNpb24gPT09ICdtZHgnICYmIGdyYXBoRGlzcGxheVNldHRpbmdzLmVuYWJsZU1keFN1cHBvcnQpKSkge1xyXG5cdFx0XHRcdGlmIChmaWxlLmV4dGVuc2lvbiA9PT0gJ21kJykge1xyXG5cdFx0XHRcdFx0Ly8gRm9yIE1EIGZpbGVzLCB1c2UgbWV0YWRhdGEgY2FjaGUgZGlyZWN0bHkgKGZhc3Qgc3luYyBhY2Nlc3MpXHJcblx0XHRcdFx0XHRjb25zdCBmaWxlQ2FjaGUgPSBhcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7XHJcblx0XHRcdFx0XHRjb25zdCBtZEZyb250bWF0dGVyID0gZmlsZUNhY2hlPy5mcm9udG1hdHRlcjtcclxuXHJcblx0XHRcdFx0XHRpZiAobWRGcm9udG1hdHRlciAmJiBtZEZyb250bWF0dGVyW2dyYXBoRGlzcGxheVNldHRpbmdzLnByb3BlcnR5S2V5XSAhPT0gdW5kZWZpbmVkICYmIG1kRnJvbnRtYXR0ZXJbZ3JhcGhEaXNwbGF5U2V0dGluZ3MucHJvcGVydHlLZXldICE9PSBudWxsKSB7XHJcblx0XHRcdFx0XHRcdGNvbnN0IHByb3BlcnR5VmFsdWUgPSBTdHJpbmcobWRGcm9udG1hdHRlcltncmFwaERpc3BsYXlTZXR0aW5ncy5wcm9wZXJ0eUtleV0pLnRyaW0oKTtcclxuXHRcdFx0XHRcdFx0aWYgKHByb3BlcnR5VmFsdWUgIT09ICcnKSB7XHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHByb3BlcnR5VmFsdWU7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9IGVsc2UgaWYgKGZpbGUuZXh0ZW5zaW9uID09PSAnbWR4Jykge1xyXG5cdFx0XHRcdFx0Ly8gRm9yIE1EWCBmaWxlcywgY2hlY2sgY2FjaGUgZmlyc3QsIHRoZW4gdHJpZ2dlciBhc3luYyBwb3B1bGF0aW9uIGlmIG5lZWRlZFxyXG5cdFx0XHRcdFx0Y29uc3QgY2FjaGVkID0gZnJvbnRtYXR0ZXJDYWNoZS5nZXRTeW5jKGZpbGUucGF0aCk7XHJcblxyXG5cdFx0XHRcdFx0aWYgKGNhY2hlZCAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRcdGlmIChjYWNoZWQgJiYgY2FjaGVkW2dyYXBoRGlzcGxheVNldHRpbmdzLnByb3BlcnR5S2V5XSAhPT0gdW5kZWZpbmVkICYmIGNhY2hlZFtncmFwaERpc3BsYXlTZXR0aW5ncy5wcm9wZXJ0eUtleV0gIT09IG51bGwpIHtcclxuXHRcdFx0XHRcdFx0XHRjb25zdCBwcm9wZXJ0eVZhbHVlID0gU3RyaW5nKGNhY2hlZFtncmFwaERpc3BsYXlTZXR0aW5ncy5wcm9wZXJ0eUtleV0pLnRyaW0oKTtcclxuXHRcdFx0XHRcdFx0XHRpZiAocHJvcGVydHlWYWx1ZSAhPT0gJycpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBwcm9wZXJ0eVZhbHVlO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0Ly8gVHJpZ2dlciBhc3luYyBsb2FkIGluIGJhY2tncm91bmRcclxuXHRcdFx0XHRcdFx0dm9pZCBmcm9udG1hdHRlckNhY2hlLmdldChhcHAsIGZpbGUsIHsgZW5hYmxlTWR4U3VwcG9ydDogZ3JhcGhEaXNwbGF5U2V0dGluZ3MuZW5hYmxlTWR4U3VwcG9ydCwgcHJvcGVydHlLZXk6IGdyYXBoRGlzcGxheVNldHRpbmdzLnByb3BlcnR5S2V5IH0gYXMgYW55KTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHQvLyBGYWxsIGJhY2sgdG8gb3JpZ2luYWwgZGlzcGxheSB0ZXh0IChmaWxlIG5hbWUpIC0gZXhhY3RseSBsaWtlIE5vZGUgTWFzcXVlcmFkZVxyXG5cdFx0aWYgKHRoaXMucG92X29yaWdpbmFsR2V0RGlzcGxheVRleHQpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMucG92X29yaWdpbmFsR2V0RGlzcGxheVRleHQoKTtcclxuXHRcdH1cclxuXHRcdHRocm93IG5ldyBFcnJvcigncG92X29yaWdpbmFsR2V0RGlzcGxheVRleHQgZG9lcyBub3QgZXhpc3Qgb24gbm9kZScpO1xyXG5cdH07XHJcbn1cclxuXHJcbi8vIFR5cGUgZGVmaW5pdGlvbnMgZm9yIGdyYXBoIHZpZXcgaW50ZXJuYWxzXHJcbmludGVyZmFjZSBHcmFwaE5vZGVDb2xsZWN0aW9uIHtcclxuICBmaXJzdCgpOiBHcmFwaE5vZGUgfCB1bmRlZmluZWQ7XHJcbiAgW1N5bWJvbC5pdGVyYXRvcl0oKTogSXRlcmF0b3I8R3JhcGhOb2RlPjtcclxufVxyXG5cclxuaW50ZXJmYWNlIEdyYXBoVmlldyB7XHJcbiAgcmVuZGVyZXI6IHtcclxuICAgIG5vZGVzOiBHcmFwaE5vZGVDb2xsZWN0aW9uO1xyXG4gICAgY2hhbmdlZCgpOiB2b2lkO1xyXG4gIH07XHJcbn1cclxuXHJcbmludGVyZmFjZSBMb2NhbEdyYXBoVmlldyB7XHJcbiAgcmVuZGVyZXI6IHtcclxuICAgIG5vZGVzOiBHcmFwaE5vZGVDb2xsZWN0aW9uO1xyXG4gICAgY2hhbmdlZCgpOiB2b2lkO1xyXG4gIH07XHJcbn1cclxuXHJcbmludGVyZmFjZSBHcmFwaE5vZGUge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdGV4dD86IHtcclxuICAgIHRleHQ6IHN0cmluZztcclxuICB9O1xyXG4gIGdldERpc3BsYXlUZXh0KCk6IHN0cmluZztcclxuICBwb3Zfb3JpZ2luYWxHZXREaXNwbGF5VGV4dD86ICgpID0+IHN0cmluZztcclxufVxyXG5cclxuaW50ZXJmYWNlIEdyYXBoTm9kZVByb3RvdHlwZSB7XHJcbiAgZ2V0RGlzcGxheVRleHQoKTogc3RyaW5nO1xyXG4gIHBvdl9vcmlnaW5hbEdldERpc3BsYXlUZXh0PzogKCkgPT4gc3RyaW5nO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgR3JhcGhOb2RlQ29sbGVjdGlvbldpdGhGaXJzdCBleHRlbmRzIEdyYXBoTm9kZUNvbGxlY3Rpb24ge1xyXG4gIGZpcnN0KCk6IEdyYXBoTm9kZSB8IHVuZGVmaW5lZDtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEdyYXBoVmlld1NlcnZpY2Uge1xyXG4gIHByaXZhdGUgcGx1Z2luOiBQcm9wZXJ0eU92ZXJGaWxlTmFtZVBsdWdpbjtcclxuICBwcml2YXRlIG1vZGlmaWVkUHJvdG90eXBlczogR3JhcGhOb2RlUHJvdG90eXBlW10gPSBbXTtcclxuICBwcml2YXRlIG9ic2VydmVyOiBNdXRhdGlvbk9ic2VydmVyIHwgbnVsbCA9IG51bGw7XHJcbiAgcHJpdmF0ZSB0aW1lcjogbnVtYmVyIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogUHJvcGVydHlPdmVyRmlsZU5hbWVQbHVnaW4pIHtcclxuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xyXG4gICAgLy8gU2V0IHN0YXRpYyBkaXNwbGF5IHNldHRpbmdzIC0gZXhhY3RseSBsaWtlIE5vZGUgTWFzcXVlcmFkZVxyXG4gICAgZ3JhcGhEaXNwbGF5U2V0dGluZ3MgPSB7XHJcbiAgICAgIGVuYWJsZUZvckdyYXBoVmlldzogcGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckdyYXBoVmlldyxcclxuICAgICAgcHJvcGVydHlLZXk6IHBsdWdpbi5zZXR0aW5ncy5wcm9wZXJ0eUtleSxcclxuICAgICAgZW5hYmxlTWR4U3VwcG9ydDogcGx1Z2luLnNldHRpbmdzLmVuYWJsZU1keFN1cHBvcnQsXHJcbiAgICAgIGFwcDogcGx1Z2luLmFwcFxyXG4gICAgfTtcclxuICB9XHJcblxyXG5cclxuICBwcml2YXRlIGdldEdyYXBoTGVhdmVzKCk6IFdvcmtzcGFjZUxlYWZbXSB7XHJcbiAgICBjb25zdCBsZWF2ZXM6IFdvcmtzcGFjZUxlYWZbXSA9IFtdO1xyXG4gICAgbGVhdmVzLnB1c2goLi4udGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoJ2dyYXBoJykpO1xyXG4gICAgbGVhdmVzLnB1c2goLi4udGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoJ2xvY2FsZ3JhcGgnKSk7XHJcbiAgICByZXR1cm4gWy4uLm5ldyBTZXQobGVhdmVzKV07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIG92ZXJyaWRlUHJvdG90eXBlcygpIHtcclxuICAgIGNvbnN0IGxlYXZlcyA9IHRoaXMuZ2V0R3JhcGhMZWF2ZXMoKTtcclxuICAgIGZvciAoY29uc3QgbGVhZiBvZiBsZWF2ZXMpIHtcclxuICAgICAgaWYgKCEobGVhZi52aWV3IGluc3RhbmNlb2YgVmlldykgfHwgbGVhZi5pc0RlZmVycmVkKSBjb250aW51ZTtcclxuICAgICAgY29uc3QgdmlldyA9IGxlYWYudmlldyBhcyB1bmtub3duIGFzIEdyYXBoVmlldyB8IExvY2FsR3JhcGhWaWV3O1xyXG4gICAgICBhd2FpdCB0aGlzLm92ZXJyaWRlUHJvdG90eXBlKHZpZXcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBvdmVycmlkZVByb3RvdHlwZSh2aWV3OiBHcmFwaFZpZXcgfCBMb2NhbEdyYXBoVmlldykge1xyXG4gICAgLy8gQ2hlY2sgaWYgZ3JhcGggdmlldyBoYXMgbm9kZXMgbG9hZGVkIHlldFxyXG4gICAgbGV0IG5vZGVDb3VudCA9IDA7XHJcbiAgICBmb3IgKGNvbnN0IGdyYXBoTm9kZSBvZiB2aWV3LnJlbmRlcmVyLm5vZGVzKSB7XHJcbiAgICAgIG5vZGVDb3VudCsrO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChub2RlQ291bnQgPT09IDApIHtcclxuICAgICAgLy8gR3JhcGggdmlldyBpcyBlbXB0eSwgdHJ5IGFnYWluIGluIDEgc2Vjb25kXHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHZvaWQgdGhpcy5vdmVycmlkZVByb3RvdHlwZSh2aWV3KTtcclxuICAgICAgfSwgMTAwMCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQcmUtcG9wdWxhdGUgY2FjaGUgZm9yIE1EWCBmaWxlcyBpbiB0aGUgZ3JhcGhcclxuICAgIGlmIChncmFwaERpc3BsYXlTZXR0aW5ncz8uZW5hYmxlTWR4U3VwcG9ydCkge1xyXG4gICAgICBjb25zdCBtZHhQcm9taXNlczogUHJvbWlzZTx2b2lkPltdID0gW107XHJcblxyXG4gICAgICBmb3IgKGNvbnN0IGdyYXBoTm9kZSBvZiB2aWV3LnJlbmRlcmVyLm5vZGVzKSB7XHJcbiAgICAgICAgY29uc3QgZmlsZSA9IGdyYXBoRGlzcGxheVNldHRpbmdzLmFwcC52YXVsdC5nZXRGaWxlQnlQYXRoKGdyYXBoTm9kZS5pZCk7XHJcbiAgICAgICAgaWYgKGZpbGUgJiYgZmlsZS5leHRlbnNpb24gPT09ICdtZHgnKSB7XHJcbiAgICAgICAgICBjb25zdCBwcm9taXNlID0gZnJvbnRtYXR0ZXJDYWNoZS5nZXQoZ3JhcGhEaXNwbGF5U2V0dGluZ3MuYXBwLCBmaWxlLCB7IGVuYWJsZU1keFN1cHBvcnQ6IGdyYXBoRGlzcGxheVNldHRpbmdzLmVuYWJsZU1keFN1cHBvcnQsIHByb3BlcnR5S2V5OiBncmFwaERpc3BsYXlTZXR0aW5ncy5wcm9wZXJ0eUtleSB9IGFzIGFueSk7XHJcbiAgICAgICAgICBtZHhQcm9taXNlcy5wdXNoKHByb21pc2UudGhlbigoKSA9PiB7fSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gV2FpdCBmb3IgYWxsIE1EWCBjYWNoZSBwb3B1bGF0aW9uIHRvIGNvbXBsZXRlXHJcbiAgICAgIGlmIChtZHhQcm9taXNlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwobWR4UHJvbWlzZXMpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgbm9kZSA9IHZpZXcucmVuZGVyZXIubm9kZXMuZmlyc3QoKTtcclxuXHJcbiAgICBpZiAobm9kZSkge1xyXG4gICAgICBjb25zdCBwcm90byA9IG5vZGUuY29uc3RydWN0b3IucHJvdG90eXBlO1xyXG4gICAgICBpZiAoIXByb3RvLmhhc093blByb3BlcnR5KCdwb3Zfb3JpZ2luYWxHZXREaXNwbGF5VGV4dCcpICYmICF0aGlzLm1vZGlmaWVkUHJvdG90eXBlcy5jb250YWlucyhwcm90bykpIHtcclxuICAgICAgICBwcm90by5wb3Zfb3JpZ2luYWxHZXREaXNwbGF5VGV4dCA9IHByb3RvLmdldERpc3BsYXlUZXh0O1xyXG4gICAgICAgIHByb3RvLmdldERpc3BsYXlUZXh0ID0gY3JlYXRlR2V0RGlzcGxheVRleHQodGhpcy5wbHVnaW4uYXBwKTtcclxuICAgICAgICBsZXQgdXBkYXRlZENvdW50ID0gMDtcclxuICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygdmlldy5yZW5kZXJlci5ub2Rlcykge1xyXG4gICAgICAgICAgaWYgKG5vZGUudGV4dCkge1xyXG4gICAgICAgICAgICBub2RlLnRleHQudGV4dCA9IG5vZGUuZ2V0RGlzcGxheVRleHQoKTtcclxuICAgICAgICAgICAgdXBkYXRlZENvdW50Kys7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZpZXcucmVuZGVyZXIuY2hhbmdlZCgpO1xyXG4gICAgICAgIHRoaXMubW9kaWZpZWRQcm90b3R5cGVzLnB1c2gocHJvdG8pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlc3RvcmVQcm90b3R5cGVzKCkge1xyXG4gICAgZm9yIChjb25zdCBwcm90byBvZiB0aGlzLm1vZGlmaWVkUHJvdG90eXBlcykge1xyXG4gICAgICBpZiAodHlwZW9mIHByb3RvLnBvdl9vcmlnaW5hbEdldERpc3BsYXlUZXh0ID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgcHJvdG8uZ2V0RGlzcGxheVRleHQgPSBwcm90by5wb3Zfb3JpZ2luYWxHZXREaXNwbGF5VGV4dDtcclxuICAgICAgICBkZWxldGUgcHJvdG8ucG92X29yaWdpbmFsR2V0RGlzcGxheVRleHQ7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMubW9kaWZpZWRQcm90b3R5cGVzID0gW107XHJcbiAgICB0aGlzLnJld3JpdGVOYW1lcygpO1xyXG4gIH1cclxuXHJcbiAgcmV3cml0ZU5hbWVzKCkge1xyXG4gICAgY29uc3QgbGVhdmVzID0gdGhpcy5nZXRHcmFwaExlYXZlcygpO1xyXG4gICAgZm9yIChjb25zdCBsZWFmIG9mIGxlYXZlcykge1xyXG4gICAgICBpZiAoIShsZWFmLnZpZXcgaW5zdGFuY2VvZiBWaWV3KSB8fCBsZWFmLmlzRGVmZXJyZWQpIGNvbnRpbnVlO1xyXG4gICAgICBjb25zdCB2aWV3ID0gbGVhZi52aWV3IGFzIHVua25vd24gYXMgR3JhcGhWaWV3IHwgTG9jYWxHcmFwaFZpZXc7XHJcbiAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiB2aWV3LnJlbmRlcmVyLm5vZGVzKSB7XHJcbiAgICAgICAgaWYgKG5vZGUudGV4dCkgbm9kZS50ZXh0LnRleHQgPSBub2RlLmdldERpc3BsYXlUZXh0KCk7XHJcbiAgICAgIH1cclxuICAgICAgdmlldy5yZW5kZXJlci5jaGFuZ2VkKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvbkxheW91dENoYW5nZSgpIHtcclxuICAgIHRoaXMuY2xlYW51cE9ic2VydmVyKCk7XHJcblxyXG4gICAgaWYgKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JHcmFwaFZpZXcpIHtcclxuICAgICAgdGhpcy5yZXN0b3JlUHJvdG90eXBlcygpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgZ3JhcGggcGx1Z2luIGlzIGxvYWRlZCAtIGV4YWN0bHkgbGlrZSBOb2RlIE1hc3F1ZXJhZGVcclxuICAgIGNvbnN0IGFwcEludGVybmFsID0gdGhpcy5wbHVnaW4uYXBwIGFzIGFueTtcclxuICAgIGNvbnN0IGlzR3JhcGhMb2FkZWQgPSBhcHBJbnRlcm5hbC5pbnRlcm5hbFBsdWdpbnMuZ2V0UGx1Z2luQnlJZChcImdyYXBoXCIpPy5fbG9hZGVkO1xyXG4gICAgaWYgKCFpc0dyYXBoTG9hZGVkKSByZXR1cm47XHJcblxyXG4gICAgLy8gVXNlIE11dGF0aW9uT2JzZXJ2ZXIgZm9yIGEgbW9yZSBlZmZpY2llbnQgd2F5IHRvIGRldGVjdCB3aGVuIG5vZGVzIGFyZSBhZGRlZFxyXG4gICAgdGhpcy5zZXR1cE9ic2VydmVyKCk7XHJcbiAgICBcclxuICAgIC8vIEFsc28gdHJpZ2dlciBpbml0aWFsIG92ZXJyaWRlXHJcbiAgICB2b2lkIHRoaXMub3ZlcnJpZGVQcm90b3R5cGVzKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldHVwT2JzZXJ2ZXIoKSB7XHJcbiAgICAvLyBMb29rIGZvciBncmFwaCBjb250YWluZXJzIGluIGFsbCBsZWF2ZXNcclxuICAgIGNvbnN0IGxlYXZlcyA9IHRoaXMuZ2V0R3JhcGhMZWF2ZXMoKTtcclxuICAgIGZvciAoY29uc3QgbGVhZiBvZiBsZWF2ZXMpIHtcclxuICAgICAgY29uc3QgY29udGFpbmVyID0gbGVhZi52aWV3LmNvbnRhaW5lckVsO1xyXG4gICAgICBpZiAoIWNvbnRhaW5lcikgY29udGludWU7XHJcblxyXG4gICAgICBpZiAoIXRoaXMub2JzZXJ2ZXIpIHtcclxuICAgICAgICB0aGlzLm9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCkgPT4ge1xyXG4gICAgICAgICAgLy8gRGVib3VuY2UgdXBkYXRlcyB0byBhdm9pZCBleGNlc3NpdmUgcHJvY2Vzc2luZ1xyXG4gICAgICAgICAgaWYgKHRoaXMudGltZXIpIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy50aW1lcik7XHJcbiAgICAgICAgICB0aGlzLnRpbWVyID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB2b2lkIHRoaXMub3ZlcnJpZGVQcm90b3R5cGVzKCk7XHJcbiAgICAgICAgICB9LCA1MDApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBPYnNlcnZlIHRoZSBjb250YWluZXIgZm9yIGFkZGl0aW9ucyBvZiBncmFwaC1yZWxhdGVkIGVsZW1lbnRzXHJcbiAgICAgIHRoaXMub2JzZXJ2ZXIub2JzZXJ2ZShjb250YWluZXIsIHtcclxuICAgICAgICBjaGlsZExpc3Q6IHRydWUsXHJcbiAgICAgICAgc3VidHJlZTogdHJ1ZVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBGYWxsYmFjazogaWYgbm8gb2JzZXJ2ZXIgY291bGQgYmUgc2V0IHVwLCBvciBhcyBhbiBleHRyYSBzYWZldHkgbWVhc3VyZSxcclxuICAgIC8vIHdlIGNvdWxkIGtlZXAgYSB2ZXJ5IGluZnJlcXVlbnQgaW50ZXJ2YWwsIGJ1dCB0aGUgcmVxdWlyZW1lbnQgaXMgdG8gcmVwbGFjZSBpdC5cclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2xlYW51cE9ic2VydmVyKCkge1xyXG4gICAgaWYgKHRoaXMub2JzZXJ2ZXIpIHtcclxuICAgICAgdGhpcy5vYnNlcnZlci5kaXNjb25uZWN0KCk7XHJcbiAgICAgIHRoaXMub2JzZXJ2ZXIgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudGltZXIpIHtcclxuICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLnRpbWVyKTtcclxuICAgICAgdGhpcy50aW1lciA9IG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgdXBkYXRlR3JhcGhWaWV3KCkge1xyXG4gICAgLy8gVXBkYXRlIHN0YXRpYyBkaXNwbGF5IHNldHRpbmdzIHdoZW4gcGx1Z2luIHNldHRpbmdzIGNoYW5nZVxyXG4gICAgaWYgKGdyYXBoRGlzcGxheVNldHRpbmdzKSB7XHJcbiAgICAgIGdyYXBoRGlzcGxheVNldHRpbmdzLmVuYWJsZUZvckdyYXBoVmlldyA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckdyYXBoVmlldztcclxuICAgICAgZ3JhcGhEaXNwbGF5U2V0dGluZ3MucHJvcGVydHlLZXkgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9wZXJ0eUtleTtcclxuICAgICAgZ3JhcGhEaXNwbGF5U2V0dGluZ3MuZW5hYmxlTWR4U3VwcG9ydCA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZU1keFN1cHBvcnQ7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckdyYXBoVmlldykge1xyXG4gICAgICB2b2lkIHRoaXMub3ZlcnJpZGVQcm90b3R5cGVzKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnJlc3RvcmVQcm90b3R5cGVzKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZWZyZXNoR3JhcGhWaWV3KCkge1xyXG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckdyYXBoVmlldykge1xyXG4gICAgICB0aGlzLnJld3JpdGVOYW1lcygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgb251bmxvYWQoKSB7XHJcbiAgICB0aGlzLmNsZWFudXBPYnNlcnZlcigpO1xyXG4gICAgdGhpcy5yZXN0b3JlUHJvdG90eXBlcygpO1xyXG4gIH1cclxufVxyXG5cclxuIiwgImltcG9ydCB7IFRGaWxlLCBBcHAgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBQbHVnaW5TZXR0aW5ncyB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IGdldEZyb250bWF0dGVyIH0gZnJvbSAnLi9mcm9udG1hdHRlcic7XG5cbi8qKlxuICogU2ltcGxlIGNhY2hlIGZvciBmcm9udG1hdHRlciBkYXRhIHRvIHN1cHBvcnQgc3luYyBjb250ZXh0cyBsaWtlIGdyYXBoIHZpZXcuXG4gKiBcbiAqICoqV2hhdCBmb3JtYXQgaXMgZXhwZWN0ZWQ6KipcbiAqIEl0IHN0b3JlcyBhIE1hcCB3aGVyZSBrZXlzIGFyZSBmaWxlIHBhdGhzIGFuZCB2YWx1ZXMgYXJlIGVpdGhlciBhIGBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPmAgXG4gKiBjb250YWluaW5nIHRoZSBwYXJzZWQgWUFNTCBmcm9udG1hdHRlciwgb3IgYG51bGxgIGlmIG5vIGZyb250bWF0dGVyIGV4aXN0cyBvciBwYXJzaW5nIGZhaWxlZC5cbiAqIFxuICogKipXaHkgaXQncyBzZXBhcmF0ZSBmcm9tIE9ic2lkaWFuJ3MgbWV0YWRhdGEgY2FjaGU6KipcbiAqIE9ic2lkaWFuJ3MgYG1ldGFkYXRhQ2FjaGVgIHNwZWNpZmljYWxseSB0YXJnZXRzIGAubWRgIGZpbGVzLiBUaGlzIHBsdWdpbiBhZGRzIHN1cHBvcnQgZm9yIGAubWR4YCBmaWxlcyxcbiAqIHdoaWNoIE9ic2lkaWFuIHRyZWF0cyBhcyBwbGFpbiB0ZXh0LiBUaGlzIHNlcGFyYXRlIGNhY2hlIGFsbG93cyB1cyB0byBzdG9yZSBtYW51YWxseSBwYXJzZWRcbiAqIGZyb250bWF0dGVyIGZvciBNRFggZmlsZXMgc28gaXQgY2FuIGJlIGFjY2Vzc2VkIHN5bmNocm9ub3VzbHkgaW4gcGVyZm9ybWFuY2UtY3JpdGljYWwgY29udGV4dHMgXG4gKiBsaWtlIHRoZSBncmFwaCB2aWV3J3Mgbm9kZSByZW5kZXJpbmcuXG4gKiBcbiAqICoqS25vd24gbGltaXRhdGlvbnM6KipcbiAqIC0gKipNYW51YWwgUGFyc2luZzoqKiBVc2VzIGEgYmFzaWMgcmVnZXggdG8gZXh0cmFjdCBmcm9udG1hdHRlciBmcm9tIE1EWCBmaWxlcywgd2hpY2ggbWlnaHQgbm90IFxuICogICBzdXBwb3J0IGFsbCBlZGdlIGNhc2VzIG9mIFlBTUwgYmxvY2sgZGV0ZWN0aW9uIHRoYXQgT2JzaWRpYW4ncyBuYXRpdmUgcGFyc2VyIGhhbmRsZXMuXG4gKiAtICoqQXN5bmMgTmF0dXJlOioqIFBvcHVsYXRpb24gaXMgYXN5bmNocm9ub3VzLiBDb250ZXh0cyByZXF1aXJpbmcgc3luY2hyb25vdXMgYWNjZXNzIChsaWtlIGdyYXBoIG5vZGVzKSBcbiAqICAgbXVzdCBoYW5kbGUgYHVuZGVmaW5lZGAgcmVzdWx0cyBieSB0cmlnZ2VyaW5nIGFuIGFzeW5jIGxvYWQgYW5kIHJlbHlpbmcgb24gYSBmdXR1cmUgcmVmcmVzaC5cbiAqIC0gKipNZW1vcnk6KiogSXQgcmVzaWRlcyBlbnRpcmVseSBpbiBtZW1vcnkgYW5kIGlzIGludmFsaWRhdGVkIG9uIGZpbGUgbW9kaWZpY2F0aW9uIG9yIHJlbmFtZS5cbiAqL1xuY2xhc3MgRnJvbnRtYXR0ZXJDYWNoZSB7XG4gIHByaXZhdGUgY2FjaGUgPSBuZXcgTWFwPHN0cmluZywgUmVjb3JkPHN0cmluZywgdW5rbm93bj4gfCBudWxsPigpO1xuICBwcml2YXRlIHBlbmRpbmcgPSBuZXcgTWFwPHN0cmluZywgUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB8IG51bGw+PigpO1xuXG4gIGFzeW5jIGdldChhcHA6IEFwcCwgZmlsZTogVEZpbGUsIHNldHRpbmdzOiBQbHVnaW5TZXR0aW5ncyk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgdW5rbm93bj4gfCBudWxsPiB7XG4gICAgY29uc3Qga2V5ID0gZmlsZS5wYXRoO1xuXG4gICAgLy8gUmV0dXJuIGNhY2hlZCB2YWx1ZSBpZiBhdmFpbGFibGVcbiAgICBpZiAodGhpcy5jYWNoZS5oYXMoa2V5KSkge1xuICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuZ2V0KGtleSkgPz8gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBJZiBhbHJlYWR5IHBlbmRpbmcsIHdhaXQgZm9yIGl0XG4gICAgaWYgKHRoaXMucGVuZGluZy5oYXMoa2V5KSkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucGVuZGluZy5nZXQoa2V5KSE7XG4gICAgfVxuXG4gICAgLy8gU3RhcnQgcmVhZGluZ1xuICAgIGNvbnN0IHByb21pc2UgPSBnZXRGcm9udG1hdHRlcihhcHAsIGZpbGUsIHNldHRpbmdzKTtcbiAgICB0aGlzLnBlbmRpbmcuc2V0KGtleSwgcHJvbWlzZSk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvbWlzZTtcbiAgICAgIHRoaXMuY2FjaGUuc2V0KGtleSwgcmVzdWx0KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMucGVuZGluZy5kZWxldGUoa2V5KTtcbiAgICB9XG4gIH1cblxuICBnZXRTeW5jKGtleTogc3RyaW5nKTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gfCBudWxsIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5jYWNoZS5nZXQoa2V5KTtcbiAgfVxuXG4gIGludmFsaWRhdGUoa2V5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgIHRoaXMucGVuZGluZy5kZWxldGUoa2V5KTtcbiAgfVxuXG4gIGNsZWFyKCk6IHZvaWQge1xuICAgIHRoaXMuY2FjaGUuY2xlYXIoKTtcbiAgICB0aGlzLnBlbmRpbmcuY2xlYXIoKTtcbiAgfVxufVxuXG4vLyBHbG9iYWwgY2FjaGUgaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBmcm9udG1hdHRlckNhY2hlID0gbmV3IEZyb250bWF0dGVyQ2FjaGUoKTtcbiIsICJpbXBvcnQgeyBNYXJrZG93blZpZXcsIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eU92ZXJGaWxlTmFtZVBsdWdpbiB9IGZyb20gJy4uL3R5cGVzJztcclxuXHJcbi8qKlxyXG4gKiBCYWNrbGluayBTZXJ2aWNlXHJcbiAqIFxyXG4gKiBIYW5kbGVzIGRpc3BsYXlpbmcgcHJvcGVydHkgdGl0bGVzIGluc3RlYWQgb2YgZmlsZSBuYW1lcyBpbjpcclxuICogLSBFbWJlZGRlZCBiYWNrbGlua3MgKExpbmtlZCBtZW50aW9ucyBmb290ZXIgaW4gZWFjaCBub3RlKVxyXG4gKiAtIERlZGljYXRlZCBiYWNrbGlua3MgcGFuZWxcclxuICogLSBPdXRnb2luZyBsaW5rc1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEJhY2tsaW5rU2VydmljZSB7XHJcbiAgcHJpdmF0ZSBwbHVnaW46IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luO1xyXG4gIHByaXZhdGUgb2JzZXJ2ZXI/OiBNdXRhdGlvbk9ic2VydmVyO1xyXG4gIHByaXZhdGUgcHJvY2Vzc2VkRWxlbWVudHM6IFdlYWtTZXQ8SFRNTEVsZW1lbnQ+ID0gbmV3IFdlYWtTZXQoKTtcclxuICBwcml2YXRlIG1vZGlmaWVkRWxlbWVudHM6IFdlYWtTZXQ8SFRNTEVsZW1lbnQ+ID0gbmV3IFdlYWtTZXQoKTtcclxuICBwcml2YXRlIG9yaWdpbmFsVGV4dENvbnRlbnREZXNjcmlwdG9yczogTWFwPEhUTUxFbGVtZW50LCBQcm9wZXJ0eURlc2NyaXB0b3I+ID0gbmV3IE1hcCgpO1xyXG5cclxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luKSB7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBkaXNwbGF5IG5hbWUgZnJvbSBmaWxlJ3MgZnJvbnRtYXR0ZXIgcHJvcGVydHlcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGdldERpc3BsYXlOYW1lKGZpbGU6IFRGaWxlKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XHJcbiAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckJhY2tsaW5rcykge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGdldEZyb250bWF0dGVyLCBpc0ZpbGVUeXBlU3VwcG9ydGVkIH0gPSBhd2FpdCBpbXBvcnQoJy4uL3V0aWxzL2Zyb250bWF0dGVyJyk7XHJcblxyXG4gICAgLy8gU2tpcCB1bnN1cHBvcnRlZCBmaWxlIHR5cGVzXHJcbiAgICBpZiAoIWlzRmlsZVR5cGVTdXBwb3J0ZWQoZmlsZS5leHRlbnNpb24sIHRoaXMucGx1Z2luLnNldHRpbmdzKSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBmcm9udG1hdHRlciA9IGF3YWl0IGdldEZyb250bWF0dGVyKHRoaXMucGx1Z2luLmFwcCwgZmlsZSwgdGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xyXG5cclxuICAgIGlmIChmcm9udG1hdHRlciAmJiBmcm9udG1hdHRlclt0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9wZXJ0eUtleV0gIT09IHVuZGVmaW5lZCAmJiBmcm9udG1hdHRlclt0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9wZXJ0eUtleV0gIT09IG51bGwpIHtcclxuICAgICAgY29uc3QgcHJvcGVydHlWYWx1ZSA9IFN0cmluZyhmcm9udG1hdHRlclt0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9wZXJ0eUtleV0pLnRyaW0oKTtcclxuICAgICAgaWYgKHByb3BlcnR5VmFsdWUgIT09ICcnKSB7XHJcbiAgICAgICAgcmV0dXJuIHByb3BlcnR5VmFsdWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSBhbGwgYmFja2xpbmsgZGlzcGxheXNcclxuICAgKi9cclxuICB1cGRhdGVCYWNrbGlua3MoKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckJhY2tsaW5rcykge1xyXG4gICAgICB0aGlzLnN0b3BPYnNlcnZpbmcoKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVwZGF0ZSBlbWJlZGRlZCBiYWNrbGlua3MgaW4gYWxsIG1hcmtkb3duIHZpZXdzXHJcbiAgICB0aGlzLnVwZGF0ZUVtYmVkZGVkQmFja2xpbmtzKCk7XHJcblxyXG4gICAgLy8gVXBkYXRlIGRlZGljYXRlZCBiYWNrbGlua3MgcGFuZWxcclxuICAgIHZvaWQgdGhpcy51cGRhdGVEZWRpY2F0ZWRCYWNrbGlua3NQYW5lbCgpO1xyXG5cclxuICAgIC8vIFN0YXJ0IG9ic2VydmluZyBmb3IgZnV0dXJlIGNoYW5nZXNcclxuICAgIHRoaXMuc3RhcnRPYnNlcnZpbmcoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSBlbWJlZGRlZCBiYWNrbGlua3MgaW4gbWFya2Rvd24gdmlld3NcclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZUVtYmVkZGVkQmFja2xpbmtzKCk6IHZvaWQge1xyXG4gICAgZm9yIChjb25zdCBsZWFmIG9mIHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2UuZ2V0TGVhdmVzT2ZUeXBlKCdtYXJrZG93bicpKSB7XHJcbiAgICAgIGlmICghKGxlYWYudmlldyBpbnN0YW5jZW9mIE1hcmtkb3duVmlldykpIHtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgZW1iZWRkZWRCYWNrbGlua3MgPSBsZWFmLnZpZXcuY29udGFpbmVyRWwucXVlcnlTZWxlY3RvcignLmVtYmVkZGVkLWJhY2tsaW5rcycpO1xyXG4gICAgICBpZiAoZW1iZWRkZWRCYWNrbGlua3MpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZUJhY2tsaW5rQ29udGFpbmVyKGVtYmVkZGVkQmFja2xpbmtzIGFzIEhUTUxFbGVtZW50KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIGRlZGljYXRlZCBiYWNrbGlua3MgcGFuZWxcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZURlZGljYXRlZEJhY2tsaW5rc1BhbmVsKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgYmFja2xpbmtzTGVhdmVzID0gdGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoJ2JhY2tsaW5rJyk7XHJcblxyXG4gICAgZm9yIChjb25zdCBsZWFmIG9mIGJhY2tsaW5rc0xlYXZlcykge1xyXG4gICAgICBhd2FpdCBsZWFmLmxvYWRJZkRlZmVycmVkKCk7XHJcblxyXG4gICAgICBpZiAobGVhZi52aWV3KSB7XHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gKGxlYWYudmlldyBhcyB7IGNvbnRhaW5lckVsPzogSFRNTEVsZW1lbnQgfSkuY29udGFpbmVyRWw7XHJcbiAgICAgICAgaWYgKGNvbnRhaW5lcikge1xyXG4gICAgICAgICAgLy8gRmluZCBiYWNrbGlua3MgYW5kIG91dGdvaW5nIGxpbmtzIHNlY3Rpb25zXHJcbiAgICAgICAgICBjb25zdCBiYWNrbGlua3NDb250YWluZXIgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmJhY2tsaW5rcy1wYW5lJykgfHwgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5iYWNrbGluay1wYW5lJyk7XHJcbiAgICAgICAgICBpZiAoYmFja2xpbmtzQ29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQmFja2xpbmtDb250YWluZXIoYmFja2xpbmtzQ29udGFpbmVyIGFzIEhUTUxFbGVtZW50KTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAvLyBBbHNvIGNoZWNrIGZvciBvdXRnb2luZyBsaW5rc1xyXG4gICAgICAgICAgY29uc3Qgb3V0Z29pbmdMaW5rc0NvbnRhaW5lciA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcub3V0Z29pbmctbGluay1wYW5lJykgfHwgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5vdXRnb2luZy1saW5rcycpO1xyXG4gICAgICAgICAgaWYgKG91dGdvaW5nTGlua3NDb250YWluZXIpIHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVCYWNrbGlua0NvbnRhaW5lcihvdXRnb2luZ0xpbmtzQ29udGFpbmVyIGFzIEhUTUxFbGVtZW50KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEV4dHJhY3QgZmlsZSBwYXRoIGZyb20gYW4gZWxlbWVudCBvciBpdHMgcGFyZW50IGxpbmtcclxuICAgKi9cclxuICBwcml2YXRlIGV4dHJhY3RGaWxlUGF0aEZyb21FbGVtZW50KGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogVEZpbGUgfCBudWxsIHtcclxuICAgIC8vIFRyeSBkYXRhLXBhdGggYXR0cmlidXRlIGZpcnN0XHJcbiAgICBjb25zdCBkYXRhUGF0aCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXBhdGgnKTtcclxuICAgIGlmIChkYXRhUGF0aCkge1xyXG4gICAgICBjb25zdCBmaWxlID0gdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChkYXRhUGF0aCk7XHJcbiAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcclxuICAgICAgICByZXR1cm4gZmlsZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFRyeSB0byBmaW5kIGEgbGluayBlbGVtZW50IChwYXJlbnQgb3IgY2hpbGQpXHJcbiAgICBjb25zdCBsaW5rID0gZWxlbWVudC5jbG9zZXN0KCdhJykgfHwgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdhJyk7XHJcbiAgICBpZiAobGluaykge1xyXG4gICAgICBjb25zdCBocmVmID0gbGluayBpbnN0YW5jZW9mIEhUTUxBbmNob3JFbGVtZW50ID8gbGluay5ocmVmIDogKGxpbmsgYXMgRWxlbWVudCkuZ2V0QXR0cmlidXRlKCdocmVmJyk7XHJcbiAgICAgIGlmIChocmVmKSB7XHJcbiAgICAgICAgLy8gVHJ5IG9ic2lkaWFuOi8vIFVSTCBmb3JtYXRcclxuICAgICAgICBpZiAoaHJlZi5zdGFydHNXaXRoKCdvYnNpZGlhbjovLycpKSB7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKGhyZWYpO1xyXG4gICAgICAgICAgICBjb25zdCBmaWxlUGFyYW0gPSB1cmwuc2VhcmNoUGFyYW1zLmdldCgnZmlsZScpO1xyXG4gICAgICAgICAgICBpZiAoZmlsZVBhcmFtKSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgZGVjb2RlZFBhdGggPSBkZWNvZGVVUklDb21wb25lbnQoZmlsZVBhcmFtKTtcclxuICAgICAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChkZWNvZGVkUGF0aCArICcubWQnKTtcclxuICAgICAgICAgICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgICAgICAvLyBJZ25vcmUgVVJMIHBhcnNpbmcgZXJyb3JzXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBUcnkgaW50ZXJuYWwgbGluayBmb3JtYXQgKGUuZy4sICNmaWxlL3BhdGgvdG8vZmlsZSlcclxuICAgICAgICBjb25zdCBpbnRlcm5hbExpbmtNYXRjaCA9IGhyZWYubWF0Y2goLyNmaWxlXFwvKC4rKS8pO1xyXG4gICAgICAgIGlmIChpbnRlcm5hbExpbmtNYXRjaCkge1xyXG4gICAgICAgICAgY29uc3QgZmlsZVBhdGggPSBkZWNvZGVVUklDb21wb25lbnQoaW50ZXJuYWxMaW5rTWF0Y2hbMV0pO1xyXG4gICAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMucGx1Z2luLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xyXG4gICAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmlsZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFRyeSBkYXRhLWhyZWYgYXR0cmlidXRlIChPYnNpZGlhbiBzb21ldGltZXMgdXNlcyB0aGlzKVxyXG4gICAgICAgIGNvbnN0IGRhdGFIcmVmID0gbGluay5nZXRBdHRyaWJ1dGUoJ2RhdGEtaHJlZicpO1xyXG4gICAgICAgIGlmIChkYXRhSHJlZikge1xyXG4gICAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMucGx1Z2luLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZGF0YUhyZWYpO1xyXG4gICAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmlsZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBUcnkgdG8gbWF0Y2ggdGV4dCBjb250ZW50IHRvIGEgZmlsZSBiYXNlbmFtZVxyXG4gICAgY29uc3QgdGV4dENvbnRlbnQgPSBlbGVtZW50LnRleHRDb250ZW50Py50cmltKCk7XHJcbiAgICBpZiAodGV4dENvbnRlbnQpIHtcclxuICAgICAgLy8gVHJ5IHRvIGZpbmQgZmlsZSBieSBiYXNlbmFtZSAod2l0aG91dCBleHRlbnNpb24pXHJcbiAgICAgIGNvbnN0IGFsbEZpbGVzID0gdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKTtcclxuICAgICAgY29uc3QgbWF0Y2hpbmdGaWxlID0gYWxsRmlsZXMuZmluZChmID0+IGYuYmFzZW5hbWUgPT09IHRleHRDb250ZW50KTtcclxuICAgICAgaWYgKG1hdGNoaW5nRmlsZSkge1xyXG4gICAgICAgIHJldHVybiBtYXRjaGluZ0ZpbGU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSBhIGJhY2tsaW5rIGNvbnRhaW5lciBieSByZXBsYWNpbmcgZmlsZSBuYW1lcyB3aXRoIHByb3BlcnR5IHRpdGxlc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgdXBkYXRlQmFja2xpbmtDb250YWluZXIoY29udGFpbmVyOiBIVE1MRWxlbWVudCk6IHZvaWQge1xyXG4gICAgLy8gRmluZCBhbGwgcG90ZW50aWFsIGZpbGUgbmFtZSBlbGVtZW50cyBpbiB0aGUgY29udGFpbmVyXHJcbiAgICAvLyBPYnNpZGlhbiB1c2VzIHZhcmlvdXMgc2VsZWN0b3JzIGZvciBiYWNrbGluayBpdGVtc1xyXG4gICAgY29uc3Qgc2VsZWN0b3JzID0gW1xyXG4gICAgICAnLnRyZWUtaXRlbS1pbm5lcicsXHJcbiAgICAgICcuYmFja2xpbmstdGl0bGUnLFxyXG4gICAgICAnLmJhY2tsaW5rLWZpbGUtbGluaycsXHJcbiAgICAgICcub3V0Z29pbmctbGluay1maWxlLWxpbmsnLFxyXG4gICAgICAnLnRyZWUtaXRlbS1zZWxmJyxcclxuICAgICAgJy5uYXYtZmlsZS10aXRsZScsXHJcbiAgICAgICdbZGF0YS1wYXRoXScsXHJcbiAgICAgICdhLmludGVybmFsLWxpbmsnXHJcbiAgICBdO1xyXG5cclxuICAgIGNvbnN0IGZpbGVFbGVtZW50cyA9IG5ldyBTZXQ8SFRNTEVsZW1lbnQ+KCk7XHJcblxyXG4gICAgLy8gQ29sbGVjdCBhbGwgcG90ZW50aWFsIGVsZW1lbnRzXHJcbiAgICBzZWxlY3RvcnMuZm9yRWFjaChzZWxlY3RvciA9PiB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpLmZvckVhY2goZWwgPT4ge1xyXG4gICAgICAgICAgZmlsZUVsZW1lbnRzLmFkZChlbCBhcyBIVE1MRWxlbWVudCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgIC8vIElnbm9yZSBpbnZhbGlkIHNlbGVjdG9yIGVycm9yc1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBmaWxlRWxlbWVudHMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xyXG4gICAgICAvLyBTa2lwIGlmIGFscmVhZHkgcHJvY2Vzc2VkIGluIHRoaXMgdXBkYXRlIGN5Y2xlXHJcbiAgICAgIGlmICh0aGlzLnByb2Nlc3NlZEVsZW1lbnRzLmhhcyhlbGVtZW50KSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gRXh0cmFjdCBmaWxlIGZyb20gZWxlbWVudFxyXG4gICAgICBjb25zdCBmaWxlID0gdGhpcy5leHRyYWN0RmlsZVBhdGhGcm9tRWxlbWVudChlbGVtZW50KTtcclxuICAgICAgaWYgKGZpbGUgJiYgZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVFbGVtZW50V2l0aEZpbGUoZWxlbWVudCwgZmlsZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIGFuIGVsZW1lbnQgd2l0aCBmaWxlJ3MgZGlzcGxheSBuYW1lXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVFbGVtZW50V2l0aEZpbGUoZWxlbWVudDogSFRNTEVsZW1lbnQsIGZpbGU6IFRGaWxlKTogdm9pZCB7XHJcbiAgICB2b2lkIChhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gYXdhaXQgdGhpcy5nZXREaXNwbGF5TmFtZShmaWxlKTtcclxuXHJcbiAgICAgIGlmIChkaXNwbGF5TmFtZSA9PT0gbnVsbCkge1xyXG4gICAgICAgIC8vIE5vIHByb3BlcnR5LCB1c2UgZGVmYXVsdCBiZWhhdmlvciAoZmlsZSBuYW1lKVxyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gTWFyayBhcyBwcm9jZXNzZWRcclxuICAgICAgdGhpcy5wcm9jZXNzZWRFbGVtZW50cy5hZGQoZWxlbWVudCk7XHJcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXBvdi1wcm9jZXNzZWQnLCAndHJ1ZScpO1xyXG5cclxuICAgICAgLy8gRmluZCB0aGUgdGV4dCBub2RlIG9yIGVsZW1lbnQgdGhhdCBjb250YWlucyB0aGUgZmlsZSBuYW1lXHJcbiAgICAgIGNvbnN0IGN1cnJlbnRUZXh0ID0gZWxlbWVudC50ZXh0Q29udGVudD8udHJpbSgpIHx8ICcnO1xyXG4gICAgICBjb25zdCBiYXNlbmFtZSA9IGZpbGUuYmFzZW5hbWU7XHJcblxyXG4gICAgICAvLyBPbmx5IHVwZGF0ZSBpZiB0aGUgY3VycmVudCB0ZXh0IG1hdGNoZXMgdGhlIGJhc2VuYW1lIG9yIGZpbGUgbmFtZVxyXG4gICAgICAvLyBUaGlzIHByZXZlbnRzIG92ZXJ3cml0aW5nIGN1c3RvbSB0ZXh0IHRoYXQgbWlnaHQgYWxyZWFkeSBiZSBzZXRcclxuICAgICAgaWYgKGN1cnJlbnRUZXh0ID09PSBiYXNlbmFtZSB8fCBjdXJyZW50VGV4dCA9PT0gZmlsZS5uYW1lIHx8IGN1cnJlbnRUZXh0LmVuZHNXaXRoKGJhc2VuYW1lKSkge1xyXG4gICAgICAgIC8vIEZpbmQgdGhlIGxpbmsgZWxlbWVudCAoaWYgYW55KVxyXG4gICAgICAgIGNvbnN0IGxpbmsgPSBlbGVtZW50LmNsb3Nlc3QoJ2EnKSB8fCBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2EnKTtcclxuICAgICAgICBjb25zdCB0YXJnZXRFbGVtZW50ID0gbGluayB8fCBlbGVtZW50O1xyXG5cclxuICAgICAgICAvLyBUcnkgdG8gcHJlc2VydmUgdGhlIHN0cnVjdHVyZSB3aGlsZSB1cGRhdGluZyB0ZXh0XHJcbiAgICAgICAgLy8gTG9vayBmb3IgdGV4dCBub2RlcyBvciBlbGVtZW50cyB0aGF0IGNvbnRhaW4gdGhlIGZpbGUgbmFtZVxyXG4gICAgICAgIGNvbnN0IHVwZGF0ZVRleHRJbkVsZW1lbnQgPSAoZWw6IEhUTUxFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAvLyBDaGVjayBpZiBlbGVtZW50IGhhcyBhIHNpbmdsZSB0ZXh0IG5vZGUgY2hpbGRcclxuICAgICAgICAgIGlmIChlbC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMSAmJiBlbC5jaGlsZE5vZGVzWzBdLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSkge1xyXG4gICAgICAgICAgICBlbC50ZXh0Q29udGVudCA9IGRpc3BsYXlOYW1lO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAvLyBMb29rIGZvciB0ZXh0IG5vZGVzXHJcbiAgICAgICAgICBjb25zdCB0ZXh0Tm9kZXMgPSBBcnJheS5mcm9tKGVsLmNoaWxkTm9kZXMpLmZpbHRlcihub2RlID0+IG5vZGUubm9kZVR5cGUgPT09IE5vZGUuVEVYVF9OT0RFKTtcclxuICAgICAgICAgIGlmICh0ZXh0Tm9kZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGZpcnN0IHRleHQgbm9kZVxyXG4gICAgICAgICAgICB0ZXh0Tm9kZXNbMF0udGV4dENvbnRlbnQgPSBkaXNwbGF5TmFtZTtcclxuICAgICAgICAgICAgLy8gUmVtb3ZlIG90aGVyIHRleHQgbm9kZXMgdG8gYXZvaWQgZHVwbGljYXRpb25cclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0ZXh0Tm9kZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICB0ZXh0Tm9kZXNbaV0ucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgLy8gSWYgbm8gdGV4dCBub2RlcywgY2hlY2sgaWYgd2Ugc2hvdWxkIHJlcGxhY2UgYWxsIGNvbnRlbnRcclxuICAgICAgICAgIC8vIE9ubHkgZG8gdGhpcyBpZiB0aGUgZWxlbWVudCdzIHRleHQgbWF0Y2hlcyB0aGUgZmlsZSBuYW1lXHJcbiAgICAgICAgICBpZiAoZWwudGV4dENvbnRlbnQ/LnRyaW0oKSA9PT0gYmFzZW5hbWUgfHwgZWwudGV4dENvbnRlbnQ/LnRyaW0oKSA9PT0gZmlsZS5uYW1lKSB7XHJcbiAgICAgICAgICAgIGVsLnRleHRDb250ZW50ID0gZGlzcGxheU5hbWU7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBUcnkgdG8gdXBkYXRlIHRoZSBsaW5rIGZpcnN0LCB0aGVuIGZhbGwgYmFjayB0byBlbGVtZW50XHJcbiAgICAgICAgaWYgKCF1cGRhdGVUZXh0SW5FbGVtZW50KHRhcmdldEVsZW1lbnQpKSB7XHJcbiAgICAgICAgICAvLyBJZiBsaW5rIHVwZGF0ZSBmYWlsZWQsIHRyeSB0aGUgZWxlbWVudCBpdHNlbGZcclxuICAgICAgICAgIHVwZGF0ZVRleHRJbkVsZW1lbnQoZWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgb2JzZXJ2aW5nIERPTSBjaGFuZ2VzIGZvciBiYWNrbGlua3NcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXJ0T2JzZXJ2aW5nKCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMub2JzZXJ2ZXIpIHtcclxuICAgICAgcmV0dXJuOyAvLyBBbHJlYWR5IG9ic2VydmluZ1xyXG4gICAgfVxyXG5cclxuICAgIC8vIE92ZXJyaWRlIHRleHRDb250ZW50IG9uIGJhY2tsaW5rIGVsZW1lbnRzIHRvIGludGVyY2VwdCBpbW1lZGlhdGVseVxyXG4gICAgdGhpcy5vdmVycmlkZUJhY2tsaW5rRWxlbWVudHMoKTtcclxuXHJcbiAgICBsZXQgdXBkYXRlVGltZW91dDogUmV0dXJuVHlwZTx0eXBlb2Ygc2V0VGltZW91dD4gfCBudWxsID0gbnVsbDtcclxuXHJcbiAgICB0aGlzLm9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKG11dGF0aW9ucykgPT4ge1xyXG4gICAgICAvLyBDaGVjayBpZiBhbnkgbXV0YXRpb25zIGFmZmVjdCBiYWNrbGluayBjb250YWluZXJzXHJcbiAgICAgIGxldCBzaG91bGRVcGRhdGUgPSBmYWxzZTtcclxuICAgICAgY29uc3QgbmV3RWxlbWVudHM6IEhUTUxFbGVtZW50W10gPSBbXTtcclxuXHJcbiAgICAgIGZvciAoY29uc3QgbXV0YXRpb24gb2YgbXV0YXRpb25zKSB7XHJcbiAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT09ICdjaGlsZExpc3QnKSB7XHJcbiAgICAgICAgICAvLyBDaGVjayBmb3IgbmV3IGVsZW1lbnRzIHRoYXQgbWlnaHQgYmUgYmFja2xpbmtzXHJcbiAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgQXJyYXkuZnJvbShtdXRhdGlvbi5hZGRlZE5vZGVzKSkge1xyXG4gICAgICAgICAgICBpZiAobm9kZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgZW1iZWRkZWRCYWNrbGlua3MgPSBub2RlLmNsb3Nlc3QoJy5lbWJlZGRlZC1iYWNrbGlua3MnKTtcclxuICAgICAgICAgICAgICBjb25zdCBiYWNrbGlua3NQYW5lbCA9IG5vZGUuY2xvc2VzdCgnLmJhY2tsaW5rcy1wYW5lLCAuYmFja2xpbmstcGFuZSwgLm91dGdvaW5nLWxpbmstcGFuZSwgLm91dGdvaW5nLWxpbmtzLCAuYmFja2xpbmstY29udGFpbmVyJyk7XHJcblxyXG4gICAgICAgICAgICAgIGlmIChlbWJlZGRlZEJhY2tsaW5rcyB8fCBiYWNrbGlua3NQYW5lbCkge1xyXG4gICAgICAgICAgICAgICAgc2hvdWxkVXBkYXRlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIC8vIEZpbmQgcG90ZW50aWFsIGJhY2tsaW5rIGVsZW1lbnRzIGluIHRoZSBuZXcgbm9kZVxyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0b3JzID0gWycudHJlZS1pdGVtLWlubmVyJywgJy5iYWNrbGluay10aXRsZScsICcuYmFja2xpbmstZmlsZS1saW5rJywgJy5vdXRnb2luZy1saW5rLWZpbGUtbGluaycsICcudHJlZS1pdGVtLXNlbGYnLCAnLm5hdi1maWxlLXRpdGxlJywgJ1tkYXRhLXBhdGhdJywgJ2EuaW50ZXJuYWwtbGluayddO1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0b3JzLmZvckVhY2goc2VsZWN0b3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRzID0gbm9kZS5xdWVyeVNlbGVjdG9yQWxsPy4oc2VsZWN0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzPy5mb3JFYWNoKChlbDogRWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgaWYgKGVsIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3RWxlbWVudHMucHVzaChlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKG11dGF0aW9uLnR5cGUgPT09ICdjaGFyYWN0ZXJEYXRhJykge1xyXG4gICAgICAgICAgY29uc3QgdGFyZ2V0ID0gbXV0YXRpb24udGFyZ2V0O1xyXG5cclxuICAgICAgICAgIC8vIENoZWNrIGlmIG11dGF0aW9uIGlzIGluIGEgYmFja2xpbmsgY29udGFpbmVyXHJcbiAgICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgY29uc3QgZW1iZWRkZWRCYWNrbGlua3MgPSB0YXJnZXQuY2xvc2VzdCgnLmVtYmVkZGVkLWJhY2tsaW5rcycpO1xyXG4gICAgICAgICAgICBjb25zdCBiYWNrbGlua3NQYW5lbCA9IHRhcmdldC5jbG9zZXN0KCcuYmFja2xpbmtzLXBhbmUsIC5iYWNrbGluay1wYW5lLCAub3V0Z29pbmctbGluay1wYW5lLCAub3V0Z29pbmctbGlua3MsIC5iYWNrbGluay1jb250YWluZXInKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChlbWJlZGRlZEJhY2tsaW5rcyB8fCBiYWNrbGlua3NQYW5lbCkge1xyXG4gICAgICAgICAgICAgIHNob3VsZFVwZGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LnBhcmVudEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgLy8gQ2hlY2sgcGFyZW50IGVsZW1lbnRcclxuICAgICAgICAgICAgY29uc3QgZW1iZWRkZWRCYWNrbGlua3MgPSB0YXJnZXQucGFyZW50RWxlbWVudC5jbG9zZXN0KCcuZW1iZWRkZWQtYmFja2xpbmtzJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGJhY2tsaW5rc1BhbmVsID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQuY2xvc2VzdCgnLmJhY2tsaW5rcy1wYW5lLCAuYmFja2xpbmstcGFuZSwgLm91dGdvaW5nLWxpbmstcGFuZSwgLm91dGdvaW5nLWxpbmtzLCAuYmFja2xpbmstY29udGFpbmVyJyk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZW1iZWRkZWRCYWNrbGlua3MgfHwgYmFja2xpbmtzUGFuZWwpIHtcclxuICAgICAgICAgICAgICBzaG91bGRVcGRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBPdmVycmlkZSBuZXcgZWxlbWVudHMgaW1tZWRpYXRlbHkgYW5kIHVwZGF0ZSB0aGVtXHJcbiAgICAgIG5ld0VsZW1lbnRzLmZvckVhY2goZWwgPT4ge1xyXG4gICAgICAgIHRoaXMub3ZlcnJpZGVFbGVtZW50VGV4dENvbnRlbnQoZWwpO1xyXG4gICAgICAgIC8vIEFsc28gdHJ5IHRvIHVwZGF0ZSBpbW1lZGlhdGVseSBpZiB3ZSBjYW4gZXh0cmFjdCB0aGUgZmlsZVxyXG4gICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmV4dHJhY3RGaWxlUGF0aEZyb21FbGVtZW50KGVsKTtcclxuICAgICAgICBpZiAoZmlsZSAmJiBmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcclxuICAgICAgICAgIHZvaWQgKGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGlzcGxheU5hbWUgPSBhd2FpdCB0aGlzLmdldERpc3BsYXlOYW1lKGZpbGUpO1xyXG4gICAgICAgICAgICBpZiAoZGlzcGxheU5hbWUpIHtcclxuICAgICAgICAgICAgICAvLyBDaGVjayBjdXJyZW50IHRleHQgYW5kIHJlcGxhY2UgaWYgaXQncyB0aGUgZmlsZW5hbWVcclxuICAgICAgICAgICAgICBjb25zdCBjdXJyZW50VGV4dCA9IGVsLnRleHRDb250ZW50Py50cmltKCkgfHwgJyc7XHJcbiAgICAgICAgICAgICAgaWYgKGN1cnJlbnRUZXh0ID09PSBmaWxlLmJhc2VuYW1lIHx8IGN1cnJlbnRUZXh0ID09PSBmaWxlLm5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGVsLnRleHRDb250ZW50ID0gZGlzcGxheU5hbWU7XHJcbiAgICAgICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtcG92LXByb2Nlc3NlZCcsICd0cnVlJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NlZEVsZW1lbnRzLmFkZChlbCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoc2hvdWxkVXBkYXRlKSB7XHJcbiAgICAgICAgLy8gQ2xlYXIgcHJvY2Vzc2VkIGVsZW1lbnRzIGNhY2hlIHdoZW4gdXBkYXRpbmdcclxuICAgICAgICB0aGlzLnByb2Nlc3NlZEVsZW1lbnRzID0gbmV3IFdlYWtTZXQoKTtcclxuXHJcbiAgICAgICAgLy8gRGVib3VuY2UgdXBkYXRlcyB0byBhdm9pZCBleGNlc3NpdmUgcHJvY2Vzc2luZ1xyXG4gICAgICAgIGlmICh1cGRhdGVUaW1lb3V0KSB7XHJcbiAgICAgICAgICBjbGVhclRpbWVvdXQodXBkYXRlVGltZW91dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHVwZGF0ZVRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIHRoaXMudXBkYXRlQmFja2xpbmtzKCk7XHJcbiAgICAgICAgICB0aGlzLm92ZXJyaWRlQmFja2xpbmtFbGVtZW50cygpOyAvLyBSZS1vdmVycmlkZSBpbiBjYXNlIG5ldyBlbGVtZW50cyB3ZXJlIGFkZGVkXHJcbiAgICAgICAgICB1cGRhdGVUaW1lb3V0ID0gbnVsbDtcclxuICAgICAgICB9LCAxMCk7IC8vIFZlcnkgc2hvcnQgZGVsYXkgZm9yIGZhc3RlciB1cGRhdGVzXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIE9ic2VydmUgdGhlIGVudGlyZSBkb2N1bWVudCBmb3IgY2hhbmdlc1xyXG4gICAgdGhpcy5vYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHtcclxuICAgICAgY2hpbGRMaXN0OiB0cnVlLFxyXG4gICAgICBzdWJ0cmVlOiB0cnVlLFxyXG4gICAgICBjaGFyYWN0ZXJEYXRhOiB0cnVlLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBPdmVycmlkZSB0ZXh0Q29udGVudCBvbiBhbGwgYmFja2xpbmsgZWxlbWVudHNcclxuICAgKi9cclxuICBwcml2YXRlIG92ZXJyaWRlQmFja2xpbmtFbGVtZW50cygpOiB2b2lkIHtcclxuICAgIGNvbnN0IHNlbGVjdG9ycyA9IFtcclxuICAgICAgJy50cmVlLWl0ZW0taW5uZXInLFxyXG4gICAgICAnLmJhY2tsaW5rLXRpdGxlJyxcclxuICAgICAgJy5iYWNrbGluay1maWxlLWxpbmsnLFxyXG4gICAgICAnLm91dGdvaW5nLWxpbmstZmlsZS1saW5rJyxcclxuICAgICAgJy50cmVlLWl0ZW0tc2VsZicsXHJcbiAgICAgICcubmF2LWZpbGUtdGl0bGUnLFxyXG4gICAgICAnW2RhdGEtcGF0aF0nLFxyXG4gICAgICAnYS5pbnRlcm5hbC1saW5rJ1xyXG4gICAgXTtcclxuXHJcbiAgICBjb25zdCBjb250YWluZXJzID0gW1xyXG4gICAgICAuLi5BcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5lbWJlZGRlZC1iYWNrbGlua3MnKSksXHJcbiAgICAgIC4uLkFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJhY2tsaW5rcy1wYW5lJykpLFxyXG4gICAgICAuLi5BcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5iYWNrbGluay1wYW5lJykpLFxyXG4gICAgICAuLi5BcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5vdXRnb2luZy1saW5rLXBhbmUnKSksXHJcbiAgICAgIC4uLkFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm91dGdvaW5nLWxpbmtzJykpLFxyXG4gICAgICAuLi5BcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5iYWNrbGluay1jb250YWluZXInKSlcclxuICAgIF07XHJcblxyXG4gICAgY29udGFpbmVycy5mb3JFYWNoKGNvbnRhaW5lciA9PiB7XHJcbiAgICAgIHNlbGVjdG9ycy5mb3JFYWNoKHNlbGVjdG9yID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpLmZvckVhY2goZWwgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZWwgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgIHRoaXMub3ZlcnJpZGVFbGVtZW50VGV4dENvbnRlbnQoZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9IGNhdGNoIHtcclxuICAgICAgICAgIC8vIElnbm9yZSBpbnZhbGlkIHNlbGVjdG9yIGVycm9yc1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE92ZXJyaWRlIHRleHRDb250ZW50IHNldHRlciBvbiBhbiBlbGVtZW50IHRvIGludGVyY2VwdCBPYnNpZGlhbidzIHVwZGF0ZXNcclxuICAgKi9cclxuICBwcml2YXRlIG92ZXJyaWRlRWxlbWVudFRleHRDb250ZW50KGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5tb2RpZmllZEVsZW1lbnRzLmhhcyhlbGVtZW50KSkge1xyXG4gICAgICByZXR1cm47IC8vIEFscmVhZHkgb3ZlcnJpZGRlblxyXG4gICAgfVxyXG5cclxuICAgIC8vIFN0b3JlIG9yaWdpbmFsIHRleHRDb250ZW50IGRlc2NyaXB0b3IgaWYgaXQgZXhpc3RzXHJcbiAgICBjb25zdCBwcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihlbGVtZW50KSBhcyB7IHRleHRDb250ZW50PzogUHJvcGVydHlEZXNjcmlwdG9yIH07XHJcbiAgICBjb25zdCBvcmlnaW5hbERlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHByb3RvLCAndGV4dENvbnRlbnQnKTtcclxuXHJcbiAgICBpZiAob3JpZ2luYWxEZXNjcmlwdG9yICYmIG9yaWdpbmFsRGVzY3JpcHRvci5zZXQpIHtcclxuICAgICAgdGhpcy5vcmlnaW5hbFRleHRDb250ZW50RGVzY3JpcHRvcnMuc2V0KGVsZW1lbnQsIG9yaWdpbmFsRGVzY3JpcHRvcik7XHJcblxyXG4gICAgICAvLyBPdmVycmlkZSB0ZXh0Q29udGVudCBzZXR0ZXJcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZWxlbWVudCwgJ3RleHRDb250ZW50Jywge1xyXG4gICAgICAgICAgc2V0OiAodmFsdWU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAvLyBDaGVjayBpZiB0aGlzIGxvb2tzIGxpa2UgYSBmaWxlbmFtZSB0aGF0IHNob3VsZCBiZSByZXBsYWNlZFxyXG4gICAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5leHRyYWN0RmlsZVBhdGhGcm9tRWxlbWVudChlbGVtZW50KTtcclxuICAgICAgICAgICAgaWYgKGZpbGUgJiYgZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XHJcbiAgICAgICAgICAgICAgdm9pZCAoYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGlzcGxheU5hbWUgPSBhd2FpdCB0aGlzLmdldERpc3BsYXlOYW1lKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGRpc3BsYXlOYW1lICYmICh2YWx1ZSA9PT0gZmlsZS5iYXNlbmFtZSB8fCB2YWx1ZSA9PT0gZmlsZS5uYW1lIHx8IHZhbHVlLmVuZHNXaXRoKGZpbGUuYmFzZW5hbWUpKSkge1xyXG4gICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIHdpdGggcHJvcGVydHkgdmFsdWUgdXNpbmcgb3JpZ2luYWwgc2V0dGVyXHJcbiAgICAgICAgICAgICAgICAgIG9yaWdpbmFsRGVzY3JpcHRvci5zZXQhLmNhbGwoZWxlbWVudCwgZGlzcGxheU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAvLyBNYXJrIGFzIHByb2Nlc3NlZFxyXG4gICAgICAgICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1wb3YtcHJvY2Vzc2VkJywgJ3RydWUnKTtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzZWRFbGVtZW50cy5hZGQoZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIE5vdCBhIGZpbGVuYW1lIG9yIG5vIHByb3BlcnR5LCB1c2Ugb3JpZ2luYWwgYmVoYXZpb3JcclxuICAgICAgICAgICAgICAgIG9yaWdpbmFsRGVzY3JpcHRvci5zZXQhLmNhbGwoZWxlbWVudCwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgIH0pKCk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBOb3QgYSBmaWxlbmFtZSBvciBubyBwcm9wZXJ0eSwgdXNlIG9yaWdpbmFsIGJlaGF2aW9yXHJcbiAgICAgICAgICAgIG9yaWdpbmFsRGVzY3JpcHRvci5zZXQhLmNhbGwoZWxlbWVudCwgdmFsdWUpO1xyXG4gICAgICAgICAgICAvLyBNYXJrIGFzIHByb2Nlc3NlZFxyXG4gICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1wb3YtcHJvY2Vzc2VkJywgJ3RydWUnKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3VuYm91bmQtbWV0aG9kIC0tIGFjY2Vzc2luZyBwcm9wZXJ0eSBkZXNjcmlwdG9yIG9yaWdpbmFsIHNldHRlclxyXG4gICAgICAgICAgZ2V0OiBvcmlnaW5hbERlc2NyaXB0b3IuZ2V0IHx8ICgoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIEZhbGxiYWNrOiBhY2Nlc3MgdGhlIG5hdGl2ZSB0ZXh0Q29udGVudCBwcm9wZXJ0eSBkaXJlY3RseVxyXG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihIVE1MRWxlbWVudC5wcm90b3R5cGUsICd0ZXh0Q29udGVudCcpPy5nZXQ/LmNhbGwoZWxlbWVudCkgYXMgc3RyaW5nIHx8ICcnO1xyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXHJcbiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgIC8vIElmIG92ZXJyaWRlIGZhaWxzIChlLmcuLCBwcm9wZXJ0eSBpcyBub3QgY29uZmlndXJhYmxlKSwgZmFsbCBiYWNrIHRvIG1vbml0b3JpbmdcclxuICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1wb3YtcHJvY2Vzc2VkJywgJ3RydWUnKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gRmFsbGJhY2s6IGNhbid0IG92ZXJyaWRlLCBidXQgbWFyayBhcyBwcm9jZXNzZWQgc28gQ1NTIGRvZXNuJ3QgaGlkZSBpdFxyXG4gICAgICAvLyBUaGUgbXV0YXRpb24gb2JzZXJ2ZXIgd2lsbCBjYXRjaCBhbmQgdXBkYXRlIGl0XHJcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXBvdi1wcm9jZXNzZWQnLCAndHJ1ZScpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMubW9kaWZpZWRFbGVtZW50cy5hZGQoZWxlbWVudCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdG9wIG9ic2VydmluZyBET00gY2hhbmdlc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RvcE9ic2VydmluZygpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLm9ic2VydmVyKSB7XHJcbiAgICAgIHRoaXMub2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xyXG4gICAgICB0aGlzLm9ic2VydmVyID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGFuZGxlIGxheW91dCBjaGFuZ2VzXHJcbiAgICovXHJcbiAgb25MYXlvdXRDaGFuZ2UoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yQmFja2xpbmtzKSB7XHJcbiAgICAgIC8vIFNtYWxsIGRlbGF5IHRvIGxldCBPYnNpZGlhbiByZW5kZXIgZmlyc3RcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVCYWNrbGlua3MoKTtcclxuICAgICAgfSwgMTAwKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc3RvcE9ic2VydmluZygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGFuZGxlIGZpbGUgb3BlbiBldmVudHNcclxuICAgKi9cclxuICBvbkZpbGVPcGVuKCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckJhY2tsaW5rcykge1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLnVwZGF0ZUVtYmVkZGVkQmFja2xpbmtzKCk7XHJcbiAgICAgIH0sIDIwMCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDbGVhbiB1cCBvbiB1bmxvYWRcclxuICAgKi9cclxuICBvbnVubG9hZCgpOiB2b2lkIHtcclxuICAgIHRoaXMuc3RvcE9ic2VydmluZygpO1xyXG5cclxuICAgIC8vIFJlc3RvcmUgb3JpZ2luYWwgdGV4dENvbnRlbnQgZGVzY3JpcHRvcnNcclxuICAgIHRoaXMub3JpZ2luYWxUZXh0Q29udGVudERlc2NyaXB0b3JzLmZvckVhY2goKGRlc2NyaXB0b3IsIGVsZW1lbnQpID0+IHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZWxlbWVudCwgJ3RleHRDb250ZW50JywgZGVzY3JpcHRvcik7XHJcbiAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgIC8vIElnbm9yZSBlcnJvcnMgd2hlbiByZXN0b3JpbmdcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLm9yaWdpbmFsVGV4dENvbnRlbnREZXNjcmlwdG9ycy5jbGVhcigpO1xyXG4gICAgdGhpcy5tb2RpZmllZEVsZW1lbnRzID0gbmV3IFdlYWtTZXQoKTtcclxuICB9XHJcbn1cclxuXHJcbiIsICIvKipcbiAqIFRhYiBTZXJ2aWNlXG4gKiBcbiAqIFRoaXMgZmlsZSBjb250YWlucyBjb2RlIGFkYXB0ZWQgZnJvbSB0aGUgVGl0bGUtb25seSBUYWIgcGx1Z2luIGJ5IHRyaXN0b25lMTN0aC5cbiAqIE9yaWdpbmFsIHNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL3RyaXN0b25lMTN0aC9vYnNpZGlhbi10aXRsZS1vbmx5LXRhYlxuICogXG4gKiBUaGUgY29kZSBoYXMgYmVlbiBtb2RpZmllZCB0byBpbnRlZ3JhdGUgd2l0aCB0aGUgUHJvcGVydHkgT3ZlciBGaWxlIE5hbWUgcGx1Z2luXG4gKiBhbmQgdXNlIHRoZSBwbHVnaW4ncyBwcm9wZXJ0eSBrZXkgc2V0dGluZyBpbnN0ZWFkIG9mIGhhcmRjb2RlZCBcInRpdGxlXCIgcHJvcGVydHkuXG4gKiBcbiAqIE9yaWdpbmFsIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgTUlULiBUaGlzIGZpbGUgaXMgYWxzbyBsaWNlbnNlZCB1bmRlciBHUEx2My5cbiAqL1xuXG5pbXBvcnQgeyBNYXJrZG93blZpZXcsIFdvcmtzcGFjZUxlYWYsIEV2ZW50UmVmIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgUHJvcGVydHlPdmVyRmlsZU5hbWVQbHVnaW4gfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBnZXRGcm9udG1hdHRlciB9IGZyb20gJy4uL3V0aWxzL2Zyb250bWF0dGVyJztcblxuZXhwb3J0IGNsYXNzIFRhYlNlcnZpY2Uge1xuICBwcml2YXRlIHBsdWdpbjogUHJvcGVydHlPdmVyRmlsZU5hbWVQbHVnaW47XG4gIHByaXZhdGUgbGVhZkV2ZW50UmVmczogTWFwPFdvcmtzcGFjZUxlYWYsIEV2ZW50UmVmPiA9IG5ldyBNYXAoKTtcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICAvKipcbiAgICogUmVuYW1lcyBhbGwgbWFya2Rvd24gdGFicyB0byB1c2UgdGhlIGNvbmZpZ3VyZWQgcHJvcGVydHkgdmFsdWVcbiAgICogRmFsbHMgYmFjayB0byBmaWxlIGJhc2VuYW1lIGlmIHByb3BlcnR5IGlzIG5vdCBmb3VuZFxuICAgKiBFWEFDVCBjb3B5IG9mIHRoZSB3b3JraW5nIGltcGxlbWVudGF0aW9uIGZyb20gb2JzaWRpYW4tdGl0bGUtb25seS10YWJcbiAgICovXG4gIHJlbmFtZVRhYnMoKSB7XG4gICAgY29uc3QgbGVhdmVzID0gdGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoJ21hcmtkb3duJyk7XG4gICAgbGVhdmVzLmZvckVhY2goKGxlYWYpID0+IHtcbiAgICAgIC8qXG4gICAgICAgKiBXaGVuIE9ic2lkaWFuIGZpcnN0IG9wZW5zLCBkdWUgdG8gbGF6eSBsb2FkaW5nLCB0aGUgdmlldyBtYXkgbm90IGhhdmVcbiAgICAgICAqIGEgZmlsZSBwcm9wZXJ0eS4gV2UgbmVlZCB0byBtYW51YWxseSB0cmlnZ2VyIGEgcmVsb2FkLiBCeSB1c2luZyBzZXRWaWV3U3RhdGVcbiAgICAgICAqIHRvIHJlYXBwbHkgdGhlIHZpZXcgc3RhdGUsIHdlIGZvcmNlIHRoZSB2aWV3IHRvIHJlaW5pdGlhbGl6ZSBhbmQgbG9hZCB0aGVcbiAgICAgICAqIGNvcnJlc3BvbmRpbmcgZmlsZSwgdGh1cyBwb3B1bGF0aW5nIHRoZSBmaWxlIHByb3BlcnR5LiBJZiBtYW55IHRhYnMgYXJlIG9wZW4sXG4gICAgICAgKiB0aGlzIG1heSBzbGlnaHRseSBpbmNyZWFzZSBzdGFydHVwIHRpbWUuXG4gICAgICAgKi9cbiAgICAgIGNvbnN0IHZpZXcgPSBsZWFmLnZpZXcgYXMgTWFya2Rvd25WaWV3O1xuICAgICAgY29uc3Qgc3RhdGUgPSBsZWFmLmdldFZpZXdTdGF0ZSgpO1xuICAgICAgaWYgKHN0YXRlLnN0YXRlPy5maWxlICYmICF2aWV3Py5maWxlKSB7XG4gICAgICAgIHZvaWQgbGVhZi5zZXRWaWV3U3RhdGUoeyB0eXBlOiBzdGF0ZS50eXBlLCBzdGF0ZTogc3RhdGUuc3RhdGUgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmICh2aWV3Py5maWxlKSB7XG4gICAgICAgIGNvbnN0IGZpbGUgPSB2aWV3LmZpbGU7XG4gICAgICAgIC8vIFVzZSBhc3luYyB2ZXJzaW9uIHRvIHN1cHBvcnQgTURYIGZpbGVzXG4gICAgICAgIHZvaWQgKGFzeW5jICgpID0+IHtcbiAgICAgICAgICBjb25zdCBmcm9udG1hdHRlciA9IGF3YWl0IGdldEZyb250bWF0dGVyKHRoaXMucGx1Z2luLmFwcCwgZmlsZSwgdGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xuICAgICAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSBmcm9udG1hdHRlcj8uW3RoaXMucGx1Z2luLnNldHRpbmdzLnByb3BlcnR5S2V5XSBhcyBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICAgICAgY29uc3QgdGFiSGVhZGVyRWwgPSAobGVhZiBhcyB7IHRhYkhlYWRlckVsPzogSFRNTEVsZW1lbnQgfSkudGFiSGVhZGVyRWw7XG5cbiAgICAgICAgICBpZiAodGFiSGVhZGVyRWwpIHtcbiAgICAgICAgICAgIC8vIEFsd2F5cyBtYXJrIHRhYnMgYXMgcHJvY2Vzc2VkIHNvIHRoZXkncmUgbm90IGRpbW1lZCAoZXZlbiB3aGVuIGZlYXR1cmUgaXMgZGlzYWJsZWQpXG4gICAgICAgICAgICB0YWJIZWFkZXJFbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtcG92LXRpdGxlLXNldCcsICd0cnVlJyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIE9ubHkgY2hhbmdlIHRoZSB0aXRsZSBpZiB0aGUgZmVhdHVyZSBpcyBlbmFibGVkXG4gICAgICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yVGFicykge1xuICAgICAgICAgICAgICBjb25zdCB0aXRsZUVsID0gdGFiSGVhZGVyRWwucXVlcnlTZWxlY3RvcignLndvcmtzcGFjZS10YWItaGVhZGVyLWlubmVyLXRpdGxlJyk7XG4gICAgICAgICAgICAgIGNvbnN0IGRpc3BsYXlUZXh0ID0gcHJvcGVydHlWYWx1ZSA/IFN0cmluZyhwcm9wZXJ0eVZhbHVlKSA6IGZpbGUuYmFzZW5hbWU7XG4gICAgICAgICAgICAgIGlmICh0aXRsZUVsKSB7XG4gICAgICAgICAgICAgICAgdGl0bGVFbC5zZXRUZXh0KGRpc3BsYXlUZXh0KTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHRhYkhlYWRlckVsLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGRpc3BsYXlUZXh0KTtcbiAgICAgICAgICAgICAgdGFiSGVhZGVyRWwuc2V0QXR0cmlidXRlKCd0aXRsZScsIGRpc3BsYXlUZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgcGlubmVkLWNoYW5nZSBldmVudCBsaXN0ZW5lcnMgb24gYWxsIG1hcmtkb3duIGxlYXZlc1xuICAgKiBUaGlzIGVuc3VyZXMgdGFiIHRpdGxlcyBhcmUgcmUtYXBwbGllZCB3aGVuIHRhYnMgYXJlIHBpbm5lZC91bnBpbm5lZFxuICAgKi9cbiAgcHJpdmF0ZSByZWdpc3RlckxlYWZMaXN0ZW5lcnMoKSB7XG4gICAgY29uc3QgY3VycmVudExlYXZlcyA9IHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2UuZ2V0TGVhdmVzT2ZUeXBlKCdtYXJrZG93bicpO1xuICAgIGNvbnN0IGN1cnJlbnRMZWFmU2V0ID0gbmV3IFNldChjdXJyZW50TGVhdmVzKTtcblxuICAgIC8vIFJlZ2lzdGVyIGxpc3RlbmVycyBvbiBuZXcgbGVhdmVzXG4gICAgY3VycmVudExlYXZlcy5mb3JFYWNoKChsZWFmKSA9PiB7XG4gICAgICBpZiAoIXRoaXMubGVhZkV2ZW50UmVmcy5oYXMobGVhZikpIHtcbiAgICAgICAgLy8gUmVnaXN0ZXIgcGlubmVkLWNoYW5nZSBsaXN0ZW5lciB3aXRoIGEgZGVsYXkgdG8gbGV0IE9ic2lkaWFuIGZpbmlzaCBET00gdXBkYXRlc1xuICAgICAgICBjb25zdCBldmVudFJlZiA9IGxlYWYub24oJ3Bpbm5lZC1jaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgLy8gVXNlIHJlcXVlc3RBbmltYXRpb25GcmFtZSBmb3IgYmV0dGVyIHRpbWluZyB3aXRoIERPTSB1cGRhdGVzXG4gICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgICAgIC8vIFNtYWxsIGFkZGl0aW9uYWwgZGVsYXkgdG8gZW5zdXJlIE9ic2lkaWFuIGhhcyBmaW5pc2hlZCB1cGRhdGluZ1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgIHZvaWQgdGhpcy5yZW5hbWVUYWJzKCk7XG4gICAgICAgICAgICB9LCA1MCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxlYWZFdmVudFJlZnMuc2V0KGxlYWYsIGV2ZW50UmVmKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIENsZWFuIHVwIGxpc3RlbmVycyBmb3IgbGVhdmVzIHRoYXQgbm8gbG9uZ2VyIGV4aXN0XG4gICAgZm9yIChjb25zdCBbbGVhZiwgZXZlbnRSZWZdIG9mIHRoaXMubGVhZkV2ZW50UmVmcy5lbnRyaWVzKCkpIHtcbiAgICAgIGlmICghY3VycmVudExlYWZTZXQuaGFzKGxlYWYpKSB7XG4gICAgICAgIGxlYWYub2ZmcmVmKGV2ZW50UmVmKTtcbiAgICAgICAgdGhpcy5sZWFmRXZlbnRSZWZzLmRlbGV0ZShsZWFmKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgZXZlbnQgbGlzdGVuZXJzIGZvciB0YWIgcmVuYW1pbmdcbiAgICogRVhBQ1QgY29weSBvZiB0aGUgd29ya2luZyBpbXBsZW1lbnRhdGlvbiBmcm9tIG9ic2lkaWFuLXRpdGxlLW9ubHktdGFiXG4gICAqL1xuICByZWdpc3RlckV2ZW50cygpIHtcbiAgICB0aGlzLnJlbmFtZVRhYnMoKTtcblxuICAgIC8vIFJlZ2lzdGVyIGxlYWYtbGV2ZWwgcGlubmVkLWNoYW5nZSBsaXN0ZW5lcnNcbiAgICB0aGlzLnJlZ2lzdGVyTGVhZkxpc3RlbmVycygpO1xuXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudChcbiAgICAgIHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oJ2xheW91dC1jaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgIHZvaWQgdGhpcy5yZW5hbWVUYWJzKCk7XG4gICAgICAgIC8vIFJlLXJlZ2lzdGVyIGxlYWYgbGlzdGVuZXJzIHRvIGNhdGNoIG5ld2x5IGNyZWF0ZWQgbGVhdmVzXG4gICAgICAgIHRoaXMucmVnaXN0ZXJMZWFmTGlzdGVuZXJzKCk7XG4gICAgICB9KVxuICAgICk7XG5cbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KFxuICAgICAgdGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbignYWN0aXZlLWxlYWYtY2hhbmdlJywgKCkgPT4gdGhpcy5yZW5hbWVUYWJzKCkpXG4gICAgKTtcblxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQoXG4gICAgICB0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKCdmaWxlLW9wZW4nLCAoKSA9PiB0aGlzLnJlbmFtZVRhYnMoKSlcbiAgICApO1xuXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudChcbiAgICAgIHRoaXMucGx1Z2luLmFwcC52YXVsdC5vbigncmVuYW1lJywgKCkgPT4gdGhpcy5yZW5hbWVUYWJzKCkpXG4gICAgKTtcblxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQoXG4gICAgICB0aGlzLnBsdWdpbi5hcHAubWV0YWRhdGFDYWNoZS5vbignY2hhbmdlZCcsICgpID0+IHRoaXMucmVuYW1lVGFicygpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRhYnMgKHB1YmxpYyBtZXRob2QgZm9yIG1hbnVhbCB1cGRhdGVzKVxuICAgKi9cbiAgdXBkYXRlVGFicygpIHtcbiAgICB2b2lkIHRoaXMucmVuYW1lVGFicygpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFudXAgb24gdW5sb2FkXG4gICAqL1xuICBvbnVubG9hZCgpIHtcbiAgICAvLyBVbnJlZ2lzdGVyIGFsbCBsZWFmLWxldmVsIGV2ZW50IGxpc3RlbmVyc1xuICAgIGZvciAoY29uc3QgW2xlYWYsIGV2ZW50UmVmXSBvZiB0aGlzLmxlYWZFdmVudFJlZnMuZW50cmllcygpKSB7XG4gICAgICBsZWFmLm9mZnJlZihldmVudFJlZik7XG4gICAgfVxuICAgIHRoaXMubGVhZkV2ZW50UmVmcy5jbGVhcigpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgVEZpbGUsIFRGb2xkZXIgfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCB7IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luLCBURmlsZUV4cGxvcmVySXRlbSwgVEZpbGVFeHBsb3JlclZpZXcgfSBmcm9tICcuLi90eXBlcyc7XHJcblxyXG4vKipcclxuICogRXhwbG9yZXIgU2VydmljZVxyXG4gKiBcclxuICogSGFuZGxlcyBkaXNwbGF5aW5nIHByb3BlcnR5LWJhc2VkIHRpdGxlcyBpbiB0aGUgZmlsZSBleHBsb3Jlci5cclxuICogU3VwcG9ydHMgZm9sZGVyIG5vdGVzOiBpZiBhIGZvbGRlciBjb250YWlucyBhIGZpbGUgbWF0Y2hpbmcgdGhlIGNvbmZpZ3VyZWRcclxuICogZm9sZGVyIG5vdGUgZmlsZW5hbWUgKGUuZy4sIFwiaW5kZXgubWRcIikgd2l0aCBhIGZyb250bWF0dGVyIHRpdGxlLCB0aGUgZm9sZGVyXHJcbiAqIHdpbGwgZGlzcGxheSB0aGF0IHRpdGxlIGluc3RlYWQgb2YgdGhlIGZvbGRlciBuYW1lLlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEV4cGxvcmVyU2VydmljZSB7XHJcbiAgcGx1Z2luOiBQcm9wZXJ0eU92ZXJGaWxlTmFtZVBsdWdpbjsgLy8gUHVibGljIHNvIEV4cGxvcmVyRmlsZUl0ZW1NdXRhdG9yIGNhbiBhY2Nlc3MgaXRcclxuICBwcml2YXRlIGV4cGxvcmVyVmlldzogVEZpbGVFeHBsb3JlclZpZXcgfCBudWxsID0gbnVsbDtcclxuICBwcml2YXRlIG1vZGlmaWVkID0gbmV3IFdlYWtNYXA8VEZpbGVFeHBsb3Jlckl0ZW0sIEV4cGxvcmVyRmlsZUl0ZW1NdXRhdG9yPigpO1xyXG5cclxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luKSB7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgZmlsZSBleHBsb3JlciB2aWV3XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRFeHBsb3JlclZpZXcoKTogVEZpbGVFeHBsb3JlclZpZXcgfCBudWxsIHtcclxuICAgIGlmICh0aGlzLmV4cGxvcmVyVmlldyA9PT0gbnVsbCkge1xyXG4gICAgICBjb25zdCBsZWF2ZXMgPSB0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZSgnZmlsZS1leHBsb3JlcicpO1xyXG4gICAgICBpZiAobGVhdmVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGxlYWYgPSBsZWF2ZXNbMF07XHJcbiAgICAgIGlmIChsZWFmICYmIGxlYWYudmlldykge1xyXG4gICAgICAgIC8vIFR5cGUgYXNzZXJ0aW9uIHRocm91Z2ggdW5rbm93biB0byBoYW5kbGUgdGhlIGludGVyZmFjZSBtaXNtYXRjaFxyXG4gICAgICAgIHRoaXMuZXhwbG9yZXJWaWV3ID0gbGVhZi52aWV3IGFzIHVua25vd24gYXMgVEZpbGVFeHBsb3JlclZpZXc7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmV4cGxvcmVyVmlldztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBmb2xkZXIgbm90ZSB0aXRsZSBmb3IgYSBmb2xkZXJcclxuICAgKiBSZXR1cm5zIHRoZSBmcm9udG1hdHRlciB0aXRsZSBwcm9wZXJ0eSBmcm9tIHRoZSBmb2xkZXIgbm90ZSBmaWxlIGlmIGl0IGV4aXN0c1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0Rm9sZGVyTm90ZVRpdGxlKGZvbGRlcjogVEZvbGRlcik6IHN0cmluZyB8IG51bGwge1xyXG4gICAgaWYgKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5mb2xkZXJOb3RlRmlsZW5hbWUgfHwgXHJcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZm9sZGVyTm90ZUZpbGVuYW1lLnRyaW0oKSA9PT0gJycpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZm9sZGVyTm90ZUZpbGVuYW1lID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuZm9sZGVyTm90ZUZpbGVuYW1lLnRyaW0oKTtcclxuICAgIGNvbnN0IGZvbGRlck5vdGVQYXRoID0gYCR7Zm9sZGVyLnBhdGh9LyR7Zm9sZGVyTm90ZUZpbGVuYW1lfS5tZGA7XHJcbiAgICBjb25zdCBmb2xkZXJOb3RlRmlsZSA9IHRoaXMucGx1Z2luLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZm9sZGVyTm90ZVBhdGgpO1xyXG5cclxuICAgIGlmIChmb2xkZXJOb3RlRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XHJcbiAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5wbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGZvbGRlck5vdGVGaWxlKTtcclxuICAgICAgY29uc3QgcHJvcGVydHlWYWx1ZSA9IGNhY2hlPy5mcm9udG1hdHRlcj8uW3RoaXMucGx1Z2luLnNldHRpbmdzLnByb3BlcnR5S2V5XSBhcyBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbiAgICAgIGlmIChwcm9wZXJ0eVZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIFN0cmluZyhwcm9wZXJ0eVZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzb2x2ZSB0aXRsZSBmb3IgYSBmaWxlIG9yIGZvbGRlclxyXG4gICAqIFB1YmxpYyBzbyBFeHBsb3JlckZpbGVJdGVtTXV0YXRvciBjYW4gYWNjZXNzIGl0XHJcbiAgICovXHJcbiAgYXN5bmMgcmVzb2x2ZVRpdGxlKGl0ZW06IFRGaWxlRXhwbG9yZXJJdGVtKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XHJcbiAgICBpZiAoaXRlbS5maWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcclxuICAgICAgLy8gRm9yIGZpbGVzLCB1c2UgcHJvcGVydHktYmFzZWQgdGl0bGVcclxuICAgICAgY29uc3QgeyBnZXRGcm9udG1hdHRlciwgaXNGaWxlVHlwZVN1cHBvcnRlZCB9ID0gYXdhaXQgaW1wb3J0KCcuLi91dGlscy9mcm9udG1hdHRlcicpO1xyXG4gICAgICBcclxuICAgICAgLy8gU2tpcCB1bnN1cHBvcnRlZCBmaWxlIHR5cGVzXHJcbiAgICAgIGlmICghaXNGaWxlVHlwZVN1cHBvcnRlZChpdGVtLmZpbGUuZXh0ZW5zaW9uLCB0aGlzLnBsdWdpbi5zZXR0aW5ncykpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgZnJvbnRtYXR0ZXIgPSBhd2FpdCBnZXRGcm9udG1hdHRlcih0aGlzLnBsdWdpbi5hcHAsIGl0ZW0uZmlsZSwgdGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xyXG4gICAgICBjb25zdCBwcm9wZXJ0eVZhbHVlID0gZnJvbnRtYXR0ZXI/Llt0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9wZXJ0eUtleV0gYXMgc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gICAgICByZXR1cm4gcHJvcGVydHlWYWx1ZSA/IFN0cmluZyhwcm9wZXJ0eVZhbHVlKSA6IG51bGw7XHJcbiAgICB9IGVsc2UgaWYgKGl0ZW0uZmlsZSBpbnN0YW5jZW9mIFRGb2xkZXIpIHtcclxuICAgICAgLy8gRm9yIGZvbGRlcnMsIGNoZWNrIGZvciBmb2xkZXIgbm90ZVxyXG4gICAgICByZXR1cm4gdGhpcy5nZXRGb2xkZXJOb3RlVGl0bGUoaXRlbS5maWxlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIGFsbCBmaWxlIGV4cGxvcmVyIGl0ZW1zXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVBbGxJdGVtcygpIHtcclxuICAgIGNvbnN0IHZpZXcgPSB0aGlzLmdldEV4cGxvcmVyVmlldygpO1xyXG4gICAgaWYgKCF2aWV3IHx8ICF2aWV3LmZpbGVJdGVtcykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaXRlbXMgPSBPYmplY3QudmFsdWVzKHZpZXcuZmlsZUl0ZW1zKTtcclxuICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xyXG4gICAgICBpZiAoIXRoaXMubW9kaWZpZWQuaGFzKGl0ZW0pKSB7XHJcbiAgICAgICAgdGhpcy5tb2RpZmllZC5zZXQoaXRlbSwgbmV3IEV4cGxvcmVyRmlsZUl0ZW1NdXRhdG9yKGl0ZW0sIHRoaXMpKTtcclxuICAgICAgfVxyXG4gICAgICBpdGVtLnVwZGF0ZVRpdGxlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0b3JlIGFsbCBvcmlnaW5hbCB0aXRsZXNcclxuICAgKi9cclxuICBwcml2YXRlIHJlc3RvcmVBbGxJdGVtcygpIHtcclxuICAgIGNvbnN0IHZpZXcgPSB0aGlzLmdldEV4cGxvcmVyVmlldygpO1xyXG4gICAgaWYgKCF2aWV3IHx8ICF2aWV3LmZpbGVJdGVtcykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaXRlbXMgPSBPYmplY3QudmFsdWVzKHZpZXcuZmlsZUl0ZW1zKTtcclxuICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xyXG4gICAgICBpZiAodGhpcy5tb2RpZmllZC5oYXMoaXRlbSkpIHtcclxuICAgICAgICBjb25zdCBtdXRhdG9yID0gdGhpcy5tb2RpZmllZC5nZXQoaXRlbSk7XHJcbiAgICAgICAgbXV0YXRvcj8uZGVzdHJveSgpO1xyXG4gICAgICAgIHRoaXMubW9kaWZpZWQuZGVsZXRlKGl0ZW0pO1xyXG4gICAgICAgIGl0ZW0udXBkYXRlVGl0bGUoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVnaXN0ZXIgZXZlbnRzIGFuZCBpbml0aWFsaXplXHJcbiAgICovXHJcbiAgcmVnaXN0ZXJFdmVudHMoKSB7XHJcbiAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckV4cGxvcmVyKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBXYWl0IGZvciBsYXlvdXQgdG8gYmUgcmVhZHlcclxuICAgIHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub25MYXlvdXRSZWFkeSgoKSA9PiB7XHJcbiAgICAgIHRoaXMuZXhwbG9yZXJWaWV3ID0gbnVsbDsgLy8gUmVzZXQgdG8gZ2V0IGZyZXNoIHZpZXdcclxuICAgICAgdGhpcy51cGRhdGVBbGxJdGVtcygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gVXBkYXRlIHdoZW4gbGF5b3V0IGNoYW5nZXNcclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQoXHJcbiAgICAgIHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oJ2xheW91dC1jaGFuZ2UnLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5leHBsb3JlclZpZXcgPSBudWxsOyAvLyBSZXNldCB0byBnZXQgZnJlc2ggdmlld1xyXG4gICAgICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JFeHBsb3Jlcikge1xyXG4gICAgICAgICAgdGhpcy51cGRhdGVBbGxJdGVtcygpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgLy8gVXBkYXRlIHdoZW4gbWV0YWRhdGEgY2hhbmdlc1xyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudChcclxuICAgICAgdGhpcy5wbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUub24oJ2NoYW5nZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckV4cGxvcmVyKSB7XHJcbiAgICAgICAgICB0aGlzLnVwZGF0ZUFsbEl0ZW1zKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBVcGRhdGUgd2hlbiBmaWxlcyBhcmUgcmVuYW1lZFxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudChcclxuICAgICAgdGhpcy5wbHVnaW4uYXBwLnZhdWx0Lm9uKCdyZW5hbWUnLCAoKSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckV4cGxvcmVyKSB7XHJcbiAgICAgICAgICB0aGlzLmV4cGxvcmVyVmlldyA9IG51bGw7IC8vIFJlc2V0IHRvIGdldCBmcmVzaCB2aWV3XHJcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMudXBkYXRlQWxsSXRlbXMoKSwgMTAwKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIGV4cGxvcmVyIHdoZW4gc2V0dGluZ3MgY2hhbmdlXHJcbiAgICovXHJcbiAgdXBkYXRlRXhwbG9yZXIoKSB7XHJcbiAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yRXhwbG9yZXIpIHtcclxuICAgICAgdGhpcy5leHBsb3JlclZpZXcgPSBudWxsOyAvLyBSZXNldCB0byBnZXQgZnJlc2ggdmlld1xyXG4gICAgICB0aGlzLnJlZ2lzdGVyRXZlbnRzKCk7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy51cGRhdGVBbGxJdGVtcygpLCAxMDApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5yZXN0b3JlQWxsSXRlbXMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENsZWFudXAgb24gdW5sb2FkXHJcbiAgICovXHJcbiAgb251bmxvYWQoKSB7XHJcbiAgICB0aGlzLnJlc3RvcmVBbGxJdGVtcygpO1xyXG4gICAgdGhpcy5leHBsb3JlclZpZXcgPSBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIE11dGF0b3IgZm9yIGluZGl2aWR1YWwgZmlsZSBleHBsb3JlciBpdGVtc1xyXG4gKiBIb29rcyBpbnRvIHVwZGF0ZVRpdGxlKCkgdG8gcmVwbGFjZSBkaXNwbGF5ZWQgdGV4dFxyXG4gKi9cclxuY2xhc3MgRXhwbG9yZXJGaWxlSXRlbU11dGF0b3Ige1xyXG4gIHByaXZhdGUgb3JpZ2luYWxVcGRhdGVUaXRsZTogKCkgPT4gdm9pZDtcclxuICBwcml2YXRlIG9yaWdpbmFsU3RhcnRSZW5hbWU6ICgoKSA9PiB2b2lkKSB8IHVuZGVmaW5lZDtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGl0ZW06IFRGaWxlRXhwbG9yZXJJdGVtLFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBzZXJ2aWNlOiBFeHBsb3JlclNlcnZpY2VcclxuICApIHtcclxuICAgIC8vIFN0b3JlIG9yaWdpbmFsIG1ldGhvZHNcclxuICAgIGNvbnN0IHByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKGl0ZW0pIGFzIHsgdXBkYXRlVGl0bGU6ICgpID0+IHZvaWQ7IHN0YXJ0UmVuYW1lPzogKCkgPT4gdm9pZCB9O1xyXG4gICAgdGhpcy5vcmlnaW5hbFVwZGF0ZVRpdGxlID0gcHJvdG8udXBkYXRlVGl0bGUuYmluZChpdGVtKTtcclxuICAgIHRoaXMub3JpZ2luYWxTdGFydFJlbmFtZSA9IHByb3RvLnN0YXJ0UmVuYW1lID8gcHJvdG8uc3RhcnRSZW5hbWUuYmluZChpdGVtKSA6IHVuZGVmaW5lZDtcclxuXHJcbiAgICAvLyBPdmVycmlkZSB1cGRhdGVUaXRsZVxyXG4gICAgaXRlbS51cGRhdGVUaXRsZSA9IHRoaXMudXBkYXRlVGl0bGUuYmluZCh0aGlzKTtcclxuICAgIFxyXG4gICAgLy8gT3ZlcnJpZGUgc3RhcnRSZW5hbWUgaWYgaXQgZXhpc3RzXHJcbiAgICBpZiAocHJvdG8uc3RhcnRSZW5hbWUpIHtcclxuICAgICAgaXRlbS5zdGFydFJlbmFtZSA9IHRoaXMuc3RhcnRSZW5hbWUuYmluZCh0aGlzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlVGl0bGUoKSB7XHJcbiAgICAvLyBDYWxsIG9yaWdpbmFsIHRvIHNldCB1cCB0aGUgZWxlbWVudFxyXG4gICAgdGhpcy5vcmlnaW5hbFVwZGF0ZVRpdGxlKCk7XHJcbiAgICBcclxuICAgIC8vIFJlcGxhY2Ugd2l0aCBwcm9wZXJ0eS1iYXNlZCB0aXRsZSBpZiBlbmFibGVkXHJcbiAgICBpZiAodGhpcy5zZXJ2aWNlLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JFeHBsb3Jlcikge1xyXG4gICAgICB2b2lkIChhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgdGl0bGUgPSBhd2FpdCB0aGlzLnNlcnZpY2UucmVzb2x2ZVRpdGxlKHRoaXMuaXRlbSk7XHJcbiAgICAgICAgaWYgKHRpdGxlICYmIHRpdGxlLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIHRoaXMuaXRlbS5pbm5lckVsLnNldFRleHQodGl0bGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSkoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhcnRSZW5hbWUoKSB7XHJcbiAgICAvLyBSZXN0b3JlIG9yaWdpbmFsIHRpdGxlIGZvciByZW5hbWluZ1xyXG4gICAgdGhpcy5pdGVtLmlubmVyRWwuc2V0VGV4dCh0aGlzLml0ZW0uZ2V0VGl0bGUoKSk7XHJcbiAgICByZXR1cm4gdGhpcy5vcmlnaW5hbFN0YXJ0UmVuYW1lPy4oKTtcclxuICB9XHJcblxyXG4gIGRlc3Ryb3koKSB7XHJcbiAgICAvLyBSZXN0b3JlIG9yaWdpbmFsIG1ldGhvZHNcclxuICAgIGNvbnN0IHByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMuaXRlbSkgYXMgeyBzdGFydFJlbmFtZT86ICgpID0+IHZvaWQgfTtcclxuICAgIHRoaXMuaXRlbS51cGRhdGVUaXRsZSA9IHRoaXMub3JpZ2luYWxVcGRhdGVUaXRsZTtcclxuICAgIGlmIChwcm90by5zdGFydFJlbmFtZSAmJiB0aGlzLm9yaWdpbmFsU3RhcnRSZW5hbWUpIHtcclxuICAgICAgdGhpcy5pdGVtLnN0YXJ0UmVuYW1lID0gdGhpcy5vcmlnaW5hbFN0YXJ0UmVuYW1lO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuIiwgImltcG9ydCB7IFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eU92ZXJGaWxlTmFtZVBsdWdpbiwgV29ya3NwYWNlRXh0IH0gZnJvbSAnLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBnZXRGcm9udG1hdHRlciB9IGZyb20gJy4uL3V0aWxzL2Zyb250bWF0dGVyJztcclxuXHJcbi8qKlxyXG4gKiBXaW5kb3cgRnJhbWUgU2VydmljZVxyXG4gKiBcclxuICogSGFuZGxlcyBkaXNwbGF5aW5nIHByb3BlcnR5LWJhc2VkIHRpdGxlIGluIHRoZSBicm93c2VyIHdpbmRvdyB0aXRsZSBiYXIuXHJcbiAqIE92ZXJyaWRlcyB3b3Jrc3BhY2UudXBkYXRlVGl0bGUoKSB0byB1c2UgdGhlIGZyb250bWF0dGVyIHByb3BlcnR5IGluc3RlYWRcclxuICogb2YgdGhlIGZpbGUgbmFtZS5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBXaW5kb3dGcmFtZVNlcnZpY2Uge1xyXG4gIHByaXZhdGUgcGx1Z2luOiBQcm9wZXJ0eU92ZXJGaWxlTmFtZVBsdWdpbjtcclxuICBwcml2YXRlIG9yaWdpbmFsVXBkYXRlVGl0bGU6ICgoKSA9PiB2b2lkKSB8IG51bGwgPSBudWxsO1xyXG4gIHByaXZhdGUgZW5hYmxlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICBjb25zdHJ1Y3RvcihwbHVnaW46IFByb3BlcnR5T3ZlckZpbGVOYW1lUGx1Z2luKSB7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgdGl0bGUgZm9yIHRoZSBhY3RpdmUgZmlsZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0QWN0aXZlRmlsZVRpdGxlKCk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBhY3RpdmVGaWxlID0gdGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk7XHJcbiAgICBpZiAoYWN0aXZlRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XHJcbiAgICAgIC8vIEZvciBNRCBmaWxlcywgdXNlIG1ldGFkYXRhIGNhY2hlIChmYXN0IHN5bmMgYWNjZXNzKVxyXG4gICAgICBpZiAoYWN0aXZlRmlsZS5leHRlbnNpb24gPT09ICdtZCcpIHtcclxuICAgICAgICBjb25zdCBmaWxlQ2FjaGUgPSB0aGlzLnBsdWdpbi5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoYWN0aXZlRmlsZSk7XHJcbiAgICAgICAgY29uc3QgcHJvcGVydHlWYWx1ZSA9IGZpbGVDYWNoZT8uZnJvbnRtYXR0ZXI/Llt0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9wZXJ0eUtleV0gYXMgc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmIChwcm9wZXJ0eVZhbHVlKSB7XHJcbiAgICAgICAgICByZXR1cm4gU3RyaW5nKHByb3BlcnR5VmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYWN0aXZlRmlsZS5iYXNlbmFtZTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gRm9yIE1EWCBmaWxlcywgdHJpZ2dlciBhc3luYyByZWFkIGFuZCByZXR1cm4gZmlsZW5hbWUgZm9yIG5vd1xyXG4gICAgICAvLyBUaGUgdGl0bGUgd2lsbCB1cGRhdGUgb25jZSB0aGUgY2FjaGUgaXMgcG9wdWxhdGVkXHJcbiAgICAgIGlmIChhY3RpdmVGaWxlLmV4dGVuc2lvbiA9PT0gJ21keCcgJiYgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlTWR4U3VwcG9ydCkge1xyXG4gICAgICAgIHZvaWQgKGFzeW5jICgpID0+IHtcclxuICAgICAgICAgIGNvbnN0IGZyb250bWF0dGVyID0gYXdhaXQgZ2V0RnJvbnRtYXR0ZXIodGhpcy5wbHVnaW4uYXBwLCBhY3RpdmVGaWxlLCB0aGlzLnBsdWdpbi5zZXR0aW5ncyk7XHJcbiAgICAgICAgICBjb25zdCBwcm9wZXJ0eVZhbHVlID0gZnJvbnRtYXR0ZXI/Llt0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9wZXJ0eUtleV0gYXMgc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gICAgICAgICAgaWYgKHByb3BlcnR5VmFsdWUpIHtcclxuICAgICAgICAgICAgLy8gVXBkYXRlIHRpdGxlIGFzeW5jaHJvbm91c2x5XHJcbiAgICAgICAgICAgIGNvbnN0IGFwcCA9IHRoaXMucGx1Z2luLmFwcCBhcyB7IGdldEFwcFRpdGxlPzogKHRpdGxlOiBzdHJpbmcpID0+IHN0cmluZyB9O1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGFwcC5nZXRBcHBUaXRsZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gYXBwLmdldEFwcFRpdGxlKFN0cmluZyhwcm9wZXJ0eVZhbHVlKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgdmF1bHROYW1lID0gdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmdldE5hbWUoKTtcclxuICAgICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IGAke1N0cmluZyhwcm9wZXJ0eVZhbHVlKX0gLSAke3ZhdWx0TmFtZX1gO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSkoKTtcclxuICAgICAgICByZXR1cm4gYWN0aXZlRmlsZS5iYXNlbmFtZTsgLy8gUmV0dXJuIGZpbGVuYW1lIGltbWVkaWF0ZWx5LCB3aWxsIHVwZGF0ZSBhc3luY1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gYWN0aXZlRmlsZS5iYXNlbmFtZTtcclxuICAgIH1cclxuICAgIHJldHVybiAnJztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE92ZXJyaWRlIHVwZGF0ZVRpdGxlIHRvIHVzZSBwcm9wZXJ0eS1iYXNlZCB0aXRsZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgdXBkYXRlVGl0bGUoKSB7XHJcbiAgICBpZiAoIXRoaXMuZW5hYmxlZCkge1xyXG4gICAgICBpZiAodGhpcy5vcmlnaW5hbFVwZGF0ZVRpdGxlKSB7XHJcbiAgICAgICAgdGhpcy5vcmlnaW5hbFVwZGF0ZVRpdGxlKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRpdGxlID0gdGhpcy5nZXRBY3RpdmVGaWxlVGl0bGUoKTtcclxuICAgIGlmICh0aXRsZSkge1xyXG4gICAgICAvLyBHZXQgdGhlIGFwcCB0aXRsZSBmb3JtYXQgKHVzdWFsbHkgXCJUaXRsZSAtIFZhdWx0IE5hbWVcIilcclxuICAgICAgLy8gVHJ5IHRvIHVzZSBPYnNpZGlhbidzIGdldEFwcFRpdGxlIG1ldGhvZCBpZiBhdmFpbGFibGVcclxuICAgICAgY29uc3QgYXBwID0gdGhpcy5wbHVnaW4uYXBwIGFzIHsgZ2V0QXBwVGl0bGU/OiAodGl0bGU6IHN0cmluZykgPT4gc3RyaW5nIH07XHJcbiAgICAgIGlmICh0eXBlb2YgYXBwLmdldEFwcFRpdGxlID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgZG9jdW1lbnQudGl0bGUgPSBhcHAuZ2V0QXBwVGl0bGUodGl0bGUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZhbGxiYWNrOiBmb3JtYXQgbWFudWFsbHlcclxuICAgICAgICBjb25zdCB2YXVsdE5hbWUgPSB0aGlzLnBsdWdpbi5hcHAudmF1bHQuZ2V0TmFtZSgpO1xyXG4gICAgICAgIGRvY3VtZW50LnRpdGxlID0gYCR7dGl0bGV9IC0gJHt2YXVsdE5hbWV9YDtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gRmFsbGJhY2sgdG8gb3JpZ2luYWwgYmVoYXZpb3JcclxuICAgICAgaWYgKHRoaXMub3JpZ2luYWxVcGRhdGVUaXRsZSkge1xyXG4gICAgICAgIHRoaXMub3JpZ2luYWxVcGRhdGVUaXRsZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBFbmFibGUgdGhlIHdpbmRvdyBmcmFtZSBmZWF0dXJlXHJcbiAgICovXHJcbiAgZW5hYmxlKCkge1xyXG4gICAgaWYgKHRoaXMuZW5hYmxlZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgd29ya3NwYWNlID0gdGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZSBhcyBXb3Jrc3BhY2VFeHQ7XHJcbiAgICBpZiAod29ya3NwYWNlLnVwZGF0ZVRpdGxlKSB7XHJcbiAgICAgIC8vIFN0b3JlIG9yaWdpbmFsIG1ldGhvZFxyXG4gICAgICB0aGlzLm9yaWdpbmFsVXBkYXRlVGl0bGUgPSB3b3Jrc3BhY2UudXBkYXRlVGl0bGUuYmluZCh3b3Jrc3BhY2UpO1xyXG4gICAgICBcclxuICAgICAgLy8gT3ZlcnJpZGUgd2l0aCBvdXIgbWV0aG9kXHJcbiAgICAgIHdvcmtzcGFjZS51cGRhdGVUaXRsZSA9IHRoaXMudXBkYXRlVGl0bGUuYmluZCh0aGlzKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFVwZGF0ZSBpbW1lZGlhdGVseVxyXG4gICAgICB0aGlzLnVwZGF0ZVRpdGxlKCk7XHJcbiAgICAgIFxyXG4gICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGlzYWJsZSB0aGUgd2luZG93IGZyYW1lIGZlYXR1cmVcclxuICAgKi9cclxuICBkaXNhYmxlKCkge1xyXG4gICAgaWYgKCF0aGlzLmVuYWJsZWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHdvcmtzcGFjZSA9IHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2UgYXMgV29ya3NwYWNlRXh0O1xyXG4gICAgaWYgKHdvcmtzcGFjZS51cGRhdGVUaXRsZSAmJiB0aGlzLm9yaWdpbmFsVXBkYXRlVGl0bGUpIHtcclxuICAgICAgLy8gUmVzdG9yZSBvcmlnaW5hbCBtZXRob2RcclxuICAgICAgd29ya3NwYWNlLnVwZGF0ZVRpdGxlID0gdGhpcy5vcmlnaW5hbFVwZGF0ZVRpdGxlO1xyXG4gICAgICBcclxuICAgICAgLy8gVXBkYXRlIHRvIHJlc3RvcmUgb3JpZ2luYWwgdGl0bGVcclxuICAgICAgd29ya3NwYWNlLnVwZGF0ZVRpdGxlKCk7XHJcbiAgICAgIFxyXG4gICAgICB0aGlzLm9yaWdpbmFsVXBkYXRlVGl0bGUgPSBudWxsO1xyXG4gICAgICB0aGlzLmVuYWJsZWQgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlZ2lzdGVyIGV2ZW50cyBmb3Igd2luZG93IGZyYW1lIHVwZGF0ZXNcclxuICAgKi9cclxuICByZWdpc3RlckV2ZW50cygpIHtcclxuICAgIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRm9yV2luZG93RnJhbWUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVwZGF0ZSB3aGVuIGFjdGl2ZSBmaWxlIGNoYW5nZXNcclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQoXHJcbiAgICAgIHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oJ2ZpbGUtb3BlbicsICgpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5lbmFibGVkKSB7XHJcbiAgICAgICAgICB0aGlzLnVwZGF0ZVRpdGxlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBVcGRhdGUgd2hlbiBtZXRhZGF0YSBjaGFuZ2VzXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KFxyXG4gICAgICB0aGlzLnBsdWdpbi5hcHAubWV0YWRhdGFDYWNoZS5vbignY2hhbmdlZCcsICgpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5lbmFibGVkKSB7XHJcbiAgICAgICAgICB0aGlzLnVwZGF0ZVRpdGxlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSB3aW5kb3cgZnJhbWUgd2hlbiBzZXR0aW5ncyBjaGFuZ2VcclxuICAgKi9cclxuICB1cGRhdGVXaW5kb3dGcmFtZSgpIHtcclxuICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGb3JXaW5kb3dGcmFtZSkge1xyXG4gICAgICB0aGlzLmVuYWJsZSgpO1xyXG4gICAgICB0aGlzLnJlZ2lzdGVyRXZlbnRzKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmRpc2FibGUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENsZWFudXAgb24gdW5sb2FkXHJcbiAgICovXHJcbiAgb251bmxvYWQoKSB7XHJcbiAgICB0aGlzLmRpc2FibGUoKTtcclxuICB9XHJcbn1cclxuXHJcbiIsICJpbXBvcnQgeyBURmlsZSB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IHsgUHJvcGVydHlPdmVyRmlsZU5hbWVQbHVnaW4gfSBmcm9tICcuLi90eXBlcyc7XHJcbmltcG9ydCB7IGdldEZyb250bWF0dGVyIH0gZnJvbSAnLi4vdXRpbHMvZnJvbnRtYXR0ZXInO1xyXG5cclxuLyoqXHJcbiAqIEJvb2ttYXJrIFNlcnZpY2VcclxuICogXHJcbiAqIEhvb2tzIGludG8gT2JzaWRpYW4ncyBpbnRlcm5hbCBCb29rbWFya3MgcGx1Z2luIHRvIGN1c3RvbWl6ZSB0aGUgZGVmYXVsdFxyXG4gKiB0aXRsZSB3aGVuIGNyZWF0aW5nIGEgbmV3IGJvb2ttYXJrIGZvciBhIG5vdGUuXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQm9va21hcmtTZXJ2aWNlIHtcclxuICBwcml2YXRlIHBsdWdpbjogUHJvcGVydHlPdmVyRmlsZU5hbWVQbHVnaW47XHJcbiAgcHJpdmF0ZSBpc0hvb2tlZCA9IGZhbHNlO1xyXG4gIHByaXZhdGUgbXV0YXRpb25PYnNlcnZlcj86IE11dGF0aW9uT2JzZXJ2ZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogUHJvcGVydHlPdmVyRmlsZU5hbWVQbHVnaW4pIHtcclxuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIGJvb2ttYXJrcyBob29rIGJhc2VkIG9uIHNldHRpbmdzXHJcbiAgICovXHJcbiAgdXBkYXRlQm9va21hcmtzKCkge1xyXG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckJvb2ttYXJrcyAmJiAhdGhpcy5pc0hvb2tlZCkge1xyXG4gICAgICB0aGlzLmhvb2tCb29rbWFya3MoKTtcclxuICAgIH0gZWxzZSBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZvckJvb2ttYXJrcyAmJiB0aGlzLmlzSG9va2VkKSB7XHJcbiAgICAgIHRoaXMudW5ob29rQm9va21hcmtzKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBIb29rIGludG8gYm9va21hcmsgZnVuY3Rpb25hbGl0eSB1c2luZyBET00gb2JzZXJ2YXRpb25cclxuICAgKi9cclxuICBwcml2YXRlIGhvb2tCb29rbWFya3MoKSB7XHJcbiAgICAvLyBDaGVjayBpZiBtb2RhbCBpcyBhbHJlYWR5IHByZXNlbnRcclxuICAgIGNvbnN0IGV4aXN0aW5nTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwnKTtcclxuICAgIGlmIChleGlzdGluZ01vZGFsIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcclxuICAgICAgdGhpcy5oYW5kbGVNb2RhbEFwcGVhcmFuY2UoZXhpc3RpbmdNb2RhbCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2V0IHVwIG11dGF0aW9uIG9ic2VydmVyIHRvIHdhdGNoIGZvciBib29rbWFyayBtb2RhbHNcclxuICAgIHRoaXMubXV0YXRpb25PYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnMpID0+IHtcclxuICAgICAgZm9yIChjb25zdCBtdXRhdGlvbiBvZiBtdXRhdGlvbnMpIHtcclxuICAgICAgICBtdXRhdGlvbi5hZGRlZE5vZGVzLmZvckVhY2goKG5vZGUpID0+IHtcclxuICAgICAgICAgIGlmIChub2RlIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgLy8gVGhlIG1vZGFsIG1pZ2h0IGJlIHRoZSBub2RlIGl0c2VsZiBvciBpbnNpZGUgaXRcclxuICAgICAgICAgICAgY29uc3QgbW9kYWxFbCA9IG5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbCcpID8gbm9kZSA6IG5vZGUucXVlcnlTZWxlY3RvcignLm1vZGFsJykgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGlmIChtb2RhbEVsKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5oYW5kbGVNb2RhbEFwcGVhcmFuY2UobW9kYWxFbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gU3RhcnQgb2JzZXJ2aW5nIHRoZSBkb2N1bWVudCBib2R5IGZvciBuZXcgbW9kYWxzXHJcbiAgICB0aGlzLm11dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5ib2R5LCB7XHJcbiAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcclxuICAgICAgc3VidHJlZTogdHJ1ZVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5pc0hvb2tlZCA9IHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBIYW5kbGUgd2hlbiBhIG1vZGFsIGFwcGVhcnNcclxuICAgKi9cclxuICBwcml2YXRlIGhhbmRsZU1vZGFsQXBwZWFyYW5jZShtb2RhbEVsOiBIVE1MRWxlbWVudCkge1xyXG4gICAgbGV0IGF0dGVtcHRzID0gMDtcclxuICAgIGNvbnN0IG1heEF0dGVtcHRzID0gMzA7IC8vIFRyeSBmb3IgdXAgdG8gMS41IHNlY29uZHNcclxuXHJcbiAgICBjb25zdCB0cnlJZGVudGlmeUFuZFBvcHVsYXRlID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0aXRsZUVsID0gbW9kYWxFbC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtdGl0bGUnKTtcclxuICAgICAgY29uc3QgdGl0bGVUZXh0ID0gdGl0bGVFbD8udGV4dENvbnRlbnQ/LnRvTG93ZXJDYXNlKCkgfHwgJyc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBMb29rIGZvciBpbmRpY2F0b3JzIHRoYXQgdGhpcyBpcyBhIGJvb2ttYXJrIG1vZGFsXHJcbiAgICAgIGNvbnN0IGlzQm9va21hcmtNb2RhbCA9IHRpdGxlVGV4dC5pbmNsdWRlcygnYm9va21hcmsnKSB8fCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbEVsLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3BsYWNlaG9sZGVyKj1cImJvb2ttYXJrXCJdJykgIT09IG51bGwgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbEVsLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3BsYWNlaG9sZGVyKj1cIkJvb2ttYXJrXCJdJykgIT09IG51bGw7XHJcblxyXG4gICAgICBpZiAoaXNCb29rbWFya01vZGFsKSB7XHJcbiAgICAgICAgLy8gRmluZCB0aGUgXCJUaXRsZVwiIGFuZCBcIlBhdGhcIiBpbnB1dCBmaWVsZHNcclxuICAgICAgICBjb25zdCBzZXR0aW5nSXRlbXMgPSBtb2RhbEVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZXR0aW5nLWl0ZW0nKTtcclxuICAgICAgICBsZXQgdGl0bGVJbnB1dDogSFRNTElucHV0RWxlbWVudCB8IG51bGwgPSBudWxsO1xyXG4gICAgICAgIGxldCBwYXRoSW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgICAgICAgc2V0dGluZ0l0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBuYW1lRWwgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy5zZXR0aW5nLWl0ZW0tbmFtZScpO1xyXG4gICAgICAgICAgY29uc3QgbmFtZVRleHQgPSBuYW1lRWw/LnRleHRDb250ZW50Py50b0xvd2VyQ2FzZSgpLnRyaW0oKSB8fCAnJztcclxuICAgICAgICAgIGlmIChuYW1lVGV4dCA9PT0gJ3RpdGxlJykge1xyXG4gICAgICAgICAgICB0aXRsZUlucHV0ID0gaXRlbS5xdWVyeVNlbGVjdG9yKCdpbnB1dFt0eXBlPVwidGV4dFwiXScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKG5hbWVUZXh0ID09PSAncGF0aCcpIHtcclxuICAgICAgICAgICAgcGF0aElucHV0ID0gaXRlbS5xdWVyeVNlbGVjdG9yKCdpbnB1dFt0eXBlPVwidGV4dFwiXScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIEZhbGxiYWNrOiBpZiB3ZSBjYW4ndCBmaW5kIGJ5IGxhYmVsLCB0aGUgYm9va21hcmsgbW9kYWwgdXN1YWxseSBoYXMgUGF0aCBmaXJzdCwgVGl0bGUgc2Vjb25kXHJcbiAgICAgICAgaWYgKCF0aXRsZUlucHV0KSB7XHJcbiAgICAgICAgICBjb25zdCBhbGxJbnB1dHMgPSBtb2RhbEVsLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W3R5cGU9XCJ0ZXh0XCJdJyk7XHJcbiAgICAgICAgICBpZiAoYWxsSW5wdXRzLmxlbmd0aCA+PSAyKSB7XHJcbiAgICAgICAgICAgIHBhdGhJbnB1dCA9IGFsbElucHV0c1swXSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgICAgICB0aXRsZUlucHV0ID0gYWxsSW5wdXRzWzFdIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBJZiB3ZSBmb3VuZCB0aGUgdGl0bGUgaW5wdXQsIGJ1dCBpdCdzIGVtcHR5IG9yIGhhcyB0aGUgZGVmYXVsdCBmaWxlbmFtZSwgdHJ5IHRvIHBvcHVsYXRlIGl0XHJcbiAgICAgICAgaWYgKHRpdGxlSW5wdXQpIHtcclxuICAgICAgICAgIC8vIElkZW50aWZ5IHRoZSBmaWxlXHJcbiAgICAgICAgICBsZXQgZmlsZSA9IHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBVc2UgcGF0aCBpbnB1dCB2YWx1ZSBpZiBhdmFpbGFibGUgZm9yIGJldHRlciBhY2N1cmFjeVxyXG4gICAgICAgICAgaWYgKHBhdGhJbnB1dCAmJiBwYXRoSW5wdXQudmFsdWUpIHtcclxuICAgICAgICAgICAgY29uc3QgcGF0aCA9IHBhdGhJbnB1dC52YWx1ZTtcclxuICAgICAgICAgICAgY29uc3QgYWJzdHJhY3RGaWxlID0gdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChwYXRoKSB8fCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHBhdGggKyAnLm1kJykgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHBhdGggKyAnLm1keCcpO1xyXG4gICAgICAgICAgICBpZiAoYWJzdHJhY3RGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcclxuICAgICAgICAgICAgICBmaWxlID0gYWJzdHJhY3RGaWxlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgaWYgKGZpbGUpIHtcclxuICAgICAgICAgICAgY29uc3QgZnJvbnRtYXR0ZXIgPSBhd2FpdCBnZXRGcm9udG1hdHRlcih0aGlzLnBsdWdpbi5hcHAsIGZpbGUsIHRoaXMucGx1Z2luLnNldHRpbmdzKTtcclxuICAgICAgICAgICAgY29uc3QgcHJvcGVydHlWYWx1ZSA9IGZyb250bWF0dGVyPy5bdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvcGVydHlLZXldO1xyXG5cclxuICAgICAgICAgICAgaWYgKHByb3BlcnR5VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBwcm9wZXJ0eVZhbHVlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgbGV0IGRpc3BsYXlWYWx1ZSA9ICcnO1xyXG4gICAgICAgICAgICAgIGlmICh0eXBlb2YgcHJvcGVydHlWYWx1ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIGRpc3BsYXlWYWx1ZSA9IHByb3BlcnR5VmFsdWU7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcHJvcGVydHlWYWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHByb3BlcnR5VmFsdWUgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgICAgICAgICAgZGlzcGxheVZhbHVlID0gU3RyaW5nKHByb3BlcnR5VmFsdWUpO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgaWYgKGRpc3BsYXlWYWx1ZSAmJiBkaXNwbGF5VmFsdWUudHJpbSgpICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgLy8gT25seSBvdmVyd3JpdGUgaWYgaXQgbWF0Y2hlcyB0aGUgZmlsZW5hbWUgb3IgaXMgZW1wdHkgKGRvbid0IG92ZXJ3cml0ZSB1c2VyIGVkaXRzKVxyXG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFZhbHVlID0gdGl0bGVJbnB1dC52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlzRGVmYXVsdCA9IGN1cnJlbnRWYWx1ZSA9PT0gJycgfHwgY3VycmVudFZhbHVlID09PSBmaWxlLmJhc2VuYW1lIHx8IGN1cnJlbnRWYWx1ZSA9PT0gZmlsZS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoaXNEZWZhdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgIHRpdGxlSW5wdXQudmFsdWUgPSBkaXNwbGF5VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgIHRpdGxlSW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2lucHV0JywgeyBidWJibGVzOiB0cnVlIH0pKTtcclxuICAgICAgICAgICAgICAgICAgdGl0bGVJbnB1dC5zZWxlY3QoKTtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIFN1Y2Nlc3NcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGF0dGVtcHRzKys7XHJcbiAgICAgIGlmIChhdHRlbXB0cyA8IG1heEF0dGVtcHRzKSB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB2b2lkIHRyeUlkZW50aWZ5QW5kUG9wdWxhdGUoKSwgNTApO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcblxyXG4gICAgdm9pZCB0cnlJZGVudGlmeUFuZFBvcHVsYXRlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdG9wIG9ic2VydmluZyBmb3IgYm9va21hcmsgbW9kYWxzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1bmhvb2tCb29rbWFya3MoKSB7XHJcbiAgICBpZiAodGhpcy5tdXRhdGlvbk9ic2VydmVyKSB7XHJcbiAgICAgIHRoaXMubXV0YXRpb25PYnNlcnZlci5kaXNjb25uZWN0KCk7XHJcbiAgICAgIHRoaXMubXV0YXRpb25PYnNlcnZlciA9IHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIHRoaXMuaXNIb29rZWQgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENsZWFudXAgb24gdW5sb2FkXHJcbiAgICovXHJcbiAgb251bmxvYWQoKSB7XHJcbiAgICB0aGlzLnVuaG9va0Jvb2ttYXJrcygpO1xyXG4gIH1cclxufVxyXG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQWNBLGVBQXNCLGVBQ3BCLEtBQ0EsTUFDQSxVQUN5QztBQUV6QyxNQUFJLEtBQUssY0FBYyxNQUFNO0FBQzNCLFVBQU0sWUFBWSxJQUFJLGNBQWMsYUFBYSxJQUFJO0FBQ3JELFlBQU8sdUNBQVcsZ0JBQWU7QUFBQSxFQUNuQztBQUdBLE1BQUksS0FBSyxjQUFjLFNBQVMsU0FBUyxrQkFBa0I7QUFDekQsUUFBSTtBQUVGLFlBQU0sVUFBVSxNQUFNLElBQUksTUFBTSxLQUFLLElBQUk7QUFJekMsWUFBTSxtQkFBbUI7QUFDekIsWUFBTSxRQUFRLFFBQVEsTUFBTSxnQkFBZ0I7QUFFNUMsVUFBSSxTQUFTLE1BQU0sQ0FBQyxHQUFHO0FBQ3JCLGNBQU0sa0JBQWtCLE1BQU0sQ0FBQztBQUUvQixZQUFJO0FBQ0YsZ0JBQU0sYUFBUywyQkFBVSxlQUFlO0FBQ3hDLGlCQUFPLFVBQVUsT0FBTyxXQUFXLFdBQVcsU0FBUztBQUFBLFFBQ3pELFNBQVMsWUFBWTtBQUNuQixrQkFBUSxNQUFNLHlCQUF5QixVQUFVO0FBQ2pELGlCQUFPO0FBQUEsUUFDVDtBQUFBLE1BQ0Y7QUFFQSxhQUFPO0FBQUEsSUFDVCxTQUFTLFdBQVc7QUFDbEIsY0FBUSxNQUFNLDJCQUEyQixTQUFTO0FBQ2xELGFBQU87QUFBQSxJQUNUO0FBQUEsRUFDRjtBQUdBLFNBQU87QUFDVDtBQVdP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QUFLLFNBQVMsS0FBSyxRQUFRO0FBRWpDLFFBQUksMkJBQTJCLFVBQWEsMkJBQTJCLEtBQUssU0FBUyx3QkFBd0I7QUFDM0csV0FBSyxvQkFBb0I7QUFBQSxJQUMzQjtBQUNBLFFBQUksaUJBQWlCLFVBQWEsaUJBQWlCLEtBQUssU0FBUyxlQUFlO0FBRzlFLFdBQUssS0FBSyxXQUFXLGVBQWU7QUFDcEMsV0FBSyxXQUFXO0FBQUEsSUFDbEI7QUFFQSxTQUFLLGdCQUFnQjtBQUFBLEVBQ3ZCO0FBQ0Y7IiwKICAibmFtZXMiOiBbImdldEZyb250bWF0dGVyIiwgImltcG9ydF9vYnNpZGlhbiIsICJnZXRGcm9udG1hdHRlciIsICJpc0ZpbGVUeXBlU3VwcG9ydGVkIiwgInNlYXJjaFF1ZXJ5IiwgIl9hIiwgImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAiZ2V0RnJvbnRtYXR0ZXIiLCAiaXNGaWxlVHlwZVN1cHBvcnRlZCIsICJzdWdnZXN0aW9ucyIsICJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJRdWlja1N3aXRjaE1vZGFsIiwgIlF1aWNrU3dpdGNoTW9kYWwiLCAiaW1wb3J0X29ic2lkaWFuIiwgImFjdGl2ZVZpZXciLCAiZ2V0RnJvbnRtYXR0ZXIiLCAiaXNGaWxlVHlwZVN1cHBvcnRlZCIsICJpbXBvcnRfb2JzaWRpYW4iLCAibm9kZSIsICJpbXBvcnRfb2JzaWRpYW4iLCAiZ2V0RnJvbnRtYXR0ZXIiLCAiaXNGaWxlVHlwZVN1cHBvcnRlZCIsICJfYSIsICJpbXBvcnRfb2JzaWRpYW4iLCAiZ2V0RnJvbnRtYXR0ZXIiLCAiaXNGaWxlVHlwZVN1cHBvcnRlZCIsICJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIiwgIl9hIl0KfQo=
